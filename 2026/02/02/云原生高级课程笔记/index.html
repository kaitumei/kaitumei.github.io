<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>云原生-Linux的高级部分笔记 | Yumi-an</title><meta name="author" content="Kaitumei,zhangsan@example.com"><meta name="copyright" content="Kaitumei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="26-1-13 (复习)1.什么是内核、什么是shell、什么是Linux、什么是开源？ 内核、shell、linux、开源的概念  内核：是操作系统的核心组件，是硬件与软件的“桥梁”，夜视整个操作系统的基石 Shell：是用户与内核之间的交互界面，也可以理解为 “命令解释器”，你之前提到的 Linux Shell 脚本，就是基于它来写的。 开源：是一种软件的授权模式，和 “闭源” 相对，核心是源">
<meta property="og:type" content="article">
<meta property="og:title" content="云原生-Linux的高级部分笔记">
<meta property="og:url" content="http://kaitumei.2345.plus/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Yumi-an">
<meta property="og:description" content="26-1-13 (复习)1.什么是内核、什么是shell、什么是Linux、什么是开源？ 内核、shell、linux、开源的概念  内核：是操作系统的核心组件，是硬件与软件的“桥梁”，夜视整个操作系统的基石 Shell：是用户与内核之间的交互界面，也可以理解为 “命令解释器”，你之前提到的 Linux Shell 脚本，就是基于它来写的。 开源：是一种软件的授权模式，和 “闭源” 相对，核心是源">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://b5dbf24.webp.li/icons/yunyuansheng.png">
<meta property="article:published_time" content="2026-02-02T10:00:00.000Z">
<meta property="article:modified_time" content="2026-02-06T16:38:47.694Z">
<meta property="article:author" content="Kaitumei">
<meta property="article:tag" content="云原生">
<meta property="article:tag" content="liunx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://b5dbf24.webp.li/icons/yunyuansheng.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "云原生-Linux的高级部分笔记",
  "url": "http://kaitumei.2345.plus/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/",
  "image": "https://b5dbf24.webp.li/icons/yunyuansheng.png",
  "datePublished": "2026-02-02T10:00:00.000Z",
  "dateModified": "2026-02-06T16:38:47.694Z",
  "author": [
    {
      "@type": "Person",
      "name": "Kaitumei",
      "url": "https://kaitumei.2345.plus"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://kaitumei.2345.plus/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '云原生-Linux的高级部分笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_5123065_5ok3ezt9tok.css"><link rel="stylesheet" href="/css/custom-loader.css"><link rel="stylesheet" href="/css/custom-nav.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/custom-music.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="/css/progress_bar.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/categoryBar/categoryBar.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(https://b5dbf24.webp.li/icons/nini.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/tx.jpg" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items visible"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-fenxiang"></i><span> 分享</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/resources/"><i class="fa-fw iconfont icon-diannao"></i><span> 资源</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-baoxiang-"></i><span> 藏宝阁</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/project/"><i class="fa-fw iconfont icon-xiangmu"></i><span> 项目</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-xianhuaduihuanquan"></i><span> 百宝袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/play/animei/"><span> 追番</span></a></li><li><a class="site-page child" href="/play/games/"><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(https://b5dbf24.webp.li/icons/yunyuansheng.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/" title="Yumi-an"><span class="site-name">Yumi-an</span></a></span><div id="menus"><div class="menus_items visible"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-fenxiang"></i><span> 分享</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/resources/"><i class="fa-fw iconfont icon-diannao"></i><span> 资源</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-baoxiang-"></i><span> 藏宝阁</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/project/"><i class="fa-fw iconfont icon-xiangmu"></i><span> 项目</span></a></li></ul></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw iconfont icon-xianhuaduihuanquan"></i><span> 百宝袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/play/animei/"><span> 追番</span></a></li><li><a class="site-page child" href="/play/games/"><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div><div id="name-container"><a id="page-name" href="javascript:btf.scrollToDest(0, 500)">PAGE_NAME</a></div><div id="nav-right"><div id="travellings"><a class="site-page" href="https://www.travellings.cn/go.html" title="友链接力-随机开往" target="_blank" rel="noopener"><i class="fa-solid fa-bus fa-fw"></i></a></div><div id="ten-years"><a class="site-page" href="https://foreverblog.cn/go.html" title="友链接力-十年之约" target="_blank" rel="noopener"><i class="fa-brands fa-nfc-symbol fa-fw"></i></a></div><div id="random"><a class="site-page" href="javascript:toRandomPost()" title="随机前往一个文章"><i class="fa-solid fa-shuffle fa-fw"></i></a></div><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="站内搜索"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="展开菜单"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">云原生-Linux的高级部分笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-02T10:00:00.000Z" title="发表于 2026-02-02 10:00:00">2026-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-06T16:38:47.694Z" title="更新于 2026-02-06 16:38:47">2026-02-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">21.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>113分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-06 16:38:47&quot;}" hidden></div><h1 id="26-1-13-复习"><a href="#26-1-13-复习" class="headerlink" title="26-1-13 (复习)"></a>26-1-13 (复习)</h1><h2 id="1-什么是内核、什么是shell、什么是Linux、什么是开源？"><a href="#1-什么是内核、什么是shell、什么是Linux、什么是开源？" class="headerlink" title="1.什么是内核、什么是shell、什么是Linux、什么是开源？"></a>1.什么是内核、什么是shell、什么是Linux、什么是开源？</h2><blockquote>
<p><strong>内核、shell、linux、开源的概念</strong></p>
</blockquote>
<p><strong>内核</strong>：是操作系统的核心组件，是硬件与软件的“桥梁”，夜视整个操作系统的基石</p>
<p><strong>Shell</strong>：是<strong>用户与内核之间的交互界面</strong>，也可以理解为 “命令解释器”，你之前提到的 Linux Shell 脚本，就是基于它来写的。</p>
<p><strong>开源</strong>：是一种<strong>软件的授权模式</strong>，和 “闭源” 相对，核心是<strong>源代码公开</strong>。</p>
<h2 id="2-Linux中命令录入方式"><a href="#2-Linux中命令录入方式" class="headerlink" title="2.Linux中命令录入方式"></a>2.Linux中命令录入方式</h2><h3 id="2-1-命令行快捷键"><a href="#2-1-命令行快捷键" class="headerlink" title="2.1.命令行快捷键"></a>2.1.命令行快捷键</h3><h4 id="2-1-1-光标移动快捷键"><a href="#2-1-1-光标移动快捷键" class="headerlink" title="2.1.1.光标移动快捷键"></a>2.1.1.光标移动快捷键</h4><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Ctrl + A</code></td>
<td align="center">光标跳到<strong>命令行开头</strong></td>
</tr>
<tr>
<td align="center"><code>Ctrl + E</code></td>
<td align="center">光标跳到<strong>命令行结尾</strong></td>
</tr>
<tr>
<td align="center"><code>Alt + F</code></td>
<td align="center">光标<strong>向右跳一个单词</strong>（按空格分隔的单位）</td>
</tr>
<tr>
<td align="center"><code>Alt + B</code></td>
<td align="center">光标<strong>向左跳一个单词</strong></td>
</tr>
<tr>
<td align="center"><code>Ctrl + ←</code></td>
<td align="center">等价于 <code>Alt + B</code>（部分终端支持）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + →</code></td>
<td align="center">等价于 <code>Alt + F</code>（部分终端支持）</td>
</tr>
</tbody></table>
<h4 id="2-1-2-命令编辑快捷键"><a href="#2-1-2-命令编辑快捷键" class="headerlink" title="2.1.2.命令编辑快捷键"></a>2.1.2.命令编辑快捷键</h4><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Ctrl + U</code></td>
<td align="center">删除<strong>光标左侧的所有字符</strong>（清空到行首）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + K</code></td>
<td align="center">删除<strong>光标右侧的所有字符</strong>（清空到行尾）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + W</code></td>
<td align="center">删除<strong>光标左侧的一个单词</strong></td>
</tr>
<tr>
<td align="center"><code>Alt + D</code></td>
<td align="center">删除<strong>光标右侧的一个单词</strong></td>
</tr>
<tr>
<td align="center"><code>Ctrl + Y</code></td>
<td align="center">粘贴之前用 <code>Ctrl+U/K/W</code> 删除的内容（剪贴板复用）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + H</code></td>
<td align="center">等同于<strong>退格键</strong>（删除光标前一个字符）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + T</code></td>
<td align="center">交换<strong>光标前两个字符</strong>的位置（输错字符时超实用）</td>
</tr>
</tbody></table>
<h4 id="2-1-3-历史命令快捷键"><a href="#2-1-3-历史命令快捷键" class="headerlink" title="2.1.3.历史命令快捷键"></a>2.1.3.历史命令快捷键</h4><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>↑</code> &#x2F; <code>↓</code></td>
<td align="center">向上 &#x2F; 向下翻找历史命令（按输入顺序）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + R</code></td>
<td align="center"><strong>搜索历史命令</strong>（输入关键词，会自动匹配最近的命令，按 <code>Ctrl+R</code> 继续找更早的）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + G</code></td>
<td align="center">退出 <code>Ctrl+R</code> 的搜索模式，回到当前命令行</td>
</tr>
<tr>
<td align="center"><code>!!</code></td>
<td align="center">快速执行<strong>上一条命令</strong>（比翻箭头更快）</td>
</tr>
<tr>
<td align="center"><code>!n</code></td>
<td align="center">执行历史命令中第 <code>n</code> 条（<code>history</code> 命令可查看历史列表及序号）</td>
</tr>
<tr>
<td align="center"><code>!字符</code></td>
<td align="center">执行最近一次以该<strong>字符开头</strong>的命令（例：<code>!ls</code> 执行最近的 <code>ls</code> 命令）</td>
</tr>
<tr>
<td align="center"><code>Alt + .</code></td>
<td align="center">粘贴<strong>上一条命令的最后一个参数</strong>（例：上一条是 <code>cp a.txt /home</code>，按后直接出现 <code>/home</code>）</td>
</tr>
</tbody></table>
<h4 id="2-1-4-进程控制快捷键"><a href="#2-1-4-进程控制快捷键" class="headerlink" title="2.1.4.进程控制快捷键"></a>2.1.4.进程控制快捷键</h4><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Ctrl + C</code></td>
<td align="center"><strong>强制终止</strong>当前正在运行的命令（最常用，比如命令卡死时）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + Z</code></td>
<td align="center">把当前命令<strong>挂起</strong>（放到后台暂停），用 <code>fg</code> 命令可恢复到前台</td>
</tr>
<tr>
<td align="center"><code>Ctrl + D</code></td>
<td align="center">退出当前 Shell 会话（等价于输入 <code>exit</code> 命令）</td>
</tr>
</tbody></table>
<h4 id="2-1-5-终端操作快捷键"><a href="#2-1-5-终端操作快捷键" class="headerlink" title="2.1.5.终端操作快捷键"></a>2.1.5.终端操作快捷键</h4><table>
<thead>
<tr>
<th align="center">快捷键</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Ctrl + L</code></td>
<td align="center">清空终端屏幕（等价于输入 <code>clear</code> 命令，不会删除历史命令）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + Shift + C</code></td>
<td align="center">复制终端中选中的内容（图形化终端模拟器适用）</td>
</tr>
<tr>
<td align="center"><code>Ctrl + Shift + V</code></td>
<td align="center">粘贴复制的内容到终端（图形化终端模拟器适用）</td>
</tr>
</tbody></table>
<h4 id="2-1-6-Linux-Bash-命令行快捷键速查表"><a href="#2-1-6-Linux-Bash-命令行快捷键速查表" class="headerlink" title="2.1.6.Linux Bash 命令行快捷键速查表"></a>2.1.6.Linux Bash 命令行快捷键速查表</h4><table>
<thead>
<tr>
<th>分类</th>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>光标移动</strong></td>
<td><code>Ctrl + A</code></td>
<td>跳到命令行开头</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + E</code></td>
<td>跳到命令行结尾</td>
</tr>
<tr>
<td></td>
<td><code>Alt + F</code></td>
<td>向右跳一个单词</td>
</tr>
<tr>
<td></td>
<td><code>Alt + B</code></td>
<td>向左跳一个单词</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + ←</code></td>
<td>向左跳一个单词（部分终端支持）</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + →</code></td>
<td>向右跳一个单词（部分终端支持）</td>
</tr>
<tr>
<td><strong>命令编辑</strong></td>
<td><code>Ctrl + U</code></td>
<td>删除光标左侧所有字符</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + K</code></td>
<td>删除光标右侧所有字符</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + W</code></td>
<td>删除光标左侧一个单词</td>
</tr>
<tr>
<td></td>
<td><code>Alt + D</code></td>
<td>删除光标右侧一个单词</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + Y</code></td>
<td>粘贴之前删除的内容</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + H</code></td>
<td>等同于退格键</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + T</code></td>
<td>交换光标前两个字符</td>
</tr>
<tr>
<td><strong>历史命令</strong></td>
<td><code>↑</code> &#x2F; <code>↓</code></td>
<td>向上 &#x2F; 向下翻历史命令</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + R</code></td>
<td>搜索历史命令（按 <code>Ctrl+R</code> 继续找更早的）</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + G</code></td>
<td>退出历史命令搜索模式</td>
</tr>
<tr>
<td></td>
<td><code>!!</code></td>
<td>执行上一条命令</td>
</tr>
<tr>
<td></td>
<td><code>!n</code></td>
<td>执行历史命令列表中第 <code>n</code> 条</td>
</tr>
<tr>
<td></td>
<td><code>!字符</code></td>
<td>执行最近一次以该字符开头的命令</td>
</tr>
<tr>
<td></td>
<td><code>Alt + .</code></td>
<td>粘贴上一条命令的最后一个参数</td>
</tr>
<tr>
<td><strong>进程控制</strong></td>
<td><code>Ctrl + C</code></td>
<td>强制终止当前运行的命令</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + Z</code></td>
<td>挂起当前命令（后台暂停，<code>fg</code> 可恢复）</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + D</code></td>
<td>退出当前 Shell 会话</td>
</tr>
<tr>
<td><strong>终端操作</strong></td>
<td><code>Ctrl + L</code></td>
<td>清空终端屏幕</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + Shift + C</code></td>
<td>复制选中内容（图形化终端适用）</td>
</tr>
<tr>
<td></td>
<td><code>Ctrl + Shift + V</code></td>
<td>粘贴内容到终端（图形化终端适用）</td>
</tr>
</tbody></table>
<h2 id="3-命令行中如何获得帮助"><a href="#3-命令行中如何获得帮助" class="headerlink" title="3.命令行中如何获得帮助"></a>3.命令行中如何获得帮助</h2><blockquote>
<p>命令 –help  </p>
<p>man 命令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启监控</span></span><br><span class="line">watch -n 1 <span class="built_in">ls</span> -Rl</span><br></pre></td></tr></table></figure>



<h2 id="4-linux上下文管理"><a href="#4-linux上下文管理" class="headerlink" title="4.linux上下文管理"></a>4.linux上下文管理</h2><h3 id="4-1-常见命令表"><a href="#4-1-常见命令表" class="headerlink" title="4.1.常见命令表"></a>4.1.常见命令表</h3><p>Linux 下文件管理是系统操作的核心内容，常用命令覆盖<strong>文件 &#x2F; 目录的创建、查看、复制、移动、删除、权限修改</strong>等场景。以下是整理的常用命令表，按功能分类并附关键参数说明：</p>
<table>
<thead>
<tr>
<th align="center">命令分类</th>
<th align="center">命令</th>
<th align="center">功能说明</th>
<th align="center">常用参数 &amp; 示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>目录操作</strong></td>
<td align="center"><code>pwd</code></td>
<td align="center">显示当前工作目录的绝对路径</td>
<td align="center">无参数示例：<code>pwd</code> → <code>/home/user</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>cd</code></td>
<td align="center">切换工作目录</td>
<td align="center">- <code>cd ~</code>：切换到当前用户家目录- <code>cd ..</code>：切换到上级目录- <code>cd /usr/local</code>：切换到指定绝对路径</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>ls</code></td>
<td align="center">列出目录下的文件和子目录</td>
<td align="center">- <code>-l</code>：以长格式显示（权限、大小、时间等）- <code>-a</code>：显示隐藏文件（以 <code>.</code> 开头的文件）- <code>-h</code>：人性化显示文件大小（KB&#x2F;MB&#x2F;GB）示例：<code>ls -lah</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>mkdir</code></td>
<td align="center">创建新目录</td>
<td align="center">- <code>-p</code>：递归创建多级目录示例：<code>mkdir -p /tmp/test/abc</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>rmdir</code></td>
<td align="center">删除空目录</td>
<td align="center">仅能删除空目录示例：<code>rmdir /tmp/test/abc</code></td>
</tr>
<tr>
<td align="center"><strong>文件操作</strong></td>
<td align="center"><code>touch</code></td>
<td align="center">创建空文件或修改文件时间戳</td>
<td align="center">示例：<code>touch newfile.txt</code> → 创建空文件</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>cp</code></td>
<td align="center">复制文件或目录</td>
<td align="center">- <code>-r</code>：递归复制目录（必选参数）- <code>-f</code>：强制覆盖目标文件示例 1：<code>cp file.txt /tmp/</code> → 复制文件示例 2：<code>cp -r dir1 /tmp/</code> → 复制目录</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>mv</code></td>
<td align="center">移动 &#x2F; 重命名文件或目录</td>
<td align="center">同一目录下执行是重命名，跨目录是移动示例 1：<code>mv oldname.txt newname.txt</code> → 重命名示例 2：<code>mv file.txt /tmp/</code> → 移动文件</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>rm</code></td>
<td align="center">删除文件或目录</td>
<td align="center">- <code>-r</code>：递归删除目录- <code>-f</code>：强制删除，不提示确认<strong>危险命令</strong>：<code>rm -rf /</code>（切勿执行！会删除系统所有文件）示例：<code>rm -rf dir1</code> → 删除目录及所有内容</td>
</tr>
<tr>
<td align="center"><strong>文件查看</strong></td>
<td align="center"><code>cat</code></td>
<td align="center">查看文件全部内容（适合小文件）</td>
<td align="center">- <code>-n</code>：显示行号示例：<code>cat -n /etc/hosts</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>more</code></td>
<td align="center">分页查看大文件（只能向下翻页）</td>
<td align="center">示例：<code>more /var/log/messages</code> → 按空格翻页，<code>q</code> 退出</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>less</code></td>
<td align="center">分页查看大文件（可上下翻页）</td>
<td align="center">示例：<code>less /var/log/syslog</code> → 按 <code>↑/↓</code> 滚动，<code>q</code> 退出</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>head</code></td>
<td align="center">查看文件前 N 行（默认前 10 行）</td>
<td align="center"><code>-n</code>：指定行数示例：<code>head -n 5 file.txt</code> → 查看前 5 行</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>tail</code></td>
<td align="center">查看文件后 N 行（默认后 10 行）</td>
<td align="center">- <code>-n</code>：指定行数- <code>-f</code>：实时跟踪文件新增内容（日志监控常用）示例 1：<code>tail -n 20 log.txt</code> → 查看后 20 行示例 2：<code>tail -f /var/log/nginx/access.log</code> → 实时监控日志</td>
</tr>
<tr>
<td align="center"><strong>权限管理</strong></td>
<td align="center"><code>chmod</code></td>
<td align="center">修改文件 &#x2F; 目录的权限</td>
<td align="center">两种方式：1. 符号法：<code>chmod u+x file.sh</code>（给所有者加执行权限）2. 数字法：<code>chmod 755 file.sh</code>（r&#x3D;4,w&#x3D;2,x&#x3D;1，7&#x3D;4+2+1）常用权限：755（用户可读可写可执行，其他只读可执行）、644（用户可读可写，其他只读）</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>chown</code></td>
<td align="center">修改文件 &#x2F; 目录的所有者和所属组</td>
<td align="center">- <code>-R</code>：递归修改目录权限示例：<code>chown -R user:group /home/user/data</code></td>
</tr>
<tr>
<td align="center"><strong>文件查找</strong></td>
<td align="center"><code>find</code></td>
<td align="center">按路径、名称、大小等条件查找文件</td>
<td align="center">- 按名称：<code>find /tmp -name &quot;*.txt&quot;</code> → 查找 tmp 下所有 txt 文件- 按大小：<code>find / -size +100M</code> → 查找系统中大于 100M 的文件- 按类型：<code>find /home -type d</code> → 查找 home 下所有目录</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>which</code></td>
<td align="center">查找命令的可执行文件路径</td>
<td align="center">示例：<code>which ls</code> → <code>/usr/bin/ls</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"><code>locate</code></td>
<td align="center">快速查找文件（基于数据库索引）</td>
<td align="center">需先更新数据库：<code>updatedb</code>示例：<code>locate passwd</code> → 查找所有含 passwd 的文件</td>
</tr>
<tr>
<td align="center"><strong>文件链接</strong></td>
<td align="center"><code>ln</code></td>
<td align="center">创建硬链接或软链接</td>
<td align="center">- 软链接（常用）：<code>ln -s /path/source /path/link</code> → 类似快捷方式- 硬链接：<code>ln /path/source /path/link</code> → 与源文件共享 inode</td>
</tr>
</tbody></table>
<hr>
<h3 id="4-2-补充说明"><a href="#4-2-补充说明" class="headerlink" title="4.2.补充说明"></a>4.2.补充说明</h3><ol>
<li><strong>隐藏文件</strong>：Linux 中以 <code>.</code> 开头的文件为隐藏文件，需用 <code>ls -a</code> 查看。</li>
<li>绝对路径 vs 相对路径<ul>
<li>绝对路径：从根目录 <code>/</code> 开始，如 <code>/home/user/file.txt</code></li>
<li>相对路径：相对于当前目录，如 <code>../file.txt</code>（上级目录的文件）</li>
</ul>
</li>
<li><strong>权限符号含义</strong>：<code>r</code>（读，4）、<code>w</code>（写，2）、<code>x</code>（执行，1），权限分三类：<code>u</code>（所有者）、<code>g</code>（所属组）、<code>o</code>（其他用户）。</li>
</ol>
<h2 id="5-文件批处理"><a href="#5-文件批处理" class="headerlink" title="5.文件批处理"></a>5.文件批处理</h2><h3 id="5-1-Linux-文件批处理命令表"><a href="#5-1-Linux-文件批处理命令表" class="headerlink" title="5.1.Linux 文件批处理命令表"></a>5.1.Linux 文件批处理命令表</h3><table>
<thead>
<tr>
<th align="center">批处理命令 &#x2F; 核心语法</th>
<th align="center">核心用途</th>
<th align="center">批处理示例（场景 + 执行命令）</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>for 循环</code></td>
<td align="center">遍历指定文件 &#x2F; 目录，执行自定义批处理操作（新手易理解）</td>
<td align="center"><strong>场景</strong>：批量将当前目录下所有 <code>.txt</code> 文件重命名为 <code>.bak``bash&lt;br&gt;for f in *.txt; do mv &quot;$f&quot; &quot;$&#123;f%.txt&#125;.bak&quot;; done&lt;br&gt;</code>（<code>$&#123;f%.txt&#125;</code> 表示去掉文件名后缀 <code>.txt</code>）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>find + xargs</code></td>
<td align="center">高效查找文件并批量执行命令（适合大量文件）</td>
<td align="center"><strong>场景</strong>：批量删除当前目录及子目录下所有 <code>.log</code> 文件&#96;&#96;&#96;bashfind . -type f -name “*.log”</td>
<td align="center">xargs rm -f&#96;&#96;&#96;（<code>-type f</code> 限定文件，<code>-f</code> 强制删除，避免确认）</td>
</tr>
<tr>
<td align="center"><code>mv</code>（批量重命名）</td>
<td align="center">基础批量重命名 &#x2F; 移动文件</td>
<td align="center"><strong>场景</strong>：批量将 <code>file1.txt</code>、<code>file2.txt</code> 移动到 <code>backup</code> 目录<code>bash&lt;br&gt;mv file*.txt backup/&lt;br&gt;</code></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>cp</code>（批量复制）</td>
<td align="center">批量复制文件到指定目录 &#x2F; 批量备份文件</td>
<td align="center"><strong>场景</strong>：批量复制当前目录下所有 <code>.sh</code> 脚本到 <code>/usr/local/bin``bash&lt;br&gt;cp *.sh /usr/local/bin/&lt;br&gt;</code></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>rm</code>（批量删除）</td>
<td align="center">批量删除指定类型 &#x2F; 条件的文件（谨慎使用）</td>
<td align="center"><strong>场景</strong>：批量删除当前目录下所有空文件（大小为 0）<code>bash&lt;br&gt;rm -f $(find . -type f -size 0)&lt;br&gt;</code></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>sed</code>（批量替换内容）</td>
<td align="center">批量修改多个文件内的文本内容</td>
<td align="center"><strong>场景</strong>：批量将所有 <code>.conf</code> 文件中的 <code>old_ip</code> 替换为 <code>192.168.1.1``bash&lt;br&gt;sed -i &#39;s/old_ip/192.168.1.1/g&#39; *.conf&lt;br&gt;</code>（<code>-i</code> 直接修改文件，<code>g</code> 全局替换）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>rename</code>（专用重命名）</td>
<td align="center">更简洁的批量重命名（支持正则）</td>
<td align="center"><strong>场景</strong>：批量将所有文件名中的 <code>test</code> 替换为 <code>prod</code>（如 test1.txt → prod1.txt）<code>bash&lt;br&gt;rename &#39;s/test/prod/&#39; *.txt&lt;br&gt;</code>（需先安装：<code>apt install rename</code>&#x2F;<code>yum install rename</code>）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>awk</code>（批量处理内容）</td>
<td align="center">批量提取 &#x2F; 筛选文件中的指定数据</td>
<td align="center"><strong>场景</strong>：批量提取所有 <code>.csv</code> 文件中第 2 列的内容并保存到 <code>result.txt``bash&lt;br&gt;awk -F &#39;,&#39; &#39;&#123;print $2&#125;&#39; *.csv &gt; result.txt&lt;br&gt;</code>（<code>-F &#39;,&#39;</code> 指定分隔符为逗号）</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="5-2-正则表达式符号-字符类-命令表"><a href="#5-2-正则表达式符号-字符类-命令表" class="headerlink" title="5.2.正则表达式符号 &#x2F; 字符类 命令表"></a>5.2.正则表达式符号 &#x2F; 字符类 命令表</h3><table>
<thead>
<tr>
<th align="center">正则符号（命令）</th>
<th align="center">用途说明</th>
<th align="center">示例（匹配 &#x2F; 不匹配）</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*</code></td>
<td align="center">量词，匹配<strong>前面的字符 &#x2F; 表达式 0 次或多次</strong>（贪婪匹配）</td>
<td align="center"><code>a*</code>：匹配空字符、<code>a</code>、<code>aa</code>、<code>aaa</code>；不匹配 <code>b</code>、<code>1</code>（仅针对前导字符<code>a</code>）例：&#96;echo”aaa b”</td>
<td align="center">grep -o ‘a*’<code>输出</code>aaa<code>、空、</code>b&#96; 旁的空</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="center">量词，匹配<strong>前面的字符 &#x2F; 表达式 0 次或 1 次</strong>（非贪婪匹配）</td>
<td align="center"><code>a?</code>：匹配空字符、<code>a</code>；不匹配 <code>aa</code>、<code>aaa</code>例：&#96;echo”a aa aaa”</td>
<td align="center">grep -o ‘a?’<code>输出</code>a<code>、空、</code>a<code>、</code>a<code>、空、</code>a<code>、</code>a<code>、</code>a<code>、空</code></td>
</tr>
<tr>
<td align="center"><code>[[:alpha:]]</code></td>
<td align="center">匹配任意<strong>字母字符</strong>（包含大小写，多语言环境适配）</td>
<td align="center">匹配：<code>a</code>、<code>B</code>、<code>中</code>（中文环境）；不匹配：<code>1</code>、<code>!</code>、（空格）例：&#96;echo”Ab123 中！”</td>
<td align="center">grep -o ‘[[:alpha:]]’<code>输出</code>A<code>、</code>b<code>、</code>中 &#96;</td>
</tr>
<tr>
<td align="center"><code>[[:digit:]]</code></td>
<td align="center">匹配任意<strong>数字字符</strong>，等价于 [0-9]</td>
<td align="center">匹配：<code>0</code>、<code>5</code>、<code>9</code>；不匹配：<code>a</code>、<code>$</code>、（空格）例：&#96;echo”abc123def”</td>
<td align="center">grep -o ‘[[:digit:]]’<code>输出</code>1<code>、</code>2<code>、</code>3&#96;</td>
</tr>
<tr>
<td align="center"><code>[[:lower:]]</code></td>
<td align="center">匹配任意<strong>小写字母</strong>，等价于 [a-z]</td>
<td align="center">匹配：<code>a</code>、<code>z</code>、<code>m</code>；不匹配：<code>A</code>、<code>1</code>、<code>!</code>例：&#96;echo”AbCdEf123”</td>
<td align="center">grep -o ‘[[:lower:]]’<code>输出</code>b<code>、</code>d<code>、</code>f&#96;</td>
</tr>
<tr>
<td align="center"><code>[[:upper:]]</code></td>
<td align="center">匹配任意<strong>大写字母</strong>，等价于 [A-Z]</td>
<td align="center">匹配：<code>A</code>、<code>Z</code>、<code>M</code>；不匹配：<code>a</code>、<code>9</code>、<code>@</code>例：&#96;echo”AbCdEf123”</td>
<td align="center">grep -o ‘[[:upper:]]’<code>输出</code>A<code>、</code>C<code>、</code>E&#96;</td>
</tr>
<tr>
<td align="center"><code>[[:alnum:]]</code></td>
<td align="center">匹配任意<strong>字母或数字字符</strong>，等价于 [a-zA-Z0-9]</td>
<td align="center">匹配：<code>a</code>、<code>B</code>、<code>8</code>；不匹配：<code>!</code>、（空格）、<code>@</code>例：&#96;echo”abc123!@#”</td>
<td align="center">grep -o ‘[[:alnum:]]’<code>输出</code>a<code>、</code>b<code>、</code>c<code>、</code>1<code>、</code>2<code>、</code>3&#96;</td>
</tr>
<tr>
<td align="center"><code>[[:punct:]]</code></td>
<td align="center">匹配任意<strong>标点符号</strong>（非字母、数字、空白的可打印字符）</td>
<td align="center">匹配：<code>!</code>、<code>@</code>、<code>#</code>、<code>,</code>、<code>.</code>、<code>:</code>；不匹配：<code>a</code>、<code>5</code>、（空格）例：&#96;echo”abc!123@def”</td>
<td align="center">grep -o ‘[[:punct:]]’<code>输出</code>!<code>、</code>@&#96;</td>
</tr>
<tr>
<td align="center"><code>[[:space:]]</code></td>
<td align="center">匹配任意<strong>空白字符</strong>（空格、制表符 \t、换行符 \n 等）</td>
<td align="center">匹配：（空格）、<code>\t</code>（制表符）、<code>\n</code>（换行）；不匹配：<code>a</code>、<code>9</code>、<code>!</code>例：&#96;echo”a b\tc\nd”</td>
<td align="center">grep -o ‘[[:space:]]’<code> 输出 空格、</code>\t<code>、</code>\n&#96;</td>
</tr>
</tbody></table>
<h3 id="5-3-补充说明"><a href="#5-3-补充说明" class="headerlink" title="5.3.补充说明"></a>5.3.补充说明</h3><ol>
<li>示例中的 <code>grep -o</code> 是终端常用命令，<code>-o</code> 参数表示 “只输出匹配到的部分”，新手可直接复制命令到终端执行，直观看到效果；</li>
<li>部分字符类（如 <code>[[:alpha:]]</code>）在中文 &#x2F; 多语言系统中可匹配非英文字母（如中文、日文），而 <code>[a-zA-Z]</code> 仅匹配英文字母，这是 POSIX 字符类的优势。</li>
</ol>
<h3 id="5-4-总结"><a href="#5-4-总结" class="headerlink" title="5.4.总结"></a>5.4.总结</h3><ol>
<li><code>*</code>&#x2F;<code>?</code> 是<strong>量词</strong>，示例核心看 “前导字符的匹配次数”，而非匹配特定字符；</li>
<li><code>[[:xxx:]]</code> 字符类的示例需区分 “匹配 &#x2F; 不匹配”，快速掌握字符范围；</li>
<li>结合 <code>grep -o</code> 命令可直接验证示例效果，是新手学习正则的高效方式。</li>
</ol>
<h2 id="6-Linux中的输入和输出"><a href="#6-Linux中的输入和输出" class="headerlink" title="6.Linux中的输入和输出"></a>6.Linux中的输入和输出</h2><h3 id="6-1-字符设备是啥？"><a href="#6-1-字符设备是啥？" class="headerlink" title="6.1.字符设备是啥？"></a>6.1.字符设备是啥？</h3><p>在 Linux 系统中，<strong>字符设备（Character Device）</strong> 是一类以<strong>字符流（字节流）</strong> 为单位进行数据传输的硬件设备，也是 Linux 设备文件的两大核心分类之一（另一类是块设备）。</p>
<p><strong>与块设备的核心区别</strong></p>
<table>
<thead>
<tr>
<th align="center">特性</th>
<th align="center">字符设备</th>
<th align="center">块设备</th>
</tr>
</thead>
<tbody><tr>
<td align="center">访问单位</td>
<td align="center">字节（字符流）</td>
<td align="center">固定大小的块（通常 512B&#x2F;4KB）</td>
</tr>
<tr>
<td align="center">访问方式</td>
<td align="center">串行、顺序访问，不支持随机访问</td>
<td align="center">支持随机访问（可跳转到任意块）</td>
</tr>
<tr>
<td align="center">缓冲区</td>
<td align="center">无缓冲或小缓冲</td>
<td align="center">有较大的内存缓冲区（提升读写效率）</td>
</tr>
<tr>
<td align="center">文件类型标识</td>
<td align="center"><code>c</code></td>
<td align="center"><code>b</code></td>
</tr>
<tr>
<td align="center">典型设备</td>
<td align="center">键盘、鼠标、串口</td>
<td align="center">硬盘、U 盘、SD 卡</td>
</tr>
</tbody></table>
<h3 id="6-2-输入与输出"><a href="#6-2-输入与输出" class="headerlink" title="6.2.输入与输出"></a>6.2.输入与输出</h3><p>在 Linux 系统中，<strong>输入（Input）和输出（Output）的核心原理围绕 “一切皆文件” 思想展开</strong>，本质是<strong>用户程序通过内核提供的接口，对文件描述符进行读写操作</strong>，内核再作为中介完成用户程序与硬件设备的交互。</p>
<p>Linux 把所有输入输出设备都抽象成<strong>文件</strong>，用户程序无需关心硬件细节，只需通过<strong>文件描述符（File Descriptor，FD）</strong> 来标识和操作这些 “文件”。</p>
<ol>
<li><p><strong>文件描述符</strong></p>
<p>是一个非负整数，内核用它来索引和管理打开的文件（包括硬件设备、普通文件、管道等）。</p>
<p>系统默认分配 3 个标准文件描述符，供所有进程使用：</p>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">文件描述符</th>
<th align="left">名称</th>
<th align="left">对应设备 &#x2F; 用途</th>
<th align="left">缩写</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">标准输入</td>
<td align="left">键盘、管道输入等</td>
<td align="left">stdin</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">标准输出</td>
<td align="left">终端、管道输出等</td>
<td align="left">stdout</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">标准错误</td>
<td align="left">终端（专门输出错误信息）</td>
<td align="left">stderr</td>
</tr>
</tbody></table>
<ol start="2">
<li><p><strong>核心原则</strong></p>
<p> 输入 &#x3D; 从文件描述符 <strong>读取数据</strong>（如从 stdin 读键盘输入）</p>
<p> 输出 &#x3D; 向文件描述符 <strong>写入数据</strong>（如向 stdout 写终端输出）</p>
</li>
<li><p><strong>本质</strong></p>
<p>Linux 输入输出的本质是 <strong>“用户程序 ↔ 内核 ↔ 硬件” 的三层交互模型</strong>：</p>
<ul>
<li>用户程序：通过 <code>read/write</code> 系统调用发起 IO 请求，只操作文件描述符，不碰硬件。</li>
<li>内核：负责管理文件描述符、缓冲区，以及设备驱动，是 IO 交互的核心中介。</li>
<li>硬件：由驱动程序控制，完成数据的物理输入输出（如键盘接收按键、屏幕显示字符）。</li>
</ul>
</li>
</ol>
<h1 id="26-1-14-复习"><a href="#26-1-14-复习" class="headerlink" title="26-1-14 (复习)"></a>26-1-14 (复习)</h1><h2 id="1-Rhel9-6安装"><a href="#1-Rhel9-6安装" class="headerlink" title="1.Rhel9.6安装"></a>1.Rhel9.6安装</h2><p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-20-55.png" alt="PixPin_2026-01-17_11-20-55"></p>
<blockquote>
<p>选项–&gt;高级–&gt;固件类型 改为<strong>BIOS</strong></p>
</blockquote>
<blockquote>
<p>安装源选择 服务器</p>
</blockquote>
<p><strong>虚拟网络配置</strong></p>
<p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-26-38.png" alt="PixPin_2026-01-17_11-26-38"></p>
<p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-26-45.png" alt="PixPin_2026-01-17_11-26-45"></p>
<h2 id="2-Rhel9-6配置"><a href="#2-Rhel9-6配置" class="headerlink" title="2.Rhel9.6配置"></a>2.Rhel9.6配置</h2><h3 id="2-1-关闭安全配置"><a href="#2-1-关闭安全配置" class="headerlink" title="2.1.关闭安全配置"></a>2.1.关闭安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">[root@base ~]# systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.</span><br><span class="line">[root@base ~]# systemctl mask firewalld</span><br><span class="line">Created symlink /etc/systemd/system/firewalld.service → /dev/null.</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭SELiunx</span></span><br><span class="line">[root@base ~]# vim /etc/sysconfig/selinux</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>

<h3 id="2-2-更改网络配置"><a href="#2-2-更改网络配置" class="headerlink" title="2.2.更改网络配置"></a>2.2.更改网络配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# vim /boot/loader/entries/1199b04b0d974659ad491305f98dcfe0-5.14.0-570.12.1.el9_6.x86_64.conf</span><br><span class="line">在quiet 添加 net.ifnames=0</span><br><span class="line">[root@base ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@base system-connections]# <span class="built_in">mv</span> ens160.nmconnection eth0.nmconnection</span><br><span class="line">[root@base system-connections]# vim eth0.nmconnection</span><br><span class="line">修改<span class="built_in">id</span>与interface-name为 eth0</span><br><span class="line">删除uuid</span><br><span class="line"><span class="comment">#如果网卡出问题</span></span><br><span class="line">nmcli connection reload</span><br><span class="line">nmcli connection up eth0</span><br><span class="line">nmcli networking</span><br><span class="line">nmcli networking on</span><br><span class="line">nmcli networking show</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<h3 id="2-3-永久挂载"><a href="#2-3-永久挂载" class="headerlink" title="2.3.永久挂载"></a>2.3.永久挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">mkdir</span> /rhel9</span><br><span class="line">[root@base ~]# mount /dev/cdrom /rhel9/</span><br><span class="line">mount: /rhel9: WARNING: <span class="built_in">source</span> write-protected, mounted read-only.</span><br><span class="line">[root@base ~]# vim /etc/rc.d/rc.local</span><br><span class="line">最后一行添加mount /dev/cdrom /rhel9</span><br><span class="line">[root@base ~]# vim /etc/rc.d/rc.local</span><br><span class="line">[root@base ~]# <span class="built_in">chmod</span> +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<h3 id="2-4-源仓库配置"><a href="#2-4-源仓库配置" class="headerlink" title="2.4.源仓库配置"></a>2.4.源仓库配置</h3><h4 id="2-4-1-本地仓库源"><a href="#2-4-1-本地仓库源" class="headerlink" title="2.4.1.本地仓库源"></a>2.4.1.本地仓库源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">[root@base yum.repos.d]# vim rhel.repo</span><br><span class="line">[AppStarem]</span><br><span class="line">name = AppStream</span><br><span class="line">baseurl = file:///rhel9/AppStream</span><br><span class="line">gpgcheck = 0</span><br><span class="line">[BaseOS]</span><br><span class="line">name = BaseOS</span><br><span class="line">baseurl = file:///rhel9/BaseOS</span><br><span class="line">gpgcheck = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base yum.repos.d]# dnf list httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-网络源"><a href="#2-4-2-网络源" class="headerlink" title="2.4.2.网络源"></a>2.4.2.网络源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker容器的网络源</span></span><br><span class="line">https://mirrors.aliyun.com/docker-ce/linux/rhel/9.6/x86_64/stable/</span><br><span class="line"><span class="comment">#epel源</span></span><br><span class="line">https://mirrors.aliyun.com/epel-archive/9.6-2025-11-11/Everything/x86_64/</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base ~]# dnf search docker</span><br><span class="line">[root@base ~]# dnf search ansible</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-自建仓库源"><a href="#2-4-3-自建仓库源" class="headerlink" title="2.4.3.自建仓库源"></a>2.4.3.自建仓库源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# dnf install httpd -y</span><br><span class="line">[root@base ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line">[root@base ~]# <span class="built_in">mkdir</span> /var/www/html/software</span><br><span class="line">[root@base ~]# dnf install docker-ce --downloadonly --destdir /mnt -y</span><br><span class="line">[root@base ~]# <span class="built_in">mv</span> /mnt/* /var/www/html/software/</span><br><span class="line">[root@base ~]# dnf install createrepo  -y</span><br><span class="line">[root@base ~]# createrepo -v /var/www/html/software/</span><br><span class="line">[root@base yum.repos.d]# vim software.repo</span><br><span class="line">[software]</span><br><span class="line">name = software</span><br><span class="line">baseurl = http://172.25.254.128/software/</span><br><span class="line">gpgcheck = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base ~]# dnf info docker-ce.x86_64</span><br></pre></td></tr></table></figure>

<h1 id="26-1-16-复习"><a href="#26-1-16-复习" class="headerlink" title="26-1-16 (复习)"></a>26-1-16 (复习)</h1><h2 id="1-网络管理"><a href="#1-网络管理" class="headerlink" title="1.网络管理"></a>1.网络管理</h2><h3 id="1-1-网络ip配置"><a href="#1-1-网络ip配置" class="headerlink" title="1.1.网络ip配置"></a>1.1.网络ip配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断网卡是否存在</span></span><br><span class="line">[root@node1 system-connections]# <span class="built_in">ls</span> /sys/class/net/ | grep eth1</span><br><span class="line">eth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断网卡是否被使用</span></span><br><span class="line">[root@node1 system-connections]# nmcli connection show</span><br><span class="line">NAME  UUID                                  TYPE      DEVICE</span><br><span class="line">eth0  7ba00b1d-8cdd-30da-91ad-bb83ed4f7474  ethernet  eth0</span><br><span class="line">lo    d97aa458-8557-4dd1-a224-0167b68b3f84  loopback  lo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改网卡ip</span></span><br><span class="line">[root@node1 ~]# nmcli connection modify eth0 ipv4.addresses 172.25.254.130/24</span><br><span class="line"><span class="comment"># 重新连接网卡</span></span><br><span class="line">[root@node1 system-connections]# nmcli connection reload</span><br><span class="line">[root@node1 system-connections]# nmcli connection up eth0</span><br><span class="line"></span><br><span class="line">[root@node1 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@node1 system-connections]# vim eth1.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=eth1</span><br><span class="line"><span class="built_in">type</span>=ethernet</span><br><span class="line">interface-name=eth1</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1=172.25.254.100/24</span><br><span class="line">gateway=172.25.254.2</span><br><span class="line">dns=114.114.114.114;</span><br><span class="line"></span><br><span class="line">[root@node1 system-connections]# <span class="built_in">chmod</span>  600 eth1.nmconnection</span><br><span class="line"></span><br><span class="line">ip a s eth1		<span class="comment">#查看ip</span></span><br><span class="line">route  -n		<span class="comment">#网关</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf	<span class="comment">#查看dns</span></span><br></pre></td></tr></table></figure>

<p>1.2.网络脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ===================== 参数说明（统一顺序，避免混淆）=====================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 用法: vmset.sh &lt;主机名&gt; &lt;网卡名&gt; &lt;IP地址&gt; [可选参数：nogateway/网关]</span></span><br><span class="line"><span class="comment"># 示例1：带网关（默认172.25.254.2）→ 主网卡用</span></span><br><span class="line"><span class="comment">#    vmset.sh base eth0 172.25.254.100</span></span><br><span class="line"><span class="comment"># 示例2：无网关（避免重复路由）→ 从网卡用</span></span><br><span class="line"><span class="comment">#    vmset.sh base et0 172.25.254.101 nogateway</span></span><br><span class="line"><span class="comment"># 示例3：自定义网关</span></span><br><span class="line"><span class="comment">#    vmset.sh eth0 base 192.168.1.100 192.168.1.1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># =========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.参数效验(至少3个参数：主机名、网卡名、IP地址)</span></span><br><span class="line">[ <span class="variable">$#</span> -lt 3 ] &amp;&amp; &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：请传入至少3个参数!&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh &lt;主机名&gt; &lt;网卡名&gt; &lt;IP地址&gt; [nogateway/网关]&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh haha eth1 172.25.254.100 nogateway&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.变量定义</span></span><br><span class="line">HOSTNAME=<span class="variable">$1</span>       <span class="comment"># 主机名（必填，如base）</span></span><br><span class="line">IFACE=<span class="variable">$2</span>        <span class="comment"># 网卡名（必填，如eth1）</span></span><br><span class="line">IP=<span class="variable">$3</span>             <span class="comment"># IP地址（必填，如172.25.254.100）</span></span><br><span class="line">DEFAULT_GW=<span class="string">&quot;172.25.254.2&quot;</span>    <span class="comment"># nogateway</span></span><br><span class="line">OPTION=<span class="variable">$&#123;4:-<span class="variable">$DEFAULT_GW</span>&#125;</span>     <span class="comment"># 可选参数：nogateway （无网关）或 自定义网关（如172.25.254.2）</span></span><br><span class="line"></span><br><span class="line">CONNECTION=$(nmcli connection show | awk <span class="string">&quot;/<span class="variable">$IFACE</span>/ &#123;print \$1&#125;&quot;</span> | grep <span class="variable">$IFACE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.判断网卡是否使用</span></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span>  ] &amp;&amp; &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IFACE</span> 正在使用!!!&quot;</span></span><br><span class="line">  nmcli connection delete <span class="variable">$CONNECTION</span></span><br><span class="line">&#125; || &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IFACE</span> 未在使用&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.选择网关</span></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$OPTION</span>&quot;</span> = <span class="string">&quot;nogateway&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line"><span class="built_in">cat</span> &gt;  /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string">address1=$IP/24</span></span><br><span class="line"><span class="string">dns=8.8.8.8</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125; || &#123;</span><br><span class="line"><span class="built_in">cat</span> &gt;  /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string">address1=$IP/24,$OPTION</span></span><br><span class="line"><span class="string">dns=8.8.8.8;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.网卡重新加载</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection</span><br><span class="line">nmcli connection reload</span><br><span class="line">nmcli connection up <span class="variable">$IFACE</span></span><br><span class="line">hostnamectl hostname <span class="variable">$HOSTNAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.域名映射</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/hosts&lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string">$IP                 $HOSTNAME</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=====网卡详细信息====&quot;</span></span><br><span class="line">ip a s <span class="variable">$IFACE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====路由表====&quot;</span></span><br><span class="line">route -n</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====主机名====&quot;</span></span><br><span class="line">hostname</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail  <span class="comment"># 严格模式，命令失败直接退出，避免无效配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================== 参数说明（统一顺序，避免混淆）=====================</span></span><br><span class="line"><span class="comment"># 用法：bash vmset.sh &lt;网卡名&gt; &lt;主机名&gt; &lt;IP地址&gt; [可选参数：noroute/网关]</span></span><br><span class="line"><span class="comment"># 示例1：带网关（默认172.25.254.2）→ 主网卡用</span></span><br><span class="line"><span class="comment">#   vmset.sh eth0 base 172.25.254.100</span></span><br><span class="line"><span class="comment"># 示例2：无网关（避免重复路由）→ 从网卡用</span></span><br><span class="line"><span class="comment">#   vmset.sh eth1 base 172.25.254.101 noroute</span></span><br><span class="line"><span class="comment"># 示例3：自定义网关</span></span><br><span class="line"><span class="comment">#   vmset.sh eth0 base 192.168.1.100 192.168.1.1</span></span><br><span class="line"><span class="comment"># =======================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 参数校验（至少3个必填参数：网卡名、主机名、IP地址）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 3 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：请传入至少3个参数！&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh &lt;网卡名&gt; &lt;主机名&gt; &lt;IP地址&gt; [noroute/网关]&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;示例：vmset.sh eth1 base 172.25.254.101 noroute（从网卡，无网关）&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 变量定义（清晰命名，避免混淆）</span></span><br><span class="line">IFACE=<span class="variable">$1</span>          <span class="comment"># 网卡名（必填，如eth1）</span></span><br><span class="line">HOSTNAME=<span class="variable">$2</span>       <span class="comment"># 主机名（必填，如base）</span></span><br><span class="line">IP=<span class="variable">$3</span>             <span class="comment"># IP地址（必填，如172.25.254.100）</span></span><br><span class="line">OPTION=<span class="variable">$&#123;4:-&#125;</span>     <span class="comment"># 可选参数：noroute（无网关）或 自定义网关（如172.25.254.2）</span></span><br><span class="line">DEFAULT_GW=<span class="string">&quot;172.25.2`:w;54.2&quot;</span>  <span class="comment"># 默认网关（可选参数为空时使用）</span></span><br><span class="line">CONN_FILE=<span class="string">&quot;/etc/NetworkManager/system-connections/<span class="variable">$&#123;IFACE&#125;</span>.nmconnection&quot;</span>  <span class="comment"># 配置文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 基础校验（避免低级错误）</span></span><br><span class="line"><span class="comment"># 3.1 检查网卡是否真实存在</span></span><br><span class="line"><span class="keyword">if</span> ! ip <span class="built_in">link</span> show <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：网卡 <span class="variable">$IFACE</span> 不存在！请检查网卡名是否正确&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.2 检查IP格式是否合法（避免输错IP）</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> | grep -E <span class="string">&#x27;^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&#x27;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：IP地址 <span class="variable">$IP</span> 格式非法！请输入正确的IPv4地址&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 处理可选参数（确定网关是否启用）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$OPTION</span>&quot;</span> = <span class="string">&quot;noroute&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  GW=<span class="string">&quot;&quot;</span>  <span class="comment"># 无网关（从网卡用，避免重复路由）</span></span><br><span class="line">  DNS=<span class="string">&quot;&quot;</span> <span class="comment"># 无网关时不配置DNS</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 可选参数为自定义网关，或使用默认网关</span></span><br><span class="line">  GW=<span class="variable">$&#123;OPTION:-<span class="variable">$DEFAULT_GW</span>&#125;</span></span><br><span class="line">  DNS=<span class="string">&quot;8.8.8.8;&quot;</span>  <span class="comment"># 有网关时配置DNS</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 删除网卡已有连接（避免配置冲突，精确匹配连接名）</span></span><br><span class="line">CONNECTION=$(nmcli connection show | awk -v iface=<span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> <span class="string">&#x27;$1 == iface &#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ 正在删除网卡 <span class="variable">$IFACE</span> 的已有连接：<span class="variable">$CONNECTION</span>&quot;</span></span><br><span class="line">  nmcli connection delete <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span> || &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;错误：删除连接 <span class="variable">$CONNECTION</span> 失败！&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 生成NetworkManager配置文件（覆盖写入，避免重复配置段）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 生成网卡 <span class="variable">$IFACE</span> 的配置文件：<span class="variable">$CONN_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="string">&quot;<span class="variable">$CONN_FILE</span>&quot;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string">autoconnect=true  # 开机自动激活网卡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string"># 配置IP和网关（无网关时仅写IP）</span></span><br><span class="line"><span class="string">address1=$IP/24$( [ -n &quot;$GW&quot; ] &amp;&amp; echo &quot;,$GW&quot; || &quot;&quot; )</span></span><br><span class="line"><span class="string">dns=$DNS</span></span><br><span class="line"><span class="string">ignore-auto-dns=true  # 忽略自动分配的DNS</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 配置文件权限（NetworkManager要求必须是600，否则报错）</span></span><br><span class="line"><span class="built_in">chmod</span> 600 <span class="string">&quot;<span class="variable">$CONN_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 重载并激活网卡连接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 重载NetworkManager配置...&quot;</span></span><br><span class="line">nmcli connection reload</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 激活网卡 <span class="variable">$IFACE</span>...&quot;</span></span><br><span class="line">nmcli connection up <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> || &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：激活网卡 <span class="variable">$IFACE</span> 失败！请检查配置&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 设置主机名</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 设置主机名为：<span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line">hostnamectl hostname <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 修改/etc/hosts（追加IP-主机名映射，不覆盖原有配置！）</span></span><br><span class="line"><span class="keyword">if</span> ! grep -q <span class="string">&quot;<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>&quot;</span> /etc/hosts; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ 向/etc/hosts添加映射：<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span>     <span class="variable">$HOSTNAME</span>&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ /etc/hosts已存在映射：<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>（无需重复添加）&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. 配置结果验证（让你直观看到是否生效）</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n======= 配置结果验证 =======&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;网卡 <span class="variable">$IFACE</span> 地址：&quot;</span></span><br><span class="line">ip a show <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> | grep -A2 <span class="string">&quot;inet &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前主机名：<span class="subst">$(hostname)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;路由表（默认路由，仅主网卡显示）：&quot;</span></span><br><span class="line">ip route show default 2&gt;/dev/null || <span class="built_in">echo</span> <span class="string">&quot;无默认路由（符合noroute配置）&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ 配置完成！&quot;</span></span><br></pre></td></tr></table></figure>



<h1 id="26-1-17-复习"><a href="#26-1-17-复习" class="headerlink" title="26-1-17 (复习)"></a>26-1-17 (复习)</h1><h2 id="1-系统引导过程修复"><a href="#1-系统引导过程修复" class="headerlink" title="1.系统引导过程修复"></a>1.系统引导过程修复</h2><p><strong><code>引导过程</code></strong></p>
 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/页-1.png" alt="页-1" style="zoom: 25%;" />

<h3 id="1-1-磁盘损坏修复"><a href="#1-1-磁盘损坏修复" class="headerlink" title="1.1.磁盘损坏修复"></a>1.1.磁盘损坏修复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# fdisk -l</span><br><span class="line">Disk /dev/nvme0n1：100 GiB，107374182400 字节，209715200 个扇区</span><br><span class="line">磁盘型号：VMware Virtual NVMe Disk</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0xb7f6e5e4</span><br><span class="line"></span><br><span class="line">设备           启动    起点      末尾      扇区 大小 Id 类型</span><br><span class="line">/dev/nvme0n1p1 *       2048   2099199   2097152   1G 83 Linux</span><br><span class="line">/dev/nvme0n1p2      2099200 209715199 207616000  99G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel_172-root：95.08 GiB，102093553664 字节，199401472 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel_172-swap：3.91 GiB，4202692608 字节，8208384 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空磁盘/dev/nvme0n1的MBR引导扇区（前446字节），但保留分区表（后66字节）</span></span><br><span class="line">[root@base ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/nvme0n1 bs=446 count=1</span><br><span class="line">记录了1+0 的读入</span><br><span class="line">记录了1+0 的写出</span><br><span class="line">446字节已复制，0.000239378 s，1.9 MB/s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1-1-磁盘引导问题表现"><a href="#1-1-1-磁盘引导问题表现" class="headerlink" title="1.1.1.磁盘引导问题表现"></a>1.1.1.磁盘引导问题表现</h4><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_10-59-28.png" alt="PixPin_2026-01-17_10-59-28"  /> 

<blockquote>
<p>解决方法</p>
<p>1.关机</p>
<p>2.插入可安装系统的设备</p>
<p>3.从此设备启动</p>
</blockquote>
<h4 id="1-1-2-磁盘引导修复过程"><a href="#1-1-2-磁盘引导修复过程" class="headerlink" title="1.1.2.磁盘引导修复过程"></a>1.1.2.磁盘引导修复过程</h4> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_10-59-28.png" alt="PixPin_2026-01-17_10-59-28"  />

 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-22.png" alt="PixPin_2026-01-17_11-01-22" style="zoom:112%;" />

 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-48.png" alt="PixPin_2026-01-17_11-01-48" style="zoom:112%;" />

 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-22.png" alt="PixPin_2026-01-17_11-01-22" style="zoom:113%;" />

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入1并且0回车后输入</span></span><br><span class="line">bash-5.1# <span class="built_in">chroot</span> /mnt/sysroot</span><br><span class="line">bash-5.1# grub2-install /dev/nvme0n1</span><br></pre></td></tr></table></figure>

<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-08-08.png" alt="PixPin_2026-01-17_11-08-08"  />

<h3 id="1-2-引导文件缺失修复"><a href="#1-2-引导文件缺失修复" class="headerlink" title="1.2.引导文件缺失修复"></a>1.2.引导文件缺失修复</h3><h4 id="1-2-1-查询引导文件"><a href="#1-2-1-查询引导文件" class="headerlink" title="1.2.1.查询引导文件"></a>1.2.1.查询引导文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# ll /boot/grub2/grub.cfg</span><br><span class="line">-rw-------. 1 root root 6955  1月 15 21:11 /boot/grub2/grub.cfg</span><br><span class="line">[root@node2 ~]# ll /boot/loader/entries/</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r--. 1 root root 500  1月 15 21:11 1199b04b0d974659ad491305f98dcfe0-0-rescue.conf</span><br><span class="line">-rw-r--r--. 1 root root 475  1月 15 21:23 1199b04b0d974659ad491305f98dcfe0-5.14.0-570.12.1.el9_6.x86_64.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#磁盘</span></span><br><span class="line">[root@node2 ~]# <span class="built_in">df</span></span><br><span class="line">文件系统                     1K-块     已用     可用 已用% 挂载点</span><br><span class="line">devtmpfs                      4096        0     4096    0% /dev</span><br><span class="line">tmpfs                      1855068        0  1855068    0% /dev/shm</span><br><span class="line">tmpfs                       742028     9220   732808    2% /run</span><br><span class="line">/dev/mapper/rhel_172-root 99635200  3278240 96356960    4% /</span><br><span class="line">/dev/nvme0n1p1              983040   315524   667516   33% /boot</span><br><span class="line">/dev/sr0                  12462174 12462174        0  100% /rhel9</span><br><span class="line">tmpfs                       371012        0   371012    0% /run/user/0</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-主引导文件缺失修复"><a href="#1-2-2-主引导文件缺失修复" class="headerlink" title="1.2.2.主引导文件缺失修复"></a>1.2.2.主引导文件缺失修复</h4><h5 id="1-2-2-1-删除主引导文件"><a href="#1-2-2-1-删除主引导文件" class="headerlink" title="1.2.2.1.删除主引导文件"></a>1.2.2.1.删除主引导文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# <span class="built_in">rm</span> -rf /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>

<h5 id="1-2-2-2-问题表现"><a href="#1-2-2-2-问题表现" class="headerlink" title="1.2.2.2.问题表现"></a>1.2.2.2.问题表现</h5><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_23-22-57.png" alt="PixPin_2026-01-17_23-22-57"></p>
<h5 id="1-2-2-3-修复过程"><a href="#1-2-2-3-修复过程" class="headerlink" title="1.2.2.3.修复过程"></a>1.2.2.3.修复过程</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt; <span class="built_in">set</span> root=(hd0,msdos1)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt; linux16 /vmlinuz-5.14.0-570.12.1.e19_6.x86_64 ro root=/dev/mapper/rhel_172-root net.ifnames=0</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt;initrd16 /initramfs-5.14.0-570.12.1.e19_6.x86_64.img</span><br><span class="line"><span class="comment"># 启动系统</span></span><br><span class="line">grub&gt; boot</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当手动引导启动系统后，需要修复自动引导文件，否则系统重启后仍然要手动引导</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修复自动引导文件</span></span><br><span class="line">[root@base ~]# grub2-mkconfig  &gt; /boot/grub2/grub.cfg    <span class="comment">#修复完成</span></span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\hym\Desktop\Linux\PixPin_2026-01-17_23-39-31.png" alt="PixPin_2026-01-17_23-39-31"></p>
<h4 id="1-2-3-子引导文件缺失修复"><a href="#1-2-3-子引导文件缺失修复" class="headerlink" title="1.2.3.子引导文件缺失修复"></a>1.2.3.子引导文件缺失修复</h4><h5 id="1-2-3-1-删除子引导文件"><a href="#1-2-3-1-删除子引导文件" class="headerlink" title="1.2.3.1.删除子引导文件"></a>1.2.3.1.删除子引导文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">rm</span> -fr /boot/loader/entries/*</span><br></pre></td></tr></table></figure>

<h5 id="1-2-3-2-问题表现"><a href="#1-2-3-2-问题表现" class="headerlink" title="1.2.3.2.问题表现"></a>1.2.3.2.问题表现</h5><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_23-22-57.png" alt="PixPin_2026-01-17_23-22-57"></p>
<h5 id="1-2-3-3-修复过程"><a href="#1-2-3-3-修复过程" class="headerlink" title="1.2.3.3.修复过程"></a>1.2.3.3.修复过程</h5><p>与上面的<a href="#1.2.4.2.%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B">主引导文件修复过程</a>一致</p>
<p>进入系统后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# kernel-install add $(<span class="built_in">uname</span> -r) /boot/vmlinuz-5.14.0-570.12.1.el9_6.x86_64</span><br><span class="line">[root@base ~]# <span class="built_in">ls</span> /boot/loader/entries/</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\hym\Desktop\Linux\PixPin_2026-01-18_00-06-54.png" alt="PixPin_2026-01-18_00-06-54"></p>
<blockquote>
<p>当修复子启动文件后网卡的名称设定参数就丢失了需要重新设定，此参数和系统修复本身无关</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-18_00-15-39.png" alt="PixPin_2026-01-18_00-15-39"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]#  grubby --update-kernel ALL --args net.ifnames=0</span><br><span class="line"><span class="comment"># 重启后网络恢复</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-内核文件修复"><a href="#1-3-内核文件修复" class="headerlink" title="1.3.内核文件修复"></a>1.3.内核文件修复</h3><h4 id="1-3-1-删除内核文件"><a href="#1-3-1-删除内核文件" class="headerlink" title="1.3.1.删除内核文件"></a>1.3.1.删除内核文件</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-42-46.png" alt="PixPin_2026-01-17_15-42-46"></p>
<h4 id="1-3-2-问题表现"><a href="#1-3-2-问题表现" class="headerlink" title="1.3.2.问题表现"></a>1.3.2.问题表现</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-44-30.png" alt="PixPin_2026-01-17_15-44-30"></p>
<h4 id="1-3-3-解决方法"><a href="#1-3-3-解决方法" class="headerlink" title="1.3.3.解决方法"></a>1.3.3.解决方法</h4><p>（1）打开电源时进入固件</p>
 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-45-45.png" alt="PixPin_2026-01-17_15-45-45" style="zoom:80%;" />

<p>（2）进入BOOT页面，将光驱启动调到最前面</p>
 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-47-07.png" alt="PixPin_2026-01-17_15-47-07" style="zoom:33%;" />

<p>（3）保存后，过程同<a href="#1.1.2.%E7%A3%81%E7%9B%98%E5%BC%95%E5%AF%BC%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B">磁盘修复</a>一致</p>
 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-47-31.png" alt="PixPin_2026-01-17_15-47-31" style="zoom:33%;" />

<p>（4）进入下方页面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# <span class="built_in">df</span></span><br><span class="line">bash-5.1# mount --<span class="built_in">bind</span> /run/install/repo/ /mnt/sys/</span><br><span class="line">bash-5.1# <span class="built_in">chroot</span> /mnt/sysroot/</span><br><span class="line">bash-5.1# rpm -ivh /media/BaseOS/Packages/kernel-core-5.14.0-570.12.1.el9_6.x86_64.rpm --force</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-57-32.png" alt="PixPin_2026-01-17_15-57-32"></p>
<h1 id="2026-1-19-复习"><a href="#2026-1-19-复习" class="headerlink" title="2026-1-19 (复习)"></a>2026-1-19 (复习)</h1><h2 id="1-apache构建web服务器"><a href="#1-apache构建web服务器" class="headerlink" title="1.apache构建web服务器"></a>1.apache构建web服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装服务并启动服务</span></span><br><span class="line">[root@base ~]# dnf install httpd -y</span><br><span class="line">[root@base ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">[root@base ~]# dnf install httpd-manual -y	<span class="comment"># httpd服务手册</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本配置信息</span></span><br><span class="line">端口：			   80</span><br><span class="line">默认发布目录：		/var/www/html</span><br><span class="line">默认发布文件：		index.html</span><br><span class="line">主配置文件：		/etc/httpd/conf/httpd.conf</span><br><span class="line">子配置文件：		/etc/httpd/conf.d/*.conf</span><br><span class="line">管理命令：		systemctl   <span class="built_in">enable</span> --now httpd</span><br></pre></td></tr></table></figure>

<h3 id="1-1-主配置文件"><a href="#1-1-主配置文件" class="headerlink" title="1.1.主配置文件"></a>1.1.主配置文件</h3><h4 id="1-1-1-更改默认发布文件"><a href="#1-1-1-更改默认发布文件" class="headerlink" title="1.1.1.更改默认发布文件"></a>1.1.1.更改默认发布文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]#  <span class="built_in">echo</span> <span class="string">&quot;index.html ---&gt; /var/www/html&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@node4 ~]#  <span class="built_in">echo</span> <span class="string">&quot;test.html ---&gt; /var/www/html &quot;</span> &gt; /var/www/html/test.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">index.html ---&gt; /var/www/html</span><br><span class="line"><span class="comment">## 修改Apache配置</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">168 &lt;IfModule dir_module&gt;</span><br><span class="line">169     DirectoryIndex index.html</span><br><span class="line">170 &lt;/IfModule&gt;</span><br><span class="line"><span class="comment">## 重启服务</span></span><br><span class="line">[root@base ~]# systemctl restart httpd</span><br><span class="line"><span class="comment">## 再次测试</span></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">test.html ---&gt; /var/www/html</span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-修改默认发布目录"><a href="#1-1-2-修改默认发布目录" class="headerlink" title="1.1.2.修改默认发布目录"></a>1.1.2.修改默认发布目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /web/html -p</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> <span class="string">&quot;index.html ---&gt; /web/html&quot;</span> &gt; /web/html/index.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">124 <span class="comment"># DocumentRoot &quot;/var/www/html&quot;</span></span><br><span class="line">125 DocumentRoot <span class="string">&quot;/web/html&quot;</span></span><br><span class="line">126</span><br><span class="line">127 <span class="comment">#</span></span><br><span class="line">128 <span class="comment"># Relax access to content within /var/www.</span></span><br><span class="line">129 <span class="comment">#</span></span><br><span class="line">130 &lt;Directory <span class="string">&quot;/web&quot;</span>&gt;</span><br><span class="line">131     AllowOverride None</span><br><span class="line">132     <span class="comment"># Allow open access:</span></span><br><span class="line">133     Require all granted</span><br><span class="line">134 &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">index.html ---&gt; /web/html</span><br></pre></td></tr></table></figure>

<h4 id="1-1-3-端口修改"><a href="#1-1-3-端口修改" class="headerlink" title="1.1.3.端口修改"></a>1.1.3.端口修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">47 Listen 80</span><br><span class="line">48 Listen 8000</span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# netstat -antlupe | grep httpd</span><br><span class="line">tcp6       0      0 :::8000                 :::*                    LISTEN      0          32220      2538/httpd</span><br><span class="line">  2538/httpd</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130:8000</span><br><span class="line">index.html ---&gt; /var/www/html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-2-子配置文件"><a href="#1-2-子配置文件" class="headerlink" title="1.2.子配置文件"></a>1.2.子配置文件</h3><h4 id="1-2-1-虚拟主机"><a href="#1-2-1-虚拟主机" class="headerlink" title="1.2.1.虚拟主机"></a>1.2.1.虚拟主机</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建基础目录</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /etc/httpd/logs/node4_log			<span class="comment"># 日志目录</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> <span class="built_in">mkdir</span> -p /web/node4/&#123;news,bbs&#125;/html	<span class="comment"># 发布目录</span></span><br><span class="line"><span class="comment"># 创建发布文件</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> news.node4.com &gt; /web/node4/news/html/index.html</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> bbs.node4.com &gt; /web/node4/bbs/html/index.html</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web&quot;</span>&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost _default_:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/html&quot;</span></span><br><span class="line">    CustomLog logs/default.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/news/html&quot;</span></span><br><span class="line">    ServerName news.node4.com</span><br><span class="line">    CustomLog logs/node4_log/news.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/bbs/html&quot;</span></span><br><span class="line">    ServerName bbs.node4.com</span><br><span class="line">    CustomLog logs/node4_log/bbs.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# vim /etc/hosts</span><br><span class="line">172.25.254.130     node4   www.node4.com   bbs.node4.com  news.node4.com</span><br><span class="line"><span class="comment"># 测试www.node4.com</span></span><br><span class="line">[root@node4 ~]# curl www.node4.com</span><br><span class="line">index.html ---&gt; /web/html</span><br><span class="line"><span class="comment"># 测试news.node4.com</span></span><br><span class="line">[root@node4 ~]# curl news.node4.com</span><br><span class="line">news.node4.com</span><br><span class="line"><span class="comment"># 测试bbs.node4.com</span></span><br><span class="line">[root@node4 ~]# curl bbs.node4.com</span><br><span class="line">bbs.node4.com</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-访问控制"><a href="#1-2-2-访问控制" class="headerlink" title="1.2.2.访问控制"></a>1.2.2.访问控制</h4><h5 id="1-2-2-1-基于IP"><a href="#1-2-2-1-基于IP" class="headerlink" title="1.2.2.1.基于IP"></a>1.2.2.1.基于IP</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /web/html/admin</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> admin &gt; /web/html/admin/index.html</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/admin/</span><br><span class="line">admin</span><br><span class="line"><span class="comment"># 拒绝其他IP，仅通过.1的流量</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web/html/admin/&quot;</span>&gt;</span><br><span class="line">    Order Deny,Allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from 172.25.254.1</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line"><span class="comment"># 测试，本机测试</span></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/admin/</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;403 Forbidden&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Forbidden&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;You don<span class="string">&#x27;t have permission to access this resource.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>172.25.254.1进行测试</p>
</blockquote>
<p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-19_16-09-46.png"></p>
<h5 id="1-2-2-2-基于用户认证"><a href="#1-2-2-2-基于用户认证" class="headerlink" title="1.2.2.2.基于用户认证"></a>1.2.2.2.基于用户认证</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /web/html/auth/</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> auth &gt; /web/html/auth/index.html</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/auth/</span><br><span class="line">auth</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成认证文件</span></span><br><span class="line">[root@node4 ~]# htpasswd -cm /etc/httpd/.htpasswd haha</span><br><span class="line">New password:</span><br><span class="line">Re-<span class="built_in">type</span> new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user haha</span><br><span class="line">[root@node4 ~]# <span class="built_in">cat</span> /etc/httpd/.htpasswd</span><br><span class="line">haha:$apr1$MKFuKZB6<span class="variable">$eTeFSJ4Mhn8TMnueDnARX0</span></span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web/html/auth/&quot;</span>&gt;</span><br><span class="line">    AuthUserFile /etc/httpd/.htpasswd</span><br><span class="line">    AuthType basic</span><br><span class="line">    AuthName <span class="string">&quot;Please input your username and password&quot;</span></span><br><span class="line">    Require valid-user</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment">## root用户</span></span><br><span class="line">[root@node4 ~]# curl  172.25.254.130/auth/</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;401 Unauthorized&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Unauthorized&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;This server could not verify that you</span><br><span class="line">are authorized to access the document</span><br><span class="line">requested.  Either you supplied the wrong</span><br><span class="line">credentials (e.g., bad password), or your</span><br><span class="line">browser doesn<span class="string">&#x27;t understand how to supply</span></span><br><span class="line"><span class="string">the credentials required.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="string">## haha用户</span></span><br><span class="line"><span class="string">[root@node4 ~]# curl  172.25.254.130/auth/ -u haha:haha</span></span><br><span class="line"><span class="string">auth</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-https"><a href="#1-2-3-https" class="headerlink" title="1.2.3.https"></a>1.2.3.https</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# dnf install mod_ssl.x86_64 -y</span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /etc/httpd/certs</span><br><span class="line">[root@node4 ~]# openssl req -newkey rsa:2048 -nodes -sha256 -keyout /etc/httpd/certs/node4.key -x509 -days 365 -out /etc/httpd/certs/node4.crt</span><br><span class="line">[root@node4 ~]# ll /etc/httpd/certs/</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r-- 1 root root 1237  1月 19 20:22 node4.crt</span><br><span class="line">-rw------- 1 root root 1704  1月 19 20:22 node4.key</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /web/node4/login/html</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> login.node4.com &gt; /web/node4/login/html/index.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;VirtualHost *:443&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/login/html&quot;</span></span><br><span class="line">    ServerName login.node4.com</span><br><span class="line">    CustomLog logs/node4_log/login.log combined</span><br><span class="line">    SSLEngine on</span><br><span class="line">    SSLCertificateFile /etc/httpd/certs/node4.crt</span><br><span class="line">    SSLCertificateKeyFile /etc/httpd/certs/node4.key</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# curl -k https://login.node4.com</span><br><span class="line">login.node4.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># http重定向</span></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName login.node4.com</span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RewriteRule  ^/(.*)$ https://login.node4.com/<span class="variable">$1</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">[root@node4 ~]#  systemctl restart httpd</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# curl -I login.node4.com</span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Date: Mon, 19 Jan 2026 12:30:48 GMT</span><br><span class="line">Server: Apache/2.4.62 (Red Hat Enterprise Linux) OpenSSL/3.2.2</span><br><span class="line">Location: https://login.node4.com/</span><br><span class="line">Content-Type: text/html; charset=iso-8859-1</span><br></pre></td></tr></table></figure>



<h1 id="2026-1-20"><a href="#2026-1-20" class="headerlink" title="2026-1-20"></a>2026-1-20</h1><h2 id="1-NAT模式实现方法"><a href="#1-NAT模式实现方法" class="headerlink" title="1.NAT模式实现方法"></a>1.NAT模式实现方法</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://d1aa036.webp.li/Build/20260123_NAT.png" alt="20260123_NAT"></p>
<h3 id="1-1-VS主机配置"><a href="#1-1-VS主机配置" class="headerlink" title="1.1.VS主机配置"></a>1.1.VS主机配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh vsnode eth0 172.25.254.100 </span><br><span class="line">[root@vsnode ~]# vmset.sh vsnode eth1 192.168.0.100 vsnode nogateway</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.25.254.2    0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">172.25.254.0    0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br></pre></td></tr></table></figure>

<h3 id="1-2-RS1配置"><a href="#1-2-RS1配置" class="headerlink" title="1.2.RS1配置"></a>1.2.RS1配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh RS1 eth0 192.168.0.10 192.168.0.100</span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@RS1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line">[root@RS1 ~]# <span class="built_in">echo</span> 192.168.0.10 --- RS1 &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure>

<h3 id="1-3-RS2配置"><a href="#1-3-RS2配置" class="headerlink" title="1.3.RS2配置"></a>1.3.RS2配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh RS2 eth0 192.168.0.20 192.168.0.100</span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@RS2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → </span><br><span class="line">[root@RS2 ~]# <span class="built_in">echo</span> 192.168.0.20 --- RS1 &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure>

<h3 id="1-4-验证"><a href="#1-4-验证" class="headerlink" title="1.4.验证"></a>1.4.验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VSnode中</span></span><br><span class="line">[root@vsnode ~]# curl 192.168.0.10</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line">[root@vsnode ~]# curl 192.168.0.20</span><br><span class="line">192.168.0.20 --- RS2</span><br></pre></td></tr></table></figure>



<h1 id="2026-1-22"><a href="#2026-1-22" class="headerlink" title="2026-1-22"></a>2026-1-22</h1><h2 id="1-DR模式"><a href="#1-DR模式" class="headerlink" title="1.DR模式"></a>1.DR模式</h2><h3 id="1-1-环境流程图"><a href="#1-1-环境流程图" class="headerlink" title="1.1.环境流程图"></a>1.1.环境流程图</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="G:\图片\20260123-DR.png" alt="20260123-DR"></p>
<h3 id="1-2-环境配置"><a href="#1-2-环境配置" class="headerlink" title="1.2.环境配置"></a>1.2.环境配置</h3><h4 id="1-2-1-配置路由器"><a href="#1-2-1-配置路由器" class="headerlink" title="1.2.1.配置路由器"></a>1.2.1.配置路由器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@router ~]# vmset.sh router eth0 172.25.254.100</span><br><span class="line">[root@router ~]# vmset.sh router eth1 192.168.0.100 nogateway</span><br><span class="line"></span><br><span class="line">[root@router ~]# dnf install ipvsadm -y</span><br><span class="line">[root@router ~]# systemctl <span class="built_in">disable</span> --now ipvsadm.service</span><br><span class="line">[root@router ~]# ipvsadm -C</span><br><span class="line"></span><br><span class="line">[root@router ~]# <span class="built_in">echo</span> net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@router ~]# sysctl  -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">[root@router ~]# iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 192.168.0.100</span><br><span class="line">[root@router ~]# iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 172.25.254.100</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-vsnode调度器"><a href="#1-2-2-vsnode调度器" class="headerlink" title="1.2.2.vsnode调度器"></a>1.2.2.vsnode调度器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh vsnode eth0 192.168.0.50 192.168.0.100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# <span class="built_in">cd</span>  /etc/NetworkManager/system-connections/</span><br><span class="line">[root@vsnode system-connections]#  <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@vsnode system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1==127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line"></span><br><span class="line">[root@vsnode system-connections]# nmcli connection reload</span><br><span class="line">[root@vsnode system-connections]# nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/8）</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.0.200/32 scope global lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2c:93:ef brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.50/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::ee1f:f906:ed7:7719/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-客户端"><a href="#1-2-3-客户端" class="headerlink" title="1.2.3.客户端"></a>1.2.3.客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vmset.sh client eth0 172.25.254.99</span><br><span class="line"></span><br><span class="line">[root@client ~]# ping 192.168.0.200 -c 2</span><br><span class="line">PING 192.168.0.200 (192.168.0.200) 56(84) 比特的数据。</span><br><span class="line">64 比特，来自 192.168.0.200: icmp_seq=1 ttl=128 时间=0.841 毫秒</span><br><span class="line">64 比特，来自 192.168.0.200: icmp_seq=2 ttl=128 时间=0.691 毫秒</span><br><span class="line"></span><br><span class="line">--- 192.168.0.200 ping 统计 ---</span><br><span class="line">已发送 2 个包， 已接收 2 个包, 0% packet loss, <span class="keyword">time</span> 1031ms</span><br><span class="line">rtt min/avg/max/mdev = 0.691/0.766/0.841/0.075 ms</span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-RS1"><a href="#1-2-4-RS1" class="headerlink" title="1.2.4.RS1"></a>1.2.4.RS1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@RS1 ~]# vmset.sh RS1 eth0 192.168.0.10 192.168.0.100</span><br><span class="line">eth0 正在使用!!!</span><br><span class="line">成功删除连接 <span class="string">&quot;eth0&quot;</span> (7ba00b1d-8cdd-30da-91ad-bb83ed4f7474)。</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line"></span><br><span class="line">=====网卡详细信息====</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:75:27:4f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.10/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> tentative noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">====路由表====</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">====主机名====</span><br><span class="line">RS1</span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@RS1 system-connections]# <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@RS1 system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">address1=127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line">method=manual</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS1 system-connections]# nmcli connection reload</span><br><span class="line">[root@RS1 system-connections]# nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line">[root@RS1 system-connections]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.0.200/32 scope global lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:c4:c1:29 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.10/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># arp 禁止响应</span></span><br><span class="line">[root@RS1 ~]# vim arp.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 执行成功</span><br><span class="line">[root@RS1 ~]# bash arp.sh</span><br></pre></td></tr></table></figure>

<h4 id="1-2-5-RS2"><a href="#1-2-5-RS2" class="headerlink" title="1.2.5.RS2"></a>1.2.5.RS2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@RS2 ~]#  vmset.sh RS2 eth0 192.168.0.20 192.168.0.100</span><br><span class="line">eth0 正在使用!!!</span><br><span class="line">成功删除连接 <span class="string">&quot;eth0&quot;</span> (7ba00b1d-8cdd-30da-91ad-bb83ed4f7474)。</span><br><span class="line"></span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line"></span><br><span class="line">=====网卡详细信息====</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:30:97:ac brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.20/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> tentative noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">====路由表====</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">====主机名====</span><br><span class="line">RS2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@RS2 system-connections]# <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@RS2 system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line">[ethernet]</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1=127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line"></span><br><span class="line">[root@RS2 system-connections]# nmcli connection reload</span><br><span class="line">[root@RS2 system-connections]#  nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/8）</span><br><span class="line"></span><br><span class="line"><span class="comment"># arp 禁止响应</span></span><br><span class="line">[root@RS1 ~]# vim arp.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 执行成功</span><br><span class="line">[root@RS1 ~]# bash arp.sh</span><br></pre></td></tr></table></figure>

<h2 id="2-利用火墙标记解决轮询错误"><a href="#2-利用火墙标记解决轮询错误" class="headerlink" title="2.利用火墙标记解决轮询错误"></a>2.利用火墙标记解决轮询错误</h2><h3 id="2-1-在rs主机中同时开始http和https两种协议"><a href="#2-1-在rs主机中同时开始http和https两种协议" class="headerlink" title="2.1.在rs主机中同时开始http和https两种协议"></a>2.1.在rs主机中同时开始http和https两种协议</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@RS1 ~]# dnf install ipvsadm -y</span><br><span class="line">[root@RS1 ~]# dnf install mod_ssl -y</span><br><span class="line">[root@RS1 ~]# systemctl <span class="built_in">disable</span> --now ipvsadm.service</span><br><span class="line">[root@RS1 ~]# ipvsadm -C</span><br><span class="line">[root@RS1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure>

<h3 id="2-2-在vsnode中添加https的轮询策略"><a href="#2-2-在vsnode中添加https的轮询策略" class="headerlink" title="2.2. 在vsnode中添加https的轮询策略"></a>2.2. 在vsnode中添加https的轮询策略</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# dnf install ipvsadm -y</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -t 192.168.0.200:80  -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:80 -r 192.168.0.20 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:80 -r 192.168.0.10 -g</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -t 192.168.0.200:443 -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:443 -r 192.168.0.10:443 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:443 -r 192.168.0.20:443 -g</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  192.168.0.200:80 rr</span><br><span class="line">  -&gt; 192.168.0.10:80              Route   1      0          0</span><br><span class="line">  -&gt; 192.168.0.20:80              Route   1      0          0</span><br><span class="line">TCP  192.168.0.200:443 rr</span><br><span class="line">  -&gt; 192.168.0.10:443             Route   1      0          0</span><br><span class="line">  -&gt; 192.168.0.20:443             Route   1      0          0</span><br></pre></td></tr></table></figure>

<h3 id="2-3-轮询错误展示"><a href="#2-3-轮询错误展示" class="headerlink" title="2.3. 轮询错误展示"></a>2.3. 轮询错误展示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@client ~]# curl  192.168.0.200;curl -k https://192.168.0.200</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line"></span><br><span class="line"><span class="comment">#当上述设定完成后http和https是独立的service，轮询会出现重复问题</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-解决方案"><a href="#2-4-解决方案" class="headerlink" title="2.4.解决方案"></a>2.4.解决方案</h3><p>使用火墙标记访问vip的80和443的所有数据包，设定标记为6666，然后对此标记进行负载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# ipvsadm -C</span><br><span class="line">[root@vsnode ~]# iptables -t mangle -A PREROUTING -d 192.168.0.200 -p tcp -m multiport --dports 80,443 -j MARK --set-mark  6666</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -f 6666 -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm  -a -f 6666 -r 192.168.0.10 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm  -a -f 6666 -r 192.168.0.20 -g</span><br></pre></td></tr></table></figure>

<h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5.测试"></a>2.5.测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# curl  192.168.0.200;curl -k https://192.168.0.200</span><br><span class="line">192.168.0.20 --- RS2</span><br><span class="line">192.168.0.10 --- RS1</span><br></pre></td></tr></table></figure>

<h2 id="3-利用持久连接实现会话粘滞"><a href="#3-利用持久连接实现会话粘滞" class="headerlink" title="3.利用持久连接实现会话粘滞"></a>3.利用持久连接实现会话粘滞</h2><p>设定ipvs调度策略</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# ipvsadm -A -f 6666 -s rr -p 1</span><br></pre></td></tr></table></figure>

<h1 id="2026-1-23"><a href="#2026-1-23" class="headerlink" title="2026-1-23"></a>2026-1-23</h1><h2 id="1-HAPORXY实验"><a href="#1-HAPORXY实验" class="headerlink" title="1.HAPORXY实验"></a>1.HAPORXY实验</h2><h3 id="1-环境图"><a href="#1-环境图" class="headerlink" title="1.环境图"></a>1.环境图</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="G:\图片\2026-1-24_HA.png" alt="2026-1-24_HA"></p>
<h2 id="2-环境搭建"><a href="#2-环境搭建" class="headerlink" title="2.环境搭建"></a>2.环境搭建</h2><h3 id="2-1-haproxy主机"><a href="#2-1-haproxy主机" class="headerlink" title="2.1.haproxy主机"></a>2.1.haproxy主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vmset.sh haproxy eth0 172.25.254.100</span><br><span class="line">[root@haproxy ~]# vmset.sh haproxy eth1 192.168.0.100 nogateway</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> net.ipv4.ip_forward=1 &gt; /etc/sysctl.conf</span><br><span class="line">[root@haproxy ~]# sysctl -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure>

<h3 id="2-2-webserver1"><a href="#2-2-webserver1" class="headerlink" title="2.2.webserver1"></a>2.2.webserver1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@webserver1 ~]# vmset.sh webserver1 eth0 192.168.0.10 nogateway</span><br><span class="line">[root@webserver1 ~]# dnf install httpd -y</span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> webserver1 - 192.168.0.10 &gt; /var/www/html/index.html</span><br><span class="line">[root@webserver1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure>

<h3 id="2-3-webserver2"><a href="#2-3-webserver2" class="headerlink" title="2.3.webserver2"></a>2.3.webserver2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@webserver2 ~]# vmset.sh webserver2 eth0 192.168.0.20 nogateway</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> webserver2 - 192.168.0.20 &gt; /var/www/html/index.html</span><br><span class="line">[root@webserver2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure>

<h3 id="2-4-环境验证"><a href="#2-4-环境验证" class="headerlink" title="2.4.环境验证"></a>2.4.环境验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# curl  192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">[root@haproxy ~]# curl  192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure>

<h2 id="3-Haproxy的安装及配置参数"><a href="#3-Haproxy的安装及配置参数" class="headerlink" title="3.Haproxy的安装及配置参数"></a>3.Haproxy的安装及配置参数</h2><h3 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1.安装"></a>3.1.安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在调度器（双网卡主机中）</span></span><br><span class="line">[root@haproxy ~]# dnf install haproxy.x86_64 -y</span><br><span class="line">[root@haproxy ~]# systemctl <span class="built_in">enable</span> --now haproxy</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/haproxy.service → /usr/lib/systemd/system/haproxy.service.</span><br></pre></td></tr></table></figure>

<h3 id="3-2-harpoxy的参数详解实验"><a href="#3-2-harpoxy的参数详解实验" class="headerlink" title="3.2.harpoxy的参数详解实验"></a>3.2.harpoxy的参数详解实验</h3><h1 id="2026-1-25"><a href="#2026-1-25" class="headerlink" title="2026-1-25"></a>2026-1-25</h1><h2 id="1-Haproxy算法实验"><a href="#1-Haproxy算法实验" class="headerlink" title="1.Haproxy算法实验"></a>1.Haproxy算法实验</h2><h3 id="1-1-静态算法"><a href="#1-1-静态算法" class="headerlink" title="1.1.静态算法"></a>1.1.静态算法</h3><h4 id="1-1-1-static-rr"><a href="#1-1-1-static-rr" class="headerlink" title="1.1.1.static-rr"></a>1.1.1.static-rr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     static-rr</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测是否支持热更新</span></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get  weight webcluster/haha&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">4 (initial 4)</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;set  weight webcluster/haha 1&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">Backend is using a static LB algorithm and only accepts weights <span class="string">&#x27;0%&#x27;</span> and <span class="string">&#x27;100%&#x27;</span>.</span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-first"><a href="#1-1-2-first" class="headerlink" title="1.1.2.first"></a>1.1.2.first</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     first</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 maxconn 1 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再开一个终端</span></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure>

<h3 id="1-2-动态算法"><a href="#1-2-动态算法" class="headerlink" title="1.2.动态算法"></a>1.2.动态算法</h3><h4 id="1-2-1-roundrobin"><a href="#1-2-1-roundrobin" class="headerlink" title="1.2.1.roundrobin"></a>1.2.1.roundrobin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞  <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态权重更新</span></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get weight webcluster/haha&quot;</span> | socat stdio /var/lib/haproxy/stats</span><br><span class="line">4 (initial 4)</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;set  weight  webcluster/haha 1  &quot;</span> | socat stdio /var/lib/haproxy/stats</span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get  weight webcluster/haha&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">1 (initial 4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 效果</span></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-leastconn"><a href="#1-2-2-leastconn" class="headerlink" title="1.2.2.leastconn"></a>1.2.2.leastconn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     leastconn</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure>

<h3 id="1-3-混合算法"><a href="#1-3-混合算法" class="headerlink" title="1.3.混合算法"></a>1.3.混合算法</h3><h4 id="1-3-1-source"><a href="#1-3-1-source" class="headerlink" title="1.3.1.source"></a>1.3.1.source</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认静态算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     <span class="built_in">source</span></span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     <span class="built_in">source</span></span><br><span class="line">	hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-uri"><a href="#1-3-2-uri" class="headerlink" title="1.3.2.uri"></a>1.3.2.uri</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主备实验环境</span></span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> RS1 - 192.168.0.10 &gt; /var/www/html/index1.html</span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> RS1 - 192.168.0.10 &gt; /var/www/html/index2.html</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> RS2 - 192.168.0.20 &gt; /var/www/html/index1.html</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> RS2 - 192.168.0.20 &gt; /var/www/html/index2.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定uri算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     uri</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index1.html; <span class="keyword">done</span></span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">                                                                       </span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index2.html; <span class="keyword">done</span></span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-url-param"><a href="#1-3-3-url-param" class="headerlink" title="1.3.3.url_param"></a>1.3.3.url_param</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设定url_param算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     url_param name</span><br><span class="line">    hash-type 	consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 2</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    </span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index.html?name=hua; <span class="keyword">done</span></span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index.html?name=huaaaaa; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-hdr"><a href="#1-3-4-hdr" class="headerlink" title="1.3.4.hdr"></a>1.3.4.hdr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     hdr(User-Agent)</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ curl -A <span class="string">&quot;hua&quot;</span> 172.25.254.100</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ curl -A <span class="string">&quot;Yeming&quot;</span> 172.25.254.100</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-基于cookie的会话保持"><a href="#2-基于cookie的会话保持" class="headerlink" title="2.基于cookie的会话保持"></a>2.基于cookie的会话保持</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    cookie WEBCOOKIE insert nocache indirect</span><br><span class="line">    server haha 192.168.0.10:80 cookie web1 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 cookie web2 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="G:\图片\PixPin_2026-01-26_00-02-24.png" alt="PixPin_2026-01-26_00-02-24"></p>
<h2 id="3-HAProxy状态页"><a href="#3-HAProxy状态页" class="headerlink" title="3.HAProxy状态页"></a>3.HAProxy状态页</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen stats</span><br><span class="line">    mode        http</span><br><span class="line">    <span class="built_in">bind</span> 0.0.0.0:1234</span><br><span class="line">    stats       <span class="built_in">enable</span></span><br><span class="line">    <span class="built_in">log</span>         global</span><br><span class="line"><span class="comment">#   stats       refresh</span></span><br><span class="line">    stats uri   /status</span><br><span class="line">    stats auth  hua:hua</span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br></pre></td></tr></table></figure>

<h1 id="2026-1-26"><a href="#2026-1-26" class="headerlink" title="2026-1-26"></a>2026-1-26</h1><h2 id="1-IP透传"><a href="#1-IP透传" class="headerlink" title="1.IP透传"></a>1.IP透传</h2><h3 id="1-1-七层透传"><a href="#1-1-七层透传" class="headerlink" title="1.1.七层透传"></a>1.1.七层透传</h3><h4 id="1-1-1-环境搭建"><a href="#1-1-1-环境搭建" class="headerlink" title="1.1.1.环境搭建"></a>1.1.1.环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Haproxy中</span></span><br><span class="line">[root@Haproxy ~]# dnf install haproxy -y</span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    blance  roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  haha 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Webserver1与Webserver2中</span></span><br><span class="line"><span class="comment">## webserver1</span></span><br><span class="line">[root@Webserver1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> <span class="string">&quot;webserver1 --- 192.168.0.10&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br><span class="line"><span class="comment">## webserver2</span></span><br><span class="line">[root@Webserver1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> <span class="string">&quot;webserver2 --- 192.168.0.20&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-测试环境"><a href="#1-1-2-测试环境" class="headerlink" title="1.1.2.测试环境"></a>1.1.2.测试环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client中</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span> curl 172.25.254.100;<span class="keyword">done</span></span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在rs主机中默认是未开启透传功能的</span></span><br><span class="line"><span class="comment">## webserver1 or 2中</span></span><br><span class="line">[[root@Webserver1 ~]# <span class="built_in">cat</span> /etc/httpd/logs/access_log</span><br><span class="line">192.168.0.20 - - [27/Jan/2026:15:45:38 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:46:12 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启ip透传的方式</span></span><br><span class="line"><span class="comment">## haproxy中</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8 <span class="comment">#开启haproxy透传功能</span></span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在rs中设定采集透传IP</span></span><br><span class="line"><span class="comment">## webserver1 or 2中</span></span><br><span class="line">[root@Webserver1 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">201     LogFormat <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;X-Forwarded-For&#125;i\&quot; \&quot;%&#123;Referer    &#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> combined</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure>

<h4 id="1-1-3-测试效果"><a href="#1-1-3-测试效果" class="headerlink" title="1.1.3.测试效果"></a>1.1.3.测试效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client中</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span> curl 172.25.254.100;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># webserver1 or 2中</span></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">cat</span> /etc/httpd/logs/access_log</span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:55:39 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;172.25.254.99&quot;</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:55:39 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;172.25.254.99&quot;</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-四层透传"><a href="#1-2-四层透传" class="headerlink" title="1.2.四层透传"></a>1.2.四层透传</h3><h4 id="1-2-1-环境搭建"><a href="#1-2-1-环境搭建" class="headerlink" title="1.2.1.环境搭建"></a>1.2.1.环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在RS中把apache停止</span></span><br><span class="line">[root@Webserver1 ~]# systemctl <span class="built_in">disable</span> --now httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl <span class="built_in">disable</span> --now httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署nginx</span></span><br><span class="line"><span class="comment"># webserver1</span></span><br><span class="line">[root@Webserver1 ~]# dnf install nginx -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> webserver1 - 192.168.0.10 &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl <span class="built_in">enable</span> --now nginx</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.</span><br><span class="line"><span class="comment"># webserver2</span></span><br><span class="line">[root@Webserver2 ~]# dnf install nginx -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> webserver2 - 192.168.0.20 &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@Webserver2 ~]# systemctl <span class="built_in">enable</span> --now nginx</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-测试环境"><a href="#1-2-2-测试环境" class="headerlink" title="1.2.2.测试环境"></a>1.2.2.测试环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用nginx的四层访问控制</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@webserver1 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 proxy_protocol;	<span class="comment"># 启用四层访问</span></span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">[root@Webserver1 ~]# systemctl restart nginx.service</span><br><span class="line">[root@Webserver2 ~]# systemctl restart nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## client</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出现上述报错标识nginx只支持四层访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.设定haproxy访问4层</span></span><br><span class="line"><span class="comment">## haproxy</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    tcp		<span class="comment"># 开启四层访问</span></span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.设置4层ip透传</span></span><br><span class="line"><span class="comment"># Webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27; &quot;$proxy_protocol_addr&quot; &#x27;</span>        <span class="comment">#采集透传信息</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart nginx.service</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-测试效果"><a href="#1-2-3-测试效果" class="headerlink" title="1.2.3.测试效果"></a>1.2.3.测试效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">cat</span> /var/log/nginx/access.log</span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-四层负载"><a href="#2-四层负载" class="headerlink" title="2.四层负载"></a>2.四层负载</h2><h3 id="2-1-环境搭建"><a href="#2-1-环境搭建" class="headerlink" title="2.1.环境搭建"></a>2.1.环境搭建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署mariadb数据库</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# dnf install mariadb-server mariadb  -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# vim /etc/my.cnf.d/mariadb-server.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=10	<span class="comment"># webserver2中20</span></span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/run/mariadb/mariadb.pid</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立远程登录用户并授权</span></span><br><span class="line">[root@Webserver1 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 5</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE USER <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;hua&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL ON *.* TO <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># haproxy</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen mariadbcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:6663</span><br><span class="line">    mode    tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:3306 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:3306 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# netstat -antlupe | grep haproxy</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      0          49468      2525/haproxy</span><br><span class="line">tcp        0      0 0.0.0.0:6663            0.0.0.0:*               LISTEN      0          49469      2525/haproxy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-环境测试"><a href="#2-2-环境测试" class="headerlink" title="2.2.环境测试"></a>2.2.环境测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# mysql -uhua -phua -h172.25.254.100 -P 6663</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 6</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT @@server_id;</span><br><span class="line">+-------------+</span><br><span class="line">| @@server_id |</span><br><span class="line">+-------------+</span><br><span class="line">|          20 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br><span class="line">[root@Client ~]# mysql -uhua -phua -h172.25.254.100 -P 6663</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 6</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT @@server_id;</span><br><span class="line">+-------------+</span><br><span class="line">| @@server_id |</span><br><span class="line">+-------------+</span><br><span class="line">|          10 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<h2 id="3-自定义HAProxy-错误界面"><a href="#3-自定义HAProxy-错误界面" class="headerlink" title="3.自定义HAProxy 错误界面"></a>3.自定义HAProxy 错误界面</h2><h3 id="3-1-sorryserver的设定"><a href="#3-1-sorryserver的设定" class="headerlink" title="3.1.sorryserver的设定"></a>3.1.sorryserver的设定</h3><blockquote>
<p>正常的所有服务器如果出现宕机，那么客户将被定向到指定的主机中，这个当业务主机出问题时被临时访问的主机叫做 sorryserver</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在新主机中安装apache（可以用haproxy主机代替）</span></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# dnf install httpd -y</span><br><span class="line">[root@Client ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">47 Listen 8080</span><br><span class="line">[root@Client ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line"></span><br><span class="line">[root@Client ~]# <span class="built_in">echo</span> <span class="string">&quot;哈哈哈&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置sorryserver上线</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  wuwu 172.25.254.99:8080  backup <span class="comment">#sorryserver</span></span><br><span class="line">    </span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭两台正常的业务主机</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# systemctl stop httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl stop httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">哈哈哈</span><br></pre></td></tr></table></figure>

<h3 id="3-2-自定义错误页面"><a href="#3-2-自定义错误页面" class="headerlink" title="3.2.自定义错误页面"></a>3.2.自定义错误页面</h3><p>当所有主机包括sorryserver都宕机了，那么haproxy会提供一个默认访问的错误页面，这个错误页面跟报错代码有关，这个页面可以通过定义来机型设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 出现的错误页面</span></span><br><span class="line">[root@Webserver1 ~]# systemctl stop httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl stop httpd</span><br><span class="line">[root@Client ~]# systemctl stop httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有后端web服务都宕机</span></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;503 Service Unavailable&lt;/h1&gt;</span><br><span class="line">No server is available to handle this request.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">mkdir</span> /errorpage/html/ -p</span><br><span class="line">[root@haproxy ~]# vim /errorpage/html/503.http</span><br><span class="line">HTTP/1.0 503 Service Unavailable</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;什么动物生气最安静&lt;/h1&gt;</span><br><span class="line">大猩猩！！</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">    errorfile 503           /errorpage/html/503.http			<span class="comment">#error 页面</span></span><br><span class="line">    </span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    http</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  wuwu 172.25.254.99:8080  backup</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;什么动物生气最安静&lt;/h1&gt;</span><br><span class="line">大猩猩！！</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-重定向错误到指定网站"><a href="#3-3-重定向错误到指定网站" class="headerlink" title="3.3.重定向错误到指定网站"></a>3.3.重定向错误到指定网站</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">    errorloc 503            http://www.baidu.com			<span class="comment">#error 页面</span></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#在浏览器中访问</span></span><br></pre></td></tr></table></figure>

<p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://d1aa036.webp.li/Build/PixPin_2026-01-27_22-52-16.gif" alt="PixPin_2026-01-27_22-52-16"></p>
<h2 id="4-Haproxy-ACL访问控制"><a href="#4-Haproxy-ACL访问控制" class="headerlink" title="4.Haproxy ACL访问控制"></a>4.Haproxy ACL访问控制</h2><h3 id="4-1-实验素材"><a href="#4-1-实验素材" class="headerlink" title="4.1.实验素材"></a>4.1.实验素材</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在浏览器或者curl主机中设定本地解析</span></span><br><span class="line">以管理员身份打开 C:\Windows\System32\drivers\etc\hosts</span><br><span class="line">172.25.254.100  www.kaitumei.com     bbs.kaitumei.com    news.kaitumei.com   login.kaitumei.com</span><br><span class="line"><span class="comment"># #在Linux中设定解析</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">172.25.254.100  www.kaitumei.com     bbs.kaitumei.com    news.kaitumei.com   login.kaitumei.com</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">ping  bbs.timinglee.org</span><br></pre></td></tr></table></figure>

<h3 id="4-2-设定基础的haproxy实验配置"><a href="#4-2-设定基础的haproxy实验配置" class="headerlink" title="4.2.设定基础的haproxy实验配置"></a>4.2.设定基础的haproxy实验配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    use_backend     webserver-80-web1</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br></pre></td></tr></table></figure>

<h3 id="4-3-基础acl示例"><a href="#4-3-基础acl示例" class="headerlink" title="4.3.基础acl示例"></a>4.3.基础acl示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在访问的网址中，所有以.com  结尾的访问10，其他访问20</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com			<span class="comment">#acl列表</span></span><br><span class="line">    </span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span>	<span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2		<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl  www.kaitumei.com</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">[root@Client ~]# curl  www.kaitumei.org</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#基于访问头部</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com          <span class="comment">#acl列表</span></span><br><span class="line">    acl <span class="built_in">head</span> hdr_beg(host) -i bbs.</span><br><span class="line"></span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">head</span>  <span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2       <span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试效果</span></span><br><span class="line">[root@Client ~]# curl  bbs.kaitumei.com</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">[root@Client ~]# curl  www.kaitumei.com</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#base参数acl</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl pathdir base_dir -i /yeming</span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> pathdir</span><br><span class="line">    default_backend webserver-80-web2		<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[root@Webserver1+2 ~]# <span class="built_in">mkdir</span> -p /var/www/html/yeming/</span><br><span class="line">[root@Webserver1+2 ~]# <span class="built_in">mkdir</span> -p /var/www/html/yeming/test/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> yeming - 192.168.0.10  &gt; /var/www/html/yeming/index.html</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> yeming/test - 192.168.0.10 &gt; /var/www/html/yeming/test/index.html</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> yeming - 192.168.0.20  &gt; /var/www/html/yeming/index.html</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> yeming/test - 192.168.0.20 &gt; /var/www/html/yeming/test/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100/yeming/</span><br><span class="line">yeming - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100/yeming/test/</span><br><span class="line">yeming/test - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100/index.html</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#acl禁止列表黑名单</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com			<span class="comment">#acl列表</span></span><br><span class="line">    </span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span>	<span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2		<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">	acl invalid_src src 172.25.254.99</span><br><span class="line">    http-request deny <span class="keyword">if</span> invalid_src</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;</span><br><span class="line">Request forbidden by administrative rules.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止列表白名单</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com          <span class="comment">#acl列表</span></span><br><span class="line"></span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span>  <span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2       <span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">    acl invalid_src src 172.25.254.99</span><br><span class="line">    http-request deny <span class="keyword">if</span> ! invalid_src</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line">    </span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# curl  172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;</span><br><span class="line">Request forbidden by administrative rules.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>Haproxy全站加密</p>
<p>1.制作证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# <span class="built_in">mkdir</span> /etc/haproxy/certs/</span><br><span class="line">[[root@Haproxy ~]# openssl req -newkey rsa:2048 -nodes -sha256  -keyout /etc/haproxy/certs/yeming.key -x509 -days 365 -out /etc/haproxy/certs/yeming.crt</span><br><span class="line">.+...+.+++++++++++++++++++++++++++++++++++++++*.+.+.....+++++++++++++++++++++++++++++++++++++++*.......+...+......+.+..............+.......+.....+...+....+...+.....+....+...+........+.............+.....+......+...............+.+.....+.........+..........+...+..++++++</span><br><span class="line">...+++++++++++++++++++++++++++++++++++++++*.....+..+.........+.+........+......+++++++++++++++++++++++++++++++++++++++*...+.+.....+.......+......+.........+..+..................+.+.....+..........+.........+............+........+.+..+....+.....+.........+......+.+...............+...+.........+.....+.......+..................+.....+............+....+............+.....+.............+.........+..+...+.+..+..................+.+..............+....+...+..+......+.+........+...+.........+.+........+....+...+...+.....+......+.+..+...+.......+.....+.+.....++++++</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Hunan</span><br><span class="line">Locality Name (eg, city) [Default City]:Hengyang</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:hh</span><br><span class="line">Organizational Unit Name (eg, section) []:hh</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:www.kaitumei.com</span></span><br><span class="line"><span class="string">Email Address []:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@Haproxy ~]# ls /etc/haproxy/certs/</span></span><br><span class="line"><span class="string">yeming.crt  yeming.key</span></span><br><span class="line"><span class="string">[root@Haproxy ~]# cat /etc/haproxy/certs/yeming.&#123;key,crt&#125; &gt; /etc/haproxy/certs/yeming.pem</span></span><br></pre></td></tr></table></figure>

<p>2.全站加密</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg </span><br><span class="line">frontend webcluster-http</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    redirect scheme https <span class="keyword">if</span> ! &#123; ssl_fc &#125;</span><br><span class="line"></span><br><span class="line">listen webcluster-https</span><br><span class="line">    <span class="built_in">bind</span>        *:443 ssl  crt /etc/haproxy/certs/yeming.pem</span><br><span class="line">    mode        http</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server haha 192.168.0.10:80  check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server hehe 192.168.0.20:80  check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl -v -k -L http://172.25.254.100</span><br><span class="line">*   Trying 172.25.254.100:80...</span><br><span class="line">* Connected to 172.25.254.100 (172.25.254.100) port 80 (#0)</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: 172.25.254.100</span><br><span class="line">&gt; User-Agent: curl/7.76.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 302 Found</span><br><span class="line">&lt; content-length: 0</span><br><span class="line">&lt; location: https://172.25.254.100/</span><br><span class="line">&lt; cache-control: no-cache</span><br><span class="line">&lt;</span><br><span class="line">* Connection <span class="comment">#0 to host 172.25.254.100 left intact</span></span><br><span class="line">* Clear auth, redirects to port from 80 to 443Issue another request to this URL: <span class="string">&#x27;https://172.25.254.100/&#x27;</span></span><br><span class="line">*   Trying 172.25.254.100:443...</span><br><span class="line">* Connected to 172.25.254.100 (172.25.254.100) port 443 (#1)</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http/1.1</span><br><span class="line">*  CAfile: /etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">* TLSv1.0 (OUT), TLS header, Certificate Status (22):</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Certificate Status (22):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, CERT verify (15):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Finished (20):</span><br><span class="line">* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384</span><br><span class="line">* ALPN, server did not agree to a protocol</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C=CN; ST=Hunan; L=Hengyang; O=hh; OU=hh; CN=www.kaitumei.com</span><br><span class="line">*  start <span class="built_in">date</span>: Jan 27 17:03:35 2026 GMT</span><br><span class="line">*  expire <span class="built_in">date</span>: Jan 27 17:03:35 2027 GMT</span><br><span class="line">*  issuer: C=CN; ST=Hunan; L=Hengyang; O=hh; OU=hh; CN=www.kaitumei.com</span><br><span class="line">*  SSL certificate verify result: self-signed certificate (18), continuing anyway.</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Unknown (23):</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: 172.25.254.100</span><br><span class="line">&gt; User-Agent: curl/7.76.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):</span><br><span class="line">* old SSL session ID is stale, removing</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; <span class="built_in">date</span>: Tue, 27 Jan 2026 17:09:23 GMT</span><br><span class="line">&lt; server: Apache/2.4.62 (Red Hat Enterprise Linux)</span><br><span class="line">&lt; last-modified: Tue, 27 Jan 2026 07:43:15 GMT</span><br><span class="line">&lt; etag: <span class="string">&quot;1c-64959c6bf22d5&quot;</span></span><br><span class="line">&lt; accept-ranges: bytes</span><br><span class="line">&lt; content-length: 28</span><br><span class="line">&lt; content-type: text/html; charset=UTF-8</span><br><span class="line">&lt;</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">* Connection <span class="comment">#1 to host 172.25.254.100 left intact</span></span><br></pre></td></tr></table></figure>

<h1 id="2026-1-28"><a href="#2026-1-28" class="headerlink" title="2026-1-28"></a>2026-1-28</h1><h2 id="1-Keepalived实验环境设定"><a href="#1-Keepalived实验环境设定" class="headerlink" title="1.Keepalived实验环境设定"></a>1.Keepalived实验环境设定</h2><h3 id="1-环境设定图"><a href="#1-环境设定图" class="headerlink" title="1.环境设定图"></a>1.环境设定图</h3><p> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="G:\图片\kastatus.png" alt="kastatus"></p>
<h3 id="2-环境设定"><a href="#2-环境设定" class="headerlink" title="2.环境设定"></a>2.环境设定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部署rs1和rh2（单网卡NAT模式）</span></span><br><span class="line">[root@rs1 ~]# vmset.sh rs1 eth0 172.25.254.10 </span><br><span class="line">[root@rs1 ~]# dnf install httpd -y</span><br><span class="line">[root@rs1 ~]# <span class="built_in">echo</span> RS1 - 172.25.254.10 &gt; /var/www/html/index.html</span><br><span class="line">[root@rs1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">[root@rs2 ~]# vmset.sh rs2 eth0 172.25.254.20 </span><br><span class="line">[root@rs2 ~]# dnf install httpd -y</span><br><span class="line">[root@rs2 ~]# <span class="built_in">echo</span> RS2 - 172.25.254.20 &gt; /var/www/html/index.html</span><br><span class="line">[root@rs2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.10</span><br><span class="line">RS1 - 172.25.254.10</span><br><span class="line">                                                                                                    ✔</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">[2026-01-28 10:36.42]  ~</span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.20</span><br><span class="line">RS2 - 172.25.254.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定ka1和ka2</span></span><br><span class="line">[root@KA1 ~]# vmset.sh KA1 eth0 172.25.254.50 </span><br><span class="line">[root@KA2 ~]# vmset.sh KA2 eth0 172.25.254.60 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定本地解析</span></span><br><span class="line">[root@KA1 ~]# vim /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">172.25.254.50     KA1</span><br><span class="line">172.25.254.60     KA2</span><br><span class="line">172.25.254.10     rs1</span><br><span class="line">172.25.254.20     rs2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 60 10 20; <span class="keyword">do</span> scp /etc/hosts 172.25.254.<span class="variable">$i</span>:/etc/hosts; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在所有主机中查看/etc/hosts</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在ka1中开启时间同步服务</span></span><br><span class="line">[root@KA1 ~]# vim /etc/chrony.conf</span><br><span class="line"> 26 allow 0.0.0.0/0</span><br><span class="line"> 29 <span class="built_in">local</span> stratum 10</span><br><span class="line"> </span><br><span class="line">[root@KA1 ~]# systemctl restart chronyd</span><br><span class="line">[root@KA1 ~]# systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在ka2中使用ka1的时间同步服务</span></span><br><span class="line">[root@KA2 ~]# vim /etc/chrony.conf</span><br><span class="line">pool 172.25.254.50 iburst</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# systemctl restart chronyd</span><br><span class="line">[root@KA2 ~]# systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# chronyc sources -v</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current best, <span class="string">&#x27;+&#x27;</span> = combined, <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /             <span class="string">&#x27;x&#x27;</span> = may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = too variable, <span class="string">&#x27;?&#x27;</span> = unusable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^* KA1                           3   6    17    13   +303ns[+6125ns] +/-   69ms </span><br></pre></td></tr></table></figure>

<h2 id="2-Keepalived日志分离"><a href="#2-Keepalived日志分离" class="headerlink" title="2.Keepalived日志分离"></a>2.Keepalived日志分离</h2><p>默认情况下。keepalived的日志会被保存在&#x2F;var&#x2F;log&#x2F;messages文件中，这个文件中除了含有keepalived的日志外，还有其他服务的日志信息，这样不利于对于keepalived的日志进行查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/sysconfig/keepalived</span><br><span class="line">KEEPALIVED_OPTIONS=<span class="string">&quot;-D -S 6&quot;</span></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# vim /etc/rsyslog.conf</span><br><span class="line">local6.*                                                /var/log/keepalived.log</span><br><span class="line">[root@KA1 ~]# systemctl restart rsyslog.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# <span class="built_in">ls</span> -l /var/log/keepalived.log</span><br><span class="line"><span class="built_in">ls</span>: 无法访问 <span class="string">&#x27;keepalived.log&#x27;</span>: 没有那个文件或目录</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA1 ~]#  <span class="built_in">ls</span> -l /var/log/keepalived.log</span><br><span class="line">-rw------- 1 root root 3294  1月 28 15:09 /var/log/keepalived.log</span><br></pre></td></tr></table></figure>

<h2 id="3-Keepalived的子配置文件设定"><a href="#3-Keepalived的子配置文件设定" class="headerlink" title="3.Keepalived的子配置文件设定"></a>3.Keepalived的子配置文件设定</h2><p>在主配置文件中如果写入过多的配置不利于对于主配置文件的阅读</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include /etc/keepalived/conf.d/*.conf			<span class="comment">#指定独立子配置文件</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">mkdir</span>  /etc/keepalived/conf.d -p</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/conf.d/webvip.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# keepalived -t -f /etc/keepalived/keepalived.conf</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 17383  bytes 1417554 (1.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 32593  bytes 3135052 (2.9 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 118  bytes 6828 (6.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 118  bytes 6828 (6.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-抢占模式"><a href="#4-抢占模式" class="headerlink" title="4.抢占模式"></a>4.抢占模式</h2><h3 id="4-1-抢占模式-默认的，谁优先级高就把vip放到哪里"><a href="#4-1-抢占模式-默认的，谁优先级高就把vip放到哪里" class="headerlink" title="4.1.抢占模式( 默认的，谁优先级高就把vip放到哪里)"></a>4.1.抢占模式( 默认的，谁优先级高就把vip放到哪里)</h3><h3 id="4-2-非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）"><a href="#4-2-非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）" class="headerlink" title="4.2.非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）"></a>4.2.非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP			<span class="comment">#非抢占模式互为backup</span></span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    nopreempt				<span class="comment">#启动非抢占模式</span></span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    nopreempt				<span class="comment">#开启非抢占模式</span></span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 18917  bytes 1546417 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 34775  bytes 3349412 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 22521  bytes 1553701 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 18517  bytes 1535122 (1.4 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 84  bytes 5128 (5.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 84  bytes 5128 (5.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启KA1的服务ip不会被抢占到1中</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 19102  bytes 1561277 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 35034  bytes 3375682 (3.2 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h3 id="4-3-延迟抢占"><a href="#4-3-延迟抢占" class="headerlink" title="4.3.延迟抢占"></a>4.3.延迟抢占</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP			<span class="comment">#非抢占模式互为backup</span></span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10				<span class="comment">#启动延迟抢占，延迟10s抢占</span></span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10				<span class="comment">#启动延迟抢占，延迟10s抢占</span></span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#在一个独立的shell中开启ip的监控</span></span><br><span class="line">[root@KA1 ~]# watch -n 1 ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA1另外的shell中关闭keepalived</span></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl start  keepalived.service</span><br><span class="line"><span class="comment">#操作完毕后观察监控中vip的迁移延迟过程</span></span><br></pre></td></tr></table></figure>

<h2 id="5-keepalived的单播模式"><a href="#5-keepalived的单播模式" class="headerlink" title="5.keepalived的单播模式"></a>5.keepalived的单播模式</h2><p>为什么要单播，组播模式使用的网址资源最少，但是不能跨网络，如果主备两台主机是跨网络的，那么只能启用单播来实现vrrp通告</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   <span class="comment">#vrrp_mcast_group4 224.0.0.44			#关闭组播</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    unicast_src_ip 172.25.254.50		<span class="comment">#指定单播源地址，通常是本机IP</span></span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">      172.25.254.60						<span class="comment">#指定单播接收地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   <span class="comment">#vrrp_mcast_group4 224.0.0.44			#关闭组播</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    unicast_src_ip 172.25.254.60		<span class="comment">#指定单播源地址，通常是本机IP</span></span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">      172.25.254.50						<span class="comment">#指定单播接收地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="comment">#在KA1中开启独立shell监控播报信息</span></span><br><span class="line">[root@KA1 ~]# tcpdump -i eth0 -nn src host 172.25.254.50 and dst 172.25.254.60</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA2中开启独立shell监控播报信息</span></span><br><span class="line">[root@KA2 ~]# tcpdump -i eth0 -nn src host 172.25.254.60 and dst 172.25.254.50</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA1正常时</span></span><br><span class="line"><span class="comment">#ka2播报信息不显示通告内容</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#vip会被迁移到KA2,KA2上开始显示播报内容</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#vip因为优先级被KA1抢占，KA2中播报停止</span></span><br></pre></td></tr></table></figure>

<p>Keepalived业务vip迁移告警</p>
<p>1.邮件告警环境构建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装邮件软件</span></span><br><span class="line">[root@KA1 ~]#  dnf install s-nail postfix   -y</span><br><span class="line">[root@KA2 ~]#  dnf install s-nail postfix   -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动邮件代理</span></span><br><span class="line">[root@KA1 ~]# systemctl start postfix.service</span><br><span class="line">[root@KA2 ~]# systemctl start postfix.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#设定sendmail可以通过公网邮箱发送邮件下面方式人选其一</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在Linux主机中配置mailrc（KA1+KA2）</span></span><br><span class="line">[root@KA1+KA2 ~]# vim /etc/mail.rc</span><br><span class="line"><span class="built_in">set</span> smtp=smtp.qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=kaitumei@foxmail.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=oxsfthfenecmfaae</span><br><span class="line"><span class="built_in">set</span> from=kaitumei@foxmail.com</span><br><span class="line"><span class="built_in">set</span> ssl-verify=ignore</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试邮件</span></span><br><span class="line">[root@KA1 mail]# <span class="built_in">echo</span> hello | mailx -s <span class="built_in">test</span> kaitumei@163.com</span><br><span class="line"></span><br><span class="line">[root@KA1 mail]# mailq		<span class="comment">#查看邮件队列</span></span><br><span class="line">Mail queue is empty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 mail]# mail		<span class="comment">#查看是否又退信</span></span><br><span class="line">s-nail version v14.9.22.  Type `?<span class="string">&#x27; for help</span></span><br><span class="line"><span class="string">/var/spool/mail/root: 1 message</span></span><br><span class="line"><span class="string">▸   1 Mail Delivery Subsys  2026-01-28 16:26   69/2210  &quot;Returned mail: see transcript for details  &quot;</span></span><br><span class="line"><span class="string">&amp;q 退出</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#查看对应邮箱是否有邮件收到</span></span><br></pre></td></tr></table></figure>

<p>2.设定keepalived告警脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# <span class="built_in">mkdir</span>  -p /etc/keepalived/scripts</span><br><span class="line">[root@KA2 ~]#  <span class="built_in">mkdir</span>  -p /etc/keepalived/scripts</span><br><span class="line"></span><br><span class="line"><span class="comment">#编写告警脚本</span></span><br><span class="line">[root@KA1+2 ~]#  vim /etc/keepalived/scripts/waring.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mail_dest=<span class="string">&#x27;kaitumei@163.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">mail_send</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    mail_subj=<span class="string">&quot;<span class="variable">$HOSTNAME</span> to be <span class="variable">$1</span> vip 转移&quot;</span></span><br><span class="line">    mail_mess=<span class="string">&quot;`date +%F\ %T`: vrrp 转移,<span class="variable">$HOSTNAME</span> 变为 <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$mail_mess</span>&quot;</span> | mail -s <span class="string">&quot;<span class="variable">$mail_subj</span>&quot;</span> <span class="variable">$mail_dest</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    master)</span><br><span class="line">    mail_send master</span><br><span class="line">    ;;</span><br><span class="line">    backup)</span><br><span class="line">    mail_send backup</span><br><span class="line">    ;;</span><br><span class="line">    fault)</span><br><span class="line">    mail_send fault</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# <span class="built_in">chmod</span>  +x /etc/keepalived/scripts/waring.sh</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# /etc/keepalived/scripts/waring.sh master</span><br><span class="line"></span><br><span class="line"><span class="comment">#对应邮箱中会出现邮件</span></span><br></pre></td></tr></table></figure>

<p>3.配置keepalived告警</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1和KA2中设定配置文件</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">   enable_script_security</span><br><span class="line">   script_user root</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">  <span class="comment"># unicast_src_ip 172.25.254.50</span></span><br><span class="line">  <span class="comment"># unicast_peer &#123;</span></span><br><span class="line">  <span class="comment">#   172.25.254.60</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master <span class="string">&quot;/etc/keepalived/scripts/waring.sh master&quot;</span></span><br><span class="line">    notify_backup <span class="string">&quot;/etc/keepalived/scripts/waring.sh backup&quot;</span></span><br><span class="line">    notify_fault <span class="string">&quot;/etc/keepalived/scripts/waring.sh fault&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service		<span class="comment">#停止服务后查看邮件</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service	<span class="comment">#开启服务后查看邮件</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6-Keepalived双主模式"><a href="#6-Keepalived双主模式" class="headerlink" title="6.Keepalived双主模式"></a>6.Keepalived双主模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;						<span class="comment">#第一个虚拟路由，以master身份设定</span></span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance DB_VIP &#123;				<span class="comment">#第二个虚拟路由。以backup身份设定</span></span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 52</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.200/24 dev eth0 label eth0:1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance DB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 52</span><br><span class="line">    preempt_delay 10</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      172.25.254.200/24 dev eth0 label eth0:1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 38766  bytes 3548249 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 67456  bytes 6209788 (5.9 MiB)</span><br><span class="line">        TX errors 0  dropped 2 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 782  bytes 60465 (59.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 782  bytes 60465 (59.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 46164  bytes 3559703 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 38170  bytes 3306899 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 532  bytes 39588 (38.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 532  bytes 39588 (38.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 46204  bytes 3562823 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 38240  bytes 3313319 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 39277  bytes 3653121 (3.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 67902  bytes 6264989 (5.9 MiB)</span><br><span class="line">        TX errors 0  dropped 2 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="7-双主模式代理不同业务实现高可用"><a href="#7-双主模式代理不同业务实现高可用" class="headerlink" title="7.双主模式代理不同业务实现高可用"></a>7.双主模式代理不同业务实现高可用</h2><h3 id="1-实验环境"><a href="#1-实验环境" class="headerlink" title="1.实验环境"></a>1.实验环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#web服务设定再个实验已经设定完成</span></span><br><span class="line"><span class="comment">#在rs中设定lo添加vip2 172.25.254.200、32</span></span><br><span class="line"><span class="comment">#在rs中搭建数据库</span></span><br><span class="line">[root@rs1+2 ~]# dnf install mariadb-server -y</span><br><span class="line">[root@rs1+2 ~]# systemctl <span class="built_in">enable</span> --now mariadb</span><br><span class="line">[root@rs1+2 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 3</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE USER <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;hua&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL ON *.* TO <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@rs1 ~]# mysql -uhua -phua -h172.25.254.10</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 4</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line"></span><br><span class="line">[root@rs1 ~]# mysql -ulee -plee -h172.25.254.20</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 4</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-实现不同vip代理不同业务"><a href="#2-实现不同vip代理不同业务" class="headerlink" title="2.实现不同vip代理不同业务"></a>2.实现不同vip代理不同业务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#KA1和KA2</span></span><br><span class="line">[root@KA1+2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">include /etc/keepalived/conf.d/webserver.conf</span><br><span class="line">include /etc/keepalived/conf.d/datebase.conf</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/keepalived/conf.d/webserver.conf</span><br><span class="line">virtual_server 172.25.254.100 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.10 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              status_code 200</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 1</span><br><span class="line">            retry 3</span><br><span class="line">            delay_before_retry 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.20 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 80</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/conf.d/datebase.conf</span><br><span class="line">virtual_server 172.25.254.200 3306 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.10 3306 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 3306</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.20 3306 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 3306</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rs1+2 ~]# vim /etc/NetworkManager/system-connections/lo.nmconnection</span><br><span class="line">address3=172.25.254.200/32</span><br><span class="line">[root@rs1 ~]# nmcli connection reload</span><br><span class="line">[root@rs1 ~]# nmcli connection up lo</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rs2 ~]# mysql -uhua  -phua  -h172.25.254.200</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 89</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">RS1 - 172.25.254.10</span><br><span class="line">                                                                                                    ✔</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">[2026-01-29 11:58.55]  ~</span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">RS2 - 172.25.254.20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="8-利用VRRP-Script-实现全能高可用"><a href="#8-利用VRRP-Script-实现全能高可用" class="headerlink" title="8.利用VRRP Script 实现全能高可用"></a>8.利用VRRP Script 实现全能高可用</h2><h3 id="1-实验环境-1"><a href="#1-实验环境-1" class="headerlink" title="1.实验环境"></a>1.实验环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1和KA2中安装haproxy</span></span><br><span class="line">[root@KA1+2 ~]# dnf install haproxy-2.4.22-4.el9.x86_64  -y</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_nonlocal_bind=1</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webserver</span><br><span class="line">    <span class="built_in">bind</span> 172.25.254.100:80</span><br><span class="line">    mode http</span><br><span class="line">    server web1 172.25.254.10:80 check</span><br><span class="line">    server web2 172.25.254.20:80 check</span><br><span class="line">    </span><br><span class="line">[root@KA1+2 ~]# systemctl <span class="built_in">enable</span> --now haproxy.service</span><br></pre></td></tr></table></figure>

<h3 id="2-利用案例理解vrrp-scripts"><a href="#2-利用案例理解vrrp-scripts" class="headerlink" title="2.利用案例理解vrrp_scripts"></a>2.利用案例理解vrrp_scripts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1主机中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/scripts/test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ ! -f <span class="string">&quot;/mnt/lee&quot;</span> ]</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_lee &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/test.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt no</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_lee</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA2</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_lee &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/test.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_lee</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 98198  bytes 9235557 (8.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 145101  bytes 12247386 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">touch</span> /mnt/lee</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 97968  bytes 9216259 (8.7 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 144858  bytes 12219108 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">rm</span> -fr /mnt/lee</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 98198  bytes 9235557 (8.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 145101  bytes 12247386 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h3 id="3-keepalived-haproxy"><a href="#3-keepalived-haproxy" class="headerlink" title="3.keepalived + haproxy"></a>3.keepalived + haproxy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/keepalived/scripts/haproxy_check.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">killall -0 haproxy &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">chmod</span> +x /etc/keepalived/scripts/haproxy_check.sh</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_script haporxy_check &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/haproxy_check.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        haporxy_check</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">通过关闭和开启haproxy来观察vip是否迁移</span><br></pre></td></tr></table></figure>

<h1 id="2026-1-29"><a href="#2026-1-29" class="headerlink" title="2026-1-29"></a>2026-1-29</h1><h2 id="1-Nginx的源码编译"><a href="#1-Nginx的源码编译" class="headerlink" title="1.Nginx的源码编译"></a>1.Nginx的源码编译</h2><h3 id="1-1-下载软件"><a href="#1-1-下载软件" class="headerlink" title="1.1.下载软件"></a>1.1.下载软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx ~]# wget https://nginx.org/download/nginx-1.28.1.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="1-2-解压"><a href="#1-2-解压" class="headerlink" title="1.2.解压"></a>1.2.解压</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx ~]# tar -zxf nginx-1.28.1.tar.gz</span><br><span class="line">[root@Nginx ~]# cd nginx-1.28.1/</span><br><span class="line">[root@Nginx nginx-1.28.1]# ls</span><br><span class="line">auto     CHANGES.ru          conf       contrib          html     man        SECURITY.md</span><br><span class="line">CHANGES  CODE_OF_CONDUCT.md  configure  CONTRIBUTING.md  LICENSE  README.md  src</span><br></pre></td></tr></table></figure>

<h3 id="1-3-检测环境"><a href="#1-3-检测环境" class="headerlink" title="1.3.检测环境"></a>1.3.检测环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装依赖性</span></span><br><span class="line">[root@Nginx ~]# dnf install gcc openssl-devel.x86_64 pcre2-devel.x86_64 zlib-devel -y</span><br><span class="line"></span><br><span class="line">[root@Nginx nginx-1.28.1]# ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module</span><br></pre></td></tr></table></figure>

<h3 id="1-4-编译"><a href="#1-4-编译" class="headerlink" title="1.4.编译"></a>1.4.编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx nginx-1.28.1]# make</span><br><span class="line">[root@Nginx nginx-1.28.1]# make install</span><br></pre></td></tr></table></figure>

<h3 id="1-5-nginx启动"><a href="#1-5-nginx启动" class="headerlink" title="1.5.nginx启动"></a>1.5.nginx启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#设定环境变量</span><br><span class="line">[root@Nginx sbin]# vim  ~/.bash_profile</span><br><span class="line">export PATH=$PATH:/usr/local/nginx/sbin</span><br><span class="line"></span><br><span class="line">[root@Nginx sbin]# source   ~/.bash_profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Nginx logs]# useradd  -s /sbin/nologin -M nginx</span><br><span class="line">[root@Nginx logs]# nginx</span><br><span class="line">[root@Nginx logs]# ps aux | grep nginx</span><br><span class="line">root       44012  0.0  0.1  14688  2356 ?        Ss   17:01   0:00 nginx: master process nginx</span><br><span class="line">nginx      44013  0.0  0.2  14888  3892 ?        S    17:01   0:00 nginx: worker process</span><br><span class="line">root       44015  0.0  0.1   6636  2176 pts/0    S+   17:01   0:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#测试</span><br><span class="line">[root@Nginx logs]# echo timinglee &gt; /usr/local/nginx/html/index.html</span><br><span class="line"></span><br><span class="line">[root@Nginx logs]# curl  172.25.254.100</span><br><span class="line">timinglee</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://kaitumei.2345.plus">Kaitumei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://kaitumei.2345.plus/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">http://kaitumei.2345.plus/2026/02/02/云原生高级课程笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://kaitumei.2345.plus" target="_blank">Yumi-an</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><a class="post-meta__tags" href="/tags/liunx/">liunx</a></div><div class="post-share"><div class="social-share" data-image="https://b5dbf24.webp.li/icons/yunyuansheng.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related  no-desc" href="/2026/02/01/PicGo%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/" title="从零开始搭建图床"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/tuchuang.gif" onerror="onerror=null;src='/img/favicon.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">从零开始搭建图床</div></div></div></a><a class="pagination-related  no-desc" href="/2026/02/04/front-mateer%E8%AF%B4%E6%98%8E/" title="主题 Butterfly 5.5.4 基础教程"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/hexo/butterfly.png" onerror="onerror=null;src='/img/favicon.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">主题 Butterfly 5.5.4 基础教程</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/tx.jpg" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="avatar"/></div><div class="author-info-name">Kaitumei</div><div class="author-info-description">个人博客网站，记录笔记与项目</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kaitumei"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://qm.qq.com/q/OXzhqWfsoo" target="_blank" title="qq"><i class="fa-brands fa-qq" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/2002252637?spm_id_from=333.1007.0.0" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili" style="color: #ffc0cb;"></i></a><a class="social-icon" href="https://github.com/kaitumei" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:kaitumei@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><center>这是一个记录学习与技术的博客，希望与各位一同进步与成长。</center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#26-1-13-%E5%A4%8D%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">26-1-13 (复习)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E6%A0%B8%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFshell%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFLinux%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%80%E6%BA%90%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1.什么是内核、什么是shell、什么是Linux、什么是开源？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Linux%E4%B8%AD%E5%91%BD%E4%BB%A4%E5%BD%95%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">2.Linux中命令录入方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1.命令行快捷键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%85%89%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1.光标移动快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E5%91%BD%E4%BB%A4%E7%BC%96%E8%BE%91%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2.命令编辑快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">2.1.3.历史命令快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">2.1.4.进程控制快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-%E7%BB%88%E7%AB%AF%E6%93%8D%E4%BD%9C%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">2.1.5.终端操作快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-Linux-Bash-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BF%AB%E6%8D%B7%E9%94%AE%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">2.1.6.Linux Bash 命令行快捷键速查表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97%E5%B8%AE%E5%8A%A9"><span class="toc-number">1.3.</span> <span class="toc-text">3.命令行中如何获得帮助</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-linux%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">4.linux上下文管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E8%A1%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1.常见命令表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2.补充说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%96%87%E4%BB%B6%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">5.文件批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Linux-%E6%96%87%E4%BB%B6%E6%89%B9%E5%A4%84%E7%90%86%E5%91%BD%E4%BB%A4%E8%A1%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1.Linux 文件批处理命令表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AC%A6%E5%8F%B7-%E5%AD%97%E7%AC%A6%E7%B1%BB-%E5%91%BD%E4%BB%A4%E8%A1%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2.正则表达式符号 &#x2F; 字符类 命令表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3.补充说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4.总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Linux%E4%B8%AD%E7%9A%84%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA"><span class="toc-number">1.6.</span> <span class="toc-text">6.Linux中的输入和输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E6%98%AF%E5%95%A5%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1.字符设备是啥？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2.输入与输出</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-1-14-%E5%A4%8D%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">26-1-14 (复习)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Rhel9-6%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">1.Rhel9.6安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Rhel9-6%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.Rhel9.6配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%85%B3%E9%97%AD%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1.关闭安全配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%9B%B4%E6%94%B9%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.更改网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%B0%B8%E4%B9%85%E6%8C%82%E8%BD%BD"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3.永久挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%BA%90%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.4.源仓库配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E6%BA%90"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">2.4.1.本地仓库源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E7%BD%91%E7%BB%9C%E6%BA%90"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">2.4.2.网络源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E8%87%AA%E5%BB%BA%E4%BB%93%E5%BA%93%E6%BA%90"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">2.4.3.自建仓库源</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-1-16-%E5%A4%8D%E4%B9%A0"><span class="toc-number">3.</span> <span class="toc-text">26-1-16 (复习)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">1.网络管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%BD%91%E7%BB%9Cip%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1.网络ip配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-1-17-%E5%A4%8D%E4%B9%A0"><span class="toc-number">4.</span> <span class="toc-text">26-1-17 (复习)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E5%BC%95%E5%AF%BC%E8%BF%87%E7%A8%8B%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.</span> <span class="toc-text">1.系统引导过程修复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1.磁盘损坏修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E7%A3%81%E7%9B%98%E5%BC%95%E5%AF%BC%E9%97%AE%E9%A2%98%E8%A1%A8%E7%8E%B0"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">1.1.1.磁盘引导问题表现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E7%A3%81%E7%9B%98%E5%BC%95%E5%AF%BC%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">1.1.2.磁盘引导修复过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6%E7%BC%BA%E5%A4%B1%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2.引导文件缺失修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E6%9F%A5%E8%AF%A2%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">1.2.1.查询引导文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E4%B8%BB%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6%E7%BC%BA%E5%A4%B1%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">1.2.2.主引导文件缺失修复</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-1-%E5%88%A0%E9%99%A4%E4%B8%BB%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.2.2.1.</span> <span class="toc-text">1.2.2.1.删除主引导文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-2-%E9%97%AE%E9%A2%98%E8%A1%A8%E7%8E%B0"><span class="toc-number">4.1.2.2.2.</span> <span class="toc-text">1.2.2.2.问题表现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-3-%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.2.2.3.</span> <span class="toc-text">1.2.2.3.修复过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E5%AD%90%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6%E7%BC%BA%E5%A4%B1%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">1.2.3.子引导文件缺失修复</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-1-%E5%88%A0%E9%99%A4%E5%AD%90%E5%BC%95%E5%AF%BC%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.2.3.1.</span> <span class="toc-text">1.2.3.1.删除子引导文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-2-%E9%97%AE%E9%A2%98%E8%A1%A8%E7%8E%B0"><span class="toc-number">4.1.2.3.2.</span> <span class="toc-text">1.2.3.2.问题表现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-3-%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.2.3.3.</span> <span class="toc-text">1.2.3.3.修复过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%86%85%E6%A0%B8%E6%96%87%E4%BB%B6%E4%BF%AE%E5%A4%8D"><span class="toc-number">4.1.3.</span> <span class="toc-text">1.3.内核文件修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E5%88%A0%E9%99%A4%E5%86%85%E6%A0%B8%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">1.3.1.删除内核文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E9%97%AE%E9%A2%98%E8%A1%A8%E7%8E%B0"><span class="toc-number">4.1.3.2.</span> <span class="toc-text">1.3.2.问题表现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.3.3.</span> <span class="toc-text">1.3.3.解决方法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-19-%E5%A4%8D%E4%B9%A0"><span class="toc-number">5.</span> <span class="toc-text">2026-1-19 (复习)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-apache%E6%9E%84%E5%BB%BAweb%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">1.apache构建web服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.1.主配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8F%91%E5%B8%83%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">1.1.1.更改默认发布文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8F%91%E5%B8%83%E7%9B%AE%E5%BD%95"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">1.1.2.修改默认发布目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E7%AB%AF%E5%8F%A3%E4%BF%AE%E6%94%B9"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">1.1.3.端口修改</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AD%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.2.</span> <span class="toc-text">1.2.子配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">1.2.1.虚拟主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">1.2.2.访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-1-%E5%9F%BA%E4%BA%8EIP"><span class="toc-number">5.1.2.2.1.</span> <span class="toc-text">1.2.2.1.基于IP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-2-%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81"><span class="toc-number">5.1.2.2.2.</span> <span class="toc-text">1.2.2.2.基于用户认证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-https"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">1.2.3.https</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-20"><span class="toc-number">6.</span> <span class="toc-text">2026-1-20</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NAT%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text">1.NAT模式实现方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-VS%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">6.1.1.</span> <span class="toc-text">1.1.VS主机配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-RS1%E9%85%8D%E7%BD%AE"><span class="toc-number">6.1.2.</span> <span class="toc-text">1.2.RS1配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-RS2%E9%85%8D%E7%BD%AE"><span class="toc-number">6.1.3.</span> <span class="toc-text">1.3.RS2配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E9%AA%8C%E8%AF%81"><span class="toc-number">6.1.4.</span> <span class="toc-text">1.4.验证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-22"><span class="toc-number">7.</span> <span class="toc-text">2026-1-22</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-DR%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.1.</span> <span class="toc-text">1.DR模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%8E%AF%E5%A2%83%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">7.1.1.</span> <span class="toc-text">1.1.环境流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.2.</span> <span class="toc-text">1.2.环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">7.1.2.1.</span> <span class="toc-text">1.2.1.配置路由器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-vsnode%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">7.1.2.2.</span> <span class="toc-text">1.2.2.vsnode调度器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">7.1.2.3.</span> <span class="toc-text">1.2.3.客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-RS1"><span class="toc-number">7.1.2.4.</span> <span class="toc-text">1.2.4.RS1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-RS2"><span class="toc-number">7.1.2.5.</span> <span class="toc-text">1.2.5.RS2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E7%81%AB%E5%A2%99%E6%A0%87%E8%AE%B0%E8%A7%A3%E5%86%B3%E8%BD%AE%E8%AF%A2%E9%94%99%E8%AF%AF"><span class="toc-number">7.2.</span> <span class="toc-text">2.利用火墙标记解决轮询错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9C%A8rs%E4%B8%BB%E6%9C%BA%E4%B8%AD%E5%90%8C%E6%97%B6%E5%BC%80%E5%A7%8Bhttp%E5%92%8Chttps%E4%B8%A4%E7%A7%8D%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.2.1.</span> <span class="toc-text">2.1.在rs主机中同时开始http和https两种协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9C%A8vsnode%E4%B8%AD%E6%B7%BB%E5%8A%A0https%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AD%96%E7%95%A5"><span class="toc-number">7.2.2.</span> <span class="toc-text">2.2. 在vsnode中添加https的轮询策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%BD%AE%E8%AF%A2%E9%94%99%E8%AF%AF%E5%B1%95%E7%A4%BA"><span class="toc-number">7.2.3.</span> <span class="toc-text">2.3. 轮询错误展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.4.</span> <span class="toc-text">2.4.解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.5.</span> <span class="toc-text">2.5.测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%E6%8C%81%E4%B9%85%E8%BF%9E%E6%8E%A5%E5%AE%9E%E7%8E%B0%E4%BC%9A%E8%AF%9D%E7%B2%98%E6%BB%9E"><span class="toc-number">7.3.</span> <span class="toc-text">3.利用持久连接实现会话粘滞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-23"><span class="toc-number">8.</span> <span class="toc-text">2026-1-23</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-HAPORXY%E5%AE%9E%E9%AA%8C"><span class="toc-number">8.1.</span> <span class="toc-text">1.HAPORXY实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%9B%BE"><span class="toc-number">8.1.1.</span> <span class="toc-text">1.环境图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">8.2.</span> <span class="toc-text">2.环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-haproxy%E4%B8%BB%E6%9C%BA"><span class="toc-number">8.2.1.</span> <span class="toc-text">2.1.haproxy主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-webserver1"><span class="toc-number">8.2.2.</span> <span class="toc-text">2.2.webserver1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-webserver2"><span class="toc-number">8.2.3.</span> <span class="toc-text">2.3.webserver2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E7%8E%AF%E5%A2%83%E9%AA%8C%E8%AF%81"><span class="toc-number">8.2.4.</span> <span class="toc-text">2.4.环境验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Haproxy%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">8.3.</span> <span class="toc-text">3.Haproxy的安装及配置参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%AE%89%E8%A3%85"><span class="toc-number">8.3.1.</span> <span class="toc-text">3.1.安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-harpoxy%E7%9A%84%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3%E5%AE%9E%E9%AA%8C"><span class="toc-number">8.3.2.</span> <span class="toc-text">3.2.harpoxy的参数详解实验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-25"><span class="toc-number">9.</span> <span class="toc-text">2026-1-25</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Haproxy%E7%AE%97%E6%B3%95%E5%AE%9E%E9%AA%8C"><span class="toc-number">9.1.</span> <span class="toc-text">1.Haproxy算法实验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E9%9D%99%E6%80%81%E7%AE%97%E6%B3%95"><span class="toc-number">9.1.1.</span> <span class="toc-text">1.1.静态算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-static-rr"><span class="toc-number">9.1.1.1.</span> <span class="toc-text">1.1.1.static-rr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-first"><span class="toc-number">9.1.1.2.</span> <span class="toc-text">1.1.2.first</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%8A%A8%E6%80%81%E7%AE%97%E6%B3%95"><span class="toc-number">9.1.2.</span> <span class="toc-text">1.2.动态算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-roundrobin"><span class="toc-number">9.1.2.1.</span> <span class="toc-text">1.2.1.roundrobin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-leastconn"><span class="toc-number">9.1.2.2.</span> <span class="toc-text">1.2.2.leastconn</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%B7%B7%E5%90%88%E7%AE%97%E6%B3%95"><span class="toc-number">9.1.3.</span> <span class="toc-text">1.3.混合算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-source"><span class="toc-number">9.1.3.1.</span> <span class="toc-text">1.3.1.source</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-uri"><span class="toc-number">9.1.3.2.</span> <span class="toc-text">1.3.2.uri</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-url-param"><span class="toc-number">9.1.3.3.</span> <span class="toc-text">1.3.3.url_param</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-hdr"><span class="toc-number">9.1.3.4.</span> <span class="toc-text">1.3.4.hdr</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E4%BA%8Ecookie%E7%9A%84%E4%BC%9A%E8%AF%9D%E4%BF%9D%E6%8C%81"><span class="toc-number">9.2.</span> <span class="toc-text">2.基于cookie的会话保持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HAProxy%E7%8A%B6%E6%80%81%E9%A1%B5"><span class="toc-number">9.3.</span> <span class="toc-text">3.HAProxy状态页</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-26"><span class="toc-number">10.</span> <span class="toc-text">2026-1-26</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-IP%E9%80%8F%E4%BC%A0"><span class="toc-number">10.1.</span> <span class="toc-text">1.IP透传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%83%E5%B1%82%E9%80%8F%E4%BC%A0"><span class="toc-number">10.1.1.</span> <span class="toc-text">1.1.七层透传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">10.1.1.1.</span> <span class="toc-text">1.1.1.环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="toc-number">10.1.1.2.</span> <span class="toc-text">1.1.2.测试环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-number">10.1.1.3.</span> <span class="toc-text">1.1.3.测试效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9B%9B%E5%B1%82%E9%80%8F%E4%BC%A0"><span class="toc-number">10.1.2.</span> <span class="toc-text">1.2.四层透传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">1.2.1.环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">1.2.2.测试环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-number">10.1.2.3.</span> <span class="toc-text">1.2.3.测试效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD"><span class="toc-number">10.2.</span> <span class="toc-text">2.四层负载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">10.2.1.</span> <span class="toc-text">2.1.环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%8E%AF%E5%A2%83%E6%B5%8B%E8%AF%95"><span class="toc-number">10.2.2.</span> <span class="toc-text">2.2.环境测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89HAProxy-%E9%94%99%E8%AF%AF%E7%95%8C%E9%9D%A2"><span class="toc-number">10.3.</span> <span class="toc-text">3.自定义HAProxy 错误界面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-sorryserver%E7%9A%84%E8%AE%BE%E5%AE%9A"><span class="toc-number">10.3.1.</span> <span class="toc-text">3.1.sorryserver的设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">10.3.2.</span> <span class="toc-text">3.2.自定义错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%87%8D%E5%AE%9A%E5%90%91%E9%94%99%E8%AF%AF%E5%88%B0%E6%8C%87%E5%AE%9A%E7%BD%91%E7%AB%99"><span class="toc-number">10.3.3.</span> <span class="toc-text">3.3.重定向错误到指定网站</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Haproxy-ACL%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">10.4.</span> <span class="toc-text">4.Haproxy ACL访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%9E%E9%AA%8C%E7%B4%A0%E6%9D%90"><span class="toc-number">10.4.1.</span> <span class="toc-text">4.1.实验素材</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AE%BE%E5%AE%9A%E5%9F%BA%E7%A1%80%E7%9A%84haproxy%E5%AE%9E%E9%AA%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">10.4.2.</span> <span class="toc-text">4.2.设定基础的haproxy实验配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%9F%BA%E7%A1%80acl%E7%A4%BA%E4%BE%8B"><span class="toc-number">10.4.3.</span> <span class="toc-text">4.3.基础acl示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-28"><span class="toc-number">11.</span> <span class="toc-text">2026-1-28</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Keepalived%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E8%AE%BE%E5%AE%9A"><span class="toc-number">11.1.</span> <span class="toc-text">1.Keepalived实验环境设定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E8%AE%BE%E5%AE%9A%E5%9B%BE"><span class="toc-number">11.1.1.</span> <span class="toc-text">1.环境设定图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E8%AE%BE%E5%AE%9A"><span class="toc-number">11.1.2.</span> <span class="toc-text">2.环境设定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Keepalived%E6%97%A5%E5%BF%97%E5%88%86%E7%A6%BB"><span class="toc-number">11.2.</span> <span class="toc-text">2.Keepalived日志分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Keepalived%E7%9A%84%E5%AD%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AE%BE%E5%AE%9A"><span class="toc-number">11.3.</span> <span class="toc-text">3.Keepalived的子配置文件设定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.4.</span> <span class="toc-text">4.抢占模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F-%E9%BB%98%E8%AE%A4%E7%9A%84%EF%BC%8C%E8%B0%81%E4%BC%98%E5%85%88%E7%BA%A7%E9%AB%98%E5%B0%B1%E6%8A%8Avip%E6%94%BE%E5%88%B0%E5%93%AA%E9%87%8C"><span class="toc-number">11.4.1.</span> <span class="toc-text">4.1.抢占模式( 默认的，谁优先级高就把vip放到哪里)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%9D%9E%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F%EF%BC%88%E6%8C%81%E6%9C%89vip%E5%8F%AA%E8%A6%81vrrp%E9%80%9A%E5%91%8A%E6%AD%A3%E5%B8%B8%E5%B0%B1%E4%B8%8D%E5%81%9Avip%E8%BF%81%E7%A7%BB%EF%BC%89"><span class="toc-number">11.4.2.</span> <span class="toc-text">4.2.非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BB%B6%E8%BF%9F%E6%8A%A2%E5%8D%A0"><span class="toc-number">11.4.3.</span> <span class="toc-text">4.3.延迟抢占</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-keepalived%E7%9A%84%E5%8D%95%E6%92%AD%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.5.</span> <span class="toc-text">5.keepalived的单播模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Keepalived%E5%8F%8C%E4%B8%BB%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.6.</span> <span class="toc-text">6.Keepalived双主模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%8F%8C%E4%B8%BB%E6%A8%A1%E5%BC%8F%E4%BB%A3%E7%90%86%E4%B8%8D%E5%90%8C%E4%B8%9A%E5%8A%A1%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">11.7.</span> <span class="toc-text">7.双主模式代理不同业务实现高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">11.7.1.</span> <span class="toc-text">1.实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9E%E7%8E%B0%E4%B8%8D%E5%90%8Cvip%E4%BB%A3%E7%90%86%E4%B8%8D%E5%90%8C%E4%B8%9A%E5%8A%A1"><span class="toc-number">11.7.2.</span> <span class="toc-text">2.实现不同vip代理不同业务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95"><span class="toc-number">11.7.3.</span> <span class="toc-text">3.测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%88%A9%E7%94%A8VRRP-Script-%E5%AE%9E%E7%8E%B0%E5%85%A8%E8%83%BD%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">11.8.</span> <span class="toc-text">8.利用VRRP Script 实现全能高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83-1"><span class="toc-number">11.8.1.</span> <span class="toc-text">1.实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E6%A1%88%E4%BE%8B%E7%90%86%E8%A7%A3vrrp-scripts"><span class="toc-number">11.8.2.</span> <span class="toc-text">2.利用案例理解vrrp_scripts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-keepalived-haproxy"><span class="toc-number">11.8.3.</span> <span class="toc-text">3.keepalived + haproxy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2026-1-29"><span class="toc-number">12.</span> <span class="toc-text">2026-1-29</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Nginx%E7%9A%84%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91"><span class="toc-number">12.1.</span> <span class="toc-text">1.Nginx的源码编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%8B%E8%BD%BD%E8%BD%AF%E4%BB%B6"><span class="toc-number">12.1.1.</span> <span class="toc-text">1.1.下载软件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%A7%A3%E5%8E%8B"><span class="toc-number">12.1.2.</span> <span class="toc-text">1.2.解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%A3%80%E6%B5%8B%E7%8E%AF%E5%A2%83"><span class="toc-number">12.1.3.</span> <span class="toc-text">1.3.检测环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E7%BC%96%E8%AF%91"><span class="toc-number">12.1.4.</span> <span class="toc-text">1.4.编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-nginx%E5%90%AF%E5%8A%A8"><span class="toc-number">12.1.5.</span> <span class="toc-text">1.5.nginx启动</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/05/hexo%E9%AD%94%E6%94%B9%E7%AF%87/" title="主题 Butterfly 5.5.4 魔改教程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/hexo/butterfly.png" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="主题 Butterfly 5.5.4 魔改教程"/></a><div class="content"><a class="title" href="/2026/02/05/hexo%E9%AD%94%E6%94%B9%E7%AF%87/" title="主题 Butterfly 5.5.4 魔改教程">主题 Butterfly 5.5.4 魔改教程</a><time datetime="2026-02-05T10:00:00.000Z" title="发表于 2026-02-05 10:00:00">2026-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/04/front-mateer%E8%AF%B4%E6%98%8E/" title="主题 Butterfly 5.5.4 基础教程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/hexo/butterfly.png" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="主题 Butterfly 5.5.4 基础教程"/></a><div class="content"><a class="title" href="/2026/02/04/front-mateer%E8%AF%B4%E6%98%8E/" title="主题 Butterfly 5.5.4 基础教程">主题 Butterfly 5.5.4 基础教程</a><time datetime="2026-02-04T15:04:07.000Z" title="发表于 2026-02-04 15:04:07">2026-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="云原生-Linux的高级部分笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/yunyuansheng.png" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="云原生-Linux的高级部分笔记"/></a><div class="content"><a class="title" href="/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="云原生-Linux的高级部分笔记">云原生-Linux的高级部分笔记</a><time datetime="2026-02-02T10:00:00.000Z" title="发表于 2026-02-02 10:00:00">2026-02-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/01/Con-Nav-Item%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" title="搭建现代化浏览器导航站"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/Con-Nav-Item.png" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="搭建现代化浏览器导航站"/></a><div class="content"><a class="title" href="/2026/02/01/Con-Nav-Item%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" title="搭建现代化浏览器导航站">搭建现代化浏览器导航站</a><time datetime="2026-02-01T20:48:00.000Z" title="发表于 2026-02-01 20:48:00">2026-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/01/PicGo%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/" title="从零开始搭建图床"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/tuchuang.gif" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="从零开始搭建图床"/></a><div class="content"><a class="title" href="/2026/02/01/PicGo%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/" title="从零开始搭建图床">从零开始搭建图床</a><time datetime="2026-02-01T20:48:00.000Z" title="发表于 2026-02-01 20:48:00">2026-02-01</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2026 By Kaitumei</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="/js/tw_cn.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"欢迎留言，支持Markdown语法，快来评论吧~"}

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoojs-cyan.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoojs-cyan.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async src="/js/title.js"></script><script src="/js/card-welcome.js"></script><script>window.loaderConfig = { enable: true,  imageUrl: 'https://b5dbf24.webp.li/icons/404.gif',  text: '加载中...',  animationType: 'pulse', showProgress: true,  duration: 1000,  darkMode: false  };</script><script async src="/js/custom-loader.js"></script><script async src="/js/custom-nav.js"></script><script src="/js/custom.js"></script><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script async src="/js/categoryBar.js"></script><div id="nav-music"><meting-js id="2301697552" server="netease" type="playlist" mutex="true" preload="none" theme="#49b1f5" data-lrrc-type="0" order="random" list-folded="true"></meting-js></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="🔍搜索本站内容" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div><script>const posts = ["2026/02/01/Con-Nav-Item安装指南/","2026/02/01/PicGo图床搭建指南/","2026/02/01/RHCE课程笔记/","2026/02/04/front-mateer说明/","2026/02/05/hexo魔改篇/","2026/02/02/云原生高级课程笔记/"]
function toRandomPost() {
  const randomPost = posts[Math.floor(Math.random() * posts.length)];
  const randomUrl = '/' + randomPost;
  window.pjax ? pjax.loadUrl(randomUrl) : window.open(randomUrl, '_self');
}</script><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2026/02/01/PicGo图床搭建指南/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/tuchuang.gif" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2026-02-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2026/02/01/PicGo图床搭建指南/&quot;);" href="javascript:void(0);" alt="">从零开始搭建图床</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2026/02/01/PicGo图床搭建指南/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2026/02/01/Con-Nav-Item安装指南/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://b5dbf24.webp.li/icons/Con-Nav-Item.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2026-02-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2026/02/01/Con-Nav-Item安装指南/&quot;);" href="javascript:void(0);" alt="">搭建现代化浏览器导航站</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2026/02/01/Con-Nav-Item安装指南/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>