<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>主题 Butterfly 5.5.4 魔改教程</title>
      <link href="/2026/02/05/hexo%E9%AD%94%E6%94%B9%E7%AF%87/"/>
      <url>/2026/02/05/hexo%E9%AD%94%E6%94%B9%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="加载动画"><a href="#加载动画" class="headerlink" title="加载动画"></a>加载动画</h1><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <p>[BlogRoot]\source\csscustom-loader.css</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">/* 自定义加载动画样式 */</span><br><span class="line">.custom-loader-container &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background-color: rgba(255, 255, 255, 0.85); /* 半透明背景 */</span><br><span class="line">  backdrop-filter: blur(20px); /* 毛玻璃模糊效果 */</span><br><span class="line">  -webkit-backdrop-filter: blur(20px);</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  z-index: 9999;</span><br><span class="line">  transition: transform 0.6s cubic-bezier(0.7, 0, 0.3, 1), opacity 0.6s ease-out; /* 幕布拉起动画 */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.custom-loader-container.dark &#123;</span><br><span class="line">  background-color: rgba(13, 13, 13, 0.85);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.custom-loader-container.fade-out &#123;</span><br><span class="line">  transform: translateY(-100%); /* 向上拉起幕布 */</span><br><span class="line">  /* opacity: 0; 如果想要淡出而不是拉起，可以使用 opacity */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载动画内容 */</span><br><span class="line">.loader-content &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">  gap: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 图片加载器 */</span><br><span class="line">.loader-image &#123;</span><br><span class="line">  width: 120px;</span><br><span class="line">  height: 120px;</span><br><span class="line">  animation: spin 1s linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 旋转动画 */</span><br><span class="line">@keyframes spin &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    transform: rotate(0deg);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    transform: rotate(360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 脉冲动画 */</span><br><span class="line">@keyframes pulse &#123;</span><br><span class="line">  0%, 100% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    opacity: 0.7;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loader-image.pulse &#123;</span><br><span class="line">  animation: pulse 1.5s ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载文字 */</span><br><span class="line">.loader-text &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  color: #333;</span><br><span class="line">  font-weight: 500;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.custom-loader-container.dark .loader-text &#123;</span><br><span class="line">  color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载进度条 */</span><br><span class="line">.loader-progress &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  height: 4px;</span><br><span class="line">  background-color: #f0f0f0;</span><br><span class="line">  border-radius: 2px;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.custom-loader-container.dark .loader-progress &#123;</span><br><span class="line">  background-color: #333;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loader-progress-bar &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background: linear-gradient(90deg, #49b1f5, #00c4b6);</span><br><span class="line">  border-radius: 2px;</span><br><span class="line">  animation: progress 2s ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes progress &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    width: 0%;</span><br><span class="line">  &#125;</span><br><span class="line">  50% &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 响应式设计 */</span><br><span class="line">@media (max-width: 768px) &#123;</span><br><span class="line">  .loader-image &#123;</span><br><span class="line">    width: 80px;</span><br><span class="line">    height: 80px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .loader-text &#123;</span><br><span class="line">    font-size: 14px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .loader-progress &#123;</span><br><span class="line">    width: 150px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>[BlogRoot]\source\js\custom-loader.js</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 自定义加载动画</span><br><span class="line"> * 配置参数通过 window.loaderConfig 传递</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">(function() &#123;</span><br><span class="line">  &#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">  // 获取加载动画配置</span><br><span class="line">  function getLoaderConfig() &#123;</span><br><span class="line">    return window.loaderConfig || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 初始化加载器</span><br><span class="line">  function initLoader() &#123;</span><br><span class="line">    const config = getLoaderConfig();</span><br><span class="line">    </span><br><span class="line">    // 如果禁用加载器则直接返回</span><br><span class="line">    if (config.enable === false) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const container = document.createElement(&#x27;div&#x27;);</span><br><span class="line">    container.className = &#x27;custom-loader-container&#x27;;</span><br><span class="line">    </span><br><span class="line">    // 检查是否为深色模式</span><br><span class="line">    if (config.darkMode || (document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;dark&#x27;)) &#123;</span><br><span class="line">      container.classList.add(&#x27;dark&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 创建加载内容</span><br><span class="line">    const content = document.createElement(&#x27;div&#x27;);</span><br><span class="line">    content.className = &#x27;loader-content&#x27;;</span><br><span class="line"></span><br><span class="line">    // 添加加载图片</span><br><span class="line">    if (config.imageUrl) &#123;</span><br><span class="line">      const img = document.createElement(&#x27;img&#x27;);</span><br><span class="line">      img.className = &#x27;loader-image &#x27; + (config.animationType || &#x27;spin&#x27;);</span><br><span class="line">      img.src = config.imageUrl;</span><br><span class="line">      img.alt = &#x27;Loading&#x27;;</span><br><span class="line">      content.appendChild(img);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 默认加载动画（纯CSS）</span><br><span class="line">      const defaultLoader = document.createElement(&#x27;div&#x27;);</span><br><span class="line">      defaultLoader.className = &#x27;loader-image &#x27; + (config.animationType || &#x27;spin&#x27;);</span><br><span class="line">      defaultLoader.innerHTML = &#x27;&lt;svg viewBox=&quot;0 0 50 50&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;circle cx=&quot;25&quot; cy=&quot;25&quot; r=&quot;20&quot; fill=&quot;none&quot; stroke=&quot;#49b1f5&quot; stroke-width=&quot;3&quot;/&gt;&lt;/svg&gt;&#x27;;</span><br><span class="line">      content.appendChild(defaultLoader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 添加加载文字</span><br><span class="line">    if (config.text) &#123;</span><br><span class="line">      const text = document.createElement(&#x27;div&#x27;);</span><br><span class="line">      text.className = &#x27;loader-text&#x27;;</span><br><span class="line">      text.textContent = config.text;</span><br><span class="line">      content.appendChild(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 添加进度条</span><br><span class="line">    if (config.showProgress !== false) &#123;</span><br><span class="line">      const progress = document.createElement(&#x27;div&#x27;);</span><br><span class="line">      progress.className = &#x27;loader-progress&#x27;;</span><br><span class="line">      const progressBar = document.createElement(&#x27;div&#x27;);</span><br><span class="line">      progressBar.className = &#x27;loader-progress-bar&#x27;;</span><br><span class="line">      progress.appendChild(progressBar);</span><br><span class="line">      content.appendChild(progress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    container.appendChild(content);</span><br><span class="line">    document.body.insertBefore(container, document.body.firstChild);</span><br><span class="line"></span><br><span class="line">    // 监听页面加载完成</span><br><span class="line">    if (document.readyState === &#x27;loading&#x27;) &#123;</span><br><span class="line">      document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123;</span><br><span class="line">        hideLoader(container, config.duration || 500);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 页面已加载完成</span><br><span class="line">      hideLoader(container, config.duration || 500);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 监听 pjax 或其他动态加载事件</span><br><span class="line">    if (window.Pjax) &#123;</span><br><span class="line">      document.addEventListener(&#x27;pjax:beforeSend&#x27;, function() &#123;</span><br><span class="line">        showLoader(container, config);</span><br><span class="line">      &#125;);</span><br><span class="line">      document.addEventListener(&#x27;pjax:complete&#x27;, function() &#123;</span><br><span class="line">        hideLoader(container, config.duration || 500);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 显示加载器</span><br><span class="line">  function showLoader(container, config) &#123;</span><br><span class="line">    if (container.classList.contains(&#x27;fade-out&#x27;)) &#123;</span><br><span class="line">      container.classList.remove(&#x27;fade-out&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 检查暗色模式</span><br><span class="line">    if (config &amp;&amp; config.darkMode) &#123;</span><br><span class="line">      container.classList.add(&#x27;dark&#x27;);</span><br><span class="line">    &#125; else if (document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;dark&#x27;) &#123;</span><br><span class="line">      container.classList.add(&#x27;dark&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      container.classList.remove(&#x27;dark&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 隐藏加载器</span><br><span class="line">  function hideLoader(container, duration) &#123;</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">      container.classList.add(&#x27;fade-out&#x27;);</span><br><span class="line">    &#125;, duration);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 在 DOM 加载完成后初始化</span><br><span class="line">  if (document.readyState === &#x27;loading&#x27;) &#123;</span><br><span class="line">    document.addEventListener(&#x27;DOMContentLoaded&#x27;, initLoader);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    initLoader();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>_config.butterfly.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">  head:</span><br><span class="line">    - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/custom-loader.css&quot;&gt;</span><br><span class="line">  bottom:</span><br><span class="line">    - &lt;script async src=&quot;/js/custom-loader.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>              </div>            </details><h1 id="分类条"><a href="#分类条" class="headerlink" title="分类条"></a>分类条</h1><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <ol><li><strong>参考</strong></li></ol><p>​<a href="https://blog.liushen.fun/posts/a64defb4/">魔改笔记七：分类条及外链卡片 | LiuShen’s Blog</a></p><ol start="2"><li><strong>创建</strong></li></ol><p>建立对应文件：<code>[BlogRoot]\themes\butterfly\layout\includes\categoryBar.pug</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.category-bar-items#category-bar-items(class=is_home() ? &#x27;home&#x27; : &#x27;&#x27;)</span><br><span class="line">  .category-bar-item(class=is_home() ? &#x27;select&#x27; : &#x27;&#x27;, id=&quot;category-bar-home&quot;)</span><br><span class="line">    a(href=url_for(&#x27;/&#x27;))= __(&#x27;博客首页&#x27;)</span><br><span class="line">  each item in site.categories.find(&#123; parent: &#123; $exists: false &#125; &#125;).data</span><br><span class="line">    .category-bar-item(class=select ? (select === item.name ? &#x27;select&#x27; : &#x27;&#x27;) : &#x27;&#x27;, id=item.name)</span><br><span class="line">      a(href=url_for(item.path))= item.name</span><br><span class="line">  .category-bar-item</span><br><span class="line">    a(href=url_for(&#x27;/archives/&#x27;))= __(&#x27;文章存档&#x27;)</span><br><span class="line">div.category-bar-right</span><br><span class="line">  a.category-bar-more(href=url_for(&#x27;/categories/&#x27;))= __(&#x27;更多分类&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>以上就是该滚动条的结构，下面我们开始实现样式的定义，新建文件<code>[BlogRoot]\themes\butterfly\source\css\_layout\category-bar.styl</code>写入以下文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#category-bar</span><br><span class="line">  padding 7px 11px</span><br><span class="line">  // 方案 1：推荐（混合 --card-bg 和浅灰，无透明，层次感强，不影响子元素）</span><br><span class="line">  background color-mix(var(--card-bg), #f8f9fa, 80%) </span><br><span class="line">  // 方案 2：直接使用 --card-bg 并降低轻微不透明度（背景独立不透明，不影响子元素）</span><br><span class="line">  // background rgba(hue(var(--card-bg)), saturation(var(--card-bg)), lightness(var(--card-bg)), 0.9)</span><br><span class="line">  // 方案 3：--card-bg 基础上加轻微渐变（无透明，视觉更立体）</span><br><span class="line">  // background linear-gradient(180deg, var(--card-bg), color-mix(var(--card-bg), #eee, 95%))</span><br><span class="line">  border-radius 8px</span><br><span class="line">  display flex</span><br><span class="line">  white-space nowrap</span><br><span class="line">  overflow hidden</span><br><span class="line">  transition 0.3s</span><br><span class="line">  height 50px</span><br><span class="line">  width 100%</span><br><span class="line">  justify-content space-between</span><br><span class="line">  user-select none</span><br><span class="line">  align-items center</span><br><span class="line">  margin-bottom 20px</span><br><span class="line"></span><br><span class="line">  .category-bar-right</span><br><span class="line">    display flex</span><br><span class="line">    border-radius 8px</span><br><span class="line">    align-items center</span><br><span class="line"></span><br><span class="line">    .category-bar-more</span><br><span class="line">      margin-left 4px</span><br><span class="line">      margin-right 4px</span><br><span class="line">      font-weight 700</span><br><span class="line">      border-radius 8px</span><br><span class="line">      padding 0 8px</span><br><span class="line"></span><br><span class="line">  .category-bar-items</span><br><span class="line">    width 100%</span><br><span class="line">    white-space nowrap</span><br><span class="line">    overflow-x scroll</span><br><span class="line">    scrollbar-width: none</span><br><span class="line">    -ms-overflow-style: none</span><br><span class="line">    overflow-y hidden</span><br><span class="line">    display flex</span><br><span class="line">    border-radius 8px</span><br><span class="line">    align-items center</span><br><span class="line">    height 30px</span><br><span class="line"></span><br><span class="line">    &amp;::-webkit-scrollbar</span><br><span class="line">      display: none</span><br><span class="line"></span><br><span class="line">    .category-bar-item</span><br><span class="line">      a</span><br><span class="line">        padding .1rem .5rem</span><br><span class="line">        margin-right 6px</span><br><span class="line">        font-weight 700</span><br><span class="line">        border-radius 8px</span><br><span class="line">        display flex</span><br><span class="line">        align-items center</span><br><span class="line">        height 30px</span><br><span class="line">        color var(--font-color) // 增加默认文字颜色</span><br><span class="line">        </span><br><span class="line">        &amp;:hover</span><br><span class="line">          color var(--theme-color) // 悬停颜色</span><br><span class="line"></span><br><span class="line">      &amp;.select</span><br><span class="line">        a</span><br><span class="line">          background #3eb8be</span><br><span class="line">          color var(--btn-color)</span><br></pre></td></tr></table></figure><ol start="3"><li>修改</li></ol><p>在pug文件中，所有的颜色我都尽量使用了butterfly主题自带的变量进行了替代，确保大部分人可以正常显示。</p><p>然后将其添加到不同的位置，比如我这里实现了添加到分类页面等位置，配合上pjax可以做到无刷更新，效果很好，打开文件</p><p>[BlogRoot]\themes\butterfly\layout\category.pug，添加其中两行代码，去掉加号即为正常缩进：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">extends includes/layout.pug</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  if theme.category_ui == &#x27;index&#x27;</span><br><span class="line">    include ./includes/mixins/indexPostUI.pug</span><br><span class="line">    +indexPostUI</span><br><span class="line">  else</span><br><span class="line">    include ./includes/mixins/article-sort.pug</span><br><span class="line">+    .recent-posts.nc(id=&quot;category-bar-wrapper&quot;)</span><br><span class="line">+      #category-bar.category-bar</span><br><span class="line">+        include includes/categoryBar.pug</span><br><span class="line">      #category</span><br><span class="line">        .article-sort-title= _p(&#x27;page.category&#x27;) + &#x27; - &#x27; + page.category</span><br><span class="line">        +articleSort(page.posts)</span><br><span class="line">        include includes/pagination.pug</span><br></pre></td></tr></table></figure><p>注意上方的修改，需要将配置文件中，分类页面的主题改成index，否则不会显示。</p><p>下面我们将其添加到主页，打开文件[BlogRoot]\themes\butterfly\layout\index.pug文件，添加下面两行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">extends includes/layout.pug</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">+  .recent-posts.nc(id=&quot;category-bar-wrapper&quot;)</span><br><span class="line">+    #category-bar.category-bar</span><br><span class="line">+      include includes/categoryBar.pug</span><br><span class="line">      </span><br><span class="line">    include ./includes/mixins/indexPostUI.pug</span><br><span class="line">    +indexPostUI</span><br></pre></td></tr></table></figure><p>然后就是实现点击切换后，高亮部分跟随分类页面走的部分，为了和主题融合我还是修改源码，打开[BlogRoot]\themes\butterfly\source\js\main.js，添加js函数，比如我添加到了778行左右，switchComments函数的上面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  const toggleCardCategory = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">// 新增</span><br><span class="line">  const setCategoryBarActive = () =&gt; &#123;</span><br><span class="line">    const categoryBar = document.querySelector(&quot;#category-bar&quot;);</span><br><span class="line">    const currentPath = decodeURIComponent(window.location.pathname);</span><br><span class="line">    const isHomePage = currentPath === GLOBAL_CONFIG.root;</span><br><span class="line"></span><br><span class="line">    if (categoryBar) &#123;</span><br><span class="line">        const categoryItems = categoryBar.querySelectorAll(&quot;.category-bar-item&quot;);</span><br><span class="line">        categoryItems.forEach(item =&gt; item.classList.remove(&quot;select&quot;));</span><br><span class="line"></span><br><span class="line">        const activeItemId = isHomePage ? &quot;category-bar-home&quot; : currentPath.split(&quot;/&quot;).slice(-2, -1)[0];</span><br><span class="line">        const activeItem = document.getElementById(activeItemId);</span><br><span class="line"></span><br><span class="line">        if (activeItem) &#123;</span><br><span class="line">            activeItem.classList.add(&quot;select&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">  const addPostOutdateNotice = () =&gt; &#123;</span><br></pre></td></tr></table></figure><p>然后再在引用部分执行这个函数，在同一个文件，找到下面的函数并添加函数的调用，位置看下方注释：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GLOBAL_CONFIG_SITE.pageType === &#x27;home&#x27; &amp;&amp; scrollDownInIndex()</span><br><span class="line">scrollFn()</span><br><span class="line"></span><br><span class="line">// ========== 新增：调用分类栏激活态切换函数 ==========</span><br><span class="line">setCategoryBarActive()</span><br><span class="line"></span><br><span class="line">forPostFn()</span><br></pre></td></tr></table></figure><blockquote><p>以下与分类条的改动无关，为我个人修改，以防忘记，特记录下来</p></blockquote><hr><h2 id="首页文章列表-indexPostUI-pug"><a href="#首页文章列表-indexPostUI-pug" class="headerlink" title="首页文章列表 (indexPostUI.pug)"></a>首页文章列表 (indexPostUI.pug)</h2><p>文件路径： themes&#x2F;butterfly&#x2F;layout&#x2F;includes&#x2F;mixins&#x2F;indexPostUI.pug</p><p>目的是为了在文章列表容器 #recent-posts 的最开始插入分类条代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//- 原始代码 (Before)</span><br><span class="line">mixin indexPostUI()</span><br><span class="line">  // ... (省略变量定义)</span><br><span class="line">  #recent-posts.recent-posts.nc</span><br><span class="line">  (class=masonryLayoutClass)</span><br><span class="line">    .recent-post-items</span><br><span class="line">      each article, index in page.</span><br><span class="line">      posts.data</span><br><span class="line">        // ...</span><br><span class="line"></span><br><span class="line">//- 现在代码 (After)</span><br><span class="line">mixin indexPostUI()</span><br><span class="line">  // ... (省略变量定义)</span><br><span class="line">  #recent-posts.recent-posts.nc</span><br><span class="line">  (class=masonryLayoutClass)</span><br><span class="line">    // [新增] 插入分类条。Swiper 会通</span><br><span class="line">    过 JS 插在它上面，文章在它下面。</span><br><span class="line">    #category-bar.category-bar</span><br><span class="line">      include ../categoryBar.pug</span><br><span class="line">    .recent-post-items</span><br><span class="line">      each article, index in page.</span><br><span class="line">      posts.data</span><br><span class="line">        // ...</span><br></pre></td></tr></table></figure><h3 id="分类归档页面-category-pug"><a href="#分类归档页面-category-pug" class="headerlink" title="分类归档页面 (category.pug)"></a>分类归档页面 (category.pug)</h3><p>文件路径： themes&#x2F;butterfly&#x2F;layout&#x2F;category.pug</p><p>为了让分类页面的布局不崩坏（保持 74% 宽度），并显示分类条，重构 else 分支。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//- 原始代码 (Before)</span><br><span class="line">  else</span><br><span class="line">    include ./includes/mixins/</span><br><span class="line">    article-sort.pug</span><br><span class="line">    #category</span><br><span class="line">      .article-sort-title= _p(&#x27;page.</span><br><span class="line">      category&#x27;) + &#x27; - &#x27; + page.</span><br><span class="line">      category</span><br><span class="line">      +articleSort(page.posts)</span><br><span class="line">      include includes/pagination.</span><br><span class="line">      pug</span><br><span class="line"></span><br><span class="line">//- 现在代码 (After)</span><br><span class="line">  else</span><br><span class="line">    include ./includes/mixins/</span><br><span class="line">    article-sort.pug</span><br><span class="line">    // [修改] 添加外层容器 .</span><br><span class="line">    recent-posts.nc 以修复布局宽度问题</span><br><span class="line">    .recent-posts.nc</span><br><span class="line">    (id=&quot;category-bar-wrapper&quot;)</span><br><span class="line">      // [新增] 添加分类条</span><br><span class="line">      #category-bar.category-bar</span><br><span class="line">        include includes/</span><br><span class="line">        categoryBar.pug</span><br><span class="line">      // 原有的分类内容</span><br><span class="line">      #category</span><br><span class="line">        .article-sort-title= _p</span><br><span class="line">        (&#x27;page.category&#x27;) + &#x27; - &#x27; + </span><br><span class="line">        page.category</span><br><span class="line">        +articleSort(page.posts)</span><br><span class="line">        include includes/pagination.</span><br><span class="line">        pug</span><br></pre></td></tr></table></figure>              </div>            </details><h1 id="外挂标签"><a href="#外挂标签" class="headerlink" title="外挂标签"></a>外挂标签</h1><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <p>[BlogRoot]\themes\liushen\scripts\tag\note.js</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * note 外挂标签，分为警告、错误、问题、信息，比原版更加简单，样式更加漂亮</span><br><span class="line"> * by: LiuShen</span><br><span class="line"> * 样式参考: https://blog.zhilu.cyou/</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">&#x27;use strict&#x27;</span><br><span class="line"></span><br><span class="line">const postNote = (args, content) =&gt; &#123;</span><br><span class="line">  // 定义五种类型及其对应的 Font Awesome 图标</span><br><span class="line">  const types = &#123;</span><br><span class="line">    warning: &#x27;fa-circle-dot&#x27;,          // 警告</span><br><span class="line">    error: &#x27;fa-circle-xmark&#x27;,          // 错误</span><br><span class="line">    question: &#x27;fa-circle-question&#x27;,    // 问题</span><br><span class="line">    info: &#x27;fa-circle-check&#x27;,           // 信息</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // 获取标签类型和标题</span><br><span class="line">  const type = args[0] || &#x27;info&#x27;; // 如果未提供类型，默认为 info</span><br><span class="line">  const title = args.slice(1).join(&#x27; &#x27;) || &#x27;附加信息&#x27;; // 提取标题，默认为 &quot;提示&quot;</span><br><span class="line">  const icon = types[type] || types.info; // 如果类型未定义，使用 info 类型的图标</span><br><span class="line"></span><br><span class="line">  // 判断标签类型是否在 types 中定义</span><br><span class="line">  if (!types[type]) &#123;</span><br><span class="line">    console.warn(`\`$&#123;type&#125;\` 类型未定义，已自动切换为 \`info\` 类型`);</span><br><span class="line">    type = &#x27;info&#x27;;</span><br><span class="line">    title = &#x27;附加信息&#x27;;</span><br><span class="line">    icon = types.info;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 返回 HTML 结构</span><br><span class="line">  return `</span><br><span class="line">    &lt;div class=&quot;note note-$&#123;type&#125;&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;note-header&quot;&gt;</span><br><span class="line">        &lt;i class=&quot;note-icon fa-regular $&#123;icon&#125;&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;span class=&quot;note-title&quot;&gt;$&#123;title&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;note-content&quot;&gt;</span><br><span class="line">        $&#123;hexo.render.renderSync(&#123; text: content, engine: &#x27;markdown&#x27; &#125;)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 注册自定义标签</span><br><span class="line">hexo.extend.tag.register(&#x27;note&#x27;, postNote, &#123; ends: true &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>美化标签 [BlogRoot]\themes\liushen\source\css_tags\note.styl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">.note</span><br><span class="line">  addBorderRadius()</span><br><span class="line">  border var(--liushen-card-border)</span><br><span class="line">  position: relative</span><br><span class="line">  margin: 0 0 20px</span><br><span class="line">  padding: 15px 15px 7px 15px</span><br><span class="line">  background-color: var(--liushen-card-bg)</span><br><span class="line">  transition: transform 0.3s ease</span><br><span class="line"></span><br><span class="line">  &amp;:hover</span><br><span class="line">    transform: translateY(-3px)</span><br><span class="line"></span><br><span class="line">  &amp;.note-warning</span><br><span class="line">    background-image: radial-gradient(circle at 4em -25em, #f0ad4e, transparent 30em),</span><br><span class="line">                linear-gradient(#f0ad4e -2000%, transparent)</span><br><span class="line">    .note-header</span><br><span class="line">      color: #f0ad4e</span><br><span class="line"></span><br><span class="line">  &amp;.note-info</span><br><span class="line">    background-image: radial-gradient(circle at 4em -25em, #5cb85c, transparent 30em),</span><br><span class="line">                linear-gradient(#5cb85c -2000%, transparent)</span><br><span class="line">    .note-header</span><br><span class="line">      color: #5cb85c</span><br><span class="line"></span><br><span class="line">  &amp;.note-error</span><br><span class="line">    background-image: radial-gradient(circle at 4em -25em, #d9534f, transparent 30em),</span><br><span class="line">                linear-gradient(#d9534f -2000%, transparent)</span><br><span class="line">    .note-header</span><br><span class="line">      color: #d9534f</span><br><span class="line"></span><br><span class="line">  &amp;.note-question</span><br><span class="line">    background-image: radial-gradient(circle at 4em -25em, #5bc0de, transparent 30em),</span><br><span class="line">                linear-gradient(#5bc0de -2000%, transparent)</span><br><span class="line">    .note-header</span><br><span class="line">      color: #5bc0de</span><br><span class="line"></span><br><span class="line">  .note-header</span><br><span class="line">    display: flex</span><br><span class="line">    align-items: center</span><br><span class="line">    font-weight: bold</span><br><span class="line">    margin-bottom: 10px</span><br><span class="line">    font-size: 1.0em</span><br><span class="line">    i.note-icon</span><br><span class="line">      margin-right: 10px</span><br><span class="line">      color: inherit</span><br></pre></td></tr></table></figure>              </div>            </details><ol><li><p>info标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note info 这是标题 %&#125;</span><br><span class="line">这个是内容展示，里面可以正常使用`Markdown`的相关渲染格式</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>效果</p>    <div class="note note-info">      <div class="note-header">        <i class="note-icon fa-regular fa-circle-check"></i>        <span class="note-title">这是标题</span>      </div>      <div class="note-content">        <p>这个是内容展示，里面可以正常使用<code>Markdown</code>的相关渲染格式</p>      </div>    </div>  </li><li><p>warning标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note warning 这是标题 %&#125;</span><br><span class="line">这个是内容展示，里面可以正常使用`Markdown`的相关渲染格式</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>效果</p>    <div class="note note-warning">      <div class="note-header">        <i class="note-icon fa-regular fa-circle-dot"></i>        <span class="note-title">这是标题</span>      </div>      <div class="note-content">        <p>这个是内容展示，里面可以正常使用<code>Markdown</code>的相关渲染格式</p>      </div>    </div>  </li><li><p>question标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note question 这是标题 %&#125;</span><br><span class="line">这个是内容展示，里面可以正常使用`Markdown`的相关渲染格式</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>效果</p>    <div class="note note-question">      <div class="note-header">        <i class="note-icon fa-regular fa-circle-question"></i>        <span class="note-title">这是标题</span>      </div>      <div class="note-content">        <p>这个是内容展示，里面可以正常使用<code>Markdown</code>的相关渲染格式</p>      </div>    </div>  </li><li><p>error标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note error 这是标题 %&#125;</span><br><span class="line">这个是内容展示，里面可以正常使用`Markdown`的相关渲染格式</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>效果</p>    <div class="note note-error">      <div class="note-header">        <i class="note-icon fa-regular fa-circle-xmark"></i>        <span class="note-title">这是标题</span>      </div>      <div class="note-content">        <p>这个是内容展示，里面可以正常使用<code>Markdown</code>的相关渲染格式</p>      </div>    </div>  </li></ol><h1 id="侧边栏"><a href="#侧边栏" class="headerlink" title="侧边栏"></a>侧边栏</h1><h2 id="来访者"><a href="#来访者" class="headerlink" title="来访者"></a>来访者</h2><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <p>新建[BlogRoot]\themes\liushen\layout\includes\widget\card_welcome.pug</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.card-widget.card-welcome</span><br><span class="line">  .item-headline</span><br><span class="line">    i.fa.fa-user</span><br><span class="line">    span 欢迎来访者!</span><br><span class="line">  .item-content</span><br><span class="line">    p &amp;nbsp&amp;nbsp👋🏻我是Kaitumei，一个</span><br><span class="line">      span(style=&quot;font-weight: bold; color: #3498db&quot;) 热爱记录、喜欢分享 </span><br><span class="line">      | 的小卡拉米。😊 </span><br><span class="line">    p &amp;nbsp&amp;nbsp希望在这里你能探寻到你心中的那座</span><br><span class="line">      span(style=&quot;font-weight: bold; color: #7a3debff&quot;) 岛屿🗻。</span><br><span class="line">      br</span><br><span class="line">      | &amp;nbsp&amp;nbsp疲惫时，你可以点击左下方的神秘小物件，然后放松放松哦~</span><br><span class="line">      | 如果遇到什么问题请通过</span><br><span class="line">      a(href=&quot;kaitumei@163.com&quot; style=&quot;font-weight: bold; color: #9b59b6&quot;) 邮箱</span><br><span class="line">      | 联系我！📧</span><br><span class="line">  #welcome-info</span><br><span class="line">    .error-message(style=&quot;height: 200px; display: flex; justify-content: center; align-items: center;&quot;)</span><br><span class="line">      p(style=&quot;text-align: center;&quot;)</span><br><span class="line">        span(style=&quot;font-size: 40px;&quot;) 😥 </span><br><span class="line">        br</span><br><span class="line">        span(style=&quot;font-size: 16px;&quot;) 由于网络问题</span><br><span class="line">        br</span><br><span class="line">        span(style=&quot;font-size: 16px;&quot;) 位置API请求错误</span><br><span class="line">        br</span><br><span class="line">        span(style=&quot;font-size: 16px;&quot;) 请刷新重试呀🤗~</span><br></pre></td></tr></table></figure><p>同目录底下index.pug</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  else</span><br><span class="line">    //- page</span><br><span class="line">    !=partial(&#x27;includes/widget/card_author&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">+    if is_home()</span><br><span class="line">+      !=partial(&#x27;includes/widget/card_welcome&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">    !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">    !=partial(&#x27;includes/widget/card_top_self&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    .sticky_layout</span><br></pre></td></tr></table></figure><p>新建<code>[BlogRoot]\themes\liushen\source\css\_layout\card-welcome.styl</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#aside-content</span><br><span class="line">    .card-widget.card-welcome</span><br><span class="line">        padding: 8px</span><br><span class="line">        .item-headline</span><br><span class="line">            margin: 12px 16px 0 16px</span><br><span class="line">        .item-content</span><br><span class="line">            margin: 0 16px 10px 16px</span><br><span class="line">        #welcome-info</span><br><span class="line">            text-align center</span><br><span class="line">            background-color: var(--liushen-card-bg)</span><br><span class="line">            border-radius: 12px</span><br><span class="line">            padding: 16px</span><br><span class="line">            margin: 8px</span><br><span class="line">            // border: 2px solid var(--liushen-text)</span><br><span class="line">            .ip-address</span><br><span class="line">                // 模糊效果</span><br><span class="line">                filter: blur(5px)</span><br><span class="line">                color: var(--default-bg-color)</span><br><span class="line">                transition: filter 0.5s</span><br><span class="line">                &amp;:hover</span><br><span class="line">                    filter: none</span><br></pre></td></tr></table></figure><p>任意js中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre></td><td class="code"><pre><span class="line">// 进行 fetch 请求</span><br><span class="line">fetch(&#x27;https://uapis.cn/api/v1/network/myip?source=commercial&#x27;)</span><br><span class="line">    .then(response =&gt; &#123;</span><br><span class="line">        if (!response.ok) &#123;</span><br><span class="line">            throw new Error(&#x27;Network response was not ok&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        return response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(data =&gt; &#123;</span><br><span class="line">        // 适配 uapis.cn API 返回格式</span><br><span class="line">        if (data &amp;&amp; data.region) &#123;</span><br><span class="line">            const regions = data.region.split(&#x27; &#x27;);</span><br><span class="line">            ipLocation = &#123;</span><br><span class="line">                ip: data.ip,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    lng: data.longitude,</span><br><span class="line">                    lat: data.latitude,</span><br><span class="line">                    country: regions[0] || &#x27;&#x27;,</span><br><span class="line">                    prov: regions[1] || &#x27;&#x27;,</span><br><span class="line">                    city: regions[2] || &#x27;&#x27;,</span><br><span class="line">                    district: data.district || &#x27;&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ipLocation = data;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (isHomePage()) &#123;</span><br><span class="line">            showWelcome();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(error =&gt; console.error(&#x27;Error fetching IP data:&#x27;, error));</span><br><span class="line"></span><br><span class="line">let ipLocation; // 显式声明变量</span><br><span class="line"></span><br><span class="line">function getDistance(e1, n1, e2, n2) &#123;</span><br><span class="line">    if ([e1, n1, e2, n2].some(v =&gt; typeof v !== &#x27;number&#x27; || isNaN(v))) &#123;</span><br><span class="line">        console.warn(&#x27;Invalid coordinates for getDistance:&#x27;, e1, n1, e2, n2);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    const R = 6371;</span><br><span class="line">    const &#123; sin, cos, asin, PI, hypot &#125; = Math;</span><br><span class="line">    let getPoint = (e, n) =&gt; &#123;</span><br><span class="line">        e *= PI / 180;</span><br><span class="line">        n *= PI / 180;</span><br><span class="line">        return &#123; x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let a = getPoint(e1, n1);</span><br><span class="line">    let b = getPoint(e2, n2);</span><br><span class="line">    let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z);</span><br><span class="line">    let r = asin(c / 2) * 2 * R;</span><br><span class="line">    return Math.round(r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function showWelcome() &#123;</span><br><span class="line">    if (!ipLocation || !ipLocation.data) &#123;</span><br><span class="line">        console.error(&#x27;ipLocation data is not available.&#x27;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let dist = getDistance(112.377552,26.975294, ipLocation.data.lng, ipLocation.data.lat); // 修改自己的经度（121.413921）纬度（31.089290）</span><br><span class="line">    let pos = ipLocation.data.country;</span><br><span class="line">    let ip = ipLocation.ip;</span><br><span class="line">    let posdesc;</span><br><span class="line"></span><br><span class="line">    // 新增ipv6显示为指定内容</span><br><span class="line">    if (ip.includes(&quot;:&quot;)) &#123;</span><br><span class="line">        ip = &quot;&lt;br&gt;好复杂，咱看不懂呢~(ipv6)&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 以下的代码需要根据新API返回的结果进行相应的调整</span><br><span class="line">    switch (ipLocation.data.country) &#123;</span><br><span class="line">        case &quot;日本&quot;:</span><br><span class="line">            posdesc = &quot;よろしく，一起去看樱花吗&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;美国&quot;:</span><br><span class="line">            posdesc = &quot;Let us live in peace!&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;英国&quot;:</span><br><span class="line">            posdesc = &quot;想同你一起夜乘伦敦眼&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;俄罗斯&quot;:</span><br><span class="line">            posdesc = &quot;干了这瓶伏特加！&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;法国&quot;:</span><br><span class="line">            posdesc = &quot;C&#x27;est La Vie&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;德国&quot;:</span><br><span class="line">            posdesc = &quot;Die Zeit verging im Fluge.&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;澳大利亚&quot;:</span><br><span class="line">            posdesc = &quot;一起去大堡礁吧！&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;加拿大&quot;:</span><br><span class="line">            posdesc = &quot;拾起一片枫叶赠予你&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &quot;中国&quot;:</span><br><span class="line">            pos = ipLocation.data.prov + &quot; &quot; + ipLocation.data.city + &quot; &quot; + ipLocation.data.district;</span><br><span class="line">            switch (ipLocation.data.prov) &#123;</span><br><span class="line">                case &quot;北京市&quot;:</span><br><span class="line">                    posdesc = &quot;北——京——欢迎你~~~&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;天津市&quot;:</span><br><span class="line">                    posdesc = &quot;讲段相声吧&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;河北省&quot;:</span><br><span class="line">                    posdesc = &quot;山势巍巍成壁垒，天下雄关铁马金戈由此向，无限江山&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;山西省&quot;:</span><br><span class="line">                    posdesc = &quot;展开坐具长三尺，已占山河五百余&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;内蒙古自治区&quot;:</span><br><span class="line">                    posdesc = &quot;天苍苍，野茫茫，风吹草低见牛羊&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;辽宁省&quot;:</span><br><span class="line">                    posdesc = &quot;我想吃烤鸡架！&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;吉林省&quot;:</span><br><span class="line">                    posdesc = &quot;状元阁就是东北烧烤之王&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;黑龙江省&quot;:</span><br><span class="line">                    posdesc = &quot;很喜欢哈尔滨大剧院&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;上海市&quot;:</span><br><span class="line">                    posdesc = &quot;众所周知，中国只有两个城市&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;江苏省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;南京市&quot;:</span><br><span class="line">                            posdesc = &quot;这是我挺想去的城市啦&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;苏州市&quot;:</span><br><span class="line">                            posdesc = &quot;上有天堂，下有苏杭&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            posdesc = &quot;散装是必须要散装的&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;浙江省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;杭州市&quot;:</span><br><span class="line">                            posdesc = &quot;东风渐绿西湖柳，雁已还人未南归&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            posdesc = &quot;望海楼明照曙霞,护江堤白蹋晴沙&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;河南省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;郑州市&quot;:</span><br><span class="line">                            posdesc = &quot;豫州之域，天地之中&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;信阳市&quot;:</span><br><span class="line">                            posdesc = &quot;品信阳毛尖，悟人间芳华&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;南阳市&quot;:</span><br><span class="line">                            posdesc = &quot;臣本布衣，躬耕于南阳此南阳非彼南阳！&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;驻马店市&quot;:</span><br><span class="line">                            posdesc = &quot;峰峰有奇石，石石挟仙气嵖岈山的花很美哦！&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;开封市&quot;:</span><br><span class="line">                            posdesc = &quot;刚正不阿包青天&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;洛阳市&quot;:</span><br><span class="line">                            posdesc = &quot;洛阳牡丹甲天下&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            posdesc = &quot;可否带我品尝河南烩面啦？&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;安徽省&quot;:</span><br><span class="line">                    posdesc = &quot;蚌埠住了，芜湖起飞&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;福建省&quot;:</span><br><span class="line">                    posdesc = &quot;井邑白云间，岩城远带山&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;江西省&quot;:</span><br><span class="line">                    posdesc = &quot;落霞与孤鹜齐飞，秋水共长天一色&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;山东省&quot;:</span><br><span class="line">                    posdesc = &quot;遥望齐州九点烟，一泓海水杯中泻&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;湖北省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;黄冈市&quot;:</span><br><span class="line">                            posdesc = &quot;红安将军县！辈出将才！&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            posdesc = &quot;来碗热干面~&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;湖南省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;衡阳市&quot;:</span><br><span class="line">                            posdesc = &quot;老乡见老乡，两眼泪汪汪&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;长沙市&quot;:</span><br><span class="line">                            posdesc = &quot;74751，长沙斯塔克&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;广东省&quot;:</span><br><span class="line">                    switch (ipLocation.data.city) &#123;</span><br><span class="line">                        case &quot;广州市&quot;:</span><br><span class="line">                            posdesc = &quot;看小蛮腰，喝早茶了嘛~&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;深圳市&quot;:</span><br><span class="line">                            posdesc = &quot;今天你逛商场了嘛~&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        case &quot;阳江市&quot;:</span><br><span class="line">                            posdesc = &quot;阳春合水！博主家乡~ 欢迎来玩~&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            posdesc = &quot;我们都是地球人~&quot;;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;广西壮族自治区&quot;:</span><br><span class="line">                    posdesc = &quot;桂林山水甲天下&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;海南省&quot;:</span><br><span class="line">                    posdesc = &quot;朝观日出逐白浪，夕看云起收霞光&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;四川省&quot;:</span><br><span class="line">                    posdesc = &quot;康康川妹子&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;贵州省&quot;:</span><br><span class="line">                    posdesc = &quot;茅台，学生，再塞200&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;云南省&quot;:</span><br><span class="line">                    posdesc = &quot;玉龙飞舞云缠绕，万仞冰川直耸天&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;西藏自治区&quot;:</span><br><span class="line">                    posdesc = &quot;躺在茫茫草原上，仰望蓝天&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;陕西省&quot;:</span><br><span class="line">                    posdesc = &quot;来份臊子面加馍&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;甘肃省&quot;:</span><br><span class="line">                    posdesc = &quot;羌笛何须怨杨柳，春风不度玉门关&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;青海省&quot;:</span><br><span class="line">                    posdesc = &quot;牛肉干和老酸奶都好好吃&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;宁夏回族自治区&quot;:</span><br><span class="line">                    posdesc = &quot;大漠孤烟直，长河落日圆&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;新疆维吾尔自治区&quot;:</span><br><span class="line">                    posdesc = &quot;驼铃古道丝绸路，胡马犹闻唐汉风&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;台湾省&quot;:</span><br><span class="line">                    posdesc = &quot;我在这头，大陆在那头&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;香港特别行政区&quot;:</span><br><span class="line">                    posdesc = &quot;永定贼有残留地鬼嚎，迎击光非岁玉&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;澳门特别行政区&quot;:</span><br><span class="line">                    posdesc = &quot;性感荷官，在线发牌&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    posdesc = &quot;带我去你的城市逛逛吧！&quot;;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            posdesc = &quot;带我去你的国家逛逛吧&quot;;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 根据本地时间切换欢迎语</span><br><span class="line">    let timeChange;</span><br><span class="line">    let date = new Date();</span><br><span class="line">    if (date.getHours() &gt;= 5 &amp;&amp; date.getHours() &lt; 11) timeChange = &quot;&lt;span&gt;🌤️ 早上好，一日之计在于晨&lt;/span&gt;&quot;;</span><br><span class="line">    else if (date.getHours() &gt;= 11 &amp;&amp; date.getHours() &lt; 13) timeChange = &quot;&lt;span&gt;☀️ 中午好，记得午休喔~&lt;/span&gt;&quot;;</span><br><span class="line">    else if (date.getHours() &gt;= 13 &amp;&amp; date.getHours() &lt; 17) timeChange = &quot;&lt;span&gt;🕞 下午好，饮茶先啦！&lt;/span&gt;&quot;;</span><br><span class="line">    else if (date.getHours() &gt;= 17 &amp;&amp; date.getHours() &lt; 19) timeChange = &quot;&lt;span&gt;🚶‍♂️ 即将下班，记得按时吃饭~&lt;/span&gt;&quot;;</span><br><span class="line">    else if (date.getHours() &gt;= 19 &amp;&amp; date.getHours() &lt; 24) timeChange = &quot;&lt;span&gt;🌙 晚上好，夜生活嗨起来！&lt;/span&gt;&quot;;</span><br><span class="line">    else timeChange = &quot;夜深了，早点休息，少熬夜&quot;;</span><br><span class="line"></span><br><span class="line">    let welcomeInfoElement = document.getElementById(&quot;welcome-info&quot;);</span><br><span class="line"></span><br><span class="line">    if (welcomeInfoElement) &#123;</span><br><span class="line">        welcomeInfoElement.innerHTML =</span><br><span class="line">            `🎉欢迎！！！━(*｀∀´*)ノ亻!&lt;b&gt;&lt;span style=&quot;color: var(--tags-blue-color)&quot;&gt; &lt;br&gt;$&#123;pos&#125;&lt;/span&gt;&lt;/b&gt;</span><br><span class="line">             &lt;br&gt;的大神👀&lt;br&gt;您的IP：&lt;b&gt;&lt;span class=&quot;blur-text&quot; style=&quot;color: var(--tags-blue-color)&quot;&gt;$&#123;ip&#125;&lt;/span&gt;&lt;/b&gt;</span><br><span class="line">             &lt;br&gt;当前位置距博主约 &lt;b&gt;&lt;span class=&quot;blur-text&quot; style=&quot;color: var(--anzhiyu-main)&quot;&gt;$&#123;dist.toFixed(2)&#125;&lt;/span&gt;&lt;/b&gt; 公里！</span><br><span class="line">             &lt;br&gt;$&#123;timeChange&#125;&lt;br&gt;Tip：&lt;b&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;$&#123;posdesc&#125;&lt;/span&gt;&lt;/b&gt;`;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&quot;Pjax无法获取元素&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Pjax完成页面切换的事件回调处理</span><br><span class="line">function handlePjaxComplete() &#123;</span><br><span class="line">    if (isHomePage()) &#123;</span><br><span class="line">        if (ipLocation &amp;&amp; ipLocation.data) &#123;</span><br><span class="line">            showWelcome();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isHomePage() &#123;</span><br><span class="line">    return window.location.pathname === &#x27;/&#x27; || window.location.pathname === &#x27;/index.html&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 添加pjax:complete事件监听</span><br><span class="line">window.onload = function () &#123;</span><br><span class="line">    if (isHomePage()) &#123;</span><br><span class="line">        if (ipLocation &amp;&amp; ipLocation.data) &#123;</span><br><span class="line">            showWelcome();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    document.addEventListener(&quot;pjax:complete&quot;, handlePjaxComplete);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>              </div>            </details><h2 id="信息卡片"><a href="#信息卡片" class="headerlink" title="信息卡片"></a>信息卡片</h2><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <p><a href="https://www.fomal.cc/posts/d739261b.html">博客魔改教程总结(四) | Fomalhaut🥝</a></p><p>修改<code>[BlogRoot]\themes\butterfly\layout\includes\widget\card_author.pug</code></p>              </div>            </details><h1 id="导航栏美化"><a href="#导航栏美化" class="headerlink" title="导航栏美化"></a>导航栏美化</h1><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <p>[root]\themes\butterfly\layout\includes\header\nav.pug 文件中下方代码标出来的内容，去掉加号即为正常缩进。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">nav#nav</span><br><span class="line">  span#blog-info</span><br><span class="line">    a.nav-site-title(href=url_for(&#x27;/&#x27;) title=config.title)</span><br><span class="line">      if theme.nav.logo</span><br><span class="line">        img.site-icon(src=url_for(theme.nav.logo))</span><br><span class="line">      if theme.nav.display_title</span><br><span class="line">        span.site-name=config.title</span><br><span class="line">    </span><br><span class="line">  #menus</span><br><span class="line">    if theme.menu</span><br><span class="line">      != partial(&#x27;includes/header/menu_item&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line"></span><br><span class="line">  div#name-container</span><br><span class="line">    a(id=&quot;page-name&quot; href=&quot;javascript:btf.scrollToDest(0, 500)&quot;) PAGE_NAME</span><br><span class="line"></span><br><span class="line">  #nav-right</span><br><span class="line">    #travellings</span><br><span class="line">      a.site-page(href=url_for(&#x27;https://www.travellings.cn/go.html&#x27;) title=&quot;友链接力-随机开往&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;)</span><br><span class="line">        i.fa-solid.fa-bus.fa-fw</span><br><span class="line">    </span><br><span class="line">    #ten-years</span><br><span class="line">      a.site-page(href=url_for(&#x27;https://foreverblog.cn/go.html&#x27;) title=&quot;友链接力-十年之约&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;)</span><br><span class="line">        i.fa-brands.fa-nfc-symbol.fa-fw</span><br><span class="line">        </span><br><span class="line">    #random</span><br><span class="line">      a.site-page(href=&quot;javascript:toRandomPost()&quot; title=&quot;随机前往一个文章&quot;)</span><br><span class="line">        i.fa-solid.fa-shuffle.fa-fw</span><br><span class="line">        </span><br><span class="line">    if theme.search.use</span><br><span class="line">      #search-button</span><br><span class="line">        a.site-page.social-icon.search(href=&quot;javascript:void(0);&quot; title=&quot;站内搜索&quot;)</span><br><span class="line">          i.fas.fa-search.fa-fw</span><br><span class="line"></span><br><span class="line">    #toggle-menu</span><br><span class="line">      a.site-page(href=&quot;javascript:void(0);&quot; title=&quot;展开菜单&quot;)</span><br><span class="line">        i.fas.fa-bars.fa-fw</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接着，添加自定义 JavaScript 脚本，内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&#x27;pjax:complete&#x27;, tonav);</span><br><span class="line">document.addEventListener(&#x27;DOMContentLoaded&#x27;, tonav);</span><br><span class="line"></span><br><span class="line">function tonav() &#123;</span><br><span class="line">    var nameContainer = document.querySelector(&quot;#nav #name-container&quot;);</span><br><span class="line">    var menusItems = document.querySelector(&quot;#nav .menus_items&quot;);</span><br><span class="line">    </span><br><span class="line">    // 如果找不到元素，直接返回</span><br><span class="line">    if (!nameContainer || !menusItems) return;</span><br><span class="line">    </span><br><span class="line">    // 使用 requestAnimationFrame 优化性能</span><br><span class="line">    var position = window.scrollY;</span><br><span class="line">    var ticking = false;</span><br><span class="line"></span><br><span class="line">    window.addEventListener(&#x27;scroll&#x27;, function() &#123;</span><br><span class="line">        if (!ticking) &#123;</span><br><span class="line">            window.requestAnimationFrame(function() &#123;</span><br><span class="line">                var scroll = window.scrollY;</span><br><span class="line"></span><br><span class="line">                if (scroll &gt; position + 5) &#123;</span><br><span class="line">                    // 向下滚动</span><br><span class="line">                    nameContainer.classList.add(&quot;visible&quot;);</span><br><span class="line">                    menusItems.classList.remove(&quot;visible&quot;);</span><br><span class="line">                &#125; else if (scroll &lt; position - 5) &#123;</span><br><span class="line">                    // 向上滚动</span><br><span class="line">                    nameContainer.classList.remove(&quot;visible&quot;);</span><br><span class="line">                    menusItems.classList.add(&quot;visible&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                position = scroll;</span><br><span class="line">                ticking = false;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            ticking = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 初始化 page-name</span><br><span class="line">    var pageName = document.getElementById(&quot;page-name&quot;);</span><br><span class="line">    if (pageName) &#123;</span><br><span class="line">        // 获取标题并去除后缀</span><br><span class="line">        var title = document.title;</span><br><span class="line">        var separator = &quot; | &quot;; // 根据实际标题分隔符调整</span><br><span class="line">        if (title.includes(separator)) &#123;</span><br><span class="line">            pageName.innerText = title.split(separator)[0];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            pageName.innerText = title;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前置工作添加好了，下面我们就开始实现核心的美化部分，添加CSS。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><span class="line">/* 导航栏基础布局 */</span><br><span class="line">#nav-right&#123;</span><br><span class="line">    flex:1;</span><br><span class="line">    justify-content: flex-end;</span><br><span class="line">    margin-left: auto;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap:nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav.show &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav .site-page &#123;</span><br><span class="line">    padding-bottom: 14px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#page-header.not-top-img #nav &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav-group &#123;</span><br><span class="line">    width: 1400px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 0 0.6rem;</span><br><span class="line">    margin-left: auto;</span><br><span class="line">    margin-right: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 顶部栏宽度定义 */</span><br><span class="line">/* 修复：移除这里的 margin-top，防止覆盖后续的样式 */</span><br><span class="line">#nav .menus_items .menus_item .menus_item_child &#123;</span><br><span class="line">    margin-top: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav .menus_items .menus_item .menus_item_child li a &#123;</span><br><span class="line">    padding-top: 6px; </span><br><span class="line">    padding-right: 18px; </span><br><span class="line">    padding-bottom: 6px; </span><br><span class="line">    padding-left: 15px; </span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">#nav #travellings &#123;</span><br><span class="line">    padding: 0 14px 0 ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav #ten-years &#123;</span><br><span class="line">    padding: 0 14px 0 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 移动端菜单逻辑（如果主题有移动端菜单，这里主要处理桌面端） */</span><br><span class="line">@media (max-width: 768px) &#123;</span><br><span class="line">    #nav #page-name &#123;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* ===========================================</span><br><span class="line">   核心动画与交互逻辑</span><br><span class="line">   =========================================== */</span><br><span class="line"></span><br><span class="line">/* 默认状态：隐藏 */</span><br><span class="line">#nav #name-container &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 50%;</span><br><span class="line">    left: 50%;</span><br><span class="line">    transform: translate(-50%, -100%); /* 向上偏移 */</span><br><span class="line">    opacity: 0;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">    transition: all 0.3s ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav .menus_items &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: fit-content;</span><br><span class="line">    left: 50%;</span><br><span class="line">    top: 50%;</span><br><span class="line">    transform: translate(-50%, -100%); /* 向上偏移 */</span><br><span class="line">    opacity: 0;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">    transition: all 0.3s ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 显示状态：居中可见 */</span><br><span class="line">#nav #name-container.visible &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    transform: translate(-50%, -50%);</span><br><span class="line">    pointer-events: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav .menus_items.visible &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    transform: translate(-50%, -50%);</span><br><span class="line">    pointer-events: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* ===========================================</span><br><span class="line">   导航栏样式优化 (桌面端)</span><br><span class="line">   =========================================== */</span><br><span class="line">@media (min-width: 768px) &#123;</span><br><span class="line">  </span><br><span class="line">  /* 菜单居中布局补充 */</span><br><span class="line">  #nav .menus_items &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* 菜单项样式 */</span><br><span class="line">  #nav .menus_items .menus_item &#123;</span><br><span class="line">    font-size: 1.2em; </span><br><span class="line">    font-weight: bold;</span><br><span class="line">    margin: 0 5px;</span><br><span class="line">    padding: 5px 10px;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    position: relative;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* 修复：增加透明桥梁连接父子菜单，防止鼠标移出时菜单消失 */</span><br><span class="line">  #nav .menus_items .menus_item::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    left: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 20px; /* 覆盖子菜单的 margin-top */</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* 悬停效果 */</span><br><span class="line">  #nav .menus_items .menus_item:hover &#123;</span><br><span class="line">    background: rgba(0, 0, 0, 0.05);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  [data-theme=&quot;dark&quot;] #nav .menus_items .menus_item:hover &#123;</span><br><span class="line">    background: rgba(255, 255, 255, 0.1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* 子菜单容器优化 - 增加 #nav 提高权重 */</span><br><span class="line">  #nav .menus_items .menus_item .menus_item_child &#123;</span><br><span class="line">    display: none; /* 默认隐藏 */</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    left: 50%;</span><br><span class="line">    transform: translateX(-50%); /* 确保居中 */</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    </span><br><span class="line">    background: rgba(255, 255, 255, 0.95);</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);</span><br><span class="line">    padding: 5px;</span><br><span class="line">    margin-top: 10px; /* 这里重新定义 margin-top */</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    </span><br><span class="line">    /* 动画 */</span><br><span class="line">    animation: subMenuSlide 0.3s ease forwards;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* hover显示子菜单 */</span><br><span class="line">  #nav .menus_items .menus_item:hover .menus_item_child &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: row;</span><br><span class="line">    gap: 5px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* 深色模式子菜单 */</span><br><span class="line">  [data-theme=&quot;dark&quot;] #nav .menus_items .menus_item .menus_item_child &#123;</span><br><span class="line">    background: rgba(40, 40, 40, 0.95);</span><br><span class="line">    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  /* 子菜单项样式 */</span><br><span class="line">  #nav .menus_items .menus_item .menus_item_child li &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin: 0 2px;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  #nav .menus_items .menus_item .menus_item_child li a &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    padding: 5px 10px;</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">    transition: background 0.2s;</span><br><span class="line">    color: var(--font-color);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  #nav .menus_items .menus_item .menus_item_child li a:hover &#123;</span><br><span class="line">    background: rgba(0, 0, 0, 0.05);</span><br><span class="line">    color: var(--theme-color);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  [data-theme=&quot;dark&quot;] #nav .menus_items .menus_item .menus_item_child li a:hover &#123;</span><br><span class="line">    background: rgba(255, 255, 255, 0.1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 标题样式 */</span><br><span class="line">#nav #page-name &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    padding: 10px 30px;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 回到顶部 悬停效果 */</span><br><span class="line">#nav #page-name::before &#123;</span><br><span class="line">    font-size: 18px;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    border-radius: 12px;</span><br><span class="line">    color: #4C4948;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    content: &#x27;回到顶部&#x27;;</span><br><span class="line">    background-color: #ffffff;</span><br><span class="line">    transition: all 0.3s;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    line-height: 45px;</span><br><span class="line">    border: 1px solid #4C4948;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[data-theme=dark] #nav #page-name::before &#123;</span><br><span class="line">    color: #B9BABB;</span><br><span class="line">    background-color: #000000;</span><br><span class="line">    border: 1px solid #B9BABB;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav #page-name:hover:before &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Logo和文字优化 */</span><br><span class="line">#blog-info .site-name &#123;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  letter-spacing: 1px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 隐藏导航栏下拉箭头 */</span><br><span class="line">#nav .menus_items .menus_item .fa-chevron-down &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 随机文章按钮样式 */</span><br><span class="line">#randomPost_button &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  padding: 0 0 0 14px;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 子菜单动画定义 */</span><br><span class="line">@keyframes subMenuSlide &#123;</span><br><span class="line">  0% &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    transform: translateX(-50%) translateY(10px);</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    transform: translateX(-50%) translateY(0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.site-page.child &#123;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  padding: 5px 10px !important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开 [root]\themes\butterfly\layout\includes\header，并修改 menu_item.pug 文件中的第二行内容，确保在生成页面时提前添加 visible 标签，以防止刷新后被隐藏。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">if theme.menu</span><br><span class="line">+  .menus_items.visible</span><br><span class="line">-  .menus_items</span><br><span class="line">    each value, label in theme.menu</span><br><span class="line">      if typeof value !== &#x27;object&#x27;</span><br><span class="line">        .menus_item</span><br><span class="line">          - const valueArray = value.split(&#x27;||&#x27;)</span><br><span class="line">          a.site-page(href=url_for(trim(valueArray[0])))</span><br><span class="line">            if valueArray[1]</span><br><span class="line">              i.fa-fw(class=trim(valueArray[1]))</span><br><span class="line">            span=&#x27; &#x27;+label</span><br><span class="line">      else</span><br><span class="line">        .menus_item</span><br><span class="line">          - const labelArray = label.split(&#x27;||&#x27;)</span><br><span class="line">          - const hideClass = labelArray[2] &amp;&amp; trim(labelArray[2]) === &#x27;hide&#x27; ? &#x27;hide&#x27; : &#x27;&#x27;</span><br><span class="line">          a.site-page.group(class=`$&#123;hideClass&#125;` href=&#x27;javascript:void(0);&#x27;)</span><br><span class="line">            if labelArray[1]</span><br><span class="line">              i.fa-fw(class=trim(labelArray[1]))</span><br><span class="line">            span=&#x27; &#x27;+ trim(labelArray[0])</span><br><span class="line">            i.fas.fa-chevron-down</span><br><span class="line">          ul.menus_item_child</span><br><span class="line">            each val,lab in value </span><br><span class="line">              - const valArray = val.split(&#x27;||&#x27;)</span><br><span class="line">              li</span><br><span class="line">                a.site-page.child(href=url_for(trim(valArray[0])))</span><br><span class="line">                  if valArray[1]</span><br><span class="line">                    i.fa-fw(class=trim(valArray[1]))</span><br><span class="line">                  span=&#x27; &#x27;+ lab</span><br><span class="line"></span><br></pre></td></tr></table></figure>              </div>            </details><h1 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h1><p>Twikoo评论</p><details class="folding-tag" cyan close><summary> 具体步骤 </summary>              <div class='content'>              <ul><li><p>搭建</p><ol><li>搭建，本博客的评论系统主要通过vercel部署。具体可参照<a href="https://twikoo.js.org/intro.html">Twikoo 文档</a></li><li>部署完成后修改<code>_config.butterfly.yml</code>中的<code>comment</code>和<code>twikoo</code>配置项即可。可参考<a href="https://butterfly.js.org/posts/4aa8abbe/">Butterfly 文檔(三) 主題配置 | Butterfly</a>中的评论配置。<ul><li>第一次进入管理面板需设置管理员登录密码，在管理面板中可管理评论</li></ul></li></ol></li><li><p>美化</p><ol><li><p>在_config.butterfly.ym的inject中添加placeholder参数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">twikoo:</span><br><span class="line">  envId: https://twikoojs-cyan.vercel.app/</span><br><span class="line">  region:</span><br><span class="line">  # 使用Twikoo访客统计作为页面浏览量</span><br><span class="line">  visitor: false</span><br><span class="line">  option:</span><br><span class="line">    placeholder: &#x27;欢迎留言，支持Markdown语法，快来评论吧~&#x27;</span><br></pre></td></tr></table></figure></li></ol></li></ul>              </div>            </details><h1 id="娱乐页"><a href="#娱乐页" class="headerlink" title="娱乐页"></a>娱乐页</h1>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 主题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>主题 Butterfly 5.5.4 基础教程</title>
      <link href="/2026/02/04/front-mateer%E8%AF%B4%E6%98%8E/"/>
      <url>/2026/02/04/front-mateer%E8%AF%B4%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h2 id="Front-matter-说明（简体中文版）"><a href="#Front-matter-说明（简体中文版）" class="headerlink" title="Front-matter 说明（简体中文版）"></a>Front-matter 说明（简体中文版）</h2><p>Front-matter 是 Markdown 文件最上方以 <code>---</code> 分隔的区域，用于指定单个文件的变量。</p><ul><li>Page Front-matter：用于<strong>页面</strong>配置</li><li>Post Front-matter：用于<strong>文章页</strong>配置</li></ul><p>标注为<strong>可选</strong>的参数可根据自身需求添加，无需全部写在 Markdown 中。</p><h3 id="页面-Page-Front-matter"><a href="#页面-Page-Front-matter" class="headerlink" title="页面 (Page) Front-matter"></a>页面 (Page) Front-matter</h3><table><thead><tr><th>参数</th><th>必填 &#x2F; 可选</th><th>说明</th></tr></thead><tbody><tr><td>title</td><td><strong>必填</strong></td><td>页面标题</td></tr><tr><td>date</td><td><strong>必填</strong></td><td>页面创建日期</td></tr><tr><td>updated</td><td>可选</td><td>页面更新日期</td></tr><tr><td>type</td><td><strong>必填</strong></td><td>标签、分类和友情链接这三个页面需配置该参数</td></tr><tr><td>comments</td><td>可选</td><td>显示页面评论模块（默认 <code>true</code>）</td></tr><tr><td>description</td><td>可选</td><td>页面描述</td></tr><tr><td>keywords</td><td>可选</td><td>页面关键词</td></tr><tr><td>top_img</td><td>可选</td><td>页面顶部图片</td></tr><tr><td>mathjax</td><td>可选</td><td>显示 MathJax（仅当 MathJax 的 <code>per_page: false</code> 时需配置，默认 <code>false</code>）</td></tr><tr><td>katex</td><td>可选</td><td>显示 KaTeX（仅当 KaTeX 的 <code>per_page: false</code> 时需配置，默认 <code>false</code>）</td></tr><tr><td>aside</td><td>可选</td><td>显示侧边栏（默认 <code>true</code>）</td></tr><tr><td>aplayer</td><td>可选</td><td>在对应页面加载 APlayer 的 JS 和 CSS，参考下方音乐配置</td></tr><tr><td>highlight_shrink</td><td>可选</td><td>配置代码框是否展开（<code>true</code>&#x2F;<code>false</code>），默认沿用主题配置的 <code>highlight_shrink</code> 设置</td></tr><tr><td>random</td><td>可选</td><td>配置友情链接是否随机排序（默认 <code>false</code>）</td></tr><tr><td>limit.type</td><td>可选</td><td>配置说说显示数量的类型（<code>date</code> 或 <code>num</code>）</td></tr><tr><td>limit.value</td><td>可选</td><td>配置说说显示数量的数值</td></tr></tbody></table><h3 id="文章-Post-Front-matter"><a href="#文章-Post-Front-matter" class="headerlink" title="文章 (Post) Front-matter"></a>文章 (Post) Front-matter</h3><table><thead><tr><th>参数</th><th>必填 &#x2F; 可选</th><th>说明</th></tr></thead><tbody><tr><td>title</td><td><strong>必填</strong></td><td>文章标题</td></tr><tr><td>date</td><td><strong>必填</strong></td><td>文章创建日期</td></tr><tr><td>updated</td><td>可选</td><td>文章更新日期</td></tr><tr><td>tags</td><td>可选</td><td>文章标签</td></tr><tr><td>categories</td><td>可选</td><td>文章分类</td></tr><tr><td>keywords</td><td>可选</td><td>文章关键词</td></tr><tr><td>description</td><td>可选</td><td>文章描述</td></tr><tr><td>top_img</td><td>可选</td><td>文章顶部图片</td></tr><tr><td>cover</td><td>可选</td><td>文章缩略图（未设置 <code>top_img</code> 时，文章页顶部显示该缩略图；可设为 <code>false</code>&#x2F; 图片地址 &#x2F; 留空）</td></tr><tr><td>comments</td><td>可选</td><td>显示文章评论模块（默认 <code>true</code>）</td></tr><tr><td>toc</td><td>可选</td><td>显示文章目录（默认沿用主题配置中 <code>toc</code> 的 <code>enable</code> 设置）</td></tr><tr><td>toc_number</td><td>可选</td><td>显示目录编号（默认沿用主题配置中 <code>toc</code> 的 <code>number</code> 设置）</td></tr><tr><td>toc_style_simple</td><td>可选</td><td>启用目录简洁模式</td></tr><tr><td>copyright</td><td>可选</td><td>显示文章版权模块（默认沿用主题配置中 <code>post_copyright</code> 的 <code>enable</code> 设置）</td></tr><tr><td>copyright_author</td><td>可选</td><td>文章版权模块的文章作者</td></tr><tr><td>copyright_author_href</td><td>可选</td><td>文章版权模块的作者链接</td></tr><tr><td>copyright_url</td><td>可选</td><td>文章版权模块的文章链接</td></tr><tr><td>copyright_info</td><td>可选</td><td>文章版权模块的版权声明文字</td></tr><tr><td>mathjax</td><td>可选</td><td>显示 MathJax（仅当 MathJax 的 <code>per_page: false</code> 时需配置，默认 <code>false</code>）</td></tr><tr><td>katex</td><td>可选</td><td>显示 KaTeX（仅当 KaTeX 的 <code>per_page: false</code> 时需配置，默认 <code>false</code>）</td></tr><tr><td>aplayer</td><td>可选</td><td>在对应页面加载 APlayer 的 JS 和 CSS，参考下方音乐配置</td></tr><tr><td>highlight_shrink</td><td>可选</td><td>配置代码框是否展开（<code>true</code>&#x2F;<code>false</code>），默认沿用主题配置的 <code>highlight_shrink</code> 设置</td></tr><tr><td>aside</td><td>可选</td><td>显示侧边栏（默认 <code>true</code>）</td></tr><tr><td>abcjs</td><td>可选</td><td>加载 ABCJS（仅当 ABCJS 的 <code>per_page: false</code> 时需配置，默认 <code>false</code>）</td></tr><tr><td>noticeOutdate</td><td>可选</td><td>启用文章过期提醒（默认沿用主题配置中 <code>noticeOutdate</code> 的 <code>enable</code> 设置）</td></tr><tr><td>swiper_index</td><td>可选</td><td>置顶优先级，数字越大优先级越高</td></tr></tbody></table><h2 id="Hexo-外挂标签汇总表格"><a href="#Hexo-外挂标签汇总表格" class="headerlink" title="Hexo 外挂标签汇总表格"></a>Hexo 外挂标签汇总表格</h2><table><thead><tr><th align="center">标签类型</th><th align="center">标签名称 &#x2F; 核心语法</th><th align="center">功能说明</th><th align="center">可直接使用的示例</th><th align="center">备注 &#x2F; 前置要求</th></tr></thead><tbody><tr><td align="center">内置（无需安装）</td><td align="center">注脚 <code>footnote</code>&#x2F;<code>footnoteref</code></td><td align="center">为文章添加正文引用 + 文末注脚，提升文章严谨性</td><td align="center">正文：<code>这是需要注释的内容&#123;% footnoteref 1 %&#125;</code>文末：<code>&#123;% footnote 1 %&#125;这是注脚的具体内容&#123;% endfootnote %&#125;</code></td><td align="center">生成的注脚会自动排列在文章末尾，支持多个注脚（修改数字编号即可）</td></tr><tr><td align="center">内置（无需安装）</td><td align="center">代码块 <code>code</code></td><td align="center">增强原生 Markdown 代码块，支持指定语言、显示行号、隐藏代码语言标识</td><td align="center"><code>&#123;% code javascript [1,3] %&#125;<br>const a = 10;<br>console.log(a);<br>function fn() &#123;&#125;<br>&#123;% endcode %&#125;</code></td><td align="center"><code>[1,3]</code> 表示仅显示第 1、3 行（也可写 <code>1-5</code> 显示第 1 到 5 行），不写则显示全部行</td></tr><tr><td align="center">内置（无需安装）</td><td align="center">图片 <code>img</code></td><td align="center">增强原生 Markdown 图片语法，支持指定宽高、自定义 alt 文本</td><td align="center"><code>&#123;% img https://xxx/photo.jpg 400 300 "这是一张示例图片" "图片描述" %&#125;</code></td><td align="center">语法格式：<code>&#123;% img 图片链接 宽度 高度 "alt文本" "标题文本" %&#125;</code>，宽高可省略（自适应）</td></tr><tr><td align="center">内置（无需安装）</td><td align="center">链接 <code>link</code></td><td align="center">增强原生 Markdown 链接，支持指定新窗口打开、添加额外属性</td><td align="center"><code>&#123;% link 我的博客 https://xxx.com _blank "noopener noreferrer" %&#125;</code></td><td align="center"><code>_blank</code> 表示新窗口打开，后续属性为安全优化，可省略；格式：<code>&#123;% link 链接文本 链接地址 额外属性 %&#125;</code></td></tr><tr><td align="center">内置（无需安装）</td><td align="center">折叠隐藏 <code>hide</code>（主题兼容）</td><td align="center">将大段内容折叠，点击展开，节省页面空间</td><td align="center"><code>&#123;% hide 点击展开查看详细内容 %&#125;<br>这里是需要隐藏的大段正文/代码/图片<br>&#123;% endhide %&#125;</code></td><td align="center">并非所有 Hexo 主题都支持，需主题内置该标签样式（如 Next、Butterfly 主题支持）</td></tr><tr><td align="center">第三方（需安装）</td><td align="center">音乐嵌入 <code>aplayer</code>（hexo-tag-aplayer）</td><td align="center">嵌入网易云音乐、QQ 音乐、本地音频，支持自定义播放器样式</td><td align="center"><code>&#123;% aplayer "花海" "周杰伦" "https://xxx/huahai.mp3" "https://xxx/cover.jpg" %&#125;</code></td><td align="center">1. 安装命令：<code>npm install hexo-tag-aplayer --save</code>2. 支持批量添加歌曲，兼容主流主题</td></tr><tr><td align="center">第三方（需安装）</td><td align="center">视频嵌入 <code>video</code>（hexo-tag-video）</td><td align="center">嵌入本地视频或在线视频（MP4&#x2F;WEBM 等格式），支持指定宽高</td><td align="center"><code>&#123;% video https://xxx/video.mp4 640 480 %&#125;`          | 1. 安装命令：`npm install hexo-tag-video --save`2. 本地视频放入 `source/images` 目录 || 第三方（需安装） | 流程图 `mermaid`（hexo-filter-mermaid-diagrams） |    嵌入流程图、时序图、饼图等，无需外部截图，支持实时渲染    | `&#123;% mermaid %&#125;<br>flowchart LR<br>A[开始] --> B[执行操作]<br>B --> C[结束]<br>&#123;% endmermaid %&#125;` | 1. 安装命令：`npm install hexo-filter-mermaid-diagrams --save`2. 需在 Hexo 配置文件开启 mermaid 支持 || 第三方（需安装） |         待办清单 `todo`（hexo-tag-todo）         |   添加可勾选的待办事项，支持「已完成」和「未完成」两种状态   | `&#123;% todo %&#125; 未完成的待办事项1<br>&#123;% todo done %&#125; 已完成的待办事项2&#123;% endtodo %&#125;` | 1. 安装命令：`npm install hexo-tag-todo --save`2. 生成的清单自带勾选样式，主题兼容度高 || 第三方（需安装） |   简洁卡片 `card`（hexo-tag-bootstrap-cards）    | 制作带标题、内容、按钮的 Bootstrap 风格卡片，提升页面美观度  | `&#123;% card "卡片标题" "卡片正文内容，支持简单 Markdown" "https://xxx.com" "按钮文本" %&#125;` | 1. 安装命令：`npm install hexo-tag-bootstrap-cards --save`2. 依赖 Bootstrap 样式，部分主题需额外引入 |### 一、行内文本标签（Inline Tags）| 标签名称    | 语法格式                      | 功能说明                             | 示例                                         || ----------- | ----------------------------- | ------------------------------------ | -------------------------------------------- || **u**       | `&#123;% u 文本内容 %&#125;`            | 添加下划线文本                       | `&#123;% u 这是带下划线的文本 %&#125;`                 || **emp**     | `&#123;% emp 文本内容 %&#125;`          | 添加着重号（底纹）文本               | `&#123;% emp 这是带着重号的文本 %&#125;`               || **wavy**    | `&#123;% wavy 文本内容 %&#125;`         | 添加波浪线文本                       | `&#123;% wavy 这是带波浪线的文本 %&#125;`              || **del**     | `&#123;% del 文本内容 %&#125;`          | 添加删除线文本                       | `&#123;% del 这是带删除线的文本 %&#125;`               || **kbd**     | `&#123;% kbd 文本内容 %&#125;`          | 添加键盘按键样式文本                 | `&#123;% kbd Ctrl+C %&#125;`                           || **psw**     | `&#123;% psw 文本内容 %&#125;`          | 添加密码隐藏效果文本（鼠标悬浮显示） | `&#123;% psw 这是隐藏的密码 %&#125;`                   || **mark**    | `&#123;% mark [color] 文本内容 %&#125;` | 添加高亮标记文本，支持自定义颜色     | `&#123;% mark #ff0 这是高亮文本 %&#125;`               || **sup**     | `&#123;% sup 文本内容 %&#125;`          | 添加上标文本                         | `X&#123;% sup 2 %&#125; + Y&#123;% sup 2 %&#125; = Z&#123;% sup 2 %&#125;` || **sub**     | `&#123;% sub 文本内容 %&#125;`          | 添加下标文本                         | `H&#123;% sub 2 %&#125;O`                              || **spoiler** | `&#123;% spoiler 文本内容 %&#125;`      | 添加剧透隐藏文本（点击显示）         | `&#123;% spoiler 这是剧透内容 %&#125;`                 |------### 二、块级容器标签（Block Containers）| 标签名称     | 语法格式                                                     | 功能说明                                | 示例                                                         || ------------ | ------------------------------------------------------------ | --------------------------------------- | ------------------------------------------------------------ || **note**     | `&#123;% note [class] [no-icon] [style] %&#125; 内容 &#123;% endnote %&#125;`    | 提示块容器，支持 6 种预设样式           | `&#123;% note success %&#125; 操作成功提示 &#123;% endnote %&#125;`              || **collapse** | `&#123;% collapse [标题] [open] %&#125; 内容 &#123;% endcollapse %&#125;`        | 可折叠面板，`open`参数默认展开          | `&#123;% collapse 点击展开内容 open %&#125; 隐藏的详细内容 &#123;% endcollapse %&#125;` || **tabs**     | `&#123;% tabs [分组名] [index] %&#125;<br>&#123;% tab 标签1 %&#125; 内容1 &#123;% endtab %&#125;<br>&#123;% tab 标签2 %&#125; 内容2 &#123;% endtab %&#125;<br>&#123;% endtabs %&#125;` | 选项卡切换面板，`index`指定默认激活标签 | `&#123;% tabs 示例 1 %&#125;<br>&#123;% tab 标签一 %&#125; 内容一 &#123;% endtab %&#125;<br>&#123;% tab 标签二 %&#125; 内容二 &#123;% endtab %&#125;<br>&#123;% endtabs %&#125;` || **timeline** | `&#123;% timeline %&#125;<br>&#123;% timelineItem [标题] [时间] [图标] %&#125; 内容 &#123;% endtimelineItem %&#125;<br>&#123;% endtimeline %&#125;` | 时间轴展示容器，支持自定义图标          | `&#123;% timeline %&#125;<br>&#123;% timelineItem 项目启动 2023-01-01 fa-solid fa-rocket %&#125; 项目开始开发 &#123;% endtimelineItem %&#125;<br>&#123;% endtimeline %&#125;` || **mermaid**  | `&#123;% mermaid %&#125; 图表代码 &#123;% endmermaid %&#125;`                    | 渲染 Mermaid 流程图 / 时序图等          | `&#123;% mermaid %&#125;<br>graph LR<br>A[开始] --> B[结束]<br>&#123;% endmermaid %&#125;` || **chart**    | `&#123;% chart [类型] [标题] [height] %&#125; 数据配置 &#123;% endchart %&#125;` | 渲染 Chart.js 图表                      | `&#123;% chart bar 销量统计 300px %&#125;<br>&#123;labels: ['1月','2月'], datasets: [&#123;data: [100, 200]&#125;]&#125;<br>&#123;% endchart %&#125;` |------### 三、媒体内容标签（Media Tags）| 标签名称    | 语法格式                                                     | 功能说明                              | 示例                                                         || ----------- | ------------------------------------------------------------ | ------------------------------------- | ------------------------------------------------------------ || **gallery** | `&#123;% gallery %&#125;<br>![图片1](url1)<br>![图片2](url2)<br>&#123;% endgallery %&#125;` | 图片相册，自动排版，支持灯箱效果      | `&#123;% gallery %&#125;<br>![风景](https://example.com/1.jpg)<br>![人物](https://example.com/2.jpg)<br>&#123;% endgallery %&#125;` || **video**   | `&#123;% video [width] [height] [poster] %&#125; 视频URL &#123;% endvideo %&#125;</code></td><td align="center">视频播放器，支持自定义尺寸和封面</td></tr><tr><td align="center"><strong>audio</strong></td><td align="center"><code>&#123;% audio [autoplay] [loop] [controls] %&#125; 音频URL &#123;% endaudio %&#125;</code></td><td align="center">音频播放器，支持自动播放和循环</td><td align="center"><code>&#123;% audio autoplay loop %&#125; https://example.com/music.mp3 &#123;% endaudio %&#125;</code></td><td align="center"></td></tr><tr><td align="center"><strong>aplayer</strong></td><td align="center"><code>&#123;% aplayer 标题, 歌手, 音频URL, 封面URL, [lrc] %&#125;</code></td><td align="center">高级音频播放器，支持歌词显示</td><td align="center"><code>&#123;% aplayer 七里香, 周杰伦, https://example.com/qlx.mp3, https://example.com/cover.jpg, https://example.com/qlx.lrc %&#125;</code></td><td align="center"></td></tr><tr><td align="center"><strong>meting</strong></td><td align="center"><code>&#123;% meting [type], [id], [server], [option] %&#125;</code></td><td align="center">音乐 API 播放器（网易云 &#x2F; QQ 音乐等）</td><td align="center"><code>&#123;% meting song, 123456, netease, "autoplay: true" %&#125;</code></td><td align="center"></td></tr></tbody></table><hr><h3 id="四、功能组件标签（Functional-Components）"><a href="#四、功能组件标签（Functional-Components）" class="headerlink" title="四、功能组件标签（Functional Components）"></a>四、功能组件标签（Functional Components）</h3><table><thead><tr><th>标签名称</th><th>语法格式</th><th>功能说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>progress</strong></td><td><code>&#123;% progress [百分比] [颜色] [文字] %&#125;</code></td><td>进度条组件，支持自定义颜色和显示文本</td><td><code>&#123;% progress 75 #3eb8be 完成75% %&#125;</code></td></tr><tr><td><strong>button</strong></td><td><code>&#123;% button [text] [url] [type] [icon] %&#125;</code></td><td>按钮组件，支持 6 种预设样式和自定义图标</td><td><code>&#123;% button 点击跳转 https://example.com primary fa-solid fa-arrow-right %&#125;</code></td></tr><tr><td><strong>badge</strong></td><td><code>&#123;% badge [text] [type] [icon] %&#125;</code></td><td>徽章组件，用于标记状态或分类</td><td><code>&#123;% badge 新 primary fa-solid fa-star %&#125;</code></td></tr><tr><td><strong>bilibili</strong></td><td><code>&#123;% bilibili [av号/bv号] [width] [height] %&#125;</code></td><td>嵌入 B 站视频</td><td><code>&#123;% bilibili BV1xx411c7m9 640 360 %&#125;</code></td></tr><tr><td><strong>youtube</strong></td><td><code>&#123;% youtube [视频ID] [width] [height] %&#125;</code></td><td>嵌入 YouTube 视频</td><td><code>&#123;% youtube dQw4w9WgXcQ 640 360 %&#125;</code></td></tr><tr><td><strong>abcjs</strong></td><td><code>&#123;% abcjs %&#125; 乐谱代码 &#123;% endabcjs %&#125;</code></td><td>渲染 ABC 乐谱</td><td><code>&#123;% abcjs %&#125;X:1<br>T:Simple Song<br>M:4/4<br>L:1/8<br>K:C<br>C D E F G A B c&#123;% endabcjs %&#125;</code></td></tr><tr><td><strong>note</strong></td><td>（补充）支持的 class 参数：default&#x2F;primary&#x2F;success&#x2F;info&#x2F;warning&#x2F;danger</td><td>提示块颜色样式预设</td><td><code>&#123;% note danger %&#125; 错误警告 &#123;% endnote %&#125;</code></td></tr><tr><td><strong>collapse</strong></td><td>（补充）<code>open</code>参数控制默认展开状态</td><td>折叠面板初始状态设置</td><td><code>&#123;% collapse 默认展开 open %&#125; 内容 &#123;% endcollapse %&#125;</code></td></tr></tbody></table><hr><h3 id="五、特殊内容标签（Special-Content）"><a href="#五、特殊内容标签（Special-Content）" class="headerlink" title="五、特殊内容标签（Special Content）"></a>五、特殊内容标签（Special Content）</h3><table><thead><tr><th>标签名称</th><th>语法格式</th><th>功能说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>center</strong></td><td><code>&#123;% center 文本内容 %&#125;</code></td><td>居中对齐文本</td><td><code>&#123;% center 这是居中显示的文本 %&#125;</code></td></tr><tr><td><strong>right</strong></td><td><code>&#123;% right 文本内容 %&#125;</code></td><td>右对齐文本</td><td><code>&#123;% right 这是右对齐显示的文本 %&#125;</code></td></tr><tr><td><strong>quote</strong></td><td><code>&#123;% quote [作者] [来源] [标题] %&#125; 引用内容 &#123;% endquote %&#125;</code></td><td>带引用信息的块引用</td><td><code>&#123;% quote 鲁迅 狂人日记 经典名言 %&#125; 救救孩子！ &#123;% endquote %&#125;</code></td></tr><tr><td><strong>code</strong></td><td><code>&#123;% code [语言] [标题] %&#125; 代码内容 &#123;% endcode %&#125;</code></td><td>代码块，支持语法高亮和标题</td><td><code>&#123;% code javascript 示例代码 %&#125;<br>console.log("Hello World");<br>&#123;% endcode %&#125;</code></td></tr></tbody></table><hr><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 主题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>云原生-Linux的高级部分笔记</title>
      <link href="/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"/>
      <url>/2026/02/02/%E4%BA%91%E5%8E%9F%E7%94%9F%E9%AB%98%E7%BA%A7%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="26-1-13-复习"><a href="#26-1-13-复习" class="headerlink" title="26-1-13 (复习)"></a>26-1-13 (复习)</h1><h2 id="1-什么是内核、什么是shell、什么是Linux、什么是开源？"><a href="#1-什么是内核、什么是shell、什么是Linux、什么是开源？" class="headerlink" title="1.什么是内核、什么是shell、什么是Linux、什么是开源？"></a>1.什么是内核、什么是shell、什么是Linux、什么是开源？</h2><blockquote><p><strong>内核、shell、linux、开源的概念</strong></p></blockquote><p><strong>内核</strong>：是操作系统的核心组件，是硬件与软件的“桥梁”，夜视整个操作系统的基石</p><p><strong>Shell</strong>：是<strong>用户与内核之间的交互界面</strong>，也可以理解为 “命令解释器”，你之前提到的 Linux Shell 脚本，就是基于它来写的。</p><p><strong>开源</strong>：是一种<strong>软件的授权模式</strong>，和 “闭源” 相对，核心是<strong>源代码公开</strong>。</p><h2 id="2-Linux中命令录入方式"><a href="#2-Linux中命令录入方式" class="headerlink" title="2.Linux中命令录入方式"></a>2.Linux中命令录入方式</h2><h3 id="2-1-命令行快捷键"><a href="#2-1-命令行快捷键" class="headerlink" title="2.1.命令行快捷键"></a>2.1.命令行快捷键</h3><h4 id="2-1-1-光标移动快捷键"><a href="#2-1-1-光标移动快捷键" class="headerlink" title="2.1.1.光标移动快捷键"></a>2.1.1.光标移动快捷键</h4><table><thead><tr><th align="center">快捷键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>Ctrl + A</code></td><td align="center">光标跳到<strong>命令行开头</strong></td></tr><tr><td align="center"><code>Ctrl + E</code></td><td align="center">光标跳到<strong>命令行结尾</strong></td></tr><tr><td align="center"><code>Alt + F</code></td><td align="center">光标<strong>向右跳一个单词</strong>（按空格分隔的单位）</td></tr><tr><td align="center"><code>Alt + B</code></td><td align="center">光标<strong>向左跳一个单词</strong></td></tr><tr><td align="center"><code>Ctrl + ←</code></td><td align="center">等价于 <code>Alt + B</code>（部分终端支持）</td></tr><tr><td align="center"><code>Ctrl + →</code></td><td align="center">等价于 <code>Alt + F</code>（部分终端支持）</td></tr></tbody></table><h4 id="2-1-2-命令编辑快捷键"><a href="#2-1-2-命令编辑快捷键" class="headerlink" title="2.1.2.命令编辑快捷键"></a>2.1.2.命令编辑快捷键</h4><table><thead><tr><th align="center">快捷键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>Ctrl + U</code></td><td align="center">删除<strong>光标左侧的所有字符</strong>（清空到行首）</td></tr><tr><td align="center"><code>Ctrl + K</code></td><td align="center">删除<strong>光标右侧的所有字符</strong>（清空到行尾）</td></tr><tr><td align="center"><code>Ctrl + W</code></td><td align="center">删除<strong>光标左侧的一个单词</strong></td></tr><tr><td align="center"><code>Alt + D</code></td><td align="center">删除<strong>光标右侧的一个单词</strong></td></tr><tr><td align="center"><code>Ctrl + Y</code></td><td align="center">粘贴之前用 <code>Ctrl+U/K/W</code> 删除的内容（剪贴板复用）</td></tr><tr><td align="center"><code>Ctrl + H</code></td><td align="center">等同于<strong>退格键</strong>（删除光标前一个字符）</td></tr><tr><td align="center"><code>Ctrl + T</code></td><td align="center">交换<strong>光标前两个字符</strong>的位置（输错字符时超实用）</td></tr></tbody></table><h4 id="2-1-3-历史命令快捷键"><a href="#2-1-3-历史命令快捷键" class="headerlink" title="2.1.3.历史命令快捷键"></a>2.1.3.历史命令快捷键</h4><table><thead><tr><th align="center">快捷键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>↑</code> &#x2F; <code>↓</code></td><td align="center">向上 &#x2F; 向下翻找历史命令（按输入顺序）</td></tr><tr><td align="center"><code>Ctrl + R</code></td><td align="center"><strong>搜索历史命令</strong>（输入关键词，会自动匹配最近的命令，按 <code>Ctrl+R</code> 继续找更早的）</td></tr><tr><td align="center"><code>Ctrl + G</code></td><td align="center">退出 <code>Ctrl+R</code> 的搜索模式，回到当前命令行</td></tr><tr><td align="center"><code>!!</code></td><td align="center">快速执行<strong>上一条命令</strong>（比翻箭头更快）</td></tr><tr><td align="center"><code>!n</code></td><td align="center">执行历史命令中第 <code>n</code> 条（<code>history</code> 命令可查看历史列表及序号）</td></tr><tr><td align="center"><code>!字符</code></td><td align="center">执行最近一次以该<strong>字符开头</strong>的命令（例：<code>!ls</code> 执行最近的 <code>ls</code> 命令）</td></tr><tr><td align="center"><code>Alt + .</code></td><td align="center">粘贴<strong>上一条命令的最后一个参数</strong>（例：上一条是 <code>cp a.txt /home</code>，按后直接出现 <code>/home</code>）</td></tr></tbody></table><h4 id="2-1-4-进程控制快捷键"><a href="#2-1-4-进程控制快捷键" class="headerlink" title="2.1.4.进程控制快捷键"></a>2.1.4.进程控制快捷键</h4><table><thead><tr><th align="center">快捷键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>Ctrl + C</code></td><td align="center"><strong>强制终止</strong>当前正在运行的命令（最常用，比如命令卡死时）</td></tr><tr><td align="center"><code>Ctrl + Z</code></td><td align="center">把当前命令<strong>挂起</strong>（放到后台暂停），用 <code>fg</code> 命令可恢复到前台</td></tr><tr><td align="center"><code>Ctrl + D</code></td><td align="center">退出当前 Shell 会话（等价于输入 <code>exit</code> 命令）</td></tr></tbody></table><h4 id="2-1-5-终端操作快捷键"><a href="#2-1-5-终端操作快捷键" class="headerlink" title="2.1.5.终端操作快捷键"></a>2.1.5.终端操作快捷键</h4><table><thead><tr><th align="center">快捷键</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center"><code>Ctrl + L</code></td><td align="center">清空终端屏幕（等价于输入 <code>clear</code> 命令，不会删除历史命令）</td></tr><tr><td align="center"><code>Ctrl + Shift + C</code></td><td align="center">复制终端中选中的内容（图形化终端模拟器适用）</td></tr><tr><td align="center"><code>Ctrl + Shift + V</code></td><td align="center">粘贴复制的内容到终端（图形化终端模拟器适用）</td></tr></tbody></table><h4 id="2-1-6-Linux-Bash-命令行快捷键速查表"><a href="#2-1-6-Linux-Bash-命令行快捷键速查表" class="headerlink" title="2.1.6.Linux Bash 命令行快捷键速查表"></a>2.1.6.Linux Bash 命令行快捷键速查表</h4><table><thead><tr><th>分类</th><th>快捷键</th><th>作用</th></tr></thead><tbody><tr><td><strong>光标移动</strong></td><td><code>Ctrl + A</code></td><td>跳到命令行开头</td></tr><tr><td></td><td><code>Ctrl + E</code></td><td>跳到命令行结尾</td></tr><tr><td></td><td><code>Alt + F</code></td><td>向右跳一个单词</td></tr><tr><td></td><td><code>Alt + B</code></td><td>向左跳一个单词</td></tr><tr><td></td><td><code>Ctrl + ←</code></td><td>向左跳一个单词（部分终端支持）</td></tr><tr><td></td><td><code>Ctrl + →</code></td><td>向右跳一个单词（部分终端支持）</td></tr><tr><td><strong>命令编辑</strong></td><td><code>Ctrl + U</code></td><td>删除光标左侧所有字符</td></tr><tr><td></td><td><code>Ctrl + K</code></td><td>删除光标右侧所有字符</td></tr><tr><td></td><td><code>Ctrl + W</code></td><td>删除光标左侧一个单词</td></tr><tr><td></td><td><code>Alt + D</code></td><td>删除光标右侧一个单词</td></tr><tr><td></td><td><code>Ctrl + Y</code></td><td>粘贴之前删除的内容</td></tr><tr><td></td><td><code>Ctrl + H</code></td><td>等同于退格键</td></tr><tr><td></td><td><code>Ctrl + T</code></td><td>交换光标前两个字符</td></tr><tr><td><strong>历史命令</strong></td><td><code>↑</code> &#x2F; <code>↓</code></td><td>向上 &#x2F; 向下翻历史命令</td></tr><tr><td></td><td><code>Ctrl + R</code></td><td>搜索历史命令（按 <code>Ctrl+R</code> 继续找更早的）</td></tr><tr><td></td><td><code>Ctrl + G</code></td><td>退出历史命令搜索模式</td></tr><tr><td></td><td><code>!!</code></td><td>执行上一条命令</td></tr><tr><td></td><td><code>!n</code></td><td>执行历史命令列表中第 <code>n</code> 条</td></tr><tr><td></td><td><code>!字符</code></td><td>执行最近一次以该字符开头的命令</td></tr><tr><td></td><td><code>Alt + .</code></td><td>粘贴上一条命令的最后一个参数</td></tr><tr><td><strong>进程控制</strong></td><td><code>Ctrl + C</code></td><td>强制终止当前运行的命令</td></tr><tr><td></td><td><code>Ctrl + Z</code></td><td>挂起当前命令（后台暂停，<code>fg</code> 可恢复）</td></tr><tr><td></td><td><code>Ctrl + D</code></td><td>退出当前 Shell 会话</td></tr><tr><td><strong>终端操作</strong></td><td><code>Ctrl + L</code></td><td>清空终端屏幕</td></tr><tr><td></td><td><code>Ctrl + Shift + C</code></td><td>复制选中内容（图形化终端适用）</td></tr><tr><td></td><td><code>Ctrl + Shift + V</code></td><td>粘贴内容到终端（图形化终端适用）</td></tr></tbody></table><h2 id="3-命令行中如何获得帮助"><a href="#3-命令行中如何获得帮助" class="headerlink" title="3.命令行中如何获得帮助"></a>3.命令行中如何获得帮助</h2><blockquote><p>命令 –help  </p><p>man 命令</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启监控</span></span><br><span class="line">watch -n 1 <span class="built_in">ls</span> -Rl</span><br></pre></td></tr></table></figure><h2 id="4-linux上下文管理"><a href="#4-linux上下文管理" class="headerlink" title="4.linux上下文管理"></a>4.linux上下文管理</h2><h3 id="4-1-常见命令表"><a href="#4-1-常见命令表" class="headerlink" title="4.1.常见命令表"></a>4.1.常见命令表</h3><p>Linux 下文件管理是系统操作的核心内容，常用命令覆盖<strong>文件 &#x2F; 目录的创建、查看、复制、移动、删除、权限修改</strong>等场景。以下是整理的常用命令表，按功能分类并附关键参数说明：</p><table><thead><tr><th align="center">命令分类</th><th align="center">命令</th><th align="center">功能说明</th><th align="center">常用参数 &amp; 示例</th></tr></thead><tbody><tr><td align="center"><strong>目录操作</strong></td><td align="center"><code>pwd</code></td><td align="center">显示当前工作目录的绝对路径</td><td align="center">无参数示例：<code>pwd</code> → <code>/home/user</code></td></tr><tr><td align="center"></td><td align="center"><code>cd</code></td><td align="center">切换工作目录</td><td align="center">- <code>cd ~</code>：切换到当前用户家目录- <code>cd ..</code>：切换到上级目录- <code>cd /usr/local</code>：切换到指定绝对路径</td></tr><tr><td align="center"></td><td align="center"><code>ls</code></td><td align="center">列出目录下的文件和子目录</td><td align="center">- <code>-l</code>：以长格式显示（权限、大小、时间等）- <code>-a</code>：显示隐藏文件（以 <code>.</code> 开头的文件）- <code>-h</code>：人性化显示文件大小（KB&#x2F;MB&#x2F;GB）示例：<code>ls -lah</code></td></tr><tr><td align="center"></td><td align="center"><code>mkdir</code></td><td align="center">创建新目录</td><td align="center">- <code>-p</code>：递归创建多级目录示例：<code>mkdir -p /tmp/test/abc</code></td></tr><tr><td align="center"></td><td align="center"><code>rmdir</code></td><td align="center">删除空目录</td><td align="center">仅能删除空目录示例：<code>rmdir /tmp/test/abc</code></td></tr><tr><td align="center"><strong>文件操作</strong></td><td align="center"><code>touch</code></td><td align="center">创建空文件或修改文件时间戳</td><td align="center">示例：<code>touch newfile.txt</code> → 创建空文件</td></tr><tr><td align="center"></td><td align="center"><code>cp</code></td><td align="center">复制文件或目录</td><td align="center">- <code>-r</code>：递归复制目录（必选参数）- <code>-f</code>：强制覆盖目标文件示例 1：<code>cp file.txt /tmp/</code> → 复制文件示例 2：<code>cp -r dir1 /tmp/</code> → 复制目录</td></tr><tr><td align="center"></td><td align="center"><code>mv</code></td><td align="center">移动 &#x2F; 重命名文件或目录</td><td align="center">同一目录下执行是重命名，跨目录是移动示例 1：<code>mv oldname.txt newname.txt</code> → 重命名示例 2：<code>mv file.txt /tmp/</code> → 移动文件</td></tr><tr><td align="center"></td><td align="center"><code>rm</code></td><td align="center">删除文件或目录</td><td align="center">- <code>-r</code>：递归删除目录- <code>-f</code>：强制删除，不提示确认<strong>危险命令</strong>：<code>rm -rf /</code>（切勿执行！会删除系统所有文件）示例：<code>rm -rf dir1</code> → 删除目录及所有内容</td></tr><tr><td align="center"><strong>文件查看</strong></td><td align="center"><code>cat</code></td><td align="center">查看文件全部内容（适合小文件）</td><td align="center">- <code>-n</code>：显示行号示例：<code>cat -n /etc/hosts</code></td></tr><tr><td align="center"></td><td align="center"><code>more</code></td><td align="center">分页查看大文件（只能向下翻页）</td><td align="center">示例：<code>more /var/log/messages</code> → 按空格翻页，<code>q</code> 退出</td></tr><tr><td align="center"></td><td align="center"><code>less</code></td><td align="center">分页查看大文件（可上下翻页）</td><td align="center">示例：<code>less /var/log/syslog</code> → 按 <code>↑/↓</code> 滚动，<code>q</code> 退出</td></tr><tr><td align="center"></td><td align="center"><code>head</code></td><td align="center">查看文件前 N 行（默认前 10 行）</td><td align="center"><code>-n</code>：指定行数示例：<code>head -n 5 file.txt</code> → 查看前 5 行</td></tr><tr><td align="center"></td><td align="center"><code>tail</code></td><td align="center">查看文件后 N 行（默认后 10 行）</td><td align="center">- <code>-n</code>：指定行数- <code>-f</code>：实时跟踪文件新增内容（日志监控常用）示例 1：<code>tail -n 20 log.txt</code> → 查看后 20 行示例 2：<code>tail -f /var/log/nginx/access.log</code> → 实时监控日志</td></tr><tr><td align="center"><strong>权限管理</strong></td><td align="center"><code>chmod</code></td><td align="center">修改文件 &#x2F; 目录的权限</td><td align="center">两种方式：1. 符号法：<code>chmod u+x file.sh</code>（给所有者加执行权限）2. 数字法：<code>chmod 755 file.sh</code>（r&#x3D;4,w&#x3D;2,x&#x3D;1，7&#x3D;4+2+1）常用权限：755（用户可读可写可执行，其他只读可执行）、644（用户可读可写，其他只读）</td></tr><tr><td align="center"></td><td align="center"><code>chown</code></td><td align="center">修改文件 &#x2F; 目录的所有者和所属组</td><td align="center">- <code>-R</code>：递归修改目录权限示例：<code>chown -R user:group /home/user/data</code></td></tr><tr><td align="center"><strong>文件查找</strong></td><td align="center"><code>find</code></td><td align="center">按路径、名称、大小等条件查找文件</td><td align="center">- 按名称：<code>find /tmp -name &quot;*.txt&quot;</code> → 查找 tmp 下所有 txt 文件- 按大小：<code>find / -size +100M</code> → 查找系统中大于 100M 的文件- 按类型：<code>find /home -type d</code> → 查找 home 下所有目录</td></tr><tr><td align="center"></td><td align="center"><code>which</code></td><td align="center">查找命令的可执行文件路径</td><td align="center">示例：<code>which ls</code> → <code>/usr/bin/ls</code></td></tr><tr><td align="center"></td><td align="center"><code>locate</code></td><td align="center">快速查找文件（基于数据库索引）</td><td align="center">需先更新数据库：<code>updatedb</code>示例：<code>locate passwd</code> → 查找所有含 passwd 的文件</td></tr><tr><td align="center"><strong>文件链接</strong></td><td align="center"><code>ln</code></td><td align="center">创建硬链接或软链接</td><td align="center">- 软链接（常用）：<code>ln -s /path/source /path/link</code> → 类似快捷方式- 硬链接：<code>ln /path/source /path/link</code> → 与源文件共享 inode</td></tr></tbody></table><hr><h3 id="4-2-补充说明"><a href="#4-2-补充说明" class="headerlink" title="4.2.补充说明"></a>4.2.补充说明</h3><ol><li><strong>隐藏文件</strong>：Linux 中以 <code>.</code> 开头的文件为隐藏文件，需用 <code>ls -a</code> 查看。</li><li>绝对路径 vs 相对路径<ul><li>绝对路径：从根目录 <code>/</code> 开始，如 <code>/home/user/file.txt</code></li><li>相对路径：相对于当前目录，如 <code>../file.txt</code>（上级目录的文件）</li></ul></li><li><strong>权限符号含义</strong>：<code>r</code>（读，4）、<code>w</code>（写，2）、<code>x</code>（执行，1），权限分三类：<code>u</code>（所有者）、<code>g</code>（所属组）、<code>o</code>（其他用户）。</li></ol><h2 id="5-文件批处理"><a href="#5-文件批处理" class="headerlink" title="5.文件批处理"></a>5.文件批处理</h2><h3 id="5-1-Linux-文件批处理命令表"><a href="#5-1-Linux-文件批处理命令表" class="headerlink" title="5.1.Linux 文件批处理命令表"></a>5.1.Linux 文件批处理命令表</h3><table><thead><tr><th align="center">批处理命令 &#x2F; 核心语法</th><th align="center">核心用途</th><th align="center">批处理示例（场景 + 执行命令）</th><th align="center"></th></tr></thead><tbody><tr><td align="center"><code>for 循环</code></td><td align="center">遍历指定文件 &#x2F; 目录，执行自定义批处理操作（新手易理解）</td><td align="center"><strong>场景</strong>：批量将当前目录下所有 <code>.txt</code> 文件重命名为 <code>.bak``bash&lt;br&gt;for f in *.txt; do mv &quot;$f&quot; &quot;$&#123;f%.txt&#125;.bak&quot;; done&lt;br&gt;</code>（<code>$&#123;f%.txt&#125;</code> 表示去掉文件名后缀 <code>.txt</code>）</td><td align="center"></td></tr><tr><td align="center"><code>find + xargs</code></td><td align="center">高效查找文件并批量执行命令（适合大量文件）</td><td align="center"><strong>场景</strong>：批量删除当前目录及子目录下所有 <code>.log</code> 文件&#96;&#96;&#96;bashfind . -type f -name “*.log”</td><td align="center">xargs rm -f&#96;&#96;&#96;（<code>-type f</code> 限定文件，<code>-f</code> 强制删除，避免确认）</td></tr><tr><td align="center"><code>mv</code>（批量重命名）</td><td align="center">基础批量重命名 &#x2F; 移动文件</td><td align="center"><strong>场景</strong>：批量将 <code>file1.txt</code>、<code>file2.txt</code> 移动到 <code>backup</code> 目录<code>bash&lt;br&gt;mv file*.txt backup/&lt;br&gt;</code></td><td align="center"></td></tr><tr><td align="center"><code>cp</code>（批量复制）</td><td align="center">批量复制文件到指定目录 &#x2F; 批量备份文件</td><td align="center"><strong>场景</strong>：批量复制当前目录下所有 <code>.sh</code> 脚本到 <code>/usr/local/bin``bash&lt;br&gt;cp *.sh /usr/local/bin/&lt;br&gt;</code></td><td align="center"></td></tr><tr><td align="center"><code>rm</code>（批量删除）</td><td align="center">批量删除指定类型 &#x2F; 条件的文件（谨慎使用）</td><td align="center"><strong>场景</strong>：批量删除当前目录下所有空文件（大小为 0）<code>bash&lt;br&gt;rm -f $(find . -type f -size 0)&lt;br&gt;</code></td><td align="center"></td></tr><tr><td align="center"><code>sed</code>（批量替换内容）</td><td align="center">批量修改多个文件内的文本内容</td><td align="center"><strong>场景</strong>：批量将所有 <code>.conf</code> 文件中的 <code>old_ip</code> 替换为 <code>192.168.1.1``bash&lt;br&gt;sed -i &#39;s/old_ip/192.168.1.1/g&#39; *.conf&lt;br&gt;</code>（<code>-i</code> 直接修改文件，<code>g</code> 全局替换）</td><td align="center"></td></tr><tr><td align="center"><code>rename</code>（专用重命名）</td><td align="center">更简洁的批量重命名（支持正则）</td><td align="center"><strong>场景</strong>：批量将所有文件名中的 <code>test</code> 替换为 <code>prod</code>（如 test1.txt → prod1.txt）<code>bash&lt;br&gt;rename &#39;s/test/prod/&#39; *.txt&lt;br&gt;</code>（需先安装：<code>apt install rename</code>&#x2F;<code>yum install rename</code>）</td><td align="center"></td></tr><tr><td align="center"><code>awk</code>（批量处理内容）</td><td align="center">批量提取 &#x2F; 筛选文件中的指定数据</td><td align="center"><strong>场景</strong>：批量提取所有 <code>.csv</code> 文件中第 2 列的内容并保存到 <code>result.txt``bash&lt;br&gt;awk -F &#39;,&#39; &#39;&#123;print $2&#125;&#39; *.csv &gt; result.txt&lt;br&gt;</code>（<code>-F &#39;,&#39;</code> 指定分隔符为逗号）</td><td align="center"></td></tr></tbody></table><h3 id="5-2-正则表达式符号-字符类-命令表"><a href="#5-2-正则表达式符号-字符类-命令表" class="headerlink" title="5.2.正则表达式符号 &#x2F; 字符类 命令表"></a>5.2.正则表达式符号 &#x2F; 字符类 命令表</h3><table><thead><tr><th align="center">正则符号（命令）</th><th align="center">用途说明</th><th align="center">示例（匹配 &#x2F; 不匹配）</th><th align="center"></th></tr></thead><tbody><tr><td align="center"><code>*</code></td><td align="center">量词，匹配<strong>前面的字符 &#x2F; 表达式 0 次或多次</strong>（贪婪匹配）</td><td align="center"><code>a*</code>：匹配空字符、<code>a</code>、<code>aa</code>、<code>aaa</code>；不匹配 <code>b</code>、<code>1</code>（仅针对前导字符<code>a</code>）例：&#96;echo”aaa b”</td><td align="center">grep -o ‘a*’<code>输出</code>aaa<code>、空、</code>b&#96; 旁的空</td></tr><tr><td align="center"><code>?</code></td><td align="center">量词，匹配<strong>前面的字符 &#x2F; 表达式 0 次或 1 次</strong>（非贪婪匹配）</td><td align="center"><code>a?</code>：匹配空字符、<code>a</code>；不匹配 <code>aa</code>、<code>aaa</code>例：&#96;echo”a aa aaa”</td><td align="center">grep -o ‘a?’<code>输出</code>a<code>、空、</code>a<code>、</code>a<code>、空、</code>a<code>、</code>a<code>、</code>a<code>、空</code></td></tr><tr><td align="center"><code>[[:alpha:]]</code></td><td align="center">匹配任意<strong>字母字符</strong>（包含大小写，多语言环境适配）</td><td align="center">匹配：<code>a</code>、<code>B</code>、<code>中</code>（中文环境）；不匹配：<code>1</code>、<code>!</code>、（空格）例：&#96;echo”Ab123 中！”</td><td align="center">grep -o ‘[[:alpha:]]’<code>输出</code>A<code>、</code>b<code>、</code>中 &#96;</td></tr><tr><td align="center"><code>[[:digit:]]</code></td><td align="center">匹配任意<strong>数字字符</strong>，等价于 [0-9]</td><td align="center">匹配：<code>0</code>、<code>5</code>、<code>9</code>；不匹配：<code>a</code>、<code>$</code>、（空格）例：&#96;echo”abc123def”</td><td align="center">grep -o ‘[[:digit:]]’<code>输出</code>1<code>、</code>2<code>、</code>3&#96;</td></tr><tr><td align="center"><code>[[:lower:]]</code></td><td align="center">匹配任意<strong>小写字母</strong>，等价于 [a-z]</td><td align="center">匹配：<code>a</code>、<code>z</code>、<code>m</code>；不匹配：<code>A</code>、<code>1</code>、<code>!</code>例：&#96;echo”AbCdEf123”</td><td align="center">grep -o ‘[[:lower:]]’<code>输出</code>b<code>、</code>d<code>、</code>f&#96;</td></tr><tr><td align="center"><code>[[:upper:]]</code></td><td align="center">匹配任意<strong>大写字母</strong>，等价于 [A-Z]</td><td align="center">匹配：<code>A</code>、<code>Z</code>、<code>M</code>；不匹配：<code>a</code>、<code>9</code>、<code>@</code>例：&#96;echo”AbCdEf123”</td><td align="center">grep -o ‘[[:upper:]]’<code>输出</code>A<code>、</code>C<code>、</code>E&#96;</td></tr><tr><td align="center"><code>[[:alnum:]]</code></td><td align="center">匹配任意<strong>字母或数字字符</strong>，等价于 [a-zA-Z0-9]</td><td align="center">匹配：<code>a</code>、<code>B</code>、<code>8</code>；不匹配：<code>!</code>、（空格）、<code>@</code>例：&#96;echo”abc123!@#”</td><td align="center">grep -o ‘[[:alnum:]]’<code>输出</code>a<code>、</code>b<code>、</code>c<code>、</code>1<code>、</code>2<code>、</code>3&#96;</td></tr><tr><td align="center"><code>[[:punct:]]</code></td><td align="center">匹配任意<strong>标点符号</strong>（非字母、数字、空白的可打印字符）</td><td align="center">匹配：<code>!</code>、<code>@</code>、<code>#</code>、<code>,</code>、<code>.</code>、<code>:</code>；不匹配：<code>a</code>、<code>5</code>、（空格）例：&#96;echo”abc!123@def”</td><td align="center">grep -o ‘[[:punct:]]’<code>输出</code>!<code>、</code>@&#96;</td></tr><tr><td align="center"><code>[[:space:]]</code></td><td align="center">匹配任意<strong>空白字符</strong>（空格、制表符 \t、换行符 \n 等）</td><td align="center">匹配：（空格）、<code>\t</code>（制表符）、<code>\n</code>（换行）；不匹配：<code>a</code>、<code>9</code>、<code>!</code>例：&#96;echo”a b\tc\nd”</td><td align="center">grep -o ‘[[:space:]]’<code> 输出 空格、</code>\t<code>、</code>\n&#96;</td></tr></tbody></table><h3 id="5-3-补充说明"><a href="#5-3-补充说明" class="headerlink" title="5.3.补充说明"></a>5.3.补充说明</h3><ol><li>示例中的 <code>grep -o</code> 是终端常用命令，<code>-o</code> 参数表示 “只输出匹配到的部分”，新手可直接复制命令到终端执行，直观看到效果；</li><li>部分字符类（如 <code>[[:alpha:]]</code>）在中文 &#x2F; 多语言系统中可匹配非英文字母（如中文、日文），而 <code>[a-zA-Z]</code> 仅匹配英文字母，这是 POSIX 字符类的优势。</li></ol><h3 id="5-4-总结"><a href="#5-4-总结" class="headerlink" title="5.4.总结"></a>5.4.总结</h3><ol><li><code>*</code>&#x2F;<code>?</code> 是<strong>量词</strong>，示例核心看 “前导字符的匹配次数”，而非匹配特定字符；</li><li><code>[[:xxx:]]</code> 字符类的示例需区分 “匹配 &#x2F; 不匹配”，快速掌握字符范围；</li><li>结合 <code>grep -o</code> 命令可直接验证示例效果，是新手学习正则的高效方式。</li></ol><h2 id="6-Linux中的输入和输出"><a href="#6-Linux中的输入和输出" class="headerlink" title="6.Linux中的输入和输出"></a>6.Linux中的输入和输出</h2><h3 id="6-1-字符设备是啥？"><a href="#6-1-字符设备是啥？" class="headerlink" title="6.1.字符设备是啥？"></a>6.1.字符设备是啥？</h3><p>在 Linux 系统中，<strong>字符设备（Character Device）</strong> 是一类以<strong>字符流（字节流）</strong> 为单位进行数据传输的硬件设备，也是 Linux 设备文件的两大核心分类之一（另一类是块设备）。</p><p><strong>与块设备的核心区别</strong></p><table><thead><tr><th align="center">特性</th><th align="center">字符设备</th><th align="center">块设备</th></tr></thead><tbody><tr><td align="center">访问单位</td><td align="center">字节（字符流）</td><td align="center">固定大小的块（通常 512B&#x2F;4KB）</td></tr><tr><td align="center">访问方式</td><td align="center">串行、顺序访问，不支持随机访问</td><td align="center">支持随机访问（可跳转到任意块）</td></tr><tr><td align="center">缓冲区</td><td align="center">无缓冲或小缓冲</td><td align="center">有较大的内存缓冲区（提升读写效率）</td></tr><tr><td align="center">文件类型标识</td><td align="center"><code>c</code></td><td align="center"><code>b</code></td></tr><tr><td align="center">典型设备</td><td align="center">键盘、鼠标、串口</td><td align="center">硬盘、U 盘、SD 卡</td></tr></tbody></table><h3 id="6-2-输入与输出"><a href="#6-2-输入与输出" class="headerlink" title="6.2.输入与输出"></a>6.2.输入与输出</h3><p>在 Linux 系统中，<strong>输入（Input）和输出（Output）的核心原理围绕 “一切皆文件” 思想展开</strong>，本质是<strong>用户程序通过内核提供的接口，对文件描述符进行读写操作</strong>，内核再作为中介完成用户程序与硬件设备的交互。</p><p>Linux 把所有输入输出设备都抽象成<strong>文件</strong>，用户程序无需关心硬件细节，只需通过<strong>文件描述符（File Descriptor，FD）</strong> 来标识和操作这些 “文件”。</p><ol><li><p><strong>文件描述符</strong></p><p>是一个非负整数，内核用它来索引和管理打开的文件（包括硬件设备、普通文件、管道等）。</p><p>系统默认分配 3 个标准文件描述符，供所有进程使用：</p></li></ol><table><thead><tr><th align="left">文件描述符</th><th align="left">名称</th><th align="left">对应设备 &#x2F; 用途</th><th align="left">缩写</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">标准输入</td><td align="left">键盘、管道输入等</td><td align="left">stdin</td></tr><tr><td align="left">1</td><td align="left">标准输出</td><td align="left">终端、管道输出等</td><td align="left">stdout</td></tr><tr><td align="left">2</td><td align="left">标准错误</td><td align="left">终端（专门输出错误信息）</td><td align="left">stderr</td></tr></tbody></table><ol start="2"><li><p><strong>核心原则</strong></p><p> 输入 &#x3D; 从文件描述符 <strong>读取数据</strong>（如从 stdin 读键盘输入）</p><p> 输出 &#x3D; 向文件描述符 <strong>写入数据</strong>（如向 stdout 写终端输出）</p></li><li><p><strong>本质</strong></p><p>Linux 输入输出的本质是 <strong>“用户程序 ↔ 内核 ↔ 硬件” 的三层交互模型</strong>：</p><ul><li>用户程序：通过 <code>read/write</code> 系统调用发起 IO 请求，只操作文件描述符，不碰硬件。</li><li>内核：负责管理文件描述符、缓冲区，以及设备驱动，是 IO 交互的核心中介。</li><li>硬件：由驱动程序控制，完成数据的物理输入输出（如键盘接收按键、屏幕显示字符）。</li></ul></li></ol><h1 id="26-1-14-复习"><a href="#26-1-14-复习" class="headerlink" title="26-1-14 (复习)"></a>26-1-14 (复习)</h1><h2 id="1-Rhel9-6安装"><a href="#1-Rhel9-6安装" class="headerlink" title="1.Rhel9.6安装"></a>1.Rhel9.6安装</h2><p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-20-55.png" alt="PixPin_2026-01-17_11-20-55"></p><blockquote><p>选项–&gt;高级–&gt;固件类型 改为<strong>BIOS</strong></p></blockquote><blockquote><p>安装源选择 服务器</p></blockquote><p><strong>虚拟网络配置</strong></p><p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-26-38.png" alt="PixPin_2026-01-17_11-26-38"></p><p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-26-45.png" alt="PixPin_2026-01-17_11-26-45"></p><h2 id="2-Rhel9-6配置"><a href="#2-Rhel9-6配置" class="headerlink" title="2.Rhel9.6配置"></a>2.Rhel9.6配置</h2><h3 id="2-1-关闭安全配置"><a href="#2-1-关闭安全配置" class="headerlink" title="2.1.关闭安全配置"></a>2.1.关闭安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">[root@base ~]# systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.</span><br><span class="line">[root@base ~]# systemctl mask firewalld</span><br><span class="line">Created symlink /etc/systemd/system/firewalld.service → /dev/null.</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭SELiunx</span></span><br><span class="line">[root@base ~]# vim /etc/sysconfig/selinux</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure><h3 id="2-2-更改网络配置"><a href="#2-2-更改网络配置" class="headerlink" title="2.2.更改网络配置"></a>2.2.更改网络配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# vim /boot/loader/entries/1199b04b0d974659ad491305f98dcfe0-5.14.0-570.12.1.el9_6.x86_64.conf</span><br><span class="line">在quiet 添加 net.ifnames=0</span><br><span class="line">[root@base ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@base system-connections]# <span class="built_in">mv</span> ens160.nmconnection eth0.nmconnection</span><br><span class="line">[root@base system-connections]# vim eth0.nmconnection</span><br><span class="line">修改<span class="built_in">id</span>与interface-name为 eth0</span><br><span class="line">删除uuid</span><br><span class="line"><span class="comment">#如果网卡出问题</span></span><br><span class="line">nmcli connection reload</span><br><span class="line">nmcli connection up eth0</span><br><span class="line">nmcli networking</span><br><span class="line">nmcli networking on</span><br><span class="line">nmcli networking show</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><h3 id="2-3-永久挂载"><a href="#2-3-永久挂载" class="headerlink" title="2.3.永久挂载"></a>2.3.永久挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">mkdir</span> /rhel9</span><br><span class="line">[root@base ~]# mount /dev/cdrom /rhel9/</span><br><span class="line">mount: /rhel9: WARNING: <span class="built_in">source</span> write-protected, mounted read-only.</span><br><span class="line">[root@base ~]# vim /etc/rc.d/rc.local</span><br><span class="line">最后一行添加mount /dev/cdrom /rhel9</span><br><span class="line">[root@base ~]# vim /etc/rc.d/rc.local</span><br><span class="line">[root@base ~]# <span class="built_in">chmod</span> +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><h3 id="2-4-源仓库配置"><a href="#2-4-源仓库配置" class="headerlink" title="2.4.源仓库配置"></a>2.4.源仓库配置</h3><h4 id="2-4-1-本地仓库源"><a href="#2-4-1-本地仓库源" class="headerlink" title="2.4.1.本地仓库源"></a>2.4.1.本地仓库源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">[root@base yum.repos.d]# vim rhel.repo</span><br><span class="line">[AppStarem]</span><br><span class="line">name = AppStream</span><br><span class="line">baseurl = file:///rhel9/AppStream</span><br><span class="line">gpgcheck = 0</span><br><span class="line">[BaseOS]</span><br><span class="line">name = BaseOS</span><br><span class="line">baseurl = file:///rhel9/BaseOS</span><br><span class="line">gpgcheck = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base yum.repos.d]# dnf list httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-4-2-网络源"><a href="#2-4-2-网络源" class="headerlink" title="2.4.2.网络源"></a>2.4.2.网络源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker容器的网络源</span></span><br><span class="line">https://mirrors.aliyun.com/docker-ce/linux/rhel/9.6/x86_64/stable/</span><br><span class="line"><span class="comment">#epel源</span></span><br><span class="line">https://mirrors.aliyun.com/epel-archive/9.6-2025-11-11/Everything/x86_64/</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base ~]# dnf search docker</span><br><span class="line">[root@base ~]# dnf search ansible</span><br></pre></td></tr></table></figure><h4 id="2-4-3-自建仓库源"><a href="#2-4-3-自建仓库源" class="headerlink" title="2.4.3.自建仓库源"></a>2.4.3.自建仓库源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# dnf install httpd -y</span><br><span class="line">[root@base ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line">[root@base ~]# <span class="built_in">mkdir</span> /var/www/html/software</span><br><span class="line">[root@base ~]# dnf install docker-ce --downloadonly --destdir /mnt -y</span><br><span class="line">[root@base ~]# <span class="built_in">mv</span> /mnt/* /var/www/html/software/</span><br><span class="line">[root@base ~]# dnf install createrepo  -y</span><br><span class="line">[root@base ~]# createrepo -v /var/www/html/software/</span><br><span class="line">[root@base yum.repos.d]# vim software.repo</span><br><span class="line">[software]</span><br><span class="line">name = software</span><br><span class="line">baseurl = http://172.25.254.128/software/</span><br><span class="line">gpgcheck = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测</span></span><br><span class="line">[root@base ~]# dnf info docker-ce.x86_64</span><br></pre></td></tr></table></figure><h1 id="26-1-16-复习"><a href="#26-1-16-复习" class="headerlink" title="26-1-16 (复习)"></a>26-1-16 (复习)</h1><h2 id="1-网络管理"><a href="#1-网络管理" class="headerlink" title="1.网络管理"></a>1.网络管理</h2><h3 id="1-1-网络ip配置"><a href="#1-1-网络ip配置" class="headerlink" title="1.1.网络ip配置"></a>1.1.网络ip配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断网卡是否存在</span></span><br><span class="line">[root@node1 system-connections]# <span class="built_in">ls</span> /sys/class/net/ | grep eth1</span><br><span class="line">eth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断网卡是否被使用</span></span><br><span class="line">[root@node1 system-connections]# nmcli connection show</span><br><span class="line">NAME  UUID                                  TYPE      DEVICE</span><br><span class="line">eth0  7ba00b1d-8cdd-30da-91ad-bb83ed4f7474  ethernet  eth0</span><br><span class="line">lo    d97aa458-8557-4dd1-a224-0167b68b3f84  loopback  lo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改网卡ip</span></span><br><span class="line">[root@node1 ~]# nmcli connection modify eth0 ipv4.addresses 172.25.254.130/24</span><br><span class="line"><span class="comment"># 重新连接网卡</span></span><br><span class="line">[root@node1 system-connections]# nmcli connection reload</span><br><span class="line">[root@node1 system-connections]# nmcli connection up eth0</span><br><span class="line"></span><br><span class="line">[root@node1 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@node1 system-connections]# vim eth1.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=eth1</span><br><span class="line"><span class="built_in">type</span>=ethernet</span><br><span class="line">interface-name=eth1</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1=172.25.254.100/24</span><br><span class="line">gateway=172.25.254.2</span><br><span class="line">dns=114.114.114.114;</span><br><span class="line"></span><br><span class="line">[root@node1 system-connections]# <span class="built_in">chmod</span>  600 eth1.nmconnection</span><br><span class="line"></span><br><span class="line">ip a s eth1<span class="comment">#查看ip</span></span><br><span class="line">route  -n<span class="comment">#网关</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf<span class="comment">#查看dns</span></span><br></pre></td></tr></table></figure><p>1.2.网络脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ===================== 参数说明（统一顺序，避免混淆）=====================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 用法: vmset.sh &lt;主机名&gt; &lt;网卡名&gt; &lt;IP地址&gt; [可选参数：nogateway/网关]</span></span><br><span class="line"><span class="comment"># 示例1：带网关（默认172.25.254.2）→ 主网卡用</span></span><br><span class="line"><span class="comment">#    vmset.sh base eth0 172.25.254.100</span></span><br><span class="line"><span class="comment"># 示例2：无网关（避免重复路由）→ 从网卡用</span></span><br><span class="line"><span class="comment">#    vmset.sh base et0 172.25.254.101 nogateway</span></span><br><span class="line"><span class="comment"># 示例3：自定义网关</span></span><br><span class="line"><span class="comment">#    vmset.sh eth0 base 192.168.1.100 192.168.1.1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># =========================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.参数效验(至少3个参数：主机名、网卡名、IP地址)</span></span><br><span class="line">[ <span class="variable">$#</span> -lt 3 ] &amp;&amp; &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：请传入至少3个参数!&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh &lt;主机名&gt; &lt;网卡名&gt; &lt;IP地址&gt; [nogateway/网关]&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh haha eth1 172.25.254.100 nogateway&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.变量定义</span></span><br><span class="line">HOSTNAME=<span class="variable">$1</span>       <span class="comment"># 主机名（必填，如base）</span></span><br><span class="line">IFACE=<span class="variable">$2</span>        <span class="comment"># 网卡名（必填，如eth1）</span></span><br><span class="line">IP=<span class="variable">$3</span>             <span class="comment"># IP地址（必填，如172.25.254.100）</span></span><br><span class="line">DEFAULT_GW=<span class="string">&quot;172.25.254.2&quot;</span>    <span class="comment"># nogateway</span></span><br><span class="line">OPTION=<span class="variable">$&#123;4:-<span class="variable">$DEFAULT_GW</span>&#125;</span>     <span class="comment"># 可选参数：nogateway （无网关）或 自定义网关（如172.25.254.2）</span></span><br><span class="line"></span><br><span class="line">CONNECTION=$(nmcli connection show | awk <span class="string">&quot;/<span class="variable">$IFACE</span>/ &#123;print \$1&#125;&quot;</span> | grep <span class="variable">$IFACE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.判断网卡是否使用</span></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span>  ] &amp;&amp; &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IFACE</span> 正在使用!!!&quot;</span></span><br><span class="line">  nmcli connection delete <span class="variable">$CONNECTION</span></span><br><span class="line">&#125; || &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IFACE</span> 未在使用&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.选择网关</span></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$OPTION</span>&quot;</span> = <span class="string">&quot;nogateway&quot;</span> ] &amp;&amp; &#123;</span><br><span class="line"><span class="built_in">cat</span> &gt;  /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string">address1=$IP/24</span></span><br><span class="line"><span class="string">dns=8.8.8.8</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125; || &#123;</span><br><span class="line"><span class="built_in">cat</span> &gt;  /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string">address1=$IP/24,$OPTION</span></span><br><span class="line"><span class="string">dns=8.8.8.8;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.网卡重新加载</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/NetworkManager/system-connections/<span class="variable">$IFACE</span>.nmconnection</span><br><span class="line">nmcli connection reload</span><br><span class="line">nmcli connection up <span class="variable">$IFACE</span></span><br><span class="line">hostnamectl hostname <span class="variable">$HOSTNAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.域名映射</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/hosts&lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string">$IP                 $HOSTNAME</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=====网卡详细信息====&quot;</span></span><br><span class="line">ip a s <span class="variable">$IFACE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====路由表====&quot;</span></span><br><span class="line">route -n</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====主机名====&quot;</span></span><br><span class="line">hostname</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail  <span class="comment"># 严格模式，命令失败直接退出，避免无效配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===================== 参数说明（统一顺序，避免混淆）=====================</span></span><br><span class="line"><span class="comment"># 用法：bash vmset.sh &lt;网卡名&gt; &lt;主机名&gt; &lt;IP地址&gt; [可选参数：noroute/网关]</span></span><br><span class="line"><span class="comment"># 示例1：带网关（默认172.25.254.2）→ 主网卡用</span></span><br><span class="line"><span class="comment">#   vmset.sh eth0 base 172.25.254.100</span></span><br><span class="line"><span class="comment"># 示例2：无网关（避免重复路由）→ 从网卡用</span></span><br><span class="line"><span class="comment">#   vmset.sh eth1 base 172.25.254.101 noroute</span></span><br><span class="line"><span class="comment"># 示例3：自定义网关</span></span><br><span class="line"><span class="comment">#   vmset.sh eth0 base 192.168.1.100 192.168.1.1</span></span><br><span class="line"><span class="comment"># =======================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 参数校验（至少3个必填参数：网卡名、主机名、IP地址）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 3 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：请传入至少3个参数！&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;用法：vmset.sh &lt;网卡名&gt; &lt;主机名&gt; &lt;IP地址&gt; [noroute/网关]&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;示例：vmset.sh eth1 base 172.25.254.101 noroute（从网卡，无网关）&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 变量定义（清晰命名，避免混淆）</span></span><br><span class="line">IFACE=<span class="variable">$1</span>          <span class="comment"># 网卡名（必填，如eth1）</span></span><br><span class="line">HOSTNAME=<span class="variable">$2</span>       <span class="comment"># 主机名（必填，如base）</span></span><br><span class="line">IP=<span class="variable">$3</span>             <span class="comment"># IP地址（必填，如172.25.254.100）</span></span><br><span class="line">OPTION=<span class="variable">$&#123;4:-&#125;</span>     <span class="comment"># 可选参数：noroute（无网关）或 自定义网关（如172.25.254.2）</span></span><br><span class="line">DEFAULT_GW=<span class="string">&quot;172.25.2`:w;54.2&quot;</span>  <span class="comment"># 默认网关（可选参数为空时使用）</span></span><br><span class="line">CONN_FILE=<span class="string">&quot;/etc/NetworkManager/system-connections/<span class="variable">$&#123;IFACE&#125;</span>.nmconnection&quot;</span>  <span class="comment"># 配置文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 基础校验（避免低级错误）</span></span><br><span class="line"><span class="comment"># 3.1 检查网卡是否真实存在</span></span><br><span class="line"><span class="keyword">if</span> ! ip <span class="built_in">link</span> show <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：网卡 <span class="variable">$IFACE</span> 不存在！请检查网卡名是否正确&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.2 检查IP格式是否合法（避免输错IP）</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> | grep -E <span class="string">&#x27;^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&#x27;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：IP地址 <span class="variable">$IP</span> 格式非法！请输入正确的IPv4地址&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 处理可选参数（确定网关是否启用）</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$OPTION</span>&quot;</span> = <span class="string">&quot;noroute&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  GW=<span class="string">&quot;&quot;</span>  <span class="comment"># 无网关（从网卡用，避免重复路由）</span></span><br><span class="line">  DNS=<span class="string">&quot;&quot;</span> <span class="comment"># 无网关时不配置DNS</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 可选参数为自定义网关，或使用默认网关</span></span><br><span class="line">  GW=<span class="variable">$&#123;OPTION:-<span class="variable">$DEFAULT_GW</span>&#125;</span></span><br><span class="line">  DNS=<span class="string">&quot;8.8.8.8;&quot;</span>  <span class="comment"># 有网关时配置DNS</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 删除网卡已有连接（避免配置冲突，精确匹配连接名）</span></span><br><span class="line">CONNECTION=$(nmcli connection show | awk -v iface=<span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> <span class="string">&#x27;$1 == iface &#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ 正在删除网卡 <span class="variable">$IFACE</span> 的已有连接：<span class="variable">$CONNECTION</span>&quot;</span></span><br><span class="line">  nmcli connection delete <span class="string">&quot;<span class="variable">$CONNECTION</span>&quot;</span> || &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;错误：删除连接 <span class="variable">$CONNECTION</span> 失败！&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 生成NetworkManager配置文件（覆盖写入，避免重复配置段）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 生成网卡 <span class="variable">$IFACE</span> 的配置文件：<span class="variable">$CONN_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="string">&quot;<span class="variable">$CONN_FILE</span>&quot;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[connection]</span></span><br><span class="line"><span class="string">id=$IFACE</span></span><br><span class="line"><span class="string">type=ethernet</span></span><br><span class="line"><span class="string">interface-name=$IFACE</span></span><br><span class="line"><span class="string">autoconnect=true  # 开机自动激活网卡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ipv4]</span></span><br><span class="line"><span class="string">method=manual</span></span><br><span class="line"><span class="string"># 配置IP和网关（无网关时仅写IP）</span></span><br><span class="line"><span class="string">address1=$IP/24$( [ -n &quot;$GW&quot; ] &amp;&amp; echo &quot;,$GW&quot; || &quot;&quot; )</span></span><br><span class="line"><span class="string">dns=$DNS</span></span><br><span class="line"><span class="string">ignore-auto-dns=true  # 忽略自动分配的DNS</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 配置文件权限（NetworkManager要求必须是600，否则报错）</span></span><br><span class="line"><span class="built_in">chmod</span> 600 <span class="string">&quot;<span class="variable">$CONN_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 重载并激活网卡连接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 重载NetworkManager配置...&quot;</span></span><br><span class="line">nmcli connection reload</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 激活网卡 <span class="variable">$IFACE</span>...&quot;</span></span><br><span class="line">nmcli connection up <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> || &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;错误：激活网卡 <span class="variable">$IFACE</span> 失败！请检查配置&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 设置主机名</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;→ 设置主机名为：<span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line">hostnamectl hostname <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 修改/etc/hosts（追加IP-主机名映射，不覆盖原有配置！）</span></span><br><span class="line"><span class="keyword">if</span> ! grep -q <span class="string">&quot;<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>&quot;</span> /etc/hosts; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ 向/etc/hosts添加映射：<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span>     <span class="variable">$HOSTNAME</span>&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;→ /etc/hosts已存在映射：<span class="variable">$IP</span> <span class="variable">$HOSTNAME</span>（无需重复添加）&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. 配置结果验证（让你直观看到是否生效）</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n======= 配置结果验证 =======&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;网卡 <span class="variable">$IFACE</span> 地址：&quot;</span></span><br><span class="line">ip a show <span class="string">&quot;<span class="variable">$IFACE</span>&quot;</span> | grep -A2 <span class="string">&quot;inet &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前主机名：<span class="subst">$(hostname)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;路由表（默认路由，仅主网卡显示）：&quot;</span></span><br><span class="line">ip route show default 2&gt;/dev/null || <span class="built_in">echo</span> <span class="string">&quot;无默认路由（符合noroute配置）&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ 配置完成！&quot;</span></span><br></pre></td></tr></table></figure><h1 id="26-1-17-复习"><a href="#26-1-17-复习" class="headerlink" title="26-1-17 (复习)"></a>26-1-17 (复习)</h1><h2 id="1-系统引导过程修复"><a href="#1-系统引导过程修复" class="headerlink" title="1.系统引导过程修复"></a>1.系统引导过程修复</h2><p><strong><code>引导过程</code></strong></p> <img src="https://b5dbf24.webp.li/Linux/页-1.png" alt="页-1" style="zoom: 25%;" /><h3 id="1-1-磁盘损坏修复"><a href="#1-1-磁盘损坏修复" class="headerlink" title="1.1.磁盘损坏修复"></a>1.1.磁盘损坏修复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# fdisk -l</span><br><span class="line">Disk /dev/nvme0n1：100 GiB，107374182400 字节，209715200 个扇区</span><br><span class="line">磁盘型号：VMware Virtual NVMe Disk</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0xb7f6e5e4</span><br><span class="line"></span><br><span class="line">设备           启动    起点      末尾      扇区 大小 Id 类型</span><br><span class="line">/dev/nvme0n1p1 *       2048   2099199   2097152   1G 83 Linux</span><br><span class="line">/dev/nvme0n1p2      2099200 209715199 207616000  99G 8e Linux LVM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel_172-root：95.08 GiB，102093553664 字节，199401472 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/rhel_172-swap：3.91 GiB，4202692608 字节，8208384 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空磁盘/dev/nvme0n1的MBR引导扇区（前446字节），但保留分区表（后66字节）</span></span><br><span class="line">[root@base ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/nvme0n1 bs=446 count=1</span><br><span class="line">记录了1+0 的读入</span><br><span class="line">记录了1+0 的写出</span><br><span class="line">446字节已复制，0.000239378 s，1.9 MB/s</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-1-1-磁盘引导问题表现"><a href="#1-1-1-磁盘引导问题表现" class="headerlink" title="1.1.1.磁盘引导问题表现"></a>1.1.1.磁盘引导问题表现</h4><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_10-59-28.png" alt="PixPin_2026-01-17_10-59-28"  /> <blockquote><p>解决方法</p><p>1.关机</p><p>2.插入可安装系统的设备</p><p>3.从此设备启动</p></blockquote><h4 id="1-1-2-磁盘引导修复过程"><a href="#1-1-2-磁盘引导修复过程" class="headerlink" title="1.1.2.磁盘引导修复过程"></a>1.1.2.磁盘引导修复过程</h4> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_10-59-28.png" alt="PixPin_2026-01-17_10-59-28"  /> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-22.png" alt="PixPin_2026-01-17_11-01-22" style="zoom:112%;" /> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-48.png" alt="PixPin_2026-01-17_11-01-48" style="zoom:112%;" /> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-01-22.png" alt="PixPin_2026-01-17_11-01-22" style="zoom:113%;" /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入1并且0回车后输入</span></span><br><span class="line">bash-5.1# <span class="built_in">chroot</span> /mnt/sysroot</span><br><span class="line">bash-5.1# grub2-install /dev/nvme0n1</span><br></pre></td></tr></table></figure><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_11-08-08.png" alt="PixPin_2026-01-17_11-08-08"  /><h3 id="1-2-引导文件缺失修复"><a href="#1-2-引导文件缺失修复" class="headerlink" title="1.2.引导文件缺失修复"></a>1.2.引导文件缺失修复</h3><h4 id="1-2-1-查询引导文件"><a href="#1-2-1-查询引导文件" class="headerlink" title="1.2.1.查询引导文件"></a>1.2.1.查询引导文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# ll /boot/grub2/grub.cfg</span><br><span class="line">-rw-------. 1 root root 6955  1月 15 21:11 /boot/grub2/grub.cfg</span><br><span class="line">[root@node2 ~]# ll /boot/loader/entries/</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r--. 1 root root 500  1月 15 21:11 1199b04b0d974659ad491305f98dcfe0-0-rescue.conf</span><br><span class="line">-rw-r--r--. 1 root root 475  1月 15 21:23 1199b04b0d974659ad491305f98dcfe0-5.14.0-570.12.1.el9_6.x86_64.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#磁盘</span></span><br><span class="line">[root@node2 ~]# <span class="built_in">df</span></span><br><span class="line">文件系统                     1K-块     已用     可用 已用% 挂载点</span><br><span class="line">devtmpfs                      4096        0     4096    0% /dev</span><br><span class="line">tmpfs                      1855068        0  1855068    0% /dev/shm</span><br><span class="line">tmpfs                       742028     9220   732808    2% /run</span><br><span class="line">/dev/mapper/rhel_172-root 99635200  3278240 96356960    4% /</span><br><span class="line">/dev/nvme0n1p1              983040   315524   667516   33% /boot</span><br><span class="line">/dev/sr0                  12462174 12462174        0  100% /rhel9</span><br><span class="line">tmpfs                       371012        0   371012    0% /run/user/0</span><br></pre></td></tr></table></figure><h4 id="1-2-2-主引导文件缺失修复"><a href="#1-2-2-主引导文件缺失修复" class="headerlink" title="1.2.2.主引导文件缺失修复"></a>1.2.2.主引导文件缺失修复</h4><h5 id="1-2-2-1-删除主引导文件"><a href="#1-2-2-1-删除主引导文件" class="headerlink" title="1.2.2.1.删除主引导文件"></a>1.2.2.1.删除主引导文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# <span class="built_in">rm</span> -rf /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><h5 id="1-2-2-2-问题表现"><a href="#1-2-2-2-问题表现" class="headerlink" title="1.2.2.2.问题表现"></a>1.2.2.2.问题表现</h5><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_23-22-57.png" alt="PixPin_2026-01-17_23-22-57"></p><h5 id="1-2-2-3-修复过程"><a href="#1-2-2-3-修复过程" class="headerlink" title="1.2.2.3.修复过程"></a>1.2.2.3.修复过程</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt; <span class="built_in">set</span> root=(hd0,msdos1)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt; linux16 /vmlinuz-5.14.0-570.12.1.e19_6.x86_64 ro root=/dev/mapper/rhel_172-root net.ifnames=0</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">grub&gt;initrd16 /initramfs-5.14.0-570.12.1.e19_6.x86_64.img</span><br><span class="line"><span class="comment"># 启动系统</span></span><br><span class="line">grub&gt; boot</span><br></pre></td></tr></table></figure><blockquote><p>当手动引导启动系统后，需要修复自动引导文件，否则系统重启后仍然要手动引导</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修复自动引导文件</span></span><br><span class="line">[root@base ~]# grub2-mkconfig  &gt; /boot/grub2/grub.cfg    <span class="comment">#修复完成</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\hym\Desktop\Linux\PixPin_2026-01-17_23-39-31.png" alt="PixPin_2026-01-17_23-39-31"></p><h4 id="1-2-3-子引导文件缺失修复"><a href="#1-2-3-子引导文件缺失修复" class="headerlink" title="1.2.3.子引导文件缺失修复"></a>1.2.3.子引导文件缺失修复</h4><h5 id="1-2-3-1-删除子引导文件"><a href="#1-2-3-1-删除子引导文件" class="headerlink" title="1.2.3.1.删除子引导文件"></a>1.2.3.1.删除子引导文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# <span class="built_in">rm</span> -fr /boot/loader/entries/*</span><br></pre></td></tr></table></figure><h5 id="1-2-3-2-问题表现"><a href="#1-2-3-2-问题表现" class="headerlink" title="1.2.3.2.问题表现"></a>1.2.3.2.问题表现</h5><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_23-22-57.png" alt="PixPin_2026-01-17_23-22-57"></p><h5 id="1-2-3-3-修复过程"><a href="#1-2-3-3-修复过程" class="headerlink" title="1.2.3.3.修复过程"></a>1.2.3.3.修复过程</h5><p>与上面的<a href="#1.2.4.2.%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B">主引导文件修复过程</a>一致</p><p>进入系统后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]# kernel-install add $(<span class="built_in">uname</span> -r) /boot/vmlinuz-5.14.0-570.12.1.el9_6.x86_64</span><br><span class="line">[root@base ~]# <span class="built_in">ls</span> /boot/loader/entries/</span><br></pre></td></tr></table></figure><p><img src="C:\Users\hym\Desktop\Linux\PixPin_2026-01-18_00-06-54.png" alt="PixPin_2026-01-18_00-06-54"></p><blockquote><p>当修复子启动文件后网卡的名称设定参数就丢失了需要重新设定，此参数和系统修复本身无关</p></blockquote><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-18_00-15-39.png" alt="PixPin_2026-01-18_00-15-39"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@base ~]#  grubby --update-kernel ALL --args net.ifnames=0</span><br><span class="line"><span class="comment"># 重启后网络恢复</span></span><br></pre></td></tr></table></figure><h3 id="1-3-内核文件修复"><a href="#1-3-内核文件修复" class="headerlink" title="1.3.内核文件修复"></a>1.3.内核文件修复</h3><h4 id="1-3-1-删除内核文件"><a href="#1-3-1-删除内核文件" class="headerlink" title="1.3.1.删除内核文件"></a>1.3.1.删除内核文件</h4><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-42-46.png" alt="PixPin_2026-01-17_15-42-46"></p><h4 id="1-3-2-问题表现"><a href="#1-3-2-问题表现" class="headerlink" title="1.3.2.问题表现"></a>1.3.2.问题表现</h4><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-44-30.png" alt="PixPin_2026-01-17_15-44-30"></p><h4 id="1-3-3-解决方法"><a href="#1-3-3-解决方法" class="headerlink" title="1.3.3.解决方法"></a>1.3.3.解决方法</h4><p>（1）打开电源时进入固件</p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-45-45.png" alt="PixPin_2026-01-17_15-45-45" style="zoom:80%;" /><p>（2）进入BOOT页面，将光驱启动调到最前面</p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-47-07.png" alt="PixPin_2026-01-17_15-47-07" style="zoom:33%;" /><p>（3）保存后，过程同<a href="#1.1.2.%E7%A3%81%E7%9B%98%E5%BC%95%E5%AF%BC%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B">磁盘修复</a>一致</p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-47-31.png" alt="PixPin_2026-01-17_15-47-31" style="zoom:33%;" /><p>（4）进入下方页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# <span class="built_in">df</span></span><br><span class="line">bash-5.1# mount --<span class="built_in">bind</span> /run/install/repo/ /mnt/sys/</span><br><span class="line">bash-5.1# <span class="built_in">chroot</span> /mnt/sysroot/</span><br><span class="line">bash-5.1# rpm -ivh /media/BaseOS/Packages/kernel-core-5.14.0-570.12.1.el9_6.x86_64.rpm --force</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-17_15-57-32.png" alt="PixPin_2026-01-17_15-57-32"></p><h1 id="2026-1-19-复习"><a href="#2026-1-19-复习" class="headerlink" title="2026-1-19 (复习)"></a>2026-1-19 (复习)</h1><h2 id="1-apache构建web服务器"><a href="#1-apache构建web服务器" class="headerlink" title="1.apache构建web服务器"></a>1.apache构建web服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装服务并启动服务</span></span><br><span class="line">[root@base ~]# dnf install httpd -y</span><br><span class="line">[root@base ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">[root@base ~]# dnf install httpd-manual -y<span class="comment"># httpd服务手册</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本配置信息</span></span><br><span class="line">端口：   80</span><br><span class="line">默认发布目录：/var/www/html</span><br><span class="line">默认发布文件：index.html</span><br><span class="line">主配置文件：/etc/httpd/conf/httpd.conf</span><br><span class="line">子配置文件：/etc/httpd/conf.d/*.conf</span><br><span class="line">管理命令：systemctl   <span class="built_in">enable</span> --now httpd</span><br></pre></td></tr></table></figure><h3 id="1-1-主配置文件"><a href="#1-1-主配置文件" class="headerlink" title="1.1.主配置文件"></a>1.1.主配置文件</h3><h4 id="1-1-1-更改默认发布文件"><a href="#1-1-1-更改默认发布文件" class="headerlink" title="1.1.1.更改默认发布文件"></a>1.1.1.更改默认发布文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]#  <span class="built_in">echo</span> <span class="string">&quot;index.html ---&gt; /var/www/html&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@node4 ~]#  <span class="built_in">echo</span> <span class="string">&quot;test.html ---&gt; /var/www/html &quot;</span> &gt; /var/www/html/test.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">index.html ---&gt; /var/www/html</span><br><span class="line"><span class="comment">## 修改Apache配置</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">168 &lt;IfModule dir_module&gt;</span><br><span class="line">169     DirectoryIndex index.html</span><br><span class="line">170 &lt;/IfModule&gt;</span><br><span class="line"><span class="comment">## 重启服务</span></span><br><span class="line">[root@base ~]# systemctl restart httpd</span><br><span class="line"><span class="comment">## 再次测试</span></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">test.html ---&gt; /var/www/html</span><br></pre></td></tr></table></figure><h4 id="1-1-2-修改默认发布目录"><a href="#1-1-2-修改默认发布目录" class="headerlink" title="1.1.2.修改默认发布目录"></a>1.1.2.修改默认发布目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /web/html -p</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> <span class="string">&quot;index.html ---&gt; /web/html&quot;</span> &gt; /web/html/index.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">124 <span class="comment"># DocumentRoot &quot;/var/www/html&quot;</span></span><br><span class="line">125 DocumentRoot <span class="string">&quot;/web/html&quot;</span></span><br><span class="line">126</span><br><span class="line">127 <span class="comment">#</span></span><br><span class="line">128 <span class="comment"># Relax access to content within /var/www.</span></span><br><span class="line">129 <span class="comment">#</span></span><br><span class="line">130 &lt;Directory <span class="string">&quot;/web&quot;</span>&gt;</span><br><span class="line">131     AllowOverride None</span><br><span class="line">132     <span class="comment"># Allow open access:</span></span><br><span class="line">133     Require all granted</span><br><span class="line">134 &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130</span><br><span class="line">index.html ---&gt; /web/html</span><br></pre></td></tr></table></figure><h4 id="1-1-3-端口修改"><a href="#1-1-3-端口修改" class="headerlink" title="1.1.3.端口修改"></a>1.1.3.端口修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">47 Listen 80</span><br><span class="line">48 Listen 8000</span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# netstat -antlupe | grep httpd</span><br><span class="line">tcp6       0      0 :::8000                 :::*                    LISTEN      0          32220      2538/httpd</span><br><span class="line">  2538/httpd</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130:8000</span><br><span class="line">index.html ---&gt; /var/www/html</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-2-子配置文件"><a href="#1-2-子配置文件" class="headerlink" title="1.2.子配置文件"></a>1.2.子配置文件</h3><h4 id="1-2-1-虚拟主机"><a href="#1-2-1-虚拟主机" class="headerlink" title="1.2.1.虚拟主机"></a>1.2.1.虚拟主机</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建基础目录</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /etc/httpd/logs/node4_log<span class="comment"># 日志目录</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> <span class="built_in">mkdir</span> -p /web/node4/&#123;news,bbs&#125;/html<span class="comment"># 发布目录</span></span><br><span class="line"><span class="comment"># 创建发布文件</span></span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> news.node4.com &gt; /web/node4/news/html/index.html</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> bbs.node4.com &gt; /web/node4/bbs/html/index.html</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web&quot;</span>&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost _default_:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/html&quot;</span></span><br><span class="line">    CustomLog logs/default.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/news/html&quot;</span></span><br><span class="line">    ServerName news.node4.com</span><br><span class="line">    CustomLog logs/node4_log/news.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/bbs/html&quot;</span></span><br><span class="line">    ServerName bbs.node4.com</span><br><span class="line">    CustomLog logs/node4_log/bbs.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# vim /etc/hosts</span><br><span class="line">172.25.254.130     node4   www.node4.com   bbs.node4.com  news.node4.com</span><br><span class="line"><span class="comment"># 测试www.node4.com</span></span><br><span class="line">[root@node4 ~]# curl www.node4.com</span><br><span class="line">index.html ---&gt; /web/html</span><br><span class="line"><span class="comment"># 测试news.node4.com</span></span><br><span class="line">[root@node4 ~]# curl news.node4.com</span><br><span class="line">news.node4.com</span><br><span class="line"><span class="comment"># 测试bbs.node4.com</span></span><br><span class="line">[root@node4 ~]# curl bbs.node4.com</span><br><span class="line">bbs.node4.com</span><br></pre></td></tr></table></figure><h4 id="1-2-2-访问控制"><a href="#1-2-2-访问控制" class="headerlink" title="1.2.2.访问控制"></a>1.2.2.访问控制</h4><h5 id="1-2-2-1-基于IP"><a href="#1-2-2-1-基于IP" class="headerlink" title="1.2.2.1.基于IP"></a>1.2.2.1.基于IP</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> /web/html/admin</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> admin &gt; /web/html/admin/index.html</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/admin/</span><br><span class="line">admin</span><br><span class="line"><span class="comment"># 拒绝其他IP，仅通过.1的流量</span></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web/html/admin/&quot;</span>&gt;</span><br><span class="line">    Order Deny,Allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from 172.25.254.1</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line"><span class="comment"># 测试，本机测试</span></span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/admin/</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;403 Forbidden&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Forbidden&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;You don<span class="string">&#x27;t have permission to access this resource.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>172.25.254.1进行测试</p></blockquote><p> <img src="https://b5dbf24.webp.li/Linux/PixPin_2026-01-19_16-09-46.png"></p><h5 id="1-2-2-2-基于用户认证"><a href="#1-2-2-2-基于用户认证" class="headerlink" title="1.2.2.2.基于用户认证"></a>1.2.2.2.基于用户认证</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /web/html/auth/</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> auth &gt; /web/html/auth/index.html</span><br><span class="line">[root@node4 ~]# curl 172.25.254.130/auth/</span><br><span class="line">auth</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成认证文件</span></span><br><span class="line">[root@node4 ~]# htpasswd -cm /etc/httpd/.htpasswd haha</span><br><span class="line">New password:</span><br><span class="line">Re-<span class="built_in">type</span> new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user haha</span><br><span class="line">[root@node4 ~]# <span class="built_in">cat</span> /etc/httpd/.htpasswd</span><br><span class="line">haha:$apr1$MKFuKZB6<span class="variable">$eTeFSJ4Mhn8TMnueDnARX0</span></span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;Directory <span class="string">&quot;/web/html/auth/&quot;</span>&gt;</span><br><span class="line">    AuthUserFile /etc/httpd/.htpasswd</span><br><span class="line">    AuthType basic</span><br><span class="line">    AuthName <span class="string">&quot;Please input your username and password&quot;</span></span><br><span class="line">    Require valid-user</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment">## root用户</span></span><br><span class="line">[root@node4 ~]# curl  172.25.254.130/auth/</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;401 Unauthorized&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Unauthorized&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;This server could not verify that you</span><br><span class="line">are authorized to access the document</span><br><span class="line">requested.  Either you supplied the wrong</span><br><span class="line">credentials (e.g., bad password), or your</span><br><span class="line">browser doesn<span class="string">&#x27;t understand how to supply</span></span><br><span class="line"><span class="string">the credentials required.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="string">## haha用户</span></span><br><span class="line"><span class="string">[root@node4 ~]# curl  172.25.254.130/auth/ -u haha:haha</span></span><br><span class="line"><span class="string">auth</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="1-2-3-https"><a href="#1-2-3-https" class="headerlink" title="1.2.3.https"></a>1.2.3.https</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# dnf install mod_ssl.x86_64 -y</span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /etc/httpd/certs</span><br><span class="line">[root@node4 ~]# openssl req -newkey rsa:2048 -nodes -sha256 -keyout /etc/httpd/certs/node4.key -x509 -days 365 -out /etc/httpd/certs/node4.crt</span><br><span class="line">[root@node4 ~]# ll /etc/httpd/certs/</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r-- 1 root root 1237  1月 19 20:22 node4.crt</span><br><span class="line">-rw------- 1 root root 1704  1月 19 20:22 node4.key</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# <span class="built_in">mkdir</span> -p /web/node4/login/html</span><br><span class="line">[root@node4 ~]# <span class="built_in">echo</span> login.node4.com &gt; /web/node4/login/html/index.html</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# vim /etc/httpd/conf.d/vhosts.conf</span><br><span class="line">&lt;VirtualHost *:443&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;/web/node4/login/html&quot;</span></span><br><span class="line">    ServerName login.node4.com</span><br><span class="line">    CustomLog logs/node4_log/login.log combined</span><br><span class="line">    SSLEngine on</span><br><span class="line">    SSLCertificateFile /etc/httpd/certs/node4.crt</span><br><span class="line">    SSLCertificateKeyFile /etc/httpd/certs/node4.key</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# systemctl restart httpd</span><br><span class="line">[root@node4 ~]# curl -k https://login.node4.com</span><br><span class="line">login.node4.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># http重定向</span></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName login.node4.com</span><br><span class="line">    RewriteEngine On</span><br><span class="line">    RewriteRule  ^/(.*)$ https://login.node4.com/<span class="variable">$1</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">[root@node4 ~]#  systemctl restart httpd</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# curl -I login.node4.com</span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Date: Mon, 19 Jan 2026 12:30:48 GMT</span><br><span class="line">Server: Apache/2.4.62 (Red Hat Enterprise Linux) OpenSSL/3.2.2</span><br><span class="line">Location: https://login.node4.com/</span><br><span class="line">Content-Type: text/html; charset=iso-8859-1</span><br></pre></td></tr></table></figure><h1 id="2026-1-20"><a href="#2026-1-20" class="headerlink" title="2026-1-20"></a>2026-1-20</h1><h2 id="1-NAT模式实现方法"><a href="#1-NAT模式实现方法" class="headerlink" title="1.NAT模式实现方法"></a>1.NAT模式实现方法</h2><p><img src="https://d1aa036.webp.li/Build/20260123_NAT.png" alt="20260123_NAT"></p><h3 id="1-1-VS主机配置"><a href="#1-1-VS主机配置" class="headerlink" title="1.1.VS主机配置"></a>1.1.VS主机配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh vsnode eth0 172.25.254.100 </span><br><span class="line">[root@vsnode ~]# vmset.sh vsnode eth1 192.168.0.100 vsnode nogateway</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.25.254.2    0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">172.25.254.0    0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br></pre></td></tr></table></figure><h3 id="1-2-RS1配置"><a href="#1-2-RS1配置" class="headerlink" title="1.2.RS1配置"></a>1.2.RS1配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh RS1 eth0 192.168.0.10 192.168.0.100</span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@RS1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line">[root@RS1 ~]# <span class="built_in">echo</span> 192.168.0.10 --- RS1 &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure><h3 id="1-3-RS2配置"><a href="#1-3-RS2配置" class="headerlink" title="1.3.RS2配置"></a>1.3.RS2配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh RS2 eth0 192.168.0.20 192.168.0.100</span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@RS2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → </span><br><span class="line">[root@RS2 ~]# <span class="built_in">echo</span> 192.168.0.20 --- RS1 &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure><h3 id="1-4-验证"><a href="#1-4-验证" class="headerlink" title="1.4.验证"></a>1.4.验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VSnode中</span></span><br><span class="line">[root@vsnode ~]# curl 192.168.0.10</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line">[root@vsnode ~]# curl 192.168.0.20</span><br><span class="line">192.168.0.20 --- RS2</span><br></pre></td></tr></table></figure><h1 id="2026-1-22"><a href="#2026-1-22" class="headerlink" title="2026-1-22"></a>2026-1-22</h1><h2 id="1-DR模式"><a href="#1-DR模式" class="headerlink" title="1.DR模式"></a>1.DR模式</h2><h3 id="1-1-环境流程图"><a href="#1-1-环境流程图" class="headerlink" title="1.1.环境流程图"></a>1.1.环境流程图</h3><p><img src="G:\图片\20260123-DR.png" alt="20260123-DR"></p><h3 id="1-2-环境配置"><a href="#1-2-环境配置" class="headerlink" title="1.2.环境配置"></a>1.2.环境配置</h3><h4 id="1-2-1-配置路由器"><a href="#1-2-1-配置路由器" class="headerlink" title="1.2.1.配置路由器"></a>1.2.1.配置路由器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@router ~]# vmset.sh router eth0 172.25.254.100</span><br><span class="line">[root@router ~]# vmset.sh router eth1 192.168.0.100 nogateway</span><br><span class="line"></span><br><span class="line">[root@router ~]# dnf install ipvsadm -y</span><br><span class="line">[root@router ~]# systemctl <span class="built_in">disable</span> --now ipvsadm.service</span><br><span class="line">[root@router ~]# ipvsadm -C</span><br><span class="line"></span><br><span class="line">[root@router ~]# <span class="built_in">echo</span> net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@router ~]# sysctl  -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">[root@router ~]# iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 192.168.0.100</span><br><span class="line">[root@router ~]# iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 172.25.254.100</span><br></pre></td></tr></table></figure><h4 id="1-2-2-vsnode调度器"><a href="#1-2-2-vsnode调度器" class="headerlink" title="1.2.2.vsnode调度器"></a>1.2.2.vsnode调度器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# vmset.sh vsnode eth0 192.168.0.50 192.168.0.100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# <span class="built_in">cd</span>  /etc/NetworkManager/system-connections/</span><br><span class="line">[root@vsnode system-connections]#  <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@vsnode system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1==127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line"></span><br><span class="line">[root@vsnode system-connections]# nmcli connection reload</span><br><span class="line">[root@vsnode system-connections]# nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/8）</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.0.200/32 scope global lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2c:93:ef brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.50/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::ee1f:f906:ed7:7719/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-2-3-客户端"><a href="#1-2-3-客户端" class="headerlink" title="1.2.3.客户端"></a>1.2.3.客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vmset.sh client eth0 172.25.254.99</span><br><span class="line"></span><br><span class="line">[root@client ~]# ping 192.168.0.200 -c 2</span><br><span class="line">PING 192.168.0.200 (192.168.0.200) 56(84) 比特的数据。</span><br><span class="line">64 比特，来自 192.168.0.200: icmp_seq=1 ttl=128 时间=0.841 毫秒</span><br><span class="line">64 比特，来自 192.168.0.200: icmp_seq=2 ttl=128 时间=0.691 毫秒</span><br><span class="line"></span><br><span class="line">--- 192.168.0.200 ping 统计 ---</span><br><span class="line">已发送 2 个包， 已接收 2 个包, 0% packet loss, <span class="keyword">time</span> 1031ms</span><br><span class="line">rtt min/avg/max/mdev = 0.691/0.766/0.841/0.075 ms</span><br></pre></td></tr></table></figure><h4 id="1-2-4-RS1"><a href="#1-2-4-RS1" class="headerlink" title="1.2.4.RS1"></a>1.2.4.RS1</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@RS1 ~]# vmset.sh RS1 eth0 192.168.0.10 192.168.0.100</span><br><span class="line">eth0 正在使用!!!</span><br><span class="line">成功删除连接 <span class="string">&quot;eth0&quot;</span> (7ba00b1d-8cdd-30da-91ad-bb83ed4f7474)。</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line"></span><br><span class="line">=====网卡详细信息====</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:75:27:4f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.10/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> tentative noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">====路由表====</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">====主机名====</span><br><span class="line">RS1</span><br><span class="line"></span><br><span class="line">[root@RS1 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@RS1 system-connections]# <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@RS1 system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">address1=127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line">method=manual</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS1 system-connections]# nmcli connection reload</span><br><span class="line">[root@RS1 system-connections]# nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line">[root@RS1 system-connections]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.0.200/32 scope global lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:c4:c1:29 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.10/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># arp 禁止响应</span></span><br><span class="line">[root@RS1 ~]# vim arp.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 执行成功</span><br><span class="line">[root@RS1 ~]# bash arp.sh</span><br></pre></td></tr></table></figure><h4 id="1-2-5-RS2"><a href="#1-2-5-RS2" class="headerlink" title="1.2.5.RS2"></a>1.2.5.RS2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@RS2 ~]#  vmset.sh RS2 eth0 192.168.0.20 192.168.0.100</span><br><span class="line">eth0 正在使用!!!</span><br><span class="line">成功删除连接 <span class="string">&quot;eth0&quot;</span> (7ba00b1d-8cdd-30da-91ad-bb83ed4f7474)。</span><br><span class="line"></span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/6）</span><br><span class="line"></span><br><span class="line">=====网卡详细信息====</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:30:97:ac brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 192.168.0.20/24 brd 192.168.0.255 scope global noprefixroute eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d364:aca6:84cb:34d7/64 scope <span class="built_in">link</span> tentative noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">====路由表====</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.0.100   0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">====主机名====</span><br><span class="line">RS2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@RS2 ~]# <span class="built_in">cd</span> /etc/NetworkManager/system-connections/</span><br><span class="line">[root@RS2 system-connections]# <span class="built_in">cp</span> -p eth0.nmconnection lo.nmconnection</span><br><span class="line">[root@RS2 system-connections]# vim lo.nmconnection</span><br><span class="line">[connection]</span><br><span class="line"><span class="built_in">id</span>=lo</span><br><span class="line"><span class="built_in">type</span>=loopback</span><br><span class="line">interface-name=lo</span><br><span class="line"></span><br><span class="line">[ethernet]</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">method=manual</span><br><span class="line">address1=127.0.0.1/8</span><br><span class="line">address2=192.168.0.200/32</span><br><span class="line"></span><br><span class="line">[root@RS2 system-connections]# nmcli connection reload</span><br><span class="line">[root@RS2 system-connections]#  nmcli connection up lo</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/8）</span><br><span class="line"></span><br><span class="line"><span class="comment"># arp 禁止响应</span></span><br><span class="line">[root@RS1 ~]# vim arp.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"><span class="built_in">echo</span> 执行成功</span><br><span class="line">[root@RS1 ~]# bash arp.sh</span><br></pre></td></tr></table></figure><h2 id="2-利用火墙标记解决轮询错误"><a href="#2-利用火墙标记解决轮询错误" class="headerlink" title="2.利用火墙标记解决轮询错误"></a>2.利用火墙标记解决轮询错误</h2><h3 id="2-1-在rs主机中同时开始http和https两种协议"><a href="#2-1-在rs主机中同时开始http和https两种协议" class="headerlink" title="2.1.在rs主机中同时开始http和https两种协议"></a>2.1.在rs主机中同时开始http和https两种协议</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@RS1 ~]# dnf install ipvsadm -y</span><br><span class="line">[root@RS1 ~]# dnf install mod_ssl -y</span><br><span class="line">[root@RS1 ~]# systemctl <span class="built_in">disable</span> --now ipvsadm.service</span><br><span class="line">[root@RS1 ~]# ipvsadm -C</span><br><span class="line">[root@RS1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure><h3 id="2-2-在vsnode中添加https的轮询策略"><a href="#2-2-在vsnode中添加https的轮询策略" class="headerlink" title="2.2. 在vsnode中添加https的轮询策略"></a>2.2. 在vsnode中添加https的轮询策略</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# dnf install ipvsadm -y</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -t 192.168.0.200:80  -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:80 -r 192.168.0.20 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:80 -r 192.168.0.10 -g</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -t 192.168.0.200:443 -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:443 -r 192.168.0.10:443 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm -a -t 192.168.0.200:443 -r 192.168.0.20:443 -g</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  192.168.0.200:80 rr</span><br><span class="line">  -&gt; 192.168.0.10:80              Route   1      0          0</span><br><span class="line">  -&gt; 192.168.0.20:80              Route   1      0          0</span><br><span class="line">TCP  192.168.0.200:443 rr</span><br><span class="line">  -&gt; 192.168.0.10:443             Route   1      0          0</span><br><span class="line">  -&gt; 192.168.0.20:443             Route   1      0          0</span><br></pre></td></tr></table></figure><h3 id="2-3-轮询错误展示"><a href="#2-3-轮询错误展示" class="headerlink" title="2.3. 轮询错误展示"></a>2.3. 轮询错误展示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@client ~]# curl  192.168.0.200;curl -k https://192.168.0.200</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line">192.168.0.10 --- RS1</span><br><span class="line"></span><br><span class="line"><span class="comment">#当上述设定完成后http和https是独立的service，轮询会出现重复问题</span></span><br></pre></td></tr></table></figure><h3 id="2-4-解决方案"><a href="#2-4-解决方案" class="headerlink" title="2.4.解决方案"></a>2.4.解决方案</h3><p>使用火墙标记访问vip的80和443的所有数据包，设定标记为6666，然后对此标记进行负载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# ipvsadm -C</span><br><span class="line">[root@vsnode ~]# iptables -t mangle -A PREROUTING -d 192.168.0.200 -p tcp -m multiport --dports 80,443 -j MARK --set-mark  6666</span><br><span class="line"></span><br><span class="line">[root@vsnode ~]# ipvsadm -A -f 6666 -s rr</span><br><span class="line">[root@vsnode ~]# ipvsadm  -a -f 6666 -r 192.168.0.10 -g</span><br><span class="line">[root@vsnode ~]# ipvsadm  -a -f 6666 -r 192.168.0.20 -g</span><br></pre></td></tr></table></figure><h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5.测试"></a>2.5.测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# curl  192.168.0.200;curl -k https://192.168.0.200</span><br><span class="line">192.168.0.20 --- RS2</span><br><span class="line">192.168.0.10 --- RS1</span><br></pre></td></tr></table></figure><h2 id="3-利用持久连接实现会话粘滞"><a href="#3-利用持久连接实现会话粘滞" class="headerlink" title="3.利用持久连接实现会话粘滞"></a>3.利用持久连接实现会话粘滞</h2><p>设定ipvs调度策略</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@vsnode ~]# ipvsadm -A -f 6666 -s rr -p 1</span><br></pre></td></tr></table></figure><h1 id="2026-1-23"><a href="#2026-1-23" class="headerlink" title="2026-1-23"></a>2026-1-23</h1><h2 id="1-HAPORXY实验"><a href="#1-HAPORXY实验" class="headerlink" title="1.HAPORXY实验"></a>1.HAPORXY实验</h2><h3 id="1-环境图"><a href="#1-环境图" class="headerlink" title="1.环境图"></a>1.环境图</h3><p><img src="G:\图片\2026-1-24_HA.png" alt="2026-1-24_HA"></p><h2 id="2-环境搭建"><a href="#2-环境搭建" class="headerlink" title="2.环境搭建"></a>2.环境搭建</h2><h3 id="2-1-haproxy主机"><a href="#2-1-haproxy主机" class="headerlink" title="2.1.haproxy主机"></a>2.1.haproxy主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vmset.sh haproxy eth0 172.25.254.100</span><br><span class="line">[root@haproxy ~]# vmset.sh haproxy eth1 192.168.0.100 nogateway</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> net.ipv4.ip_forward=1 &gt; /etc/sysctl.conf</span><br><span class="line">[root@haproxy ~]# sysctl -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><h3 id="2-2-webserver1"><a href="#2-2-webserver1" class="headerlink" title="2.2.webserver1"></a>2.2.webserver1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@webserver1 ~]# vmset.sh webserver1 eth0 192.168.0.10 nogateway</span><br><span class="line">[root@webserver1 ~]# dnf install httpd -y</span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> webserver1 - 192.168.0.10 &gt; /var/www/html/index.html</span><br><span class="line">[root@webserver1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure><h3 id="2-3-webserver2"><a href="#2-3-webserver2" class="headerlink" title="2.3.webserver2"></a>2.3.webserver2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@webserver2 ~]# vmset.sh webserver2 eth0 192.168.0.20 nogateway</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> webserver2 - 192.168.0.20 &gt; /var/www/html/index.html</span><br><span class="line">[root@webserver2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure><h3 id="2-4-环境验证"><a href="#2-4-环境验证" class="headerlink" title="2.4.环境验证"></a>2.4.环境验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# curl  192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">[root@haproxy ~]# curl  192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure><h2 id="3-Haproxy的安装及配置参数"><a href="#3-Haproxy的安装及配置参数" class="headerlink" title="3.Haproxy的安装及配置参数"></a>3.Haproxy的安装及配置参数</h2><h3 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1.安装"></a>3.1.安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在调度器（双网卡主机中）</span></span><br><span class="line">[root@haproxy ~]# dnf install haproxy.x86_64 -y</span><br><span class="line">[root@haproxy ~]# systemctl <span class="built_in">enable</span> --now haproxy</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/haproxy.service → /usr/lib/systemd/system/haproxy.service.</span><br></pre></td></tr></table></figure><h3 id="3-2-harpoxy的参数详解实验"><a href="#3-2-harpoxy的参数详解实验" class="headerlink" title="3.2.harpoxy的参数详解实验"></a>3.2.harpoxy的参数详解实验</h3><h1 id="2026-1-25"><a href="#2026-1-25" class="headerlink" title="2026-1-25"></a>2026-1-25</h1><h2 id="1-Haproxy算法实验"><a href="#1-Haproxy算法实验" class="headerlink" title="1.Haproxy算法实验"></a>1.Haproxy算法实验</h2><h3 id="1-1-静态算法"><a href="#1-1-静态算法" class="headerlink" title="1.1.静态算法"></a>1.1.静态算法</h3><h4 id="1-1-1-static-rr"><a href="#1-1-1-static-rr" class="headerlink" title="1.1.1.static-rr"></a>1.1.1.static-rr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     static-rr</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测是否支持热更新</span></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get  weight webcluster/haha&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">4 (initial 4)</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;set  weight webcluster/haha 1&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">Backend is using a static LB algorithm and only accepts weights <span class="string">&#x27;0%&#x27;</span> and <span class="string">&#x27;100%&#x27;</span>.</span><br></pre></td></tr></table></figure><h4 id="1-1-2-first"><a href="#1-1-2-first" class="headerlink" title="1.1.2.first"></a>1.1.2.first</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     first</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 maxconn 1 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再开一个终端</span></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure><h3 id="1-2-动态算法"><a href="#1-2-动态算法" class="headerlink" title="1.2.动态算法"></a>1.2.动态算法</h3><h4 id="1-2-1-roundrobin"><a href="#1-2-1-roundrobin" class="headerlink" title="1.2.1.roundrobin"></a>1.2.1.roundrobin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞  <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态权重更新</span></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get weight webcluster/haha&quot;</span> | socat stdio /var/lib/haproxy/stats</span><br><span class="line">4 (initial 4)</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;set  weight  webcluster/haha 1  &quot;</span> | socat stdio /var/lib/haproxy/stats</span><br><span class="line">[root@haproxy ~]# <span class="built_in">echo</span> <span class="string">&quot;get  weight webcluster/haha&quot;</span> | socat  stdio /var/lib/haproxy/stats</span><br><span class="line">1 (initial 4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 效果</span></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-2-2-leastconn"><a href="#1-2-2-leastconn" class="headerlink" title="1.2.2.leastconn"></a>1.2.2.leastconn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     leastconn</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure><h3 id="1-3-混合算法"><a href="#1-3-混合算法" class="headerlink" title="1.3.混合算法"></a>1.3.混合算法</h3><h4 id="1-3-1-source"><a href="#1-3-1-source" class="headerlink" title="1.3.1.source"></a>1.3.1.source</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认静态算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     <span class="built_in">source</span></span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     <span class="built_in">source</span></span><br><span class="line">hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy </span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br></pre></td></tr></table></figure><h4 id="1-3-2-uri"><a href="#1-3-2-uri" class="headerlink" title="1.3.2.uri"></a>1.3.2.uri</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主备实验环境</span></span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> RS1 - 192.168.0.10 &gt; /var/www/html/index1.html</span><br><span class="line">[root@webserver1 ~]# <span class="built_in">echo</span> RS1 - 192.168.0.10 &gt; /var/www/html/index2.html</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> RS2 - 192.168.0.20 &gt; /var/www/html/index1.html</span><br><span class="line">[root@webserver2 ~]# <span class="built_in">echo</span> RS2 - 192.168.0.20 &gt; /var/www/html/index2.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定uri算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     uri</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index1.html; <span class="keyword">done</span></span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">RS1 - 192.168.0.10</span><br><span class="line">                                                                       </span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index2.html; <span class="keyword">done</span></span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br><span class="line">RS2 - 192.168.0.20</span><br></pre></td></tr></table></figure><h4 id="1-3-3-url-param"><a href="#1-3-3-url-param" class="headerlink" title="1.3.3.url_param"></a>1.3.3.url_param</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设定url_param算法</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     url_param name</span><br><span class="line">    hash-type consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 2</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    </span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index.html?name=hua; <span class="keyword">done</span></span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span> curl 172.25.254.100/index.html?name=huaaaaa; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver1 - 192.168.0.10</span><br></pre></td></tr></table></figure><h4 id="1-3-4-hdr"><a href="#1-3-4-hdr" class="headerlink" title="1.3.4.hdr"></a>1.3.4.hdr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     hdr(User-Agent)</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    server haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ curl -A <span class="string">&quot;hua&quot;</span> 172.25.254.100</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line">[kaitumei.DESKTOP-BMTM34T] ⮞ curl -A <span class="string">&quot;Yeming&quot;</span> 172.25.254.100</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-基于cookie的会话保持"><a href="#2-基于cookie的会话保持" class="headerlink" title="2.基于cookie的会话保持"></a>2.基于cookie的会话保持</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    hash-type   consistent</span><br><span class="line">    cookie WEBCOOKIE insert nocache indirect</span><br><span class="line">    server haha 192.168.0.10:80 cookie web1 check inter 3s fall 3 rise 5 weight 4</span><br><span class="line">    server hehe 192.168.0.20:80 cookie web2 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br></pre></td></tr></table></figure><p><img src="G:\图片\PixPin_2026-01-26_00-02-24.png" alt="PixPin_2026-01-26_00-02-24"></p><h2 id="3-HAProxy状态页"><a href="#3-HAProxy状态页" class="headerlink" title="3.HAProxy状态页"></a>3.HAProxy状态页</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen stats</span><br><span class="line">    mode        http</span><br><span class="line">    <span class="built_in">bind</span> 0.0.0.0:1234</span><br><span class="line">    stats       <span class="built_in">enable</span></span><br><span class="line">    <span class="built_in">log</span>         global</span><br><span class="line"><span class="comment">#   stats       refresh</span></span><br><span class="line">    stats uri   /status</span><br><span class="line">    stats auth  hua:hua</span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br></pre></td></tr></table></figure><h1 id="2026-1-26"><a href="#2026-1-26" class="headerlink" title="2026-1-26"></a>2026-1-26</h1><h2 id="1-IP透传"><a href="#1-IP透传" class="headerlink" title="1.IP透传"></a>1.IP透传</h2><h3 id="1-1-七层透传"><a href="#1-1-七层透传" class="headerlink" title="1.1.七层透传"></a>1.1.七层透传</h3><h4 id="1-1-1-环境搭建"><a href="#1-1-1-环境搭建" class="headerlink" title="1.1.1.环境搭建"></a>1.1.1.环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Haproxy中</span></span><br><span class="line">[root@Haproxy ~]# dnf install haproxy -y</span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    blance  roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  haha 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Webserver1与Webserver2中</span></span><br><span class="line"><span class="comment">## webserver1</span></span><br><span class="line">[root@Webserver1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> <span class="string">&quot;webserver1 --- 192.168.0.10&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br><span class="line"><span class="comment">## webserver2</span></span><br><span class="line">[root@Webserver1 ~]# dnf install httpd -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> <span class="string">&quot;webserver2 --- 192.168.0.20&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure><h4 id="1-1-2-测试环境"><a href="#1-1-2-测试环境" class="headerlink" title="1.1.2.测试环境"></a>1.1.2.测试环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client中</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span> curl 172.25.254.100;<span class="keyword">done</span></span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在rs主机中默认是未开启透传功能的</span></span><br><span class="line"><span class="comment">## webserver1 or 2中</span></span><br><span class="line">[[root@Webserver1 ~]# <span class="built_in">cat</span> /etc/httpd/logs/access_log</span><br><span class="line">192.168.0.20 - - [27/Jan/2026:15:45:38 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:46:12 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启ip透传的方式</span></span><br><span class="line"><span class="comment">## haproxy中</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8 <span class="comment">#开启haproxy透传功能</span></span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在rs中设定采集透传IP</span></span><br><span class="line"><span class="comment">## webserver1 or 2中</span></span><br><span class="line">[root@Webserver1 ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">201     LogFormat <span class="string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;X-Forwarded-For&#125;i\&quot; \&quot;%&#123;Referer    &#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> combined</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart httpd</span><br></pre></td></tr></table></figure><h4 id="1-1-3-测试效果"><a href="#1-1-3-测试效果" class="headerlink" title="1.1.3.测试效果"></a>1.1.3.测试效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client中</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span> curl 172.25.254.100;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># webserver1 or 2中</span></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">cat</span> /etc/httpd/logs/access_log</span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:55:39 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;172.25.254.99&quot;</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:15:55:39 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 28 <span class="string">&quot;172.25.254.99&quot;</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-四层透传"><a href="#1-2-四层透传" class="headerlink" title="1.2.四层透传"></a>1.2.四层透传</h3><h4 id="1-2-1-环境搭建"><a href="#1-2-1-环境搭建" class="headerlink" title="1.2.1.环境搭建"></a>1.2.1.环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在RS中把apache停止</span></span><br><span class="line">[root@Webserver1 ~]# systemctl <span class="built_in">disable</span> --now httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl <span class="built_in">disable</span> --now httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署nginx</span></span><br><span class="line"><span class="comment"># webserver1</span></span><br><span class="line">[root@Webserver1 ~]# dnf install nginx -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> webserver1 - 192.168.0.10 &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@Webserver1 ~]# systemctl <span class="built_in">enable</span> --now nginx</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.</span><br><span class="line"><span class="comment"># webserver2</span></span><br><span class="line">[root@Webserver2 ~]# dnf install nginx -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> webserver2 - 192.168.0.20 &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@Webserver2 ~]# systemctl <span class="built_in">enable</span> --now nginx</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.</span><br></pre></td></tr></table></figure><h4 id="1-2-2-测试环境"><a href="#1-2-2-测试环境" class="headerlink" title="1.2.2.测试环境"></a>1.2.2.测试环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用nginx的四层访问控制</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@webserver1 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 proxy_protocol;<span class="comment"># 启用四层访问</span></span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">[root@Webserver1 ~]# systemctl restart nginx.service</span><br><span class="line">[root@Webserver2 ~]# systemctl restart nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment">## client</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;</span><br><span class="line">The server returned an invalid or incomplete response.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出现上述报错标识nginx只支持四层访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.设定haproxy访问4层</span></span><br><span class="line"><span class="comment">## haproxy</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    tcp<span class="comment"># 开启四层访问</span></span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.设置4层ip透传</span></span><br><span class="line"><span class="comment"># Webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27; &quot;$proxy_protocol_addr&quot; &#x27;</span>        <span class="comment">#采集透传信息</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart nginx.service</span><br></pre></td></tr></table></figure><h4 id="1-2-3-测试效果"><a href="#1-2-3-测试效果" class="headerlink" title="1.2.3.测试效果"></a>1.2.3.测试效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> curl 172.25.254.100; <span class="keyword">done</span></span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">cat</span> /var/log/nginx/access.log</span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">192.168.0.100 - - [27/Jan/2026:16:33:22 +0800] <span class="string">&quot;GET / HTTP/1.1&quot;</span>  <span class="string">&quot;172.25.254.99&quot;</span> 200 26 <span class="string">&quot;-&quot;</span> <span class="string">&quot;curl/7.76.1&quot;</span> <span class="string">&quot;-&quot;</span></span><br></pre></td></tr></table></figure><h2 id="2-四层负载"><a href="#2-四层负载" class="headerlink" title="2.四层负载"></a>2.四层负载</h2><h3 id="2-1-环境搭建"><a href="#2-1-环境搭建" class="headerlink" title="2.1.环境搭建"></a>2.1.环境搭建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署mariadb数据库</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# dnf install mariadb-server mariadb  -y --disablerepo=docker,epel</span><br><span class="line">[root@Webserver1 ~]# vim /etc/my.cnf.d/mariadb-server.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=10<span class="comment"># webserver2中20</span></span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/run/mariadb/mariadb.pid</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立远程登录用户并授权</span></span><br><span class="line">[root@Webserver1 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 5</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE USER <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;hua&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL ON *.* TO <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# systemctl restart mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># haproxy</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen mariadbcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:6663</span><br><span class="line">    mode    tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:3306 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:3306 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# netstat -antlupe | grep haproxy</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      0          49468      2525/haproxy</span><br><span class="line">tcp        0      0 0.0.0.0:6663            0.0.0.0:*               LISTEN      0          49469      2525/haproxy</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2-环境测试"><a href="#2-2-环境测试" class="headerlink" title="2.2.环境测试"></a>2.2.环境测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# mysql -uhua -phua -h172.25.254.100 -P 6663</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 6</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT @@server_id;</span><br><span class="line">+-------------+</span><br><span class="line">| @@server_id |</span><br><span class="line">+-------------+</span><br><span class="line">|          20 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br><span class="line">[root@Client ~]# mysql -uhua -phua -h172.25.254.100 -P 6663</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 6</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT @@server_id;</span><br><span class="line">+-------------+</span><br><span class="line">| @@server_id |</span><br><span class="line">+-------------+</span><br><span class="line">|          10 |</span><br><span class="line">+-------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><h2 id="3-自定义HAProxy-错误界面"><a href="#3-自定义HAProxy-错误界面" class="headerlink" title="3.自定义HAProxy 错误界面"></a>3.自定义HAProxy 错误界面</h2><h3 id="3-1-sorryserver的设定"><a href="#3-1-sorryserver的设定" class="headerlink" title="3.1.sorryserver的设定"></a>3.1.sorryserver的设定</h3><blockquote><p>正常的所有服务器如果出现宕机，那么客户将被定向到指定的主机中，这个当业务主机出问题时被临时访问的主机叫做 sorryserver</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在新主机中安装apache（可以用haproxy主机代替）</span></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# dnf install httpd -y</span><br><span class="line">[root@Client ~]# vim /etc/httpd/conf/httpd.conf</span><br><span class="line">47 Listen 8080</span><br><span class="line">[root@Client ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.</span><br><span class="line"></span><br><span class="line">[root@Client ~]# <span class="built_in">echo</span> <span class="string">&quot;哈哈哈&quot;</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置sorryserver上线</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    tcp</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 send-proxy check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  wuwu 172.25.254.99:8080  backup <span class="comment">#sorryserver</span></span><br><span class="line">    </span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver1 - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver2 - 192.168.0.20</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭两台正常的业务主机</span></span><br><span class="line"><span class="comment"># webserver1 and 2</span></span><br><span class="line">[root@Webserver1 ~]# systemctl stop httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl stop httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">哈哈哈</span><br></pre></td></tr></table></figure><h3 id="3-2-自定义错误页面"><a href="#3-2-自定义错误页面" class="headerlink" title="3.2.自定义错误页面"></a>3.2.自定义错误页面</h3><p>当所有主机包括sorryserver都宕机了，那么haproxy会提供一个默认访问的错误页面，这个错误页面跟报错代码有关，这个页面可以通过定义来机型设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 出现的错误页面</span></span><br><span class="line">[root@Webserver1 ~]# systemctl stop httpd</span><br><span class="line">[root@Webserver2 ~]# systemctl stop httpd</span><br><span class="line">[root@Client ~]# systemctl stop httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有后端web服务都宕机</span></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;503 Service Unavailable&lt;/h1&gt;</span><br><span class="line">No server is available to handle this request.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# <span class="built_in">mkdir</span> /errorpage/html/ -p</span><br><span class="line">[root@haproxy ~]# vim /errorpage/html/503.http</span><br><span class="line">HTTP/1.0 503 Service Unavailable</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;什么动物生气最安静&lt;/h1&gt;</span><br><span class="line">大猩猩！！</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">    errorfile 503           /errorpage/html/503.http<span class="comment">#error 页面</span></span><br><span class="line">    </span><br><span class="line">listen webcluster</span><br><span class="line">    <span class="built_in">bind</span>    *:80</span><br><span class="line">    mode    http</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  haha 192.168.0.10:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  hehe 192.168.0.20:80 check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server  wuwu 172.25.254.99:8080  backup</span><br><span class="line"></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;什么动物生气最安静&lt;/h1&gt;</span><br><span class="line">大猩猩！！</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="3-3-重定向错误到指定网站"><a href="#3-3-重定向错误到指定网站" class="headerlink" title="3.3.重定向错误到指定网站"></a>3.3.重定向错误到指定网站</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line">    errorloc 503            http://www.baidu.com<span class="comment">#error 页面</span></span><br><span class="line">[root@haproxy ~]# systemctl restart haproxy.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#在浏览器中访问</span></span><br></pre></td></tr></table></figure><p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-27_22-52-16.gif" alt="PixPin_2026-01-27_22-52-16"></p><h2 id="4-Haproxy-ACL访问控制"><a href="#4-Haproxy-ACL访问控制" class="headerlink" title="4.Haproxy ACL访问控制"></a>4.Haproxy ACL访问控制</h2><h3 id="4-1-实验素材"><a href="#4-1-实验素材" class="headerlink" title="4.1.实验素材"></a>4.1.实验素材</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在浏览器或者curl主机中设定本地解析</span></span><br><span class="line">以管理员身份打开 C:\Windows\System32\drivers\etc\hosts</span><br><span class="line">172.25.254.100  www.kaitumei.com     bbs.kaitumei.com    news.kaitumei.com   login.kaitumei.com</span><br><span class="line"><span class="comment"># #在Linux中设定解析</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">172.25.254.100  www.kaitumei.com     bbs.kaitumei.com    news.kaitumei.com   login.kaitumei.com</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">ping  bbs.timinglee.org</span><br></pre></td></tr></table></figure><h3 id="4-2-设定基础的haproxy实验配置"><a href="#4-2-设定基础的haproxy实验配置" class="headerlink" title="4.2.设定基础的haproxy实验配置"></a>4.2.设定基础的haproxy实验配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    use_backend     webserver-80-web1</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br></pre></td></tr></table></figure><h3 id="4-3-基础acl示例"><a href="#4-3-基础acl示例" class="headerlink" title="4.3.基础acl示例"></a>4.3.基础acl示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在访问的网址中，所有以.com  结尾的访问10，其他访问20</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com<span class="comment">#acl列表</span></span><br><span class="line">    </span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span><span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl  www.kaitumei.com</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">[root@Client ~]# curl  www.kaitumei.org</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#基于访问头部</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com          <span class="comment">#acl列表</span></span><br><span class="line">    acl <span class="built_in">head</span> hdr_beg(host) -i bbs.</span><br><span class="line"></span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">head</span>  <span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2       <span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试效果</span></span><br><span class="line">[root@Client ~]# curl  bbs.kaitumei.com</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">[root@Client ~]# curl  www.kaitumei.com</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#base参数acl</span></span><br><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl pathdir base_dir -i /yeming</span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> pathdir</span><br><span class="line">    default_backend webserver-80-web2<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line">[root@Webserver1+2 ~]# <span class="built_in">mkdir</span> -p /var/www/html/yeming/</span><br><span class="line">[root@Webserver1+2 ~]# <span class="built_in">mkdir</span> -p /var/www/html/yeming/test/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> yeming - 192.168.0.10  &gt; /var/www/html/yeming/index.html</span><br><span class="line">[root@Webserver1 ~]# <span class="built_in">echo</span> yeming/test - 192.168.0.10 &gt; /var/www/html/yeming/test/index.html</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> yeming - 192.168.0.20  &gt; /var/www/html/yeming/index.html</span><br><span class="line">[root@Webserver2 ~]# <span class="built_in">echo</span> yeming/test - 192.168.0.20 &gt; /var/www/html/yeming/test/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100/yeming/</span><br><span class="line">yeming - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100/yeming/test/</span><br><span class="line">yeming/test - 192.168.0.10</span><br><span class="line">[root@Client ~]# curl 172.25.254.100/index.html</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#acl禁止列表黑名单</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    </span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com<span class="comment">#acl列表</span></span><br><span class="line">    </span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span><span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2<span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">acl invalid_src src 172.25.254.99</span><br><span class="line">    http-request deny <span class="keyword">if</span> invalid_src</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;</span><br><span class="line">Request forbidden by administrative rules.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止列表白名单</span></span><br><span class="line">[root@haproxy ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">frontend webcluster</span><br><span class="line">    <span class="built_in">bind</span>            *:80</span><br><span class="line">    mode            http</span><br><span class="line">    acl <span class="built_in">test</span> hdr_end(host) -i .com          <span class="comment">#acl列表</span></span><br><span class="line"></span><br><span class="line">    use_backend  webserver-80-web1 <span class="keyword">if</span> <span class="built_in">test</span>  <span class="comment">#acl列表访问匹配</span></span><br><span class="line">    default_backend webserver-80-web2       <span class="comment">#acl列表访问不匹配</span></span><br><span class="line"></span><br><span class="line">    acl invalid_src src 172.25.254.99</span><br><span class="line">    http-request deny <span class="keyword">if</span> ! invalid_src</span><br><span class="line"></span><br><span class="line">backend webserver-80-web1</span><br><span class="line">    server web1 192.168.0.10:80 check inter 3s fall 3 rise 5</span><br><span class="line"></span><br><span class="line">backend webserver-80-web2</span><br><span class="line">    server web2 192.168.0.20:80 check inter 3s fall 3 rise 5</span><br><span class="line">    </span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl 172.25.254.100</span><br><span class="line">webserver2 --- 192.168.0.20</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# curl  172.25.254.100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;</span><br><span class="line">Request forbidden by administrative rules.</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>Haproxy全站加密</p><p>1.制作证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# <span class="built_in">mkdir</span> /etc/haproxy/certs/</span><br><span class="line">[[root@Haproxy ~]# openssl req -newkey rsa:2048 -nodes -sha256  -keyout /etc/haproxy/certs/yeming.key -x509 -days 365 -out /etc/haproxy/certs/yeming.crt</span><br><span class="line">.+...+.+++++++++++++++++++++++++++++++++++++++*.+.+.....+++++++++++++++++++++++++++++++++++++++*.......+...+......+.+..............+.......+.....+...+....+...+.....+....+...+........+.............+.....+......+...............+.+.....+.........+..........+...+..++++++</span><br><span class="line">...+++++++++++++++++++++++++++++++++++++++*.....+..+.........+.+........+......+++++++++++++++++++++++++++++++++++++++*...+.+.....+.......+......+.........+..+..................+.+.....+..........+.........+............+........+.+..+....+.....+.........+......+.+...............+...+.........+.....+.......+..................+.....+............+....+............+.....+.............+.........+..+...+.+..+..................+.+..............+....+...+..+......+.+........+...+.........+.+........+....+...+...+.....+......+.+..+...+.......+.....+.+.....++++++</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Hunan</span><br><span class="line">Locality Name (eg, city) [Default City]:Hengyang</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:hh</span><br><span class="line">Organizational Unit Name (eg, section) []:hh</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:www.kaitumei.com</span></span><br><span class="line"><span class="string">Email Address []:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@Haproxy ~]# ls /etc/haproxy/certs/</span></span><br><span class="line"><span class="string">yeming.crt  yeming.key</span></span><br><span class="line"><span class="string">[root@Haproxy ~]# cat /etc/haproxy/certs/yeming.&#123;key,crt&#125; &gt; /etc/haproxy/certs/yeming.pem</span></span><br></pre></td></tr></table></figure><p>2.全站加密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@Haproxy ~]# vim /etc/haproxy/haproxy.cfg </span><br><span class="line">frontend webcluster-http</span><br><span class="line">    <span class="built_in">bind</span>        *:80</span><br><span class="line">    redirect scheme https <span class="keyword">if</span> ! &#123; ssl_fc &#125;</span><br><span class="line"></span><br><span class="line">listen webcluster-https</span><br><span class="line">    <span class="built_in">bind</span>        *:443 ssl  crt /etc/haproxy/certs/yeming.pem</span><br><span class="line">    mode        http</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server haha 192.168.0.10:80  check inter 3s fall 3 rise 5 weight 1</span><br><span class="line">    server hehe 192.168.0.20:80  check inter 3s fall 3 rise 5 weight 1</span><br><span class="line"></span><br><span class="line">[root@Haproxy ~]# systemctl restart haproxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@Client ~]# curl -v -k -L http://172.25.254.100</span><br><span class="line">*   Trying 172.25.254.100:80...</span><br><span class="line">* Connected to 172.25.254.100 (172.25.254.100) port 80 (#0)</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: 172.25.254.100</span><br><span class="line">&gt; User-Agent: curl/7.76.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 302 Found</span><br><span class="line">&lt; content-length: 0</span><br><span class="line">&lt; location: https://172.25.254.100/</span><br><span class="line">&lt; cache-control: no-cache</span><br><span class="line">&lt;</span><br><span class="line">* Connection <span class="comment">#0 to host 172.25.254.100 left intact</span></span><br><span class="line">* Clear auth, redirects to port from 80 to 443Issue another request to this URL: <span class="string">&#x27;https://172.25.254.100/&#x27;</span></span><br><span class="line">*   Trying 172.25.254.100:443...</span><br><span class="line">* Connected to 172.25.254.100 (172.25.254.100) port 443 (#1)</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http/1.1</span><br><span class="line">*  CAfile: /etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">* TLSv1.0 (OUT), TLS header, Certificate Status (22):</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Client hello (1):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Certificate Status (22):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Server hello (2):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Finished (20):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Certificate (11):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, CERT verify (15):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Finished (20):</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Finished (20):</span><br><span class="line">* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (OUT), TLS handshake, Finished (20):</span><br><span class="line">* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384</span><br><span class="line">* ALPN, server did not agree to a protocol</span><br><span class="line">* Server certificate:</span><br><span class="line">*  subject: C=CN; ST=Hunan; L=Hengyang; O=hh; OU=hh; CN=www.kaitumei.com</span><br><span class="line">*  start <span class="built_in">date</span>: Jan 27 17:03:35 2026 GMT</span><br><span class="line">*  expire <span class="built_in">date</span>: Jan 27 17:03:35 2027 GMT</span><br><span class="line">*  issuer: C=CN; ST=Hunan; L=Hengyang; O=hh; OU=hh; CN=www.kaitumei.com</span><br><span class="line">*  SSL certificate verify result: self-signed certificate (18), continuing anyway.</span><br><span class="line">* TLSv1.2 (OUT), TLS header, Unknown (23):</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: 172.25.254.100</span><br><span class="line">&gt; User-Agent: curl/7.76.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):</span><br><span class="line">* old SSL session ID is stale, removing</span><br><span class="line">* TLSv1.2 (IN), TLS header, Unknown (23):</span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; <span class="built_in">date</span>: Tue, 27 Jan 2026 17:09:23 GMT</span><br><span class="line">&lt; server: Apache/2.4.62 (Red Hat Enterprise Linux)</span><br><span class="line">&lt; last-modified: Tue, 27 Jan 2026 07:43:15 GMT</span><br><span class="line">&lt; etag: <span class="string">&quot;1c-64959c6bf22d5&quot;</span></span><br><span class="line">&lt; accept-ranges: bytes</span><br><span class="line">&lt; content-length: 28</span><br><span class="line">&lt; content-type: text/html; charset=UTF-8</span><br><span class="line">&lt;</span><br><span class="line">webserver1 --- 192.168.0.10</span><br><span class="line">* Connection <span class="comment">#1 to host 172.25.254.100 left intact</span></span><br></pre></td></tr></table></figure><h1 id="2026-1-28"><a href="#2026-1-28" class="headerlink" title="2026-1-28"></a>2026-1-28</h1><h2 id="1-Keepalived实验环境设定"><a href="#1-Keepalived实验环境设定" class="headerlink" title="1.Keepalived实验环境设定"></a>1.Keepalived实验环境设定</h2><h3 id="1-环境设定图"><a href="#1-环境设定图" class="headerlink" title="1.环境设定图"></a>1.环境设定图</h3><p> <img src="G:\图片\kastatus.png" alt="kastatus"></p><h3 id="2-环境设定"><a href="#2-环境设定" class="headerlink" title="2.环境设定"></a>2.环境设定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部署rs1和rh2（单网卡NAT模式）</span></span><br><span class="line">[root@rs1 ~]# vmset.sh rs1 eth0 172.25.254.10 </span><br><span class="line">[root@rs1 ~]# dnf install httpd -y</span><br><span class="line">[root@rs1 ~]# <span class="built_in">echo</span> RS1 - 172.25.254.10 &gt; /var/www/html/index.html</span><br><span class="line">[root@rs1 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">[root@rs2 ~]# vmset.sh rs2 eth0 172.25.254.20 </span><br><span class="line">[root@rs2 ~]# dnf install httpd -y</span><br><span class="line">[root@rs2 ~]# <span class="built_in">echo</span> RS2 - 172.25.254.20 &gt; /var/www/html/index.html</span><br><span class="line">[root@rs2 ~]# systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.10</span><br><span class="line">RS1 - 172.25.254.10</span><br><span class="line">                                                                                                    ✔</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">[2026-01-28 10:36.42]  ~</span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.20</span><br><span class="line">RS2 - 172.25.254.20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定ka1和ka2</span></span><br><span class="line">[root@KA1 ~]# vmset.sh KA1 eth0 172.25.254.50 </span><br><span class="line">[root@KA2 ~]# vmset.sh KA2 eth0 172.25.254.60 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设定本地解析</span></span><br><span class="line">[root@KA1 ~]# vim /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">172.25.254.50     KA1</span><br><span class="line">172.25.254.60     KA2</span><br><span class="line">172.25.254.10     rs1</span><br><span class="line">172.25.254.20     rs2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 60 10 20; <span class="keyword">do</span> scp /etc/hosts 172.25.254.<span class="variable">$i</span>:/etc/hosts; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在所有主机中查看/etc/hosts</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在ka1中开启时间同步服务</span></span><br><span class="line">[root@KA1 ~]# vim /etc/chrony.conf</span><br><span class="line"> 26 allow 0.0.0.0/0</span><br><span class="line"> 29 <span class="built_in">local</span> stratum 10</span><br><span class="line"> </span><br><span class="line">[root@KA1 ~]# systemctl restart chronyd</span><br><span class="line">[root@KA1 ~]# systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在ka2中使用ka1的时间同步服务</span></span><br><span class="line">[root@KA2 ~]# vim /etc/chrony.conf</span><br><span class="line">pool 172.25.254.50 iburst</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# systemctl restart chronyd</span><br><span class="line">[root@KA2 ~]# systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# chronyc sources -v</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current best, <span class="string">&#x27;+&#x27;</span> = combined, <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /             <span class="string">&#x27;x&#x27;</span> = may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = too variable, <span class="string">&#x27;?&#x27;</span> = unusable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</span><br><span class="line">===============================================================================</span><br><span class="line">^* KA1                           3   6    17    13   +303ns[+6125ns] +/-   69ms </span><br></pre></td></tr></table></figure><h2 id="2-Keepalived日志分离"><a href="#2-Keepalived日志分离" class="headerlink" title="2.Keepalived日志分离"></a>2.Keepalived日志分离</h2><p>默认情况下。keepalived的日志会被保存在&#x2F;var&#x2F;log&#x2F;messages文件中，这个文件中除了含有keepalived的日志外，还有其他服务的日志信息，这样不利于对于keepalived的日志进行查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/sysconfig/keepalived</span><br><span class="line">KEEPALIVED_OPTIONS=<span class="string">&quot;-D -S 6&quot;</span></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# vim /etc/rsyslog.conf</span><br><span class="line">local6.*                                                /var/log/keepalived.log</span><br><span class="line">[root@KA1 ~]# systemctl restart rsyslog.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# <span class="built_in">ls</span> -l /var/log/keepalived.log</span><br><span class="line"><span class="built_in">ls</span>: 无法访问 <span class="string">&#x27;keepalived.log&#x27;</span>: 没有那个文件或目录</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA1 ~]#  <span class="built_in">ls</span> -l /var/log/keepalived.log</span><br><span class="line">-rw------- 1 root root 3294  1月 28 15:09 /var/log/keepalived.log</span><br></pre></td></tr></table></figure><h2 id="3-Keepalived的子配置文件设定"><a href="#3-Keepalived的子配置文件设定" class="headerlink" title="3.Keepalived的子配置文件设定"></a>3.Keepalived的子配置文件设定</h2><p>在主配置文件中如果写入过多的配置不利于对于主配置文件的阅读</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include /etc/keepalived/conf.d/*.conf<span class="comment">#指定独立子配置文件</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">mkdir</span>  /etc/keepalived/conf.d -p</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/conf.d/webvip.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# keepalived -t -f /etc/keepalived/keepalived.conf</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 17383  bytes 1417554 (1.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 32593  bytes 3135052 (2.9 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 118  bytes 6828 (6.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 118  bytes 6828 (6.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-抢占模式"><a href="#4-抢占模式" class="headerlink" title="4.抢占模式"></a>4.抢占模式</h2><h3 id="4-1-抢占模式-默认的，谁优先级高就把vip放到哪里"><a href="#4-1-抢占模式-默认的，谁优先级高就把vip放到哪里" class="headerlink" title="4.1.抢占模式( 默认的，谁优先级高就把vip放到哪里)"></a>4.1.抢占模式( 默认的，谁优先级高就把vip放到哪里)</h3><h3 id="4-2-非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）"><a href="#4-2-非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）" class="headerlink" title="4.2.非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）"></a>4.2.非抢占模式（持有vip只要vrrp通告正常就不做vip迁移）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP<span class="comment">#非抢占模式互为backup</span></span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    nopreempt<span class="comment">#启动非抢占模式</span></span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    nopreempt<span class="comment">#开启非抢占模式</span></span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 18917  bytes 1546417 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 34775  bytes 3349412 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 22521  bytes 1553701 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 18517  bytes 1535122 (1.4 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 84  bytes 5128 (5.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 84  bytes 5128 (5.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启KA1的服务ip不会被抢占到1中</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 19102  bytes 1561277 (1.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 35034  bytes 3375682 (3.2 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 162  bytes 9028 (8.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><h3 id="4-3-延迟抢占"><a href="#4-3-延迟抢占" class="headerlink" title="4.3.延迟抢占"></a>4.3.延迟抢占</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP<span class="comment">#非抢占模式互为backup</span></span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10<span class="comment">#启动延迟抢占，延迟10s抢占</span></span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10<span class="comment">#启动延迟抢占，延迟10s抢占</span></span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#在一个独立的shell中开启ip的监控</span></span><br><span class="line">[root@KA1 ~]# watch -n 1 ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA1另外的shell中关闭keepalived</span></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl start  keepalived.service</span><br><span class="line"><span class="comment">#操作完毕后观察监控中vip的迁移延迟过程</span></span><br></pre></td></tr></table></figure><h2 id="5-keepalived的单播模式"><a href="#5-keepalived的单播模式" class="headerlink" title="5.keepalived的单播模式"></a>5.keepalived的单播模式</h2><p>为什么要单播，组播模式使用的网址资源最少，但是不能跨网络，如果主备两台主机是跨网络的，那么只能启用单播来实现vrrp通告</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   <span class="comment">#vrrp_mcast_group4 224.0.0.44#关闭组播</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    unicast_src_ip 172.25.254.50<span class="comment">#指定单播源地址，通常是本机IP</span></span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">      172.25.254.60<span class="comment">#指定单播接收地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   <span class="comment">#vrrp_mcast_group4 224.0.0.44#关闭组播</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    unicast_src_ip 172.25.254.60<span class="comment">#指定单播源地址，通常是本机IP</span></span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">      172.25.254.50<span class="comment">#指定单播接收地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="comment">#在KA1中开启独立shell监控播报信息</span></span><br><span class="line">[root@KA1 ~]# tcpdump -i eth0 -nn src host 172.25.254.50 and dst 172.25.254.60</span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA2中开启独立shell监控播报信息</span></span><br><span class="line">[root@KA2 ~]# tcpdump -i eth0 -nn src host 172.25.254.60 and dst 172.25.254.50</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在KA1正常时</span></span><br><span class="line"><span class="comment">#ka2播报信息不显示通告内容</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#vip会被迁移到KA2,KA2上开始显示播报内容</span></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#vip因为优先级被KA1抢占，KA2中播报停止</span></span><br></pre></td></tr></table></figure><p>Keepalived业务vip迁移告警</p><p>1.邮件告警环境构建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装邮件软件</span></span><br><span class="line">[root@KA1 ~]#  dnf install s-nail postfix   -y</span><br><span class="line">[root@KA2 ~]#  dnf install s-nail postfix   -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动邮件代理</span></span><br><span class="line">[root@KA1 ~]# systemctl start postfix.service</span><br><span class="line">[root@KA2 ~]# systemctl start postfix.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#设定sendmail可以通过公网邮箱发送邮件下面方式人选其一</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在Linux主机中配置mailrc（KA1+KA2）</span></span><br><span class="line">[root@KA1+KA2 ~]# vim /etc/mail.rc</span><br><span class="line"><span class="built_in">set</span> smtp=smtp.qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth=login</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=kaitumei@foxmail.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=oxsfthfenecmfaae</span><br><span class="line"><span class="built_in">set</span> from=kaitumei@foxmail.com</span><br><span class="line"><span class="built_in">set</span> ssl-verify=ignore</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试邮件</span></span><br><span class="line">[root@KA1 mail]# <span class="built_in">echo</span> hello | mailx -s <span class="built_in">test</span> kaitumei@163.com</span><br><span class="line"></span><br><span class="line">[root@KA1 mail]# mailq<span class="comment">#查看邮件队列</span></span><br><span class="line">Mail queue is empty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 mail]# mail<span class="comment">#查看是否又退信</span></span><br><span class="line">s-nail version v14.9.22.  Type `?<span class="string">&#x27; for help</span></span><br><span class="line"><span class="string">/var/spool/mail/root: 1 message</span></span><br><span class="line"><span class="string">▸   1 Mail Delivery Subsys  2026-01-28 16:26   69/2210  &quot;Returned mail: see transcript for details  &quot;</span></span><br><span class="line"><span class="string">&amp;q 退出</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#查看对应邮箱是否有邮件收到</span></span><br></pre></td></tr></table></figure><p>2.设定keepalived告警脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# <span class="built_in">mkdir</span>  -p /etc/keepalived/scripts</span><br><span class="line">[root@KA2 ~]#  <span class="built_in">mkdir</span>  -p /etc/keepalived/scripts</span><br><span class="line"></span><br><span class="line"><span class="comment">#编写告警脚本</span></span><br><span class="line">[root@KA1+2 ~]#  vim /etc/keepalived/scripts/waring.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mail_dest=<span class="string">&#x27;kaitumei@163.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">mail_send</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    mail_subj=<span class="string">&quot;<span class="variable">$HOSTNAME</span> to be <span class="variable">$1</span> vip 转移&quot;</span></span><br><span class="line">    mail_mess=<span class="string">&quot;`date +%F\ %T`: vrrp 转移,<span class="variable">$HOSTNAME</span> 变为 <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$mail_mess</span>&quot;</span> | mail -s <span class="string">&quot;<span class="variable">$mail_subj</span>&quot;</span> <span class="variable">$mail_dest</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    master)</span><br><span class="line">    mail_send master</span><br><span class="line">    ;;</span><br><span class="line">    backup)</span><br><span class="line">    mail_send backup</span><br><span class="line">    ;;</span><br><span class="line">    fault)</span><br><span class="line">    mail_send fault</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# <span class="built_in">chmod</span>  +x /etc/keepalived/scripts/waring.sh</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# /etc/keepalived/scripts/waring.sh master</span><br><span class="line"></span><br><span class="line"><span class="comment">#对应邮箱中会出现邮件</span></span><br></pre></td></tr></table></figure><p>3.配置keepalived告警</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1和KA2中设定配置文件</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">   enable_script_security</span><br><span class="line">   script_user root</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">  <span class="comment"># unicast_src_ip 172.25.254.50</span></span><br><span class="line">  <span class="comment"># unicast_peer &#123;</span></span><br><span class="line">  <span class="comment">#   172.25.254.60</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master <span class="string">&quot;/etc/keepalived/scripts/waring.sh master&quot;</span></span><br><span class="line">    notify_backup <span class="string">&quot;/etc/keepalived/scripts/waring.sh backup&quot;</span></span><br><span class="line">    notify_fault <span class="string">&quot;/etc/keepalived/scripts/waring.sh fault&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service<span class="comment">#停止服务后查看邮件</span></span><br><span class="line">[root@KA1 ~]# systemctl start keepalived.service<span class="comment">#开启服务后查看邮件</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-Keepalived双主模式"><a href="#6-Keepalived双主模式" class="headerlink" title="6.Keepalived双主模式"></a>6.Keepalived双主模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;<span class="comment">#第一个虚拟路由，以master身份设定</span></span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance DB_VIP &#123;<span class="comment">#第二个虚拟路由。以backup身份设定</span></span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 52</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.200/24 dev eth0 label eth0:1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#KA2中</span></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    preempt_delay 10</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance DB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 52</span><br><span class="line">    preempt_delay 10</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">      172.25.254.200/24 dev eth0 label eth0:1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line">[root@KA2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 38766  bytes 3548249 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 67456  bytes 6209788 (5.9 MiB)</span><br><span class="line">        TX errors 0  dropped 2 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 782  bytes 60465 (59.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 782  bytes 60465 (59.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 46164  bytes 3559703 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 38170  bytes 3306899 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 532  bytes 39588 (38.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 532  bytes 39588 (38.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl stop keepalived.service</span><br><span class="line">[root@KA2 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.60  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::26df:35e5:539:56bc  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 46204  bytes 3562823 (3.3 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 38240  bytes 3313319 (3.1 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:1e:fd:7a  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# systemctl stop keepalived.service</span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 39277  bytes 3653121 (3.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 67902  bytes 6264989 (5.9 MiB)</span><br><span class="line">        TX errors 0  dropped 2 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.200  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-双主模式代理不同业务实现高可用"><a href="#7-双主模式代理不同业务实现高可用" class="headerlink" title="7.双主模式代理不同业务实现高可用"></a>7.双主模式代理不同业务实现高可用</h2><h3 id="1-实验环境"><a href="#1-实验环境" class="headerlink" title="1.实验环境"></a>1.实验环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#web服务设定再个实验已经设定完成</span></span><br><span class="line"><span class="comment">#在rs中设定lo添加vip2 172.25.254.200、32</span></span><br><span class="line"><span class="comment">#在rs中搭建数据库</span></span><br><span class="line">[root@rs1+2 ~]# dnf install mariadb-server -y</span><br><span class="line">[root@rs1+2 ~]# systemctl <span class="built_in">enable</span> --now mariadb</span><br><span class="line">[root@rs1+2 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 3</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; CREATE USER <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;hua&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL ON *.* TO <span class="string">&#x27;hua&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@rs1 ~]# mysql -uhua -phua -h172.25.254.10</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 4</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line"></span><br><span class="line">[root@rs1 ~]# mysql -ulee -plee -h172.25.254.20</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 4</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-实现不同vip代理不同业务"><a href="#2-实现不同vip代理不同业务" class="headerlink" title="2.实现不同vip代理不同业务"></a>2.实现不同vip代理不同业务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#KA1和KA2</span></span><br><span class="line">[root@KA1+2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">include /etc/keepalived/conf.d/webserver.conf</span><br><span class="line">include /etc/keepalived/conf.d/datebase.conf</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/keepalived/conf.d/webserver.conf</span><br><span class="line">virtual_server 172.25.254.100 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.10 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              status_code 200</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 1</span><br><span class="line">            retry 3</span><br><span class="line">            delay_before_retry 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.20 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 80</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/conf.d/datebase.conf</span><br><span class="line">virtual_server 172.25.254.200 3306 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.10 3306 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 3306</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.25.254.20 3306 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">          connect_timeout 5</span><br><span class="line">          retry 3</span><br><span class="line">          delay_before_retry 3</span><br><span class="line">          connect_port 3306</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rs1+2 ~]# vim /etc/NetworkManager/system-connections/lo.nmconnection</span><br><span class="line">address3=172.25.254.200/32</span><br><span class="line">[root@rs1 ~]# nmcli connection reload</span><br><span class="line">[root@rs1 ~]# nmcli connection up lo</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@rs2 ~]# mysql -uhua  -phua  -h172.25.254.200</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 89</span><br><span class="line">Server version: 10.5.27-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">RS1 - 172.25.254.10</span><br><span class="line">                                                                                                    ✔</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">[2026-01-29 11:58.55]  ~</span><br><span class="line">[Administrator.DESKTOP-VJ307M3] ➤ curl 172.25.254.100</span><br><span class="line">RS2 - 172.25.254.20</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8-利用VRRP-Script-实现全能高可用"><a href="#8-利用VRRP-Script-实现全能高可用" class="headerlink" title="8.利用VRRP Script 实现全能高可用"></a>8.利用VRRP Script 实现全能高可用</h2><h3 id="1-实验环境-1"><a href="#1-实验环境-1" class="headerlink" title="1.实验环境"></a>1.实验环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1和KA2中安装haproxy</span></span><br><span class="line">[root@KA1+2 ~]# dnf install haproxy-2.4.22-4.el9.x86_64  -y</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_nonlocal_bind=1</span><br><span class="line"></span><br><span class="line">[root@KA1+2 ~]# vim /etc/haproxy/haproxy.cfg</span><br><span class="line">listen webserver</span><br><span class="line">    <span class="built_in">bind</span> 172.25.254.100:80</span><br><span class="line">    mode http</span><br><span class="line">    server web1 172.25.254.10:80 check</span><br><span class="line">    server web2 172.25.254.20:80 check</span><br><span class="line">    </span><br><span class="line">[root@KA1+2 ~]# systemctl <span class="built_in">enable</span> --now haproxy.service</span><br></pre></td></tr></table></figure><h3 id="2-利用案例理解vrrp-scripts"><a href="#2-利用案例理解vrrp-scripts" class="headerlink" title="2.利用案例理解vrrp_scripts"></a>2.利用案例理解vrrp_scripts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在KA1主机中</span></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/scripts/test.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ ! -f <span class="string">&quot;/mnt/lee&quot;</span> ]</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA1</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_lee &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/test.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt no</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_lee</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA2 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     timinglee_zln@163.com</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from timinglee_zln@163.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id KA2</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   <span class="comment">#vrrp_strict</span></span><br><span class="line">   vrrp_garp_interval 1</span><br><span class="line">   vrrp_gna_interval 1</span><br><span class="line">   vrrp_mcast_group4 224.0.0.44</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_lee &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/test.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_lee</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试：</span></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 98198  bytes 9235557 (8.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 145101  bytes 12247386 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">touch</span> /mnt/lee</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 97968  bytes 9216259 (8.7 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 144858  bytes 12219108 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">rm</span> -fr /mnt/lee</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.50  netmask 255.255.255.0  broadcast 172.25.254.255</span><br><span class="line">        inet6 fe80::3901:aeea:786a:7227  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 98198  bytes 9235557 (8.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 145101  bytes 12247386 (11.6 MiB)</span><br><span class="line">        TX errors 0  dropped 9 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth0:0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.25.254.100  netmask 255.255.255.0  broadcast 0.0.0.0</span><br><span class="line">        ether 00:0c:29:26:33:d9  txqueuelen 1000  (Ethernet)</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 932  bytes 72195 (70.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><h3 id="3-keepalived-haproxy"><a href="#3-keepalived-haproxy" class="headerlink" title="3.keepalived + haproxy"></a>3.keepalived + haproxy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@KA1 ~]# vim /etc/keepalived/scripts/haproxy_check.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">killall -0 haproxy &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# <span class="built_in">chmod</span> +x /etc/keepalived/scripts/haproxy_check.sh</span><br><span class="line">[root@KA1 ~]# vim /etc/keepalived/keepalived.conf</span><br><span class="line">vrrp_script haporxy_check &#123;</span><br><span class="line">    script <span class="string">&quot;/etc/keepalived/scripts/haproxy_check.sh&quot;</span></span><br><span class="line">    interval 1</span><br><span class="line">    weight -30</span><br><span class="line">    fall 2</span><br><span class="line">    rise 2</span><br><span class="line">    <span class="built_in">timeout</span> 2</span><br><span class="line">    user root</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance WEB_VIP &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.25.254.100/24 dev eth0 label eth0:0</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        haporxy_check</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@KA1 ~]# systemctl restart keepalived.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">通过关闭和开启haproxy来观察vip是否迁移</span><br></pre></td></tr></table></figure><h1 id="2026-1-29"><a href="#2026-1-29" class="headerlink" title="2026-1-29"></a>2026-1-29</h1><h2 id="1-Nginx的源码编译"><a href="#1-Nginx的源码编译" class="headerlink" title="1.Nginx的源码编译"></a>1.Nginx的源码编译</h2><h3 id="1-1-下载软件"><a href="#1-1-下载软件" class="headerlink" title="1.1.下载软件"></a>1.1.下载软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx ~]# wget https://nginx.org/download/nginx-1.28.1.tar.gz</span><br></pre></td></tr></table></figure><h3 id="1-2-解压"><a href="#1-2-解压" class="headerlink" title="1.2.解压"></a>1.2.解压</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx ~]# tar -zxf nginx-1.28.1.tar.gz</span><br><span class="line">[root@Nginx ~]# cd nginx-1.28.1/</span><br><span class="line">[root@Nginx nginx-1.28.1]# ls</span><br><span class="line">auto     CHANGES.ru          conf       contrib          html     man        SECURITY.md</span><br><span class="line">CHANGES  CODE_OF_CONDUCT.md  configure  CONTRIBUTING.md  LICENSE  README.md  src</span><br></pre></td></tr></table></figure><h3 id="1-3-检测环境"><a href="#1-3-检测环境" class="headerlink" title="1.3.检测环境"></a>1.3.检测环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装依赖性</span></span><br><span class="line">[root@Nginx ~]# dnf install gcc openssl-devel.x86_64 pcre2-devel.x86_64 zlib-devel -y</span><br><span class="line"></span><br><span class="line">[root@Nginx nginx-1.28.1]# ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream --with-stream_ssl_module --with-stream_realip_module</span><br></pre></td></tr></table></figure><h3 id="1-4-编译"><a href="#1-4-编译" class="headerlink" title="1.4.编译"></a>1.4.编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx nginx-1.28.1]# make</span><br><span class="line">[root@Nginx nginx-1.28.1]# make install</span><br></pre></td></tr></table></figure><h3 id="1-5-nginx启动"><a href="#1-5-nginx启动" class="headerlink" title="1.5.nginx启动"></a>1.5.nginx启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#设定环境变量</span><br><span class="line">[root@Nginx sbin]# vim  ~/.bash_profile</span><br><span class="line">export PATH=$PATH:/usr/local/nginx/sbin</span><br><span class="line"></span><br><span class="line">[root@Nginx sbin]# source   ~/.bash_profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Nginx logs]# useradd  -s /sbin/nologin -M nginx</span><br><span class="line">[root@Nginx logs]# nginx</span><br><span class="line">[root@Nginx logs]# ps aux | grep nginx</span><br><span class="line">root       44012  0.0  0.1  14688  2356 ?        Ss   17:01   0:00 nginx: master process nginx</span><br><span class="line">nginx      44013  0.0  0.2  14888  3892 ?        S    17:01   0:00 nginx: worker process</span><br><span class="line">root       44015  0.0  0.1   6636  2176 pts/0    S+   17:01   0:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#测试</span><br><span class="line">[root@Nginx logs]# echo timinglee &gt; /usr/local/nginx/html/index.html</span><br><span class="line"></span><br><span class="line">[root@Nginx logs]# curl  172.25.254.100</span><br><span class="line">timinglee</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 云原生 </tag>
            
            <tag> liunx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建现代化浏览器导航站</title>
      <link href="/2026/02/01/Con-Nav-Item%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/"/>
      <url>/2026/02/01/Con-Nav-Item%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="Con-Nav-Item-现代化个人导航站"><a href="#Con-Nav-Item-现代化个人导航站" class="headerlink" title="Con-Nav-Item - 现代化个人导航站"></a>Con-Nav-Item - 现代化个人导航站</h1><p>Con-Nav-Item 是一款专为数字化工作者打造的现代化个人导航系统。它不仅仅是一个链接收藏夹，更是一个集成了 AI 智能生成、多端同步、卡片化管理和浏览器深度集成的全能工作台。<a href="https://github.com/zczy-k/Con-Nav-Item?tab=readme-ov-file">Con-Nav-Item: 新一代导航网站,Ai集成</a></p><h2 id="1-基于Docker部署"><a href="#1-基于Docker部署" class="headerlink" title="1.基于Docker部署"></a>1.基于Docker部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name Con-Nav-Item \</span><br><span class="line">  -p 3000:3000 \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>)/database:/app/database \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>)/backups:/app/backups \</span><br><span class="line">  -e ADMIN_USERNAME=admin \</span><br><span class="line">  -e ADMIN_PASSWORD=123456 \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  ghcr.io/zczy-k/con-nav-item:latest</span><br></pre></td></tr></table></figure><h2 id="2-初始化配置-安装后必看"><a href="#2-初始化配置-安装后必看" class="headerlink" title="2.初始化配置 (安装后必看)"></a>2.初始化配置 (安装后必看)</h2><ol><li><strong>访问后台</strong>：打开 <code>http://你的IP:3000/admin</code></li><li><strong>默认账号</strong>：用户名 <code>admin</code>，密码 <code>123456</code>。</li><li><strong>安全修改</strong>：进入 <strong>[用户管理]</strong> 菜单，第一时间修改管理员用户名和密码。</li><li><strong>配置 AI</strong>：进入 **[AI 智能生成]**，填入你的 API Key（推荐 DeepSeek），测试通过后即可享受一键生成功能。</li></ol><h2 id="3-浏览器插件安装"><a href="#3-浏览器插件安装" class="headerlink" title="3.浏览器插件安装"></a>3.浏览器插件安装</h2><ol><li>前往 <a href="https://github.com/zczy-k/Con-Nav-Item/releases">Releases</a> 下载最新 <code>browser-extension.zip</code>。</li><li>解压后，在 Chrome&#x2F;Edge 浏览器进入 <code>chrome://extensions/</code>。</li><li>开启 <strong>开发者模式</strong>，选择 <strong>加载已解压的扩展程序</strong>。</li><li>在插件设置中填入你的导航站地址和密码，完成绑定。</li></ol><h2 id="4-使用"><a href="#4-使用" class="headerlink" title="4.使用"></a>4.使用</h2><ol><li>在后台添加一个只写了“URL”的卡片。</li><li>勾选该卡片，点击 <strong>批量 AI 生成</strong>。</li><li>AI 会自动爬取标题、描述、图标并分类，点击“覆盖”或“补全”保存。</li></ol><h2 id="5-升级与卸载"><a href="#5-升级与卸载" class="headerlink" title="5.升级与卸载"></a>5.升级与卸载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 拉取镜像</span></span><br><span class="line">docker pull ghcr.io/zczy-k/con-nav-item:latest</span><br><span class="line"><span class="comment"># 2. 删除容器 (数据不会丢)</span></span><br><span class="line">docker stop Con-Nav-Item &amp;&amp; docker <span class="built_in">rm</span> Con-Nav-Item</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 导航栏 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从零开始搭建图床</title>
      <link href="/2026/02/01/PicGo%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/"/>
      <url>/2026/02/01/PicGo%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="图床搭建（Cloudflare-R2-WebP-Cloud-PicGo）"><a href="#图床搭建（Cloudflare-R2-WebP-Cloud-PicGo）" class="headerlink" title="图床搭建（Cloudflare R2 + WebP Cloud + PicGo）"></a>图床搭建（Cloudflare R2 + WebP Cloud + PicGo）</h1><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>图床有什么用呢？从名字上看就知道是一个专门储存图片的仓库，可以极大节省大量图片带来的资源消耗，比如用在网站上，以减少图片大量堆积而导致服务器过载；也可以用在笔记里，减少笔记的总体大小以及图片路径导致图片无法加载的问题。</p><p>总之，图床的核心功能就是跨平台访问、降低资源消耗、方便管理等。本次图床搭建主要是基于<code>Cloudflare R2 + WebP Cloud + PicGo</code>而搭建的。</p><h2 id="2-从零开始搭建图床"><a href="#2-从零开始搭建图床" class="headerlink" title="2.从零开始搭建图床"></a>2.从零开始搭建图床</h2><h3 id="2-1-配置Cloudflare-R2"><a href="#2-1-配置Cloudflare-R2" class="headerlink" title="2.1.配置Cloudflare R2"></a>2.1.配置Cloudflare R2</h3><p>R2 是 Cloudflare 推出的免费对象存储服务，需要免费注册一个 <a href="https://dash.cloudflare.com/1dc74a6575af68307104f0a3b835e5dd/r2/overview">Cloudflare 账号</a>才能使用。并且需要先绑定好信用卡，填写好信息后才能订阅服务。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-02-29.png" alt="PixPin_2026-01-20_22-02-29" style="zoom: 44%;" /> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-09-37.png" alt="PixPin_2026-01-20_22-09-37" style="zoom: 52%;" /> <p>订阅之后，需要创建一个 “存储库” 。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-20-15.png" alt="PixPin_2026-01-20_22-20-15" style="zoom: 50%;" /><p>需要填写存储桶（Bucket）名称，建议有一些辨识度，后续在配置上传时会用到。位置和默认存储库可根据自己需求配置，随后点击蓝色按钮创建完成。</p><img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-20-56.png" alt="PixPin_2026-01-20_22-20-56" style="zoom:50%;" /> <p>创建成功后点击 <code>设置</code> ，进入下面页面，记住S3 API的值并且启用公共开发URL。启用后可获得一个公网地址。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-21-46.png" alt="PixPin_2026-01-20_22-21-46" style="zoom: 67%;" /><p>将这个公共URL也给记录好，后续要用到。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-28-18.png" alt="PixPin_2026-01-20_22-28-18" style="zoom: 50%;" /><p>完成上面的设置后，返回<code>概述</code>页面，然后创建API令牌。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-28-59.png" alt="PixPin_2026-01-20_22-28-59" style="zoom:50%;" /> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-29-21.png" alt="PixPin_2026-01-20_22-29-21" style="zoom:50%;" /><p>并且完成下面的配置后保存。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-29-52.png" alt="PixPin_2026-01-20_22-29-52" style="zoom:50%;" /><p>令牌名称可自己随意设定，权限选择第三个，保证文件能够写入与读取，并且将这个API指定到刚才创建好的<code>images</code>仓库。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-30-04.png" alt="PixPin_2026-01-20_22-30-04" style="zoom:50%;" /><p>再创建完API令牌后进入下面页面，并且将下面的访问密钥ID与机密访问密钥记录保存，这两个之后无法查询到。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-30-42.png" alt="PixPin_2026-01-20_22-30-42" style="zoom:50%;" /><h3 id="2-2-WebP-Cloud-图片优化"><a href="#2-2-WebP-Cloud-图片优化" class="headerlink" title="2.2.WebP Cloud 图片优化"></a>2.2.WebP Cloud 图片优化</h3><p>首先，到<a href="https://dashboard.webp.se/">WebP Cloude</a>官网注册登录后，创建一个代理。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-32-16.png" alt="PixPin_2026-01-20_22-32-16" style="zoom: 40%;" /><p>代理区域选择与库当时设定的地区最近的地方，代理名称可自定义，源站地址为库的公共URL&#x2F;自定义URL，完成相关配置后保存。</p><p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-38-20.png" alt="PixPin_2026-01-20_22-38-20" style="zoom: 67%;" />  <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-39-03.png" alt="PixPin_2026-01-20_22-39-03" style="zoom: 40%;" /></p><p>完成配置后可在我的代理中查看代理地址，并且保存好代理地址。</p><h3 id="2-3-PicGo-工具"><a href="#2-3-PicGo-工具" class="headerlink" title="2.3.PicGo 工具"></a>2.3.PicGo 工具</h3><p>PicGo 本体并不包括 S3 图床，但可以通过「<a href="https://sspai.com/link?target=https://github.com/wayjam/picgo-plugin-s3">GitHub - wayjam&#x2F;picgo-plugin-s3</a>」插件来支持。或者，直接在插件设置直接搜索相关插件并且安装。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-39-33.png" alt="PixPin_2026-01-20_22-39-33" style="zoom: 67%;" /><p>插件安装好后，可以在<code>图床设置</code>那一栏直接编辑Amazon S3 。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-39-42.png" alt="PixPin_2026-01-20_22-39-42" style="zoom:67%;" /><p>随后完成以下7个配置。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-41-56.png" alt="PixPin_2026-01-20_22-41-56" style="zoom:67%;" /><ul><li><strong>图床配置名</strong> ，根据喜好填写。</li><li><strong>应用密钥 ID</strong>，填写 R2 API 中的 Access Key ID（访问密钥 ID）</li><li><strong>应用密钥</strong>，填写 R2 API 中的 Secret Access Key（机密访问密钥）</li><li><strong>桶名</strong>，填写 R2 中创建的 Bucket 名称，如我上文的 <code>images</code></li><li><strong>文件路径</strong>，上传到 R2 中的文件路径，我选择使用 <code>&#123;fileName&#125;.&#123;extName&#125;</code> 来保留原文件的文件名和扩展名。</li><li><strong>自定义节点</strong>，填写 R2 API 中的 <code>S3 API</code>仓库名前面的域名，<code>/</code> 后面为想要保存的地点。 </li><li><strong>自定义输出URL模板</strong>，填写代理域名以及路径，可参考示例7</li></ul> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-43-41.png" alt="PixPin_2026-01-20_22-43-41" style="zoom:67%;" /><p>完成所有配置后点击保存，然后进行测试</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-43-57.png" alt="PixPin_2026-01-20_22-43-57" style="zoom:67%;" /><p>随便上传一个图片进行测试，如果显示上传成功，则图床搭建成功；如若显示上传失败，大概率是上面的配置出错了。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-49-34.png" alt="PixPin_2026-01-20_22-49-34" style="zoom: 150%;" /><p>然后回到Cloudflare R2的库中查看是否写入对应路径，可以看到图片已经写入库中相应目录。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_22-49-53.png" alt="PixPin_2026-01-20_22-49-53" style="zoom: 50%;" /><h2 id="3-与typora联动"><a href="#3-与typora联动" class="headerlink" title="3.与typora联动"></a>3.与typora联动</h2><p>搭建图床的主要目的还是为了方便记笔记，所以这里以Typora为例。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_23-32-51.png" alt="PixPin_2026-01-20_23-32-51"  /><p>首先打开文件—&gt;偏好设置—&gt;图像—&gt;上传服务设定。</p> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_23-33-17.png" alt="PixPin_2026-01-20_23-33-17" style="zoom: 50%;" /><p>将上传服务和PicGO路径改后。之后回到笔记随便插入一张图片，然后右击图片完成上传图片。</p><blockquote> <img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_23-36-47.png" alt="PixPin_2026-01-20_23-36-47"  /></blockquote><p>可以看到上传成功后，会自动变更地址，从之前的绝对路径更换为网络地址，并且右下角显示上传成功弹窗。</p><blockquote><p><img src="https://d1aa036.webp.li/Build/PixPin_2026-01-20_23-37-26.png" alt="PixPin_2026-01-20_23-37-26"></p></blockquote><p>至此图床的搭建已全部完成。</p><p><strong>编辑者</strong>：<span style="color:#0000CC;"><code>kaituemi</code></span></p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图床 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RHCE-Linux的基础部分笔记</title>
      <link href="/2026/02/01/RHCE%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"/>
      <url>/2026/02/01/RHCE%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="25-10-16-SSH"><a href="#25-10-16-SSH" class="headerlink" title="25-10-16(SSH)"></a>25-10-16(SSH)</h1><h2 id="1-SSH理论"><a href="#1-SSH理论" class="headerlink" title="1.SSH理论"></a>1.SSH理论</h2><p><strong>理论部分参考</strong>   <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/01ssh%E7%90%86%E8%AE%BA.md">跳转</a></p><ul><li><p>查看 sshd 是否使用</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>systemctl status sshd</td><td>查询 <code>sshd</code> 服务的<strong>运行状态</strong></td></tr><tr><td>netstat -intup | grep sshd</td><td>查询 <code>sshd</code> 服务对应的<strong>网络连接、监听端口</strong></td></tr><tr><td>ps -aux  | grep sshd</td><td>查询系统中所有和 <code>sshd</code> 相关的<strong>进程详情</strong></td></tr></tbody></table></li><li><p>原理图</p></li></ul><p> <img src="https://b5dbf24.webp.li/image-20251018135704473.png" alt="image-20251018135704473"></p><blockquote><p>yum whatprocides netstat –查看该命令所需软件（–&gt;下载net-tools）</p></blockquote><ul><li>关键配置：<ul><li>端口修改（<code>Port</code>，默认 22，建议自定义提高安全性）。</li><li>禁用密码认证（<code>PasswordAuthentication no</code>），强制公钥认证。</li><li>禁用 root 直接登录（<code>PermitRootLogin no</code>），通过普通用户 sudo 提权。</li><li>限制允许登录的用户（<code>AllowUsers</code>）或组（<code>AllowGroups</code>）</li></ul></li></ul><h2 id="2-SSH实验"><a href="#2-SSH实验" class="headerlink" title="2.SSH实验"></a>2.SSH实验</h2><h3 id="2-1-修改SSH端口"><a href="#2-1-修改SSH端口" class="headerlink" title="2.1 修改SSH端口"></a>2.1 修改SSH端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置(/etc/ssh/sshd_config)(服务器配置)</span></span><br><span class="line">[root@ssh ~]# vim /etc/ssh/sshd_config</span><br><span class="line">21 <span class="comment">#Port 22#改端口号</span></span><br><span class="line">22 Port 666</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭防火墙和切换宽容模式</span></span><br><span class="line">[root@ssh ~]# systemctl --now <span class="built_in">disable</span> firewalld</span><br><span class="line">[root@ssh ~]# setenforce 0</span><br><span class="line">[root@ssh ~]# getenforce</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@ssh ~]# systemctl restart sshd</span><br></pre></td></tr></table></figure><p> <img src="https://d1aa036.webp.li/Build/image-20260130002411974.png" alt="image-20260130002411974"></p><h3 id="2-2-拒绝root用户远程登录"><a href="#2-2-拒绝root用户远程登录" class="headerlink" title="2.2 拒绝root用户远程登录"></a>2.2 拒绝root用户远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置(/etc/ssh/sshd_config)(服务器配置)</span></span><br><span class="line">[root@ssh ~]# vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#改参数</span></span><br><span class="line">    <span class="comment"># PermitRootLogin yes   ---&gt;</span></span><br><span class="line">    PermitRootLogin no</span><br><span class="line">[root@ssh ~]# systemctl restart sshd</span><br><span class="line"><span class="comment">#(------若不生效------)</span></span><br><span class="line"><span class="comment">#配置(/etc/ssh/sshd_config.d/01-permitrootlogin.conf)</span></span><br><span class="line">[root@ssh ~]# vim /etc/ssh/sshd_config.d/01-permitrootlogin.conf</span><br><span class="line">    <span class="comment"># PermitRootLogin yes   ---&gt;</span></span><br><span class="line">    PermitRootLogin no</span><br><span class="line">[root@ssh ~]# systemctl restart sshd</span><br></pre></td></tr></table></figure><p> <img src="https://d1aa036.webp.li/Build/image-20260130003058267.png" alt="image-20260130003058267"></p><h3 id="2-3-允许特定用户ssh登录，其余用户无法登录（包括root用户）"><a href="#2-3-允许特定用户ssh登录，其余用户无法登录（包括root用户）" class="headerlink" title="2.3 允许特定用户ssh登录，其余用户无法登录（包括root用户）"></a>2.3 允许特定用户ssh登录，其余用户无法登录（包括root用户）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置(/etc/ssh/sshd_config)(服务器配置)</span></span><br><span class="line">[root@ssh ~]# vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#改参数</span></span><br><span class="line">    <span class="comment">#AllowUsers USERNAME ---&gt;</span></span><br><span class="line">    AllowUsers zhangsan</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@ssh ~]# systemctl restart sshd</span><br><span class="line"><span class="comment">#注：</span></span><br><span class="line"><span class="comment">#USERNAME需要存在，多个用户之间使用空格隔开</span></span><br><span class="line"></span><br><span class="line">[root@ssh ~]# systemctl restart sshd</span><br><span class="line">[root@ssh ~]# useradd zhangsan</span><br><span class="line">[root@ssh ~]# passwd zhangsan</span><br><span class="line">更改用户 zhangsan 的密码 。</span><br><span class="line">新的密码： </span><br><span class="line">无效的密码： 密码少于 8 个字符</span><br><span class="line">重新输入新的密码： </span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br></pre></td></tr></table></figure><p><img src="https://d1aa036.webp.li/Build/image-20260130003746580.png" alt="image-20260130003746580"></p><h3 id="2-4-liunx客户端通过密钥登录liunx服务端root用户"><a href="#2-4-liunx客户端通过密钥登录liunx服务端root用户" class="headerlink" title="2.4 liunx客户端通过密钥登录liunx服务端root用户"></a>2.4 liunx客户端通过密钥登录liunx服务端root用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端(无需操作)</span></span><br><span class="line"><span class="comment">#客户端：</span></span><br><span class="line"><span class="comment">#1.创建密钥对</span></span><br><span class="line">[root@client ~]# ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">/root/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:RiUr92e99iK9aId8lj91L+LfIPOwMO/GBW8+TLMcN6Q root@client</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 3072]----+</span></span><br><span class="line"><span class="string">|        . .      |</span></span><br><span class="line"><span class="string">|         +       |</span></span><br><span class="line"><span class="string">|      . +        |</span></span><br><span class="line"><span class="string">|       + .  .. . |</span></span><br><span class="line"><span class="string">|        S . oo+  |</span></span><br><span class="line"><span class="string">|       .   o EBo+|</span></span><br><span class="line"><span class="string">|          oo+X+*=|</span></span><br><span class="line"><span class="string">|           +OO#=.|</span></span><br><span class="line"><span class="string">|           =*B+*=|</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#2.将公玥发送至服务端(用户的家目录的.ssh/authorized_keys)</span></span><br><span class="line"><span class="string">[root@client ~]# ssh-copy-id root@172.25.254.129</span></span><br><span class="line"><span class="string">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line"><span class="string">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span></span><br><span class="line"><span class="string">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span></span><br><span class="line"><span class="string">root@172.25.254.129&#x27;</span>s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   <span class="string">&quot;ssh &#x27;root@172.25.254.129&#x27;&quot;</span></span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.客户端免密登录</span></span><br><span class="line">[root@client ~]# ssh root@172.25.254.129</span><br></pre></td></tr></table></figure><blockquote><p>ssh-keygen (生成、管理和转换认证密钥)     -t (制定类型 RSA)<br>    &#x2F;root&#x2F;.ssh&#x2F;id_rsa  ——  私钥文件<br>   &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub  —–  公钥文件</p></blockquote><p><img src="https://d1aa036.webp.li/Build/image-20260130004928605.png" alt="image-20260130004928605"></p><h3 id="2-5-windows客户端通过秘钥登录linux服务端root用户"><a href="#2-5-windows客户端通过秘钥登录linux服务端root用户" class="headerlink" title="2.5 windows客户端通过秘钥登录linux服务端root用户"></a>2.5 windows客户端通过秘钥登录linux服务端root用户</h3><blockquote><p>上传至<span style="text-decoration:underline;">autgorized_keys</span></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、生成公私钥对</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="comment">#2、将公钥上传到服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、测试免密登录</span></span><br><span class="line">ssh  root@192.168.223.5</span><br><span class="line"><span class="comment">#4.使用XShell自带的密钥生成密钥对，然后复制到服务器上</span></span><br></pre></td></tr></table></figure><blockquote><p>​             加密 </p><p>公钥&lt;————&gt;私钥</p><p>​    解密</p></blockquote><h2 id="3-SSH协议原理"><a href="#3-SSH协议原理" class="headerlink" title="3. SSH协议原理"></a>3. SSH协议原理</h2><h3 id="3-1-连接过程"><a href="#3-1-连接过程" class="headerlink" title="3.1 连接过程"></a>3.1 连接过程</h3> <img src="https://b5dbf24.webp.li/image-20251012105145531.png" alt="image-20251012105145531"  /><p><strong>说明</strong> </p><p> <img src="https://b5dbf24.webp.li/image-20251012105343249.png" alt="image-20251012105343249"></p><h3 id="3-2-两种认证方式"><a href="#3-2-两种认证方式" class="headerlink" title="3.2 两种认证方式"></a>3.2 两种认证方式</h3><ul><li>密码认证：通过用户名+密码验证（安全性较低，易受暴力破解）。</li></ul><p> <img src="https://b5dbf24.webp.li/image-20251012110434119.png" alt="image-20251012110434119"></p><ul><li>公钥认证：基于密钥对（公钥存服务器，私钥存客户端），安全性更高，是推荐方式。</li></ul><p> <img src="https://b5dbf24.webp.li/image-20251012110246733.png" alt="image-20251012110246733"></p><h1 id="25-10-18-at-crond"><a href="#25-10-18-at-crond" class="headerlink" title="25-10-18(at&#x2F;crond)"></a>25-10-18(at&#x2F;crond)</h1><h2 id="1-计划任务理论"><a href="#1-计划任务理论" class="headerlink" title="1.计划任务理论"></a>1.计划任务理论</h2><p><strong>理论部分参考</strong> <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/02%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-计划任务"><a href="#2-计划任务" class="headerlink" title="2.计划任务"></a>2.计划任务</h2><p><strong>随课记</strong></p><blockquote><p>witch at  — 查看at命令所在目录</p><p>yum whatprovides *&#x2F;at — 查找命令由哪个软件包提供</p><p>at -V  —- 查看软件版本</p><p>yum install at -y   —- 安装at</p><p>systemctl start atd.service  — 运行at</p><p>wall 【内容】 —- 广播内容</p><p>at -l   —- 查看计划任务</p><p>at -d  — 删除计划任务</p><p>atrm [任务编号]    ——   删除计划任务</p><p>&#x2F;var&#x2F;log&#x2F;cron —-  日志文件</p><p>&#x2F;var&#x2F;spool&#x2F;at</p></blockquote><h3 id="2-1-一次性计划任务【at】"><a href="#2-1-一次性计划任务【at】" class="headerlink" title="2.1 一次性计划任务【at】"></a>2.1 一次性计划任务【at】</h3><blockquote><p><span style="color:#CC0000; font-size:1.6em;">at </span> [HH:MM]  [yyyy-mm-dd]   #设置一次性计划任务</p></blockquote><table><thead><tr><th align="center">参数</th><th>作用</th></tr></thead><tbody><tr><td align="center"><strong>-l</strong></td><td>列出系统上所有用户的at任务，等价于atq</td></tr><tr><td align="center"><strong>-d</strong></td><td>删除或取消一个任务</td></tr><tr><td align="center"><strong>-v</strong></td><td>使用时间格式，列出at任务</td></tr><tr><td align="center"><strong>-c</strong></td><td>可以列出任务之后的命令内容</td></tr><tr><td align="center"><strong>-f</strong></td><td>从文件中读取</td></tr></tbody></table><h4 id="2-1-1-实现形式"><a href="#2-1-1-实现形式" class="headerlink" title="2.1.1 实现形式"></a>2.1.1 实现形式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设定任务</span></span><br><span class="line">[root@1010 ~]# at 10;00  <span class="comment">#系统时间10点执行</span></span><br><span class="line">    warning: commands will be executed using /bin/sh</span><br><span class="line">    at&gt; wall 6666 <span class="comment"># 广播6666</span></span><br><span class="line">    at&gt; &lt;EOT&gt;   <span class="comment">#ctrl d 生成任务</span></span><br><span class="line">    job 1 at Sun Jan  5 9:59:00 2025</span><br><span class="line"><span class="comment">#at相关命令</span></span><br><span class="line">    at -l  或  atq  ---      查看任务</span><br><span class="line">    at -c [编号]  --- 查看任务具体内容</span><br><span class="line">    atrm [编号] 或 at -d [编号] ---   删除任务</span><br><span class="line"><span class="built_in">tail</span> -f /var/log/cron--- 查看系统是否执行</span><br><span class="line">或 watch -n [编号] <span class="built_in">ls</span> -l /root</span><br></pre></td></tr></table></figure><ul><li><span style="border:1px solid #330000;">计划任务保存在目录： &#x2F;var&#x2F;spool&#x2F;at</span></li><li><span style="border:1px solid #330000;">计划任务的日志：&#x2F;var&#x2F;log&#x2F;cron</span></li></ul><p><span style="color:#FF0000;">注意</span>：</p><blockquote><p>at命令的输出结果（标准输出和标准错误输出）不会显示到屏幕上 </p><p>at命令中执行的命令最好使用绝对路径，不容易报错 </p><p>过程：输入at 时间 -&gt; 回车 -&gt;输入执行的命令-&gt;ctrl+d退出at </p><p>at命令只会执行一次，时间过了就不再执行</p></blockquote><h4 id="2-1-2-时间的书写格式"><a href="#2-1-2-时间的书写格式" class="headerlink" title="2.1.2 时间的书写格式"></a>2.1.2 时间的书写格式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、指定时间</span></span><br><span class="line">am、pm   12小时制</span><br><span class="line">HH:MM   24小时制</span><br><span class="line">年月日   06122024   2024-12-06  12/06/2024   06.12.2024</span><br><span class="line">      MMDD[CC]YY  [CC]YY-MM-DD.  MM/DD/[CC]YY  DD.MM.[CC]YY  </span><br><span class="line"> [HH:MM]  [yyyy-mm-dd]  </span><br><span class="line"><span class="comment">#2、模糊时间</span></span><br><span class="line">noon（12:00）   midnight（00:00）   teatime（4pm）</span><br><span class="line"><span class="comment">#3、相对时间</span></span><br><span class="line">now +1 min  now +2 days</span><br><span class="line"><span class="comment">#要在三天后的下午4点运行作业    at 4pm + 3 days</span></span><br><span class="line"><span class="comment">#要在7月31日上午10点运行作业   at 10am Jul 31</span></span><br><span class="line"><span class="comment">#要在明天的凌晨1点运行作业     at 1am tomorrow</span></span><br></pre></td></tr></table></figure><h4 id="2-1-3-黑白名单"><a href="#2-1-3-黑白名单" class="headerlink" title="2.1.3 黑白名单"></a>2.1.3 黑白名单</h4><blockquote><p>超级用户可以在任何情况下使用这些命令。</p><p>对于其他用户，使用 at 的权限由文件 &#x2F;etc&#x2F;at.allow 和 &#x2F;etc&#x2F;at.deny 确定</p><p>​1、格式：每行一个用户名称，不允许有空白字符</p><p>​2、系统先检测at.allow,如果at.allow存在，其中的用户允许at，即使at.deny也存      在该用户也会被忽略</p><p>​3、如果at.allow不存在才检测at.deny,其中用户不允许at，剩下的用户可使用at</p><p>​4、at.allow at.deny 都不存在，只有root可用at</p></blockquote><h4 id="2-1-4-注意点"><a href="#2-1-4-注意点" class="headerlink" title="2.1.4 注意点"></a>2.1.4 注意点</h4><ul><li><span style="background:#CCFFFF;">权限：不同用户对系统的使用权限不一样，设置任务的时候，该任务的一定要在该用户的权限范围之内</span></li></ul><h3 id="2-2-周期性计划任务【crond】"><a href="#2-2-周期性计划任务【crond】" class="headerlink" title="2.2 周期性计划任务【crond】"></a>2.2 周期性计划任务【crond】</h3><h4 id="2-2-1-实现形式"><a href="#2-2-1-实现形式" class="headerlink" title="2.2.1 实现形式"></a>2.2.1 实现形式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件</span></span><br><span class="line">[root@1010 ~]# systemctl status crond.service <span class="comment">#查看服务是否启动</span></span><br><span class="line">[root@1010 ~]# rpm -ql crontabs </span><br><span class="line">/etc/cron.daily</span><br><span class="line">/etc/cron.hourly</span><br><span class="line">/etc/cron.monthly</span><br><span class="line">/etc/cron.weekly</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/sysconfig/run-parts</span><br><span class="line">/usr/bin/run-parts</span><br><span class="line">/usr/share/licenses/crontabs</span><br><span class="line">/usr/share/licenses/crontabs/COPYING</span><br><span class="line">/usr/share/man/man4/crontabs.4.gz</span><br><span class="line">/usr/share/man/man4/run-parts.4.gz</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设定任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###方法1.编辑系统的crontab 文件，由crond进程管理</span></span><br><span class="line">[root@1010 ~]# vim /etc/crontab</span><br><span class="line"></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###方法2.以用户身份添加计划任务，并以用户的身份命名的文件保存在/var/spool/cron/目录下</span></span><br><span class="line">[root@1010 ~]# crontab -e -u root(用户)</span><br><span class="line"> *  *  *  *  * <span class="built_in">ls</span> &gt; /file</span><br><span class="line"> </span><br><span class="line">[root@1010 ~]# ll /var/spool/cron/<span class="comment"># 查看任务编号及数量</span></span><br><span class="line">总用量 4</span><br><span class="line">-rw-------. 1 root root 26 10月 18 20:11 root</span><br><span class="line"></span><br><span class="line">[root@1010 ~]# <span class="built_in">cat</span> /var/spool/cron/root  <span class="comment">#查看任务内容</span></span><br><span class="line"> *  *  *  *  * <span class="built_in">ls</span> &gt; /file</span><br><span class="line"> </span><br><span class="line"><span class="comment">#crontab相关命令</span></span><br><span class="line">crontab -l列出当前用户的 crontab 文件内容。</span><br><span class="line">crontab -r删除当前用户的 crontab 文件。</span><br><span class="line">crontab -e 修改任务的执行时间和任务内容。</span><br><span class="line"><span class="comment">#可以添加 -u  来选择用户，但是要注意权限问题。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###方法3.包含为不同用户存储的不同类别的任务，系统定时任务的目录，由crond进程管理</span></span><br><span class="line"><span class="comment">#/etc/cron.d/ </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个名为 nginx_maintenance的文件，放在/etc/cron.d/目录下，可以清晰地知道该</span></span><br><span class="line"><span class="comment"># 文件是用于   nginx   服务的维护任务，并且能够快速地找到和修改相关的定时任务配置。</span></span><br><span class="line"></span><br><span class="line">[root@1010 ~]# /etc/cron.d/nginx_maintenance </span><br><span class="line"><span class="comment"># 清理旧的日志文件，每周执行一次</span></span><br><span class="line">0 2 * * 7 root /usr/local/bin/cleanup_nginx_logs.sh</span><br><span class="line"><span class="comment"># 检查配置文件的完整性，每天执行一次</span></span><br><span class="line">0 1 * * * root /usr/local/bin/check_nginx_config.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#crontab执行的每一项工作都会被记录到日志：/var/log/cron</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/cron  <span class="comment">## %需要转义</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">tail</span> -n 1 /etc/crontab </span><br><span class="line">* 10 * * *   root  <span class="built_in">echo</span> 123 &gt; <span class="string">&quot;/file1_`date +\%R`&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-2-时间书写格式"><a href="#2-2-2-时间书写格式" class="headerlink" title="2.2.2 时间书写格式"></a>2.2.2 时间书写格式</h4><p><span style="color:#FF0000;">*     *     *     *     *</span></p><p>分   时   日    月     周</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#特殊符号</span></span><br><span class="line">*：代表指定时间单位中的每一个时刻。例如，*在分钟字段中表示每分钟。</span><br><span class="line">,：用于分隔列表中的项目。例如，1,3,5 * * * * <span class="built_in">command</span> 表示每个小时的第1、3、5分钟执行命令。</span><br><span class="line">-：用于定义范围。例如，0 9-17 * * * <span class="built_in">command</span> 表示从早上9点到下午5点每小时开始时执行命令。</span><br><span class="line">/数字：用于指定步长。例如，*/15 * * * * <span class="built_in">command</span> 表示每15分钟执行一次命令。</span><br><span class="line"></span><br><span class="line">分 时 日 月 周</span><br><span class="line">*/2 */2 */2 */2 *</span><br><span class="line">* * * * */2</span><br><span class="line">* * L 1-6/2 *</span><br><span class="line">* * * * 2</span><br><span class="line">* 8 * * *  每天8点的每一分钟</span><br><span class="line">0 8 * * *  每天8：00执行</span><br><span class="line">13 0 1 * *   每月1日00：13执行</span><br><span class="line">*/2 12 * * * 每天12点每两分钟执行</span><br><span class="line">* 11,23 * * *   每天11点和23点的每一分钟都 执行</span><br><span class="line">* 1-3 * * *    每天的1点、2点、3点的每一分钟都执行</span><br><span class="line"></span><br><span class="line"><span class="comment">###特殊情况：</span></span><br><span class="line"><span class="comment">#2025年1月5日是星期日，当日期和星期冲突的时候，那么这天和这个星期都会执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###如果想在每年的2月最后一天凌晨2点执行任务</span></span><br><span class="line">* * L 2 * </span><br><span class="line"></span><br><span class="line"><span class="comment">#  anacron   能够在系统启动后自动执行定期任务，即使系统在任务预定时间未运行，任务也会在系统下次启动时执行.</span></span><br><span class="line">[root@1010 ~]# rpm -ql cronie-anacron</span><br><span class="line">/etc/anacrontab</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-3-黑白名单"><a href="#2-2-3-黑白名单" class="headerlink" title="2.2.3 黑白名单"></a>2.2.3 黑白名单</h4><p><span style="border:1px solid #330000;"> &#x2F;etc&#x2F;cron.allow </span>    <span style="border:1px solid #330000;">&#x2F;etc&#x2F;cron.deny      </span> </p><blockquote><p>cron.allow和cron.deny文件不能用于限制cron的执行；它们只限制crontab的使用。</p><p>特别是，限制访问crontab对用户的现有crontab没有影响。其工作将继续直到crontab被删除。<br>调用crontab的用户必须能够读取cron.allow和cron.deny文件。如果不是这样，那么它们就被视为不存在。</p><p>当系统中有 &#x2F;etc&#x2F;cron.allow 文件时，只有写入此文件的用户可以使用 crontab 命令，没有写入的用户不能使用crontab 命令。<br>同样，如果有此&#x2F;etc&#x2F;cron.allow文件，&#x2F;etc&#x2F;cron.deny 文件会被忽略，因为 &#x2F;etc&#x2F;cron.allow 文件的优先级更高<br>当系统中只有 &#x2F;etc&#x2F;cron.deny 文件时，写入此文件的用户不能使用 crontab 命令，没有写入文件的用户可以使用 crontab 命令</p><p>crontab 执行的每一项工作都会被 记录到 &#x2F;var&#x2F;log&#x2F;cron 这个日志文件中<br>当用户使用 crontab 新建工作之后，该项工作就会被记录到 &#x2F;var&#x2F;spool&#x2F;cron&#x2F;目录里面</p></blockquote><h4 id="2-2-4-扩展-【run-parts】"><a href="#2-2-4-扩展-【run-parts】" class="headerlink" title="2.2.4 扩展 【run-parts】"></a>2.2.4 扩展 【run-parts】</h4><blockquote><p>run-parts：该命令可将后面接的“目录”内的所有文件找出来执行。</p></blockquote><p>假设我们有一个名为 scripts 的目录，其中包含以下可执行脚本：<br>&#x2F;scripts&#x2F;<br>├── script1.sh<br>├── script2.sh<br>└── script3.sh<br>我们想要在每天的凌晨 1 点执行这些脚本。我们可以这样做：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.确保脚本有执行权限。</span></span><br><span class="line">[root@1010 ~] <span class="comment">#chmod  +x /scripts/*.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.设置周期性任务</span></span><br><span class="line">[root@1010 ~] <span class="comment"># vim /etc/crontab</span></span><br><span class="line">01 * * * *   run-parts  /scripts</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.检查</span></span><br><span class="line">[root@1010 ~] <span class="comment"># mkdir /shell</span></span><br><span class="line">[root@1010 ~] <span class="comment"># vim /shell/1.sh</span></span><br><span class="line">[root@1010 ~] <span class="comment"># vim /shell/2.sh</span></span><br><span class="line">[root@1010 ~] <span class="comment"># vim /shell/3.sh</span></span><br><span class="line">[root@1010 ~] <span class="comment"># chmod  u+x /shell/* </span></span><br><span class="line">[root@1010 ~] <span class="comment"># vim /etc/crontab</span></span><br><span class="line">* 11 * * *   root   run-parts  /shell    <span class="comment">#注意/shell 是目录</span></span><br><span class="line"><span class="comment">#日志追踪</span></span><br><span class="line">[root@1010 ~] <span class="comment"># tail -f  /var/log/cron</span></span><br></pre></td></tr></table></figure><h1 id="25-10-23-chrony"><a href="#25-10-23-chrony" class="headerlink" title="25-10-23(chrony)"></a>25-10-23(chrony)</h1><h2 id="1-ntp理论"><a href="#1-ntp理论" class="headerlink" title="1.ntp理论"></a>1.ntp理论</h2><p><strong>理论部分参考</strong>   <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/03ntp%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-ntp实验"><a href="#2-ntp实验" class="headerlink" title="2.ntp实验"></a>2.ntp实验</h2><h3 id="2-1-chrony"><a href="#2-1-chrony" class="headerlink" title="2.1.chrony"></a>2.1.chrony</h3><blockquote><p>chronyc sources  — 查看每个时间源更详细的统计信息</p><p>date  — 显示时间</p><p>chrony 的主配置文件：&#x2F;etc&#x2F;chrony.conf</p></blockquote><p><strong>概念：</strong></p><p>chrony是一个开源的自由软件，它能帮助你保持系统时钟与时钟服务器（NTP）同步，因此让你的时间保持精确。</p><h3 id="2-2-安装与查看"><a href="#2-2-安装与查看" class="headerlink" title="2.2.安装与查看"></a>2.2.安装与查看</h3><blockquote><p>yum install chrony -y# 安装</p><p>systemctl start  chronyd #启动服务</p><p>systemctl start  chronyd #重启服务</p><p>systemctl enable  chronyd#开机自启</p><p>systemctl status ntp # 查看ntp状态</p></blockquote><h4 id="2-2-1-实验1—-同步时间"><a href="#2-2-1-实验1—-同步时间" class="headerlink" title="2.2.1 实验1—-同步时间"></a>2.2.1 实验1—-同步时间</h4><p><strong>(1) 手动修改至错误时间</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# <span class="built_in">date</span> -s 8:00</span><br><span class="line">2025年 10月 23日 星期四 08:00:00 CST</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-00-36.png" alt="PixPin_2025-10-23_20-00-36"></p><p><strong>(2) 编辑配置文件</strong></p><p><strong>检查网络</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# ping ntp.aliyun.com<span class="comment">#检查是否能连通阿里云授时中心</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-04-31.png" alt="PixPin_2025-10-23_20-04-31"></p><p><strong>修改&#x2F;etc&#x2F;chrony.conf文件</strong></p><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-04-01.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# vim /etc/chrony.conf</span><br></pre></td></tr></table></figure><p><strong>(3) 重启服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# systemctl restart  chronyd</span><br><span class="line">[root@1010 ~]# systemctl status  chronyd<span class="comment">#查看服务状态</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-08-25.png" alt="PixPin_2025-10-23_20-08-25"></p><p><strong>(4) 验证</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# chronyc  sources<span class="comment"># 列出时间源  添加-v(更详细)</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-09-55.png" alt="PixPin_2025-10-23_20-09-55"></p><blockquote><p>与阿里云地址相同，同步成功</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# timedatectl   status</span><br><span class="line">[root@1010 ~]# <span class="built_in">date</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-11-04.png" alt="PixPin_2025-10-23_20-11-04"></p><h4 id="2-2-2-实验2—搭建本地时间同步服务器"><a href="#2-2-2-实验2—搭建本地时间同步服务器" class="headerlink" title="2.2.2 实验2—搭建本地时间同步服务器"></a>2.2.2 实验2—搭建本地时间同步服务器</h4><h5 id="服务端配置（192-168-232-3）"><a href="#服务端配置（192-168-232-3）" class="headerlink" title="服务端配置（192.168.232.3）"></a>服务端配置（192.168.232.3）</h5><h5 id="1-网络检查（ping客户端）"><a href="#1-网络检查（ping客户端）" class="headerlink" title="(1) 网络检查（ping客户端）"></a>(1) 网络检查（ping客户端）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# ping 192.168.232.131</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-21-49.png" alt="PixPin_2025-10-23_20-21-49"></p><h5 id="2-编辑配置文件-已安装服务"><a href="#2-编辑配置文件-已安装服务" class="headerlink" title="(2) 编辑配置文件(已安装服务)"></a>(2) 编辑配置文件(已安装服务)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# vim /etc/chrony.conf</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-19-26.png" alt="PixPin_2025-10-23_20-19-26"></p><blockquote><p>基于实验一已经配置阿里云的时间源的情况下，允许客户端同步服务端的时间源</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# systemctl restart chronyd<span class="comment">#重启服务</span></span><br></pre></td></tr></table></figure><h5 id="客户端（192-168-232-131）"><a href="#客户端（192-168-232-131）" class="headerlink" title="客户端（192.168.232.131）"></a>客户端（192.168.232.131）</h5><h5 id="1-网络检查"><a href="#1-网络检查" class="headerlink" title="(1) 网络检查"></a>(1) 网络检查</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# ping 192.168.232.3</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-25-38.png" alt="PixPin_2025-10-23_20-25-38"></p><h5 id="2-软件安装"><a href="#2-软件安装" class="headerlink" title="(2) 软件安装"></a>(2) 软件安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# yum  install  chrony  -y   </span><br><span class="line">[root@hym ~]# systemctl status  chronyd  <span class="comment"># 查看服务状态</span></span><br></pre></td></tr></table></figure><h5 id="3-配置文件（时间源改为服务端的）"><a href="#3-配置文件（时间源改为服务端的）" class="headerlink" title="(3) 配置文件（时间源改为服务端的）"></a>(3) 配置文件（时间源改为服务端的）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# vim  /etc/chrony.conf </span><br><span class="line">[root@hym ~]# systemctl restart  chronyd<span class="comment">#重启服务</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-29-40.png" alt="PixPin_2025-10-23_20-29-40"></p><h5 id="4-检查"><a href="#4-检查" class="headerlink" title="(4) 检查"></a>(4) 检查</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# chronyc  sources</span><br><span class="line">[root@1010 ~]# timedatectl   status</span><br><span class="line">[root@1010 ~]# <span class="built_in">date</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-23_20-32-31.png" alt="PixPin_2025-10-23_20-32-31"></p><h1 id="25-10-24-Nginx"><a href="#25-10-24-Nginx" class="headerlink" title="25-10-24(Nginx)"></a>25-10-24(Nginx)</h1><h2 id="1-Nginx理论"><a href="#1-Nginx理论" class="headerlink" title="1 Nginx理论"></a>1 Nginx理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/04web%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-Nginx实验"><a href="#2-Nginx实验" class="headerlink" title="2 Nginx实验"></a>2 Nginx实验</h2><p><strong>安装</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# yum install nginx -y</span><br></pre></td></tr></table></figure><p><strong>启动</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# systemctl start nginx.service</span><br></pre></td></tr></table></figure><blockquote><p>systemctl restart nginx.service 重新启动Nginx服务</p><p>systemctl status nginx.service  查看运行状态</p></blockquote><blockquote><p>核心配置：&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p></blockquote><h3 id="2-1-实验1：Nginx基础"><a href="#2-1-实验1：Nginx基础" class="headerlink" title="2.1 实验1：Nginx基础"></a>2.1 实验1：Nginx基础</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装</span></span><br><span class="line">[root@1010 ~]# yum install nginx -y</span><br><span class="line"><span class="comment">#服务启动</span></span><br><span class="line">[root@1010 ~]# systemctl start nginx.service</span><br><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line">[root@1010 ~]# systemctl --now <span class="built_in">disable</span> firewalld.service</span><br><span class="line"><span class="comment">#设置兼容模式</span></span><br><span class="line">[root@1010 ~]# setenforce 0</span><br></pre></td></tr></table></figure><blockquote><p>默认目录为&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-06-42.png" alt="PixPin_2025-10-24_23-06-42"></p><h3 id="2-2-实验2：修改端口、默认目录、默认文件访问web页面"><a href="#2-2-实验2：修改端口、默认目录、默认文件访问web页面" class="headerlink" title="2.2 实验2：修改端口、默认目录、默认文件访问web页面"></a>2.2 实验2：修改端口、默认目录、默认文件访问web页面</h3><h4 id="多端口访问同一web页面"><a href="#多端口访问同一web页面" class="headerlink" title="多端口访问同一web页面"></a>多端口访问同一web页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件(/etc/nginx/nginx.conf)</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">        listen       80;</span><br><span class="line">        listen       81;<span class="comment">#添加81端口</span></span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-12-03.png" alt="PixPin_2025-10-24_23-12-03"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启Nginx服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx.service </span><br><span class="line"><span class="comment">#防火墙</span></span><br><span class="line">[root@1010 ~]# systemctl --now <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment">#兼容模式</span></span><br><span class="line">[root@1010 ~]# setenforce 0</span><br><span class="line"><span class="comment">#监听端口</span></span><br><span class="line">[root@1010 ~]# netstat -lntup | grep nginx</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-20-52.png" alt="PixPin_2025-10-24_23-20-52"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80</span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:81</span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-42-35.png" alt="PixPin_2025-10-24_23-42-35" style="zoom: 50%;" /><h4 id="自定义默认目录"><a href="#自定义默认目录" class="headerlink" title="自定义默认目录"></a>自定义默认目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">       <span class="comment"># root         /usr/share/nginx/html;</span></span><br><span class="line">        root         /web;</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-46-53.png" alt="PixPin_2025-10-24_23-46-53"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /web</span><br><span class="line">[root@1010 ~]# systemctl restart nginx.service</span><br><span class="line">[root@1010 ~]# vim /web/index.html</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-50-09.png" alt="PixPin_2025-10-24_23-50-09"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.1//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;https://ts1.tc.mm.bing.net/th/id/R-C.987f582c510be58755c4933cda68d525?rik=C0D21hJDYvXosw&amp;riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1305%2f16%2fc4%2f20990657_1368686545122.jpg&amp;ehk=netN2qzcCVS4ALUQfDOwxAwFcy41oxC%2b0xTFvOYy5ds%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0&quot;</span>  height=<span class="string">&quot;600px&quot;</span> width=<span class="string">&quot;800px&quot;</span>&gt;</span><br><span class="line">&lt;/img&gt;</span><br><span class="line">&lt;div&gt;测试图像&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-24_23-52-31.png" alt="PixPin_2025-10-24_23-52-31" style="zoom: 67%;" /><h4 id="通过不同文件访问web页面"><a href="#通过不同文件访问web页面" class="headerlink" title="通过不同文件访问web页面"></a>通过不同文件访问web页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/default.d/web.conf</span><br><span class="line">location /html &#123;</span><br><span class="line">  root /web;</span><br><span class="line">  index 1.html;</span><br><span class="line">  error_log /web/error/web_error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /web</span><br><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /web/html</span><br><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /web/error</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;/web/html  mulu xia&#x27;</span> &gt; /web/html/1.html</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看目录结构</span></span><br><span class="line">[root@1010 ~]# tree /web</span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_11-25-24.png" alt="PixPin_2025-10-25_11-25-24" style="zoom: 150%;" /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3/html/</span><br><span class="line">/web/html  mulu xia</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_11-19-53.png" alt="PixPin_2025-10-25_11-19-53"></p><h3 id="3-3-实验三：基于不同端口-目录、IP、域名-访问不同页面"><a href="#3-3-实验三：基于不同端口-目录、IP、域名-访问不同页面" class="headerlink" title="3.3 实验三：基于不同端口(目录、IP、域名)访问不同页面"></a>3.3 实验三：基于不同端口(目录、IP、域名)访问不同页面</h3><h4 id="3-3-1-基于不同端口访问不同页面"><a href="#3-3-1-基于不同端口访问不同页面" class="headerlink" title="3.3.1 基于不同端口访问不同页面"></a>3.3.1 基于不同端口访问不同页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1：(不覆盖主配置root)</span></span><br><span class="line"><span class="comment">#配置编辑文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/port.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  location / &#123;</span><br><span class="line">    index port80.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 81;</span><br><span class="line">  location / &#123;</span><br><span class="line">    index port81.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#创建对应html</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">cd</span> /usr/share/nginx/html/</span><br><span class="line">[root@1010 html]# <span class="built_in">echo</span> <span class="string">&quot;This is port 80&quot;</span> &gt; port80.html</span><br><span class="line">[root@1010 html]# <span class="built_in">echo</span> <span class="string">&quot;This is port 81&quot;</span> &gt; port81.html</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80</span><br><span class="line">This is port 80</span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:81</span><br><span class="line">This is port 81</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_15-18-27.png" alt="PixPin_2025-10-25_15-18-27"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法2：(设置root参数覆盖主配置文件)</span></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/port.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root /web;</span><br><span class="line">    index port80.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 81;</span><br><span class="line">  location / &#123;</span><br><span class="line">    root /web;</span><br><span class="line">    index port81.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#创建对应html</span></span><br><span class="line">[root@1010 web]# <span class="built_in">echo</span> <span class="string">&#x27;This is /web 80&#x27;</span> &gt; port80.html</span><br><span class="line">[root@1010 web]# <span class="built_in">echo</span> <span class="string">&#x27;This is /web 81&#x27;</span> &gt; port81.html</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80</span><br><span class="line">This is /web 80</span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:81</span><br><span class="line">This is /web 81</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_15-13-30.png" alt="PixPin_2025-10-25_15-13-30"></p><h4 id="3-3-2-基于不同目录访问不同页面"><a href="#3-3-2-基于不同目录访问不同页面" class="headerlink" title="3.3.2 基于不同目录访问不同页面"></a>3.3.2 基于不同目录访问不同页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/dir.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 82;</span><br><span class="line">  root /web;</span><br><span class="line">  location /dir1 &#123;</span><br><span class="line">    index index1.html;</span><br><span class="line">  &#125;</span><br><span class="line">  location /dir2 &#123;</span><br><span class="line">    index index2.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#创建文件</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /web/dir1 /web/dir2</span><br><span class="line">[root@1010 ~]# tree /web</span><br><span class="line">/web</span><br><span class="line">├── dir1</span><br><span class="line">├── dir2</span><br><span class="line">├── error</span><br><span class="line">│   └── web_error.log</span><br><span class="line">├── html</span><br><span class="line">│   └── 1.html</span><br><span class="line">├── index.html</span><br><span class="line">├── port80.html</span><br><span class="line">└── port81.html</span><br><span class="line"></span><br><span class="line">4 directories, 5 files</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;location ---&gt; /web/dir1 &#x27;</span> &gt; /web/dir1/index1.html</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;location ---&gt; /web/dir2 &#x27;</span> &gt; /web/dir2/index2.html</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:82/dir1/</span><br><span class="line">location ---&gt; /web/dir1 </span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:82/dir2/</span><br><span class="line">location ---&gt; /web/dir2</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_15-41-01.png" alt="PixPin_2025-10-25_15-41-01"></p><blockquote><p>root &#x2F;web 可放在location外面或里面；</p></blockquote><h4 id="3-3-3-基于不同IP访问不同页面"><a href="#3-3-3-基于不同IP访问不同页面" class="headerlink" title="3.3.3 基于不同IP访问不同页面"></a>3.3.3 基于不同IP访问不同页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加IP并激活</span></span><br><span class="line">[root@1010 ~]#nmtui</span><br><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/ip.con</span><br><span class="line">server&#123;</span><br><span class="line">  listen 192.168.232.3:83;</span><br><span class="line">  root /web;</span><br><span class="line">  location /dir1 &#123;</span><br><span class="line">    index index1.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">  listen 192.168.232.4:83;</span><br><span class="line">  root /web;</span><br><span class="line">  location /dir2 &#123;</span><br><span class="line">    index index2.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#创建目录与html文件</span></span><br><span class="line"><span class="comment">#延续上面实验的目录，不再重新创建</span></span><br><span class="line"><span class="comment">#修改html内容</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;192.168.232.3:83 location ---&gt; /web/dir1 &#x27;</span> &gt; /web/dir1/index1.html</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;192.168.232.4:83 location ---&gt; /web/dir2 &#x27;</span> &gt; /web/dir2/index2.html</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:83/dir1/</span><br><span class="line">192.168.232.3:83 location ---&gt; /web/dir1 </span><br><span class="line">[root@1010 ~]# curl 192.168.232.4:83/dir2/</span><br><span class="line">192.168.232.4:83 location ---&gt; /web/dir2</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_15-54-22.png" alt="PixPin_2025-10-25_15-54-22"></p><h4 id="3-3-4-基于不同域名访问不同页面"><a href="#3-3-4-基于不同域名访问不同页面" class="headerlink" title="3.3.4 基于不同域名访问不同页面"></a>3.3.4 基于不同域名访问不同页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]#  vim /etc/nginx/conf.d/www.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 84;</span><br><span class="line">  root /web;</span><br><span class="line">  server_name hym.com;</span><br><span class="line">  location /dir1 &#123;</span><br><span class="line">    index index3.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen 84;</span><br><span class="line">  root /web;</span><br><span class="line">  server_name hym.cn;</span><br><span class="line">  location /dir2 &#123;</span><br><span class="line">    index index4.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#创建html</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;hym.com ---&gt; dir1/&#x27;</span> &gt; /web/dir1/index3.html</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&#x27;hym.cn ---&gt; dir2/&#x27;</span> &gt; /web/dir2/index4.html</span><br><span class="line"><span class="comment">#域名映射</span></span><br><span class="line"><span class="comment">#liunx</span></span><br><span class="line">[root@1010 ~]# vim /etc/hosts</span><br><span class="line">192.168.232.3 hym.com hym.cn</span><br><span class="line"><span class="comment">#windows</span></span><br><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl hym.com:84/dir1/</span><br><span class="line">hym.com ---&gt; dir1/</span><br><span class="line">[root@1010 ~]# curl hym.cn:84/dir2/</span><br><span class="line">hym.cn ---&gt; dir2/</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-25_16-30-39.png" alt="PixPin_2025-10-25_16-30-39"></p><h1 id="25-10-29-Web"><a href="#25-10-29-Web" class="headerlink" title="25-10-29(Web)"></a>25-10-29(Web)</h1><h2 id="1-Web理论"><a href="#1-Web理论" class="headerlink" title="1.Web理论"></a>1.Web理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/04web%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-Web实验："><a href="#2-Web实验：" class="headerlink" title="2.Web实验："></a>2.Web实验：</h2><h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1.安装"></a>2.1.安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# dnf install httpd-tools-2.4.57-5.el9.x86_64</span><br></pre></td></tr></table></figure><h3 id="2-2-访问控制"><a href="#2-2-访问控制" class="headerlink" title="2.2.访问控制"></a>2.2.访问控制</h3><h4 id="2-2-1-基于不同用户的访问控制访问同一页面"><a href="#2-2-1-基于不同用户的访问控制访问同一页面" class="headerlink" title="2.2.1.基于不同用户的访问控制访问同一页面"></a>2.2.1.基于不同用户的访问控制访问同一页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建访问用户</span></span><br><span class="line">[root@1010 ~]# htpasswd -cb /etc/nginx/conf.d/auth_passwd hua1 passwd</span><br><span class="line">Adding password <span class="keyword">for</span> user hua1</span><br><span class="line">[root@1010 ~]# htpasswd -b /etc/nginx/conf.d/auth_passwd hua2 passwd</span><br><span class="line">Adding password <span class="keyword">for</span> user hua2</span><br><span class="line">[root@1010 ~]# <span class="built_in">cat</span>  /etc/nginx/conf.d/auth_passwd</span><br><span class="line">hua1:$apr1$abKnNyKn<span class="variable">$t4P9lZdmWRurMgmzASRn60</span></span><br><span class="line">hua2:$apr1$hS73hLM8<span class="variable">$z8YEsjzZdRpLfocEJ5KXh</span>.</span><br><span class="line"><span class="comment">#配置基本文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/access.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 192.168.232.3:80;</span><br><span class="line">        root /web;</span><br><span class="line">        location / &#123;</span><br><span class="line">                auth_basic on;</span><br><span class="line">                auth_basic_user_file /etc/nginx/conf.d/auth_passwd;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 192.168.232.4:80;</span><br><span class="line">        root /web;</span><br><span class="line">        location / &#123;</span><br><span class="line">                auth_basic on;</span><br><span class="line">                auth_basic_user_file /etc/nginx/conf.d/auth_passwd;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-23-33.png" alt="PixPin_2025-10-29_20-23-33" style="zoom: 80%;" /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80 -u hua1</span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80 -u hua2</span><br></pre></td></tr></table></figure><p> （本机）</p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-27-30.png" alt="PixPin_2025-10-29_20-27-30" style="zoom: 80%;" /><p> （浏览器）</p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-28-25.png" alt="PixPin_2025-10-29_20-28-25" style="zoom:80%;" /> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-28-32.png" alt="PixPin_2025-10-29_20-28-32" style="zoom:80%;" /><h4 id="2-2-2-基于不同的用户认证访问-不同的页面"><a href="#2-2-2-基于不同的用户认证访问-不同的页面" class="headerlink" title="2.2.2.基于不同的用户认证访问 不同的页面"></a>2.2.2.基于不同的用户认证访问 不同的页面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[root@1010 ~]# tree /web</span><br><span class="line">/web</span><br><span class="line">├── access</span><br><span class="line">│   └── access.html</span><br><span class="line">├── dir1</span><br><span class="line">│   ├── index1.html</span><br><span class="line">│   └── index3.html</span><br><span class="line">├── dir2</span><br><span class="line">│   ├── index2.html</span><br><span class="line">│   └── index4.html</span><br><span class="line">├── error</span><br><span class="line">│   └── web_error.log</span><br><span class="line">├── html</span><br><span class="line">│   └── 1.html</span><br><span class="line">├── index.html</span><br><span class="line">├── port80.html</span><br><span class="line">└── port81.html</span><br><span class="line"></span><br><span class="line">5 directories, 10 files</span><br><span class="line"></span><br><span class="line">[root@1010 ~]#  htpasswd -cb /etc/nginx/conf.d/auth_passwd1 hua3 passwd</span><br><span class="line">Adding password <span class="keyword">for</span> user hua3</span><br><span class="line">[root@1010 ~]# tree /etc/nginx/conf.d/</span><br><span class="line">/etc/nginx/conf.d/</span><br><span class="line">├── access.conf</span><br><span class="line">├── auth_passwd</span><br><span class="line">├── auth_passwd1</span><br><span class="line">├── dir.conf</span><br><span class="line">├── ip.conf</span><br><span class="line">├── port.conf</span><br><span class="line">└── www.conf</span><br><span class="line"></span><br><span class="line">0 directories, 7 files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/access.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 192.168.232.3:80;</span><br><span class="line">        root /web;</span><br><span class="line">        location / &#123;</span><br><span class="line">                auth_basic on;</span><br><span class="line">                auth_basic_user_file /etc/nginx/conf.d/auth_passwd;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 192.168.232.4:80;</span><br><span class="line">        root /web;</span><br><span class="line">        location /html &#123;</span><br><span class="line">                auth_basic on;</span><br><span class="line">                auth_basic_user_file /etc/nginx/conf.d/auth_passwd1;</span><br><span class="line">                index 1.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80 -u hua2</span><br><span class="line">Enter host password <span class="keyword">for</span> user <span class="string">&#x27;hua2&#x27;</span>:</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.1//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span><br><span class="line">&lt;img src=<span class="string">&quot;https://ts1.tc.mm.bing.net/th/id/R-C.987f582c510be58755c4933cda68d525?rik=C0D21hJDYvXosw&amp;riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1305%2f16%2fc4%2f20990657_1368686545122.jpg&amp;ehk=netN2qzcCVS4ALUQfDOwxAwFcy41oxC%2b0xTFvOYy5ds%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0&quot;</span>  height=<span class="string">&quot;600px&quot;</span> width=<span class="string">&quot;800px&quot;</span>&gt;</span><br><span class="line">&lt;/img&gt;</span><br><span class="line">&lt;div&gt;测试图像&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@1010 ~]# curl 192.168.232.4:80/html/ -u hua3</span><br><span class="line">Enter host password <span class="keyword">for</span> user <span class="string">&#x27;hua3&#x27;</span>:</span><br><span class="line">/web/html  mulu xia</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p> （本机）</p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-43-33.png" alt="PixPin_2025-10-29_20-43-33" style="zoom:80%;" /><p> （浏览器）</p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-44-03.png" alt="PixPin_2025-10-29_20-44-03" style="zoom:80%;" /><h4 id="2-2-3-基于源ip的访问控制"><a href="#2-2-3-基于源ip的访问控制" class="headerlink" title="2.2.3 基于源ip的访问控制"></a>2.2.3 基于源ip的访问控制</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/nginx/conf.d/access.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 192.168.232.3:80;</span><br><span class="line">        root /web;</span><br><span class="line">        location / &#123;</span><br><span class="line">                allow 192.168.232.1;</span><br><span class="line">                deny all;</span><br><span class="line"><span class="comment">#               auth_basic on;</span></span><br><span class="line"><span class="comment">#               auth_basic_user_file /etc/nginx/conf.d/auth_passwd;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-47-35.png" alt="PixPin_2025-10-29_20-47-35"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart nginx</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# curl 192.168.232.3:80</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.20.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-48-39.png" alt="PixPin_2025-10-29_20-48-39" style="zoom:80%;" /><h3 id="2-3-https"><a href="#2-3-https" class="headerlink" title="2.3 https"></a>2.3 https</h3><h4 id="2-3-1-搭建nginx-ssl的加密认证web服务器"><a href="#2-3-1-搭建nginx-ssl的加密认证web服务器" class="headerlink" title="2.3.1 搭建nginx+ssl的加密认证web服务器"></a>2.3.1 搭建nginx+ssl的加密认证web服务器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建私钥</span></span><br><span class="line">[root@1010 ~]# openssl genrsa -out /web/https/1.key</span><br><span class="line"><span class="comment">#基于私玥创建证书</span></span><br><span class="line">[root@1010 ~]# openssl req -utf8 -new -key /web/https/1.key -x509 -days 100 -out /web/https/ssl.crt</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:HuNan </span><br><span class="line">Locality Name (eg, city) [Default City]:Changsha</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:www.hym.com</span></span><br><span class="line"><span class="string">Email Address []:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#编辑配置文件</span></span><br><span class="line"><span class="string">[root@1010 ~]# vim /etc/nginx/conf.d/openss.conf</span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">        listen 192.168.232.3:443 ssl ;</span></span><br><span class="line"><span class="string">        root /web ;</span></span><br><span class="line"><span class="string">        ssl_certificate &quot;/web/https/ssl.crt&quot;;</span></span><br><span class="line"><span class="string">        ssl_certificate_key &quot;/web/https/1.key&quot;;</span></span><br><span class="line"><span class="string">        location / &#123;</span></span><br><span class="line"><span class="string">        index index.html;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">#重启服务</span></span><br><span class="line"><span class="string">[root@1010 ~]# systemctl restart nginx</span></span><br><span class="line"><span class="string">#测试</span></span><br></pre></td></tr></table></figure> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_20-59-57.png" alt="PixPin_2025-10-29_20-59-57" style="zoom:80%;" /> <img src="https://b5dbf24.webp.li/PixPin_2025-10-29_21-00-08.png" alt="PixPin_2025-10-29_21-00-08" style="zoom:80%;" /><h1 id="25-10-31-DNS"><a href="#25-10-31-DNS" class="headerlink" title="25-10-31(DNS)"></a>25-10-31(DNS)</h1><h2 id="1-DNS理论"><a href="#1-DNS理论" class="headerlink" title="1.DNS理论"></a>1.DNS理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/05dns%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-DNF实验"><a href="#2-DNF实验" class="headerlink" title="2.DNF实验"></a>2.DNF实验</h2><h3 id="2-1-安装-1"><a href="#2-1-安装-1" class="headerlink" title="2.1.安装"></a>2.1.安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询软件包名</span></span><br><span class="line">[root@1010 ~]# dnf search name DNS</span><br><span class="line">[root@1010 ~]# dnf install <span class="built_in">bind</span> bind-utils -y</span><br></pre></td></tr></table></figure><h3 id="2-2-正向解析"><a href="#2-2-正向解析" class="headerlink" title="2.2.正向解析"></a>2.2.正向解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改核心配置文件 /etc/named.conf</span></span><br><span class="line">[root@1010 ~]# vim /etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; any; &#125;;</span><br><span class="line">        directory       <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> hint;</span><br><span class="line">        file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">include <span class="string">&quot;/etc/named.root.key&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_17-33-15.png" alt="PixPin_2025-11-05_17-33-15"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置</span></span><br><span class="line">[root@1010 ~]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone <span class="string">&quot;hym.com&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;hym.com.zone&quot;</span>;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">#创建数据文件，存储dns记录</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">cd</span> /var/named/</span><br><span class="line">[root@1010 ~]# <span class="built_in">cp</span>  -a   named.localhost hym.com.zone </span><br><span class="line">[root@1010 ~]# vim hym.com.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  ns.hym.com.  admin.hym.com. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      ns.hym.com.</span><br><span class="line">ns      A       192.168.232.3</span><br><span class="line">www     A       192.168.232.4</span><br><span class="line">blog    CNAME      www.hym.com</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_18-24-13.png" alt="PixPin_2025-11-05_18-24-13"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#添加新IP</span><br><span class="line">nmcli connection modify ens160 +ipv4.addresses 172.25.0.100/24</span><br><span class="line">nmcli connection down ens160</span><br><span class="line">nmcli connection up ens160</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 ~]# systemctl restart named</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# host www.hym.com 192.168.232.3</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.3</span><br><span class="line">Address: 192.168.232.3#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">www.hym.com has address 192.168.232.4</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_19-14-46.png" alt="PixPin_2025-11-05_19-14-46"></p><h3 id="2-3-反向解析"><a href="#2-3-反向解析" class="headerlink" title="2.3.反向解析"></a>2.3.反向解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改区域配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/named.rfc1912.zones</span><br><span class="line">zone <span class="string">&quot;232.168.192.in-addr.arpa&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;192.168.232.zone&quot;</span>;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_19-27-14.png" alt="PixPin_2025-11-05_19-27-14"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑数据文件</span></span><br><span class="line">[root@1010 named]# <span class="built_in">cd</span> /var/named/</span><br><span class="line">[root@1010 named]# <span class="built_in">cp</span> -a named.loopback 192.168.232.zone</span><br><span class="line">[root@1010 named]# vim 192.168.232.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  ns2.hym.com.  admin.hym.com. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">                NS      ns2.hym.com.</span><br><span class="line">                </span><br><span class="line">4               PTR     ns2.hym.com.</span><br><span class="line">5               PTR     xixi.hym.com.</span><br><span class="line">6               PTR     haha.hym.com.</span><br><span class="line">7               PTR     huhu.hym.com.</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_19-25-59.png" alt="PixPin_2025-11-05_19-25-59"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@1010 named]# systemctl restart named</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 named]# host 192.168.232.6 192.168.232.4</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.4</span><br><span class="line">Address: 192.168.232.4#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">6.232.168.192.in-addr.arpa domain name pointer haha.hym.com.</span><br><span class="line">[root@1010 named]# host 192.168.232.5 192.168.232.4</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.4</span><br><span class="line">Address: 192.168.232.4#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">5.232.168.192.in-addr.arpa domain name pointer xixi.hym.com.</span><br><span class="line">[root@1010 named]# host 192.168.232.7 192.168.232.4</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.4</span><br><span class="line">Address: 192.168.232.4#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">7.232.168.192.in-addr.arpa domain name pointer huhu.hym.com.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-05_19-25-07.png" alt="PixPin_2025-11-05_19-25-07"></p><h3 id="2-4-主从同步"><a href="#2-4-主从同步" class="headerlink" title="2.4.主从同步"></a>2.4.主从同步</h3><h4 id="2-4-1-完全同步"><a href="#2-4-1-完全同步" class="headerlink" title="2.4.1.完全同步"></a>2.4.1.完全同步</h4><blockquote><p>主：192.168.232.133       从：192.168.232.3</p></blockquote><p><strong>前置：关闭防火墙，调至宽容模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl --now <span class="built_in">disable</span> firewalld</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><p><strong>修改配置文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主机</span></span><br><span class="line">[root@hym ~]# vim /etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; any; &#125;;</span><br><span class="line">        directory <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">allow-transfer &#123; 192.168.232.3; &#125;;<span class="comment">#允许从机转移dns记录</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> hint;</span><br><span class="line">        file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line">zone <span class="string">&quot;hym.com.&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;hym.com.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;232.168.192.in-addr.arpa&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;192.168.232.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line">include <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">include <span class="string">&quot;/etc/named.root.key&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#从机</span></span><br><span class="line">[root@1010 ~]# vim /etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">listen-on port 53 &#123; any; &#125;;</span><br><span class="line">directory <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">allow-query     &#123; any; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line"><span class="built_in">type</span> hint;</span><br><span class="line">file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">#########################################</span></span><br><span class="line">zone <span class="string">&quot;hym.com.&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> slave;</span><br><span class="line">masters &#123; 192.168.232.133; &#125;;<span class="comment">#主</span></span><br><span class="line">        file <span class="string">&quot;slaves/hym.com.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;232.168.192.in-addr.arpa&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> slave;</span><br><span class="line">        masters &#123; 192.168.232.133; &#125;;<span class="comment">#主</span></span><br><span class="line">        file <span class="string">&quot;slaves/192.168.232.zone&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line">include <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">include <span class="string">&quot;/etc/named.root.key&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>创建数据文件（主机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# vim /var/named/hym.com.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  ns.hym.com. admin.hym.com. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      ns.hym.com.</span><br><span class="line"></span><br><span class="line">ns      A       192.168.232.133</span><br><span class="line">ns2     A       192.168.232.134</span><br><span class="line">www     A       192.168.232.135</span><br><span class="line">xixi    A       192.168.232.136</span><br><span class="line">blog    CNAME   www.hym.com.</span><br><span class="line"></span><br><span class="line">[root@hym ~]# vim /var/named/192.168.232.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  ns2.hym.com.  admin.hym.com. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      ns2.hym.com.</span><br><span class="line">133     PTR     ns.hym.com.</span><br><span class="line">134     PTR     ns2.hym.com.</span><br><span class="line">135     PTR     www.hym.com.</span><br><span class="line">136     PTR     xixi.hym.com.</span><br><span class="line">137     PTR     haha.hym.com.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>重启服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主</span></span><br><span class="line">[root@hym ~]# systemctl restart named</span><br><span class="line"><span class="comment">#从</span></span><br><span class="line">[root@1010 ~]# systemctl restart named</span><br></pre></td></tr></table></figure><p><strong>测试（从机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看文件变化</span></span><br><span class="line">[root@1010 ~]# tree /var/named/</span><br><span class="line">/var/named/</span><br><span class="line">├── 192.168.232.zone</span><br><span class="line">├── data</span><br><span class="line">│   └── named.run</span><br><span class="line">├── dynamic</span><br><span class="line">│   ├── managed-keys.bind</span><br><span class="line">│   └── managed-keys.bind.jnl</span><br><span class="line">├── hym.com.zone</span><br><span class="line">├── named.ca</span><br><span class="line">├── named.empty</span><br><span class="line">├── named.localhost</span><br><span class="line">├── named.loopback</span><br><span class="line">└── slaves</span><br><span class="line">    ├── 192.168.232.zone</span><br><span class="line">    └── hym.com.zone</span><br><span class="line"></span><br><span class="line">3 directories, 11 files</span><br><span class="line"><span class="comment">#使用host测试</span></span><br><span class="line">[root@1010 ~]# host 192.168.232.136 192.168.232.3</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.3</span><br><span class="line">Address: 192.168.232.3#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">136.232.168.192.in-addr.arpa domain name pointer xixi.hym.com.</span><br><span class="line">[root@1010 ~]# host xixi.hym.com 192.168.232.3</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.3</span><br><span class="line">Address: 192.168.232.3#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">xixi.hym.com has address 192.168.232.136</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-06_17-49-24.png" alt="PixPin_2025-11-06_17-49-24"></p><h4 id="2-4-2-增量同步（正反向解析同理）"><a href="#2-4-2-增量同步（正反向解析同理）" class="headerlink" title="2.4.2.增量同步（正反向解析同理）"></a>2.4.2.增量同步（正反向解析同理）</h4><p><strong>添加记录（主机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# vim /var/named/hym.com.zone</span><br><span class="line">haha    A       192.168.232.137 ;新增加</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-06_16-17-04.png" alt="PixPin_2025-11-06_16-17-04"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@hym ~]# systemctl restart named</span><br></pre></td></tr></table></figure><p><strong>进行增量同步并测试（从机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#同步</span></span><br><span class="line">[root@1010 ~]# rndc refresh hym.com.</span><br><span class="line">zone refresh queued</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# host haha.hym.com 192.168.232.3</span><br><span class="line">Using domain server:</span><br><span class="line">Name: 192.168.232.3</span><br><span class="line">Address: 192.168.232.3#53</span><br><span class="line">Aliases: </span><br><span class="line"></span><br><span class="line">haha.hym.com has address 192.168.232.137</span><br></pre></td></tr></table></figure><p> <img src="https://b5dbf24.webp.li/PixPin_2025-11-06_16-18-59.png" alt="PixPin_2025-11-06_16-18-59"></p><h1 id="25-11-6-NFS"><a href="#25-11-6-NFS" class="headerlink" title="25-11-6(NFS)"></a>25-11-6(NFS)</h1><h2 id="1-NFS理论"><a href="#1-NFS理论" class="headerlink" title="1.NFS理论"></a>1.NFS理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/06nfs%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-NFS实验"><a href="#2-NFS实验" class="headerlink" title="2.NFS实验"></a>2.NFS实验</h2><h3 id="2-1-安装-两端"><a href="#2-1-安装-两端" class="headerlink" title="2.1.安装(两端)"></a>2.1.安装(两端)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# dnf install nfs-utils rpcbind -y</span><br></pre></td></tr></table></figure><h3 id="2-2-服务端配置"><a href="#2-2-服务端配置" class="headerlink" title="2.2.服务端配置"></a>2.2.服务端配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@hym ~]# vim /etc/exports</span><br><span class="line">/server/dir1    *(rw,root_squash)</span><br><span class="line">/server/dir2    *(rw,all_squash,anonuid=10000,anongid=10000)</span><br><span class="line"><span class="comment">#创建对应目录</span></span><br><span class="line">[root@hym ~]# <span class="built_in">mkdir</span> /server</span><br><span class="line">[root@hym ~]# <span class="built_in">mkdir</span> /server/dir&#123;1,2&#125;</span><br><span class="line">[root@hym ~]# tree /server/</span><br><span class="line">/server/</span><br><span class="line">├── dir1</span><br><span class="line">└── dir2</span><br><span class="line"><span class="comment">#给予权限</span></span><br><span class="line">[root@hym ~]# <span class="built_in">chmod</span> 755 -R /server/</span><br><span class="line"><span class="comment">#根据配置文件进行补充，比如用户权限</span></span><br><span class="line">[root@hym ~]# useradd -u 10000 hym</span><br><span class="line">[root@hym ~]# <span class="built_in">id</span> hym</span><br><span class="line">用户<span class="built_in">id</span>=10000(hym) 组<span class="built_in">id</span>=10000(hym) 组=10000(hym)</span><br><span class="line">[root@hym ~]# setfacl -m u:hym:rwx /server/dir2</span><br><span class="line"><span class="comment">#导出</span></span><br><span class="line">[root@hym ~]# exportfs -ar</span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">[root@hym ~]# systemctl start nfs-server</span><br><span class="line"><span class="comment">#验证共享配置</span></span><br><span class="line">[root@hym ~]# showmount -e localhost</span><br><span class="line">Export list <span class="keyword">for</span> localhost:</span><br><span class="line">/server/dir2 *</span><br><span class="line">/server/dir1 *</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_23-09-50.png" alt="PixPin_2025-11-06_23-09-50"></p><h3 id="2-3-客户端配置"><a href="#2-3-客户端配置" class="headerlink" title="2.3.客户端配置"></a>2.3.客户端配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试服务端共享</span></span><br><span class="line">[root@1010 ~]# showmount -e 192.168.232.133</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.232.133:</span><br><span class="line">/server/dir2 *</span><br><span class="line">/server/dir1 *</span><br><span class="line"><span class="comment">#创建本地挂载点</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /bendi</span><br><span class="line">[root@1010 ~]# <span class="built_in">mkdir</span> /bendi/dir&#123;1,2&#125;</span><br><span class="line">[root@1010 ~]# tree /bendi/</span><br><span class="line">/bendi/</span><br><span class="line">├── dir1</span><br><span class="line">└── dir2</span><br><span class="line"><span class="comment">#挂载</span></span><br><span class="line">[root@1010 ~]# mount -t nfs 192.168.232.133:/server/dir1 /bendi/dir1</span><br><span class="line">[root@1010 ~]# mount -t nfs 192.168.232.133:/server/dir2 /bendi/dir2</span><br><span class="line"><span class="comment">#查看挂载状态</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">df</span> -h</span><br><span class="line">文件系统                      容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                      4.0M     0  4.0M    0% /dev</span><br><span class="line">tmpfs                         866M     0  866M    0% /dev/shm</span><br><span class="line">tmpfs                         347M  5.1M  342M    2% /run</span><br><span class="line">/dev/mapper/rhel-root          17G  1.7G   15G   11% /</span><br><span class="line">/dev/nvme0n1p2                960M  217M  744M   23% /boot</span><br><span class="line">/dev/nvme0n1p1                599M  7.0M  592M    2% /boot/efi</span><br><span class="line">/dev/sr0                      9.9G  9.9G     0  100% /mnt</span><br><span class="line">tmpfs                         174M     0  174M    0% /run/user/0</span><br><span class="line">192.168.232.133:/server/dir1   17G  1.7G   15G   11% /bendi/dir1</span><br><span class="line">192.168.232.133:/server/dir2   17G  1.7G   15G   11% /bendi/dir2</span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&quot;dir1&quot;</span> &gt; /bendi/dir1/test.txt</span><br><span class="line">-bash: /bendi/dir1/test.txt: 权限不够</span><br><span class="line">[root@1010 ~]# ll -d /bendi/dir1</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 21:53 /bendi/dir1</span><br><span class="line">[root@1010 ~]# <span class="built_in">echo</span> <span class="string">&quot;dir2&quot;</span> &gt; /bendi/dir2/test.txt</span><br><span class="line">[root@1010 ~]# ll /bendi/dir2/test.txt </span><br><span class="line">-rw-r--r--. 1 10000 10000 5 11月  6 21:48 /bendi/dir2/test.txt</span><br><span class="line"><span class="comment">####dir1的权限不足，只能查看，dir2的权限给了rw所以客户端能够创建文件</span></span><br><span class="line"><span class="comment">####dir1的权限为可读，dir2目录hym用户权限为可读可写</span></span><br><span class="line"><span class="comment">###dir1需要写权限时，可在服务端修改对应目录权限</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_22-16-46.png" alt="PixPin_2025-11-06_22-16-46"></p><h3 id="2-4-开机挂载"><a href="#2-4-开机挂载" class="headerlink" title="2.4.开机挂载"></a>2.4.开机挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/fstab</span><br><span class="line">192.168.232.133:/server/dir1  /bendi/dir1       nfs     defaults        0 0</span><br><span class="line">192.168.232.133:/server/dir2  /bendi/dir2       nfs     defaults        0 0</span><br><span class="line"><span class="comment">#立即生效</span></span><br><span class="line">[root@1010 ~]# mount -a</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_22-49-25.png" alt="PixPin_2025-11-06_22-49-25"></p><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_22-49-12.png" alt="PixPin_2025-11-06_22-49-12"></p><h3 id="2-5-动态挂载-无进程时会自动卸载"><a href="#2-5-动态挂载-无进程时会自动卸载" class="headerlink" title="2.5.动态挂载(无进程时会自动卸载)"></a>2.5.动态挂载(无进程时会自动卸载)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#客户端安装 autofs</span></span><br><span class="line">[root@1010 ~]# yum install autofs -y</span><br><span class="line"><span class="comment">#编辑主配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/auto.misc</span><br><span class="line">/nfs_auto       /etc/auto.misc</span><br><span class="line"><span class="comment">#编辑子配置文件</span></span><br><span class="line">[root@1010 ~]# vim /etc/auto.misc</span><br><span class="line">dir1            -fstype=nfs 192.168.232.133:/server/dir1</span><br><span class="line">dir2            -fstype=nfs 192.168.232.133:/server/dir2</span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">[root@1010 ~]# systemctl start autofs</span><br><span class="line"><span class="comment">#访问挂载点实现动态挂载</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">ls</span> /nfs_auto/dir1</span><br><span class="line">hy</span><br><span class="line">[root@1010 ~]# <span class="built_in">ls</span> /nfs_auto/dir2</span><br><span class="line">test.txt</span><br><span class="line"><span class="comment">#查看挂载状态</span></span><br><span class="line">[root@1010 ~]# <span class="built_in">df</span> -h</span><br><span class="line">文件系统                      容量  已用  可用 已用% 挂载点</span><br><span class="line">devtmpfs                      4.0M     0  4.0M    0% /dev</span><br><span class="line">tmpfs                         866M     0  866M    0% /dev/shm</span><br><span class="line">tmpfs                         347M  6.5M  340M    2% /run</span><br><span class="line">/dev/mapper/rhel-root          17G  1.7G   15G   11% /</span><br><span class="line">/dev/nvme0n1p2                960M  217M  744M   23% /boot</span><br><span class="line">/dev/nvme0n1p1                599M  7.0M  592M    2% /boot/efi</span><br><span class="line">/dev/sr0                      9.9G  9.9G     0  100% /mnt</span><br><span class="line">tmpfs                         174M     0  174M    0% /run/user/0</span><br><span class="line">192.168.232.133:/server/dir1   17G  1.7G   15G   11% /bendi/dir1</span><br><span class="line">192.168.232.133:/server/dir2   17G  1.7G   15G   11% /bendi/dir2</span><br><span class="line">192.168.232.133:/server/dir1   17G  1.7G   15G   11% /nfs_auto/dir1</span><br><span class="line">192.168.232.133:/server/dir2   17G  1.7G   15G   11% /nfs_auto/dir2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_22-57-35.png" alt="PixPin_2025-11-06_22-57-35"></p><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_22-59-45.png" alt="PixPin_2025-11-06_22-59-45"></p><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_23-02-31.png" alt="PixPin_2025-11-06_23-02-31"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改卸载时间(默认300s)</span></span><br><span class="line">[root@1010 ~]# vim /etc/autofs.conf</span><br><span class="line"><span class="built_in">timeout</span> = 300</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-06_23-07-52.png" alt="PixPin_2025-11-06_23-07-52"></p><h1 id="25-11-13-SELiunx"><a href="#25-11-13-SELiunx" class="headerlink" title="25-11-13(SELiunx)"></a>25-11-13(SELiunx)</h1><h2 id="1-SELiunx理论"><a href="#1-SELiunx理论" class="headerlink" title="1.SELiunx理论"></a>1.SELiunx理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/07SeLinux.md">跳转</a> </p><p>SELinux 是一种强制访问控制（MAC）安全机制，作为 Linux 内核的安全模块，它弥补了传统 Linux 自主访问控制的缺陷，从内核层面强化系统安全。</p><p><strong>工作过程</strong></p><p><img src="https://d1aa036.webp.li/Build/20130809153255828" alt="img"></p><p><strong>三种工作模式</strong></p><table><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>enforcing</td><td>强制模式，正常加载并执行策略，拦截违规访问并记录日志</td></tr><tr><td>permissive</td><td>宽容模式，不拦截违规操作，仅记录日志，常用于调试策略</td></tr><tr><td>disabled</td><td>关闭模式，SELinux 完全不生效</td></tr></tbody></table><h2 id="2-SELiunx实验"><a href="#2-SELiunx实验" class="headerlink" title="2.SELiunx实验"></a>2.SELiunx实验</h2><h3 id="2-1-实验1：SELiunx端口限制实践"><a href="#2-1-实验1：SELiunx端口限制实践" class="headerlink" title="2.1.实验1：SELiunx端口限制实践"></a>2.1.实验1：SELiunx端口限制实践</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#前置</span></span><br><span class="line">systemctl start nginx</span><br><span class="line">setroubleshoot<span class="comment"># 提供解决方案</span></span><br><span class="line"><span class="comment">#检查</span></span><br><span class="line">[root@server ~]# systemctl status nginx</span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line">[root@server ~]# ps -axZ | grep nginx</span><br><span class="line">[root@server ~]# systemctl stop nginx</span><br><span class="line">[root@server ~]# semanage port -l | grep http</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">[root@server ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen  84;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">[root@server ~]# systemctl start nginx</span><br><span class="line">Job <span class="keyword">for</span> nginx.service failed because the control process exited with error code.</span><br><span class="line">See <span class="string">&quot;systemctl status nginx.service&quot;</span> and <span class="string">&quot;journalctl -xeu nginx.service&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">[root@server ~]# dnf install setroubleshoot</span><br><span class="line"><span class="comment">#查看日志</span></span><br><span class="line">[root@server ~]# <span class="built_in">tail</span> -f /var/log/messages</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-21_00-17-36.png" alt="PixPin_2025-11-21_00-17-36"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据日志进行配置</span></span><br><span class="line">[root@server ~]# semanage port -a -t http_port_t -p tcp 82</span><br><span class="line">[root@server ~]# semanage port -l | grep http</span><br><span class="line">[root@server ~]# systemctl restart nginx</span><br></pre></td></tr></table></figure><h3 id="2-2-实验2：SELiunx类型限制实践-管理安全上下文"><a href="#2-2-实验2：SELiunx类型限制实践-管理安全上下文" class="headerlink" title="2.2.实验2：SELiunx类型限制实践-管理安全上下文"></a>2.2.实验2：SELiunx类型限制实践-管理安全上下文</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更改SELinux模式为Permissive</span></span><br><span class="line">[root@server ~]# setenforce 0</span><br><span class="line">[root@server ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建网页页面</span></span><br><span class="line">[root@server ~]# <span class="built_in">mkdir</span> /web</span><br><span class="line">[root@server ~]# <span class="built_in">echo</span> “SELiunx 82” &gt; /web/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改nginx配置</span></span><br><span class="line">[root@server ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">        listen       82;</span><br><span class="line">        root         /web;</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-21_23-34-19.png" alt="PixPin_2025-11-21_23-34-19"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">[root@server ~]# systemctl restart nginx.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改SELinux模式为Enforcing</span></span><br><span class="line">[root@server ~]# setenforce 1</span><br><span class="line">[root@server ~]# getenforce </span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志</span></span><br><span class="line">[root@server ~]# <span class="built_in">tail</span> -f /var/log/messages</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试curl网页</span></span><br><span class="line">[root@server ~]# curl 192.168.232.133:82</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.20.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="comment">#发现失败，返回403</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-21_23-39-36.png" alt="PixPin_2025-11-21_23-39-36"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看日志报错</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-21_23-40-49.png" alt="PixPin_2025-11-21_23-40-49"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据日志报错修改index文件标签</span></span><br><span class="line">[root@server ~]# semanage fcontext -a -t httpd_sys_content_t <span class="string">&#x27;/web/index.html&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件</span></span><br><span class="line">[root@server ~]# restorecon  -R  -v  /web/index.html</span><br><span class="line">Relabeled /web/index.html from unconfined_u:object_r:default_t:s0 to unconfined_u:object_r:httpd_sys_content_t:s0</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新测试</span></span><br><span class="line">[root@server ~]# curl 192.168.232.133:82</span><br><span class="line">SELiunx 82</span><br></pre></td></tr></table></figure><h3 id="2-3-实验3：SELiunx类型限制实践"><a href="#2-3-实验3：SELiunx类型限制实践" class="headerlink" title="2.3.实验3：SELiunx类型限制实践"></a>2.3.实验3：SELiunx类型限制实践</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装与启动</span></span><br><span class="line">[root@server ~]# dnf install  nginx  -y </span><br><span class="line">[root@server ~]# yum install setroubleshoot -y</span><br><span class="line">[root@server ~]# systemctl start nginx</span><br><span class="line">[root@server ~]# systemctl start setroubleshootd.service </span><br><span class="line"></span><br><span class="line">[root@server ~]# <span class="built_in">mkdir</span> -p /web/http</span><br><span class="line">[root@server ~]# <span class="built_in">echo</span> <span class="string">&quot;SELinux 84&quot;</span> &gt; /web/http/index.html</span><br><span class="line">[root@server ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       84</span><br><span class="line">        root         /web/http;</span><br><span class="line">        &#125;</span><br><span class="line">[root@server ~]# systemctl restart nginx.service </span><br><span class="line">Job <span class="keyword">for</span> nginx.service failed because the control process exited with error code.</span><br><span class="line">See <span class="string">&quot;systemctl status nginx.service&quot;</span> and <span class="string">&quot;journalctl -xeu nginx.service&quot;</span> <span class="keyword">for</span> details.     </span><br><span class="line">[root@server ~]# semanage port -a -t http_port_t -p tcp 84</span><br><span class="line">[root@server ~]# systemctl restart nginx.service </span><br><span class="line"></span><br><span class="line">[root@server ~]# curl 192.168.232.133:84</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.20.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root@server ~]# semanage fcontext -a -t httpd_sys_content_t  <span class="string">&#x27;/web/http/index.html&#x27;</span></span><br><span class="line">[root@server ~]# systemctl restart nginx.service </span><br><span class="line">[root@server ~]# curl 192.168.232.133:84</span><br><span class="line">SELinux 84</span><br></pre></td></tr></table></figure><h1 id="25-11-15-iptables-firewall"><a href="#25-11-15-iptables-firewall" class="headerlink" title="25-11-15(iptables&#x2F;firewall)"></a>25-11-15(iptables&#x2F;firewall)</h1><h2 id="1-防火墙理论"><a href="#1-防火墙理论" class="headerlink" title="1.防火墙理论"></a>1.防火墙理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/08%E9%98%B2%E7%81%AB%E5%A2%99%E7%90%86%E8%AE%BA.md">跳转</a></p><h3 id="1-1-iptables基本命令"><a href="#1-1-iptables基本命令" class="headerlink" title="1.1.iptables基本命令"></a>1.1.iptables基本命令</h3><p><strong>安装iptables</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、RHEL9默认使用firewalld，需先禁用firewalld并安装iptables服务：</span></span><br><span class="line">[root@hym ~]# systemctl stop firewalld</span><br><span class="line">[root@hym ~]# systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">[root@hym ~]# systemctl mask firewalld</span><br><span class="line"><span class="comment">#2、安装iptables</span></span><br><span class="line">dnf install iptables-services -y</span><br><span class="line">systemctl <span class="built_in">enable</span> --now iptables.service</span><br><span class="line">systemctl status iptables.service</span><br></pre></td></tr></table></figure><p><strong>增删改查</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.增加</span></span><br><span class="line"><span class="comment">#1.1追加到末尾</span></span><br><span class="line">   iptables -A INPUT -p tcp --dport 22 -j ACCEPT  <span class="comment">#允许SSH通过TCP 22端口（追加到INPUT链末尾）</span></span><br><span class="line"><span class="comment">#1.2插入规则到链的指定位置</span></span><br><span class="line">iptables -I INPUT 2 -s 192.168.1.0/24 -j DROP  <span class="comment">#在INPUT链的第2条位置插入规则，丢弃来自192.168.1.0/24网段的所有流量</span></span><br><span class="line"><span class="comment">#1.3指定表（如filter表）插入规则</span></span><br><span class="line">iptables -t filter -I FORWARD -d 192.168.10.182 -p tcp --dport 80:443 -j ACCEPT  <span class="comment">#允许目标为192.168.10.182的TCP 80-443端口流量通过FORWARD链</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2.删除</span></span><br><span class="line">iptables -t 表名 -F 链名<span class="comment">#清空指定链</span></span><br><span class="line">iptables -t 表名 -F<span class="comment">#清空当前表的所有链(默认 `filter` 表)</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3.查询</span></span><br><span class="line">iptables -L -t filter -n  <span class="comment">#查看指定表</span></span><br><span class="line">iptables -L -nv   -t filter   --line-numbers <span class="comment">#查看所有链上的   指定表（ -t fileter ）的所有规则</span></span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/iptables   <span class="comment">#规则链存储文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>相关命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看指定表</span></span><br><span class="line">[root@localhost ~]# iptables -L -t mangle  -n</span><br><span class="line">[root@localhost ~]# iptables -L -t nat -n</span><br><span class="line">[root@localhost ~]# iptables -L -t raw -n </span><br><span class="line">[root@localhost ~]# iptables -L -t filter -n</span><br><span class="line"></span><br><span class="line"><span class="comment">#规则链存储文件</span></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有链上的   指定表（ -t fileter ）的所有规则</span></span><br><span class="line"> iptables -L -nv   -t filter   --line-numbers</span><br></pre></td></tr></table></figure><h2 id="2-防火墙实验"><a href="#2-防火墙实验" class="headerlink" title="2.防火墙实验"></a>2.防火墙实验</h2><h3 id="2-1-firewall实验"><a href="#2-1-firewall实验" class="headerlink" title="2.1.firewall实验"></a>2.1.firewall实验</h3><h4 id="2-1-1-firewalld区域添加http服务，使其为放行状态"><a href="#2-1-1-firewalld区域添加http服务，使其为放行状态" class="headerlink" title="2.1.1.firewalld区域添加http服务，使其为放行状态"></a>2.1.1.firewalld区域添加http服务，使其为放行状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装nginxa</span></span><br><span class="line">[root@server ~]# dnf install -y nginx</span><br><span class="line">[root@server ~]# <span class="built_in">echo</span> <span class="string">&quot;firewalld&quot;</span> &gt; /usr/share/nginx/html/index.html</span><br><span class="line">[root@server ~]# systemctl restart nginx.service</span><br><span class="line"></span><br><span class="line">[root@server ~]# firewall-cmd --get-default-zone </span><br><span class="line">public</span><br><span class="line">[root@server ~]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens160</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client ssh</span><br><span class="line">  ports: </span><br><span class="line">  protocols: </span><br><span class="line">  forward: <span class="built_in">yes</span></span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br><span class="line">  </span><br><span class="line">  [root@server ~]# firewall-cmd --permanent --zone=public --add-service=http</span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd --permanent --zone=public --add-port=80/tcp</span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd --reload </span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@server ~]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens160</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client http ssh</span><br><span class="line">  ports: 80/tcp</span><br><span class="line">  protocols: </span><br><span class="line">  forward: <span class="built_in">yes</span></span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure><h4 id="2-1-2-某些服务需要编辑zone文件才能添加服务，添加nginx服务"><a href="#2-1-2-某些服务需要编辑zone文件才能添加服务，添加nginx服务" class="headerlink" title="2.1.2.某些服务需要编辑zone文件才能添加服务，添加nginx服务"></a>2.1.2.某些服务需要编辑zone文件才能添加服务，添加nginx服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> firewall-cmd   --add-service=nginx  --permanent# 查看所有区域支持的服务</span><br><span class="line">[root@server ~]# firewall-cmd   --get-services</span><br><span class="line"></span><br><span class="line">[root@server ~]#  firewall-cmd --permanent  --add-service=nginx  </span><br><span class="line">Error: INVALID_SERVICE: Zone <span class="string">&#x27;public&#x27;</span>: <span class="string">&#x27;nginx&#x27;</span> not among existing services</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@server ~]# <span class="built_in">cp</span> -a  /usr/lib/firewalld/services/http.xml    /usr/lib/firewalld/services/nginx.xml</span><br><span class="line">[root@server ~]# vim /usr/lib/firewalld/services/nginx.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;service&gt;</span><br><span class="line">  &lt;short&gt;nginx&lt;/short&gt;</span><br><span class="line">  &lt;description&gt;&lt;/description&gt;</span><br><span class="line">  &lt;port protocol=<span class="string">&quot;tcp&quot;</span> port=<span class="string">&quot;80&quot;</span>/&gt;</span><br><span class="line">  &lt;port protocol=<span class="string">&quot;tcp&quot;</span> port=<span class="string">&quot;443&quot;</span>/&gt;</span><br><span class="line">&lt;/service&gt;</span><br><span class="line"></span><br><span class="line">[root@server ~]#  firewall-cmd --permanent  --add-service=nginx</span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd   --reload </span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd  --zone=public  --list-service</span><br><span class="line">cockpit dhcpv6-client http nginx ssh</span><br><span class="line">[root@server ~]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: ens160</span><br><span class="line">  sources: </span><br><span class="line">  services: cockpit dhcpv6-client http nginx ssh</span><br><span class="line">  ports: 80/tcp</span><br><span class="line">  protocols: </span><br><span class="line">  forward: <span class="built_in">yes</span></span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure><h4 id="2-1-3-禁止192-168-48-0-24-网段的地址进行ping"><a href="#2-1-3-禁止192-168-48-0-24-网段的地址进行ping" class="headerlink" title="2.1.3.禁止192.168.48.0&#x2F;24 网段的地址进行ping"></a>2.1.3.禁止192.168.48.0&#x2F;24 网段的地址进行ping</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# man firewalld.richlanguage</span><br><span class="line"></span><br><span class="line">[root@server ~]# firewall-cmd  --permanent  --add-rich-rule=<span class="string">&#x27;rule  family=&quot;ipv4&quot;  source address=&quot;192.168.232.0/24&quot; protocol  value=&quot;icmp&quot;  reject&#x27;</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd  --reload</span><br><span class="line">success</span><br><span class="line"><span class="comment">#测试</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-22_14-24-30.png" alt="PixPin_2025-11-22_14-24-30"></p><h4 id="2-1-4-端口转发"><a href="#2-1-4-端口转发" class="headerlink" title="2.1.4.端口转发"></a>2.1.4.端口转发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# dnf install net-tools -y</span><br><span class="line">[root@server ~]# netstat  -lntup | grep nginx</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1783/nginx: master  </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      1783/nginx: master </span><br><span class="line">[root@server ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">[root@server ~]# setenforce 0       </span><br><span class="line">[root@server ~]# systemctl restart nginx.service </span><br><span class="line">[root@server ~]# vim /etc/nginx/nginx.conf</span><br><span class="line">[root@server ~]# setenforce 0</span><br><span class="line">[root@server ~]# systemctl res</span><br><span class="line">rescue        reset-failed  restart       </span><br><span class="line">[root@server ~]# systemctl restart nginx.service </span><br><span class="line">[root@server ~]# firewall-cmd  --permanent --add-rich-rule=<span class="string">&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.232.1&quot; forward-port port=&quot;80&quot; protocol=&quot;tcp&quot; to-port=&quot;99&quot;&#x27;</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]# firewall-cmd  --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-11-22_14-46-55.png" alt="PixPin_2025-11-22_14-46-55"></p><h1 id="25-12-3-LNMP"><a href="#25-12-3-LNMP" class="headerlink" title="25-12-3(LNMP)"></a>25-12-3(LNMP)</h1><h2 id="1-LNMP理论"><a href="#1-LNMP理论" class="headerlink" title="1.LNMP理论"></a>1.LNMP理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/09LNMP%E6%90%AD%E5%BB%BA%E8%AE%BA%E5%9D%9B.md">跳转</a></p><h2 id="2-LNMP搭建实验"><a href="#2-LNMP搭建实验" class="headerlink" title="2.LNMP搭建实验"></a>2.LNMP搭建实验</h2><h3 id="2-1-编写脚本"><a href="#2-1-编写脚本" class="headerlink" title="2.1.编写脚本"></a>2.1.编写脚本</h3><h4 id="2-1-1-基础配置脚本sys-sh"><a href="#2-1-1-基础配置脚本sys-sh" class="headerlink" title="2.1.1.基础配置脚本sys.sh"></a>2.1.1.基础配置脚本sys.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sys.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#1.安装基础软件</span></span><br><span class="line"><span class="function"><span class="title">install_app</span></span>() &#123;</span><br><span class="line">        yum install httpd mariadb-server php php-fpm php-mysqlnd nginx -y &gt;/dev/null</span><br><span class="line">        yum install zip -y &gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#2.创建目录</span></span><br><span class="line"><span class="function"><span class="title">dir_create</span></span>() &#123;</span><br><span class="line">        <span class="built_in">mkdir</span> -p /web/ssl /web/www</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#3.创建https证书</span></span><br><span class="line"><span class="function"><span class="title">ssl</span></span>() &#123;</span><br><span class="line">        openssl genrsa --out /web/ssl/ssl.key</span><br><span class="line">        openssl req -utf8 -new -key /web/ssl/ssl.key -x509 -days 100 -out /web/ssl/ssl.crt \</span><br><span class="line">        -subj <span class="string">&quot;/C=CN/ST=HuNan/L=Changsha/O=./OU=./CN=www.hym.com/emailAddress=admin@hym.com&quot;</span> &gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#4.http前置</span></span><br><span class="line"><span class="function"><span class="title">http</span></span>() &#123;</span><br><span class="line">        unzip Dis* -d /web/www  &gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;解压成功&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;解压失败&quot;</span></span><br><span class="line">        <span class="built_in">cd</span> /web/www/upload/</span><br><span class="line">        <span class="built_in">chmod</span> -R 777 config/ uc_* data</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#关闭安全措施</span></span><br><span class="line"><span class="function"><span class="title">safe</span></span>() &#123;</span><br><span class="line">        setenforce 0</span><br><span class="line">        systemctl <span class="built_in">disable</span> --now firewalld &gt;/dev/null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-2-应用配置脚本app-sh"><a href="#2-1-2-应用配置脚本app-sh" class="headerlink" title="2.1.2.应用配置脚本app.sh"></a>2.1.2.应用配置脚本app.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Nginx</span></span><br><span class="line"><span class="function"><span class="title">nginx_config</span></span>() &#123;</span><br><span class="line">        <span class="built_in">mv</span> /root/nginx.conf /etc/nginx/conf.d/nginx.conf &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        systemctl restart nginx &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#mysql</span></span><br><span class="line"><span class="function"><span class="title">mysql_config</span></span>() &#123;</span><br><span class="line">        systemctl start mariadb &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">        mysql -u root -e <span class="string">&quot;</span></span><br><span class="line"><span class="string">        alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;passwd&#x27;;</span></span><br><span class="line"><span class="string">        create database luntan;</span></span><br><span class="line"><span class="string">        flush privileges; &quot;</span> &gt;/dev/null 2&gt;&amp;1 \</span><br><span class="line">        &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;你的数据库名为luntan,密码为passwd&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-1-3-运行脚本do-sh"><a href="#2-1-3-运行脚本do-sh" class="headerlink" title="2.1.3.运行脚本do.sh"></a>2.1.3.运行脚本do.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#do.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span> sys.sh</span><br><span class="line"><span class="built_in">source</span> app.sh</span><br><span class="line"><span class="comment">#关闭防火墙</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">safe</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 防火墙关闭 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> 防火墙关闭 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#1.软件安装</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">install_app</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 软件安装 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> 软件安装 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#2.创建目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">dir_create</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 目录创建 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> 目录创建 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#3.创建https证书</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">ssl</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 证书创建 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> 证书创建 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#4.http搭建</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">http</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> http配置 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> http配置 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#5.nginx配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">nginx_config</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> nginx配置 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> nginx配置 失败</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#6.mysql配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==============&quot;</span></span><br><span class="line">mysql_config</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> mysql配置 成功</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> mysql配置 失败</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        root /web/www/upload;</span><br><span class="line">        include /etc/nginx/default.d/php.conf;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        root /web/www/upload;</span><br><span class="line">        include /etc/nginx/default.d/php.conf;</span><br><span class="line"></span><br><span class="line">        ssl_certificate <span class="string">&quot;/web/ssl/ssl.crt&quot;</span>;</span><br><span class="line">        ssl_certificate_key <span class="string">&quot;/web/ssl/ssl.key&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-运行"><a href="#2-2-运行" class="headerlink" title="2.2.运行"></a>2.2.运行</h3><h4 id="2-2-1-准备文件"><a href="#2-2-1-准备文件" class="headerlink" title="2.2.1.准备文件"></a>2.2.1.准备文件</h4><p><img src="https://b5dbf24.webp.li/PixPin_2025-12-05_17-08-59.png" alt="PixPin_2025-12-05_17-08-59"></p><h4 id="2-2-2-运行shell脚本"><a href="#2-2-2-运行shell脚本" class="headerlink" title="2.2.2.运行shell脚本"></a>2.2.2.运行shell脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# bash do.sh </span><br><span class="line">==============</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.</span><br><span class="line">防火墙关闭 成功</span><br><span class="line">==============</span><br><span class="line">软件安装 成功</span><br><span class="line">==============</span><br><span class="line">目录创建 成功</span><br><span class="line">==============</span><br><span class="line">证书创建 成功</span><br><span class="line">==============</span><br><span class="line">解压成功</span><br><span class="line">http配置 成功</span><br><span class="line">==============</span><br><span class="line">nginx配置 成功</span><br><span class="line">==============</span><br><span class="line">你的数据库名为luntan,密码为passwd</span><br><span class="line">mysql配置 成功</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-12-05_17-16-50.png" alt="PixPin_2025-12-05_17-16-50"></p><h3 id="2-3-测试"><a href="#2-3-测试" class="headerlink" title="2.3.测试"></a>2.3.测试</h3><p><img src="https://b5dbf24.webp.li/PixPin_2025-12-05_17-17-42.png" alt="PixPin_2025-12-05_17-17-42"></p><p><img src="https://b5dbf24.webp.li/PixPin_2025-12-05_17-18-19.png" alt="PixPin_2025-12-05_17-18-19"></p><h1 id="25-12-13-SHELL"><a href="#25-12-13-SHELL" class="headerlink" title="25-12-13(SHELL)"></a>25-12-13(SHELL)</h1><h2 id="1-SHELL理论"><a href="#1-SHELL理论" class="headerlink" title="1.SHELL理论"></a>1.SHELL理论</h2><table><thead><tr><th>01 入门：</th><th align="center">02 变量：</th><th align="center">03 条件测试：</th><th align="center">04 流程判断：</th><th align="center">05 函数：</th><th align="center">06 数组：</th><th align="center">07 grep:</th><th align="center">08 sed:</th><th align="center">09 awk:</th></tr></thead><tbody><tr><td><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_1SHELL01-%E5%85%A5%E9%97%A8.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_2SHELL02-%E5%8F%98%E9%87%8F.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_3SHELL03-%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%20.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_4SHELL04-%E6%B5%81%E7%A8%8B%E5%88%A4%E6%96%AD.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_5SHELL05-%E5%87%BD%E6%95%B0.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_5SHELL05-%E6%95%B0%E7%BB%84.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_6SHELL06-grep.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_7SHELL07-sed.md">跳转</a></td><td align="center"><a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/10_8SHELL08-awk.md">跳转</a></td></tr></tbody></table><h2 id="2-SHELL实验"><a href="#2-SHELL实验" class="headerlink" title="2.SHELL实验:"></a>2.SHELL实验:</h2><h3 id="2-1-实验1：提示用户输入用户名称，判断用户是否存在。"><a href="#2-1-实验1：提示用户输入用户名称，判断用户是否存在。" class="headerlink" title="2.1.实验1：提示用户输入用户名称，判断用户是否存在。"></a>2.1.实验1：提示用户输入用户名称，判断用户是否存在。</h3><blockquote><p>附加要求：无论存在与否都初始化用户密码为redhat，如果用户不存在就创建用户，然后初始化密码为redhat</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@hym ~]# vim /check_user.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">passwd_init</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;正在初始化密码...&quot;</span></span><br><span class="line">        passwd <span class="variable">$name</span> &lt;&lt;<span class="string">end &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"><span class="string">        redhat</span></span><br><span class="line"><span class="string">        redhat</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;初始化成功，初始密码为redhat&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入用户名称：&quot;</span> name</span><br><span class="line"><span class="built_in">id</span> <span class="variable">$name</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$name</span> 已存在&quot;</span></span><br><span class="line">        passwd_init</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;正在创建用户<span class="variable">$name</span>&quot;</span></span><br><span class="line">        useradd <span class="variable">$name</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;用户<span class="variable">$name</span>创建成功.&quot;</span></span><br><span class="line">        passwd_init</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2026-01-13_23-06-17.png" alt="PixPin_2026-01-13_23-06-17"></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="https://b5dbf24.webp.li/PixPin_2026-01-13_23-10-39.png" alt="PixPin_2026-01-13_23-10-39"></p><h3 id="2-1-实验2：创建一个简单的系统信息报告脚本，输出基本的系统状态信息"><a href="#2-1-实验2：创建一个简单的系统信息报告脚本，输出基本的系统状态信息" class="headerlink" title="2.1 实验2：创建一个简单的系统信息报告脚本，输出基本的系统状态信息"></a>2.1 实验2：创建一个简单的系统信息报告脚本，输出基本的系统状态信息</h3><blockquote><p>附加：当前登录用户名称、报告生成时间、磁盘使用情况、内存使用情况</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@hym shell]# vim sys.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出报告</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====系统基本信息====&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前用户:&quot;</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----磁盘使用情况----&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----内存使用情况----&quot;</span></span><br><span class="line">free -h</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;生成时间:&quot;</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;====报告结束====&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2026-01-14_20-52-19.png" alt="PixPin_2026-01-14_20-52-19"></p><h3 id="2-2-实验3：检查文件"><a href="#2-2-实验3：检查文件" class="headerlink" title="2.2 实验3：检查文件"></a>2.2 实验3：检查文件</h3><blockquote><p>检查文件 <code>/etc/passwd</code>是否存在 <strong>并且</strong> 可读，如果两个条件都满足，则输出”文件存在且可读”，否则输出相应错误信息。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@hym shell]# vim check.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">file=<span class="string">&quot;/etc/passw&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ] &amp;&amp; [ -r <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$file</span> 存在且可读&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">        [ -e <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ] || <span class="string">&quot;<span class="variable">$file</span> 不存在&quot;</span></span><br><span class="line"></span><br><span class="line">        [ -r <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ] || <span class="string">&quot;<span class="variable">$file</span> 不可读&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@hym shell]# bash check.sh</span><br><span class="line">/etc/passwd 存在且可读</span><br><span class="line"></span><br><span class="line">[root@hym shell]# bash check.sh</span><br><span class="line">check.sh:行4: /etc/passw 不存在: 没有那个文件或目录</span><br><span class="line">check.sh:行5: /etc/passw 不可读: 没有那个文件或目录</span><br></pre></td></tr></table></figure><h1 id="25-12-20-Ansible"><a href="#25-12-20-Ansible" class="headerlink" title="25-12-20(Ansible)"></a>25-12-20(Ansible)</h1><h2 id="1-Ansible理论"><a href="#1-Ansible理论" class="headerlink" title="1.Ansible理论"></a>1.Ansible理论</h2><p><strong>理论部分参考</strong>  <a href="https://gitee.com/kaitumei/note/blob/master/Liunx/02RHCE/11ansiblemd%E7%90%86%E8%AE%BA.md">跳转</a></p><h2 id="2-Ansible实验"><a href="#2-Ansible实验" class="headerlink" title="2.Ansible实验:"></a>2.Ansible实验:</h2><h3 id="2-1-用ansible命令行实现nginx部署修改端口号"><a href="#2-1-用ansible命令行实现nginx部署修改端口号" class="headerlink" title="2.1.用ansible命令行实现nginx部署修改端口号"></a>2.1.用ansible命令行实现nginx部署修改端口号</h3><h5 id="2-1-1-建立连接"><a href="#2-1-1-建立连接" class="headerlink" title="2.1.1.建立连接"></a>2.1.1.建立连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]vim /hosts</span><br><span class="line">    [server]</span><br><span class="line">    192.168.232.134</span><br><span class="line">[root@client ~]vim /auth.yml    </span><br><span class="line">---</span><br><span class="line">- hosts: server          <span class="comment"># 目标主机组（对应你清单里的[newserver]）</span></span><br><span class="line">  gather_facts: no          <span class="comment"># 关闭事实收集（首次推送公钥时，受控节点可能未配置Python依赖）</span></span><br><span class="line">  vars:</span><br><span class="line">    ansible_ssh_pass: <span class="string">&quot;passwd&quot;</span></span><br><span class="line">    ansible_host_key_checking: False</span><br><span class="line">  tasks:</span><br><span class="line">    - name: 给root用户添加SSH公钥（Ansible管理）</span><br><span class="line">      authorized_key:</span><br><span class="line">        user: root                    <span class="comment"># 指定目标用户（必填）</span></span><br><span class="line">        state: present                <span class="comment"># 确保公钥存在（添加）</span></span><br><span class="line">        key: <span class="string">&quot;&#123;&#123; lookup(&#x27;file&#x27;, &#x27;/root/.ssh/id_rsa.pub&#x27;) &#125;&#125;&quot;</span>  <span class="comment"># 读取本地公钥</span></span><br><span class="line">[root@client ~]# ansible-playbook -i /hosts /auth.yml</span><br><span class="line"></span><br><span class="line">PLAY [server] ******************************************************************</span><br><span class="line"></span><br><span class="line">TASK [给root用户添加SSH公钥（Ansible管理）] ************************************</span><br><span class="line">changed: [192.168.232.134]</span><br><span class="line"></span><br><span class="line">PLAY RECAP *********************************************************************</span><br><span class="line">192.168.232.134            : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 </span><br></pre></td></tr></table></figure><h5 id="2-1-2-创建目录"><a href="#2-1-2-创建目录" class="headerlink" title="2.1.2.创建目录"></a>2.1.2.创建目录</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vim file.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /ansible</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /ansible/roles/warehouse/&#123;vars,tasks&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /ansible/roles/safety/&#123;vars,tasks&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /ansible/roles/web/&#123;vars,tasks&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /ansible/site.yml</span><br></pre></td></tr></table></figure><p><img src="https://b5dbf24.webp.li/PixPin_2025-12-20_19-31-39.png" alt="PixPin_2025-12-20_19-31-39"></p><h5 id="2-1-3-编写相关配置"><a href="#2-1-3-编写相关配置" class="headerlink" title="2.1.3.编写相关配置"></a>2.1.3.编写相关配置</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@client</span> <span class="string">~</span>]<span class="comment"># cat /ansible/site.yml </span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.232</span><span class="number">.134</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">warehouse</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">safety</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">web</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@client</span> <span class="string">~</span>]<span class="comment"># vim /ansible/roles/warehouse/tasks/main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">挂载</span></span><br><span class="line">  <span class="attr">mount:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/mnt</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/dev/sr0</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">mounted</span></span><br><span class="line">    <span class="attr">fstype:</span> <span class="string">iso9660</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">配置仓库源1</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">cangku</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">base</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">base</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">/mnt/BaseOS</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">配置仓库源2</span></span><br><span class="line">  <span class="attr">yum_repository:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">cangku</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">gpgcheck:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">baseurl:</span> <span class="string">/mnt/AppStream</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@client</span> <span class="string">~</span>]<span class="comment"># vim /ansible/roles/safety/tasks/main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SELinx设置宽容模式</span></span><br><span class="line">  <span class="attr">ansible.builtin.selinux:</span></span><br><span class="line">    <span class="attr">policy:</span> <span class="string">targeted</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">permissive</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">放行89端口</span></span><br><span class="line">  <span class="attr">ansible.builtin.firewalld:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">89</span><span class="string">/tcp</span></span><br><span class="line">    <span class="attr">permanent:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">immediate:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">enabled</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@client</span> <span class="string">~</span>]<span class="comment"># vim /ansible/roles/web/tasks/main.yml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装nginx</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">启动nginx</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">修改端口号</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^(\s*)listen\s.*;&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27;\1listen 89;&#x27;</span></span><br><span class="line">    <span class="attr">backup:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">backrefs:</span> <span class="literal">yes</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">重启配置</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><h5 id="2-1-4-测试"><a href="#2-1-4-测试" class="headerlink" title="2.1.4.测试"></a>2.1.4.测试</h5><p><img src="https://b5dbf24.webp.li/image-20251220194237778.png" alt="image-20251220194237778"></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> RHCE </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
