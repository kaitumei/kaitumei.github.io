function initEssayBar(){const e=document.querySelector(".essay-bar-list");if(!e)return;const t=e.querySelectorAll(".essay-bar-item");if(t.length<=1)return void(1===t.length&&t[0].classList.add("active"));let n=0;t[n].classList.add("active"),setInterval(()=>{const e=(n+1)%t.length;t[n].classList.remove("active"),t[n].classList.add("exit"),t[e].classList.add("active"),t[e].classList.remove("exit"),setTimeout(()=>{t[n].classList.remove("exit"),n=e},500)},4e3)}function showToast(e,t=2e3){const n="dark"===document.documentElement.getAttribute("data-theme")||document.body.classList.contains("DarkMode");let o=document.getElementById("toast-container");o||(o=document.createElement("div"),o.id="toast-container",o.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 9999;\n            pointer-events: none;\n        ",document.body.appendChild(o));const r=o.lastElementChild;if(r&&r.textContent.includes(e))return;const s=document.createElement("div");s.innerHTML=`\n        <span style="margin-right: 8px;">üòä</span>\n        <span>${e}</span>\n    `;const a=n?{background:"#1e293b",border:"1px solid #475569",color:"#e2e8f0",boxShadow:"0 4px 12px rgba(0,0,0,0.4)"}:{background:"#f0f9ff",border:"1px solid #bfdbfe",color:"#1e293b",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"};s.style.cssText=`\n        display: flex;\n        align-items: center;\n        margin-bottom: 10px;\n        padding: 12px 16px;\n        background: ${a.background};\n        border: ${a.border};\n        color: ${a.color};\n        border-radius: 8px;\n        box-shadow: ${a.boxShadow};\n        transform: translateX(100%);\n        transition: all 0.3s ease;\n        pointer-events: auto;\n        max-width: 320px;\n        word-break: break-word;\n        font-size: 14px;\n        line-height: 1.4;\n        cursor: pointer;\n    `,o.appendChild(s),setTimeout(()=>{s.style.transform="translateX(0)"},10),setTimeout(()=>{s.style.transform="translateX(100%)",s.style.opacity="0",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},t),s.addEventListener("click",()=>{s.style.transform="translateX(100%)",s.style.opacity="0",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)})}function toRandomPost(){showToast("Ê≠£Âú®ÂØªÊâæÈöèÊú∫ÊñáÁ´†...",1e3),fetch("/search.xml").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()}).then(e=>(new window.DOMParser).parseFromString(e,"text/xml")).then(e=>{const t=e.querySelectorAll("entry");if(t.length>0){const e=t[Math.floor(Math.random()*t.length)].querySelector("url").textContent;window.location.href=e}else showToast("ÊöÇÊó∂Ê≤°ÊúâÊñáÁ´†ÂèØ‰ª•ÈöèÊú∫Âì¶~")}).catch(e=>{console.error("Error fetching search.xml:",e),fetch("/content.json").then(e=>e.json()).then(e=>{if(Array.isArray(e)&&e.length>0){const t=e[Math.floor(Math.random()*e.length)];window.location.href=t.path||t.url}else showToast("ÈöèÊú∫ÊñáÁ´†ÂäüËÉΩÊöÇÊó∂‰∏çÂèØÁî®~")}).catch(e=>{console.error("Error fetching content.json:",e),showToast("Ëé∑ÂèñÊñáÁ´†ÂàóË°®Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï~")})})}function init404Page(){const e=document.getElementById("body-wrap");if(e&&e.classList.contains("type-404"))document.body.classList.add("is-404");else if(!location.pathname.includes("404"))return void document.body.classList.remove("is-404");const t=document.querySelector(".error-info");if(t&&!document.querySelector(".error_actions")){console.log("Detected 404 page, injecting buttons...");const e=document.querySelector(".error-content");e&&(e.style.height="auto",e.style.minHeight="360px");const n=document.createElement("div");n.className="error_actions",n.style.cssText="margin-top: 40px; display: flex; gap: 20px; justify-content: center; width: 100%;";const o="\n            padding: 10px 30px;\n            border-radius: 30px;\n            background: var(--btn-bg, #49b1f5);\n            color: var(--btn-color, #fff);\n            text-decoration: none;\n            transition: all 0.3s;\n            display: flex;\n            align-items: center;\n            cursor: pointer;\n            box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            font-size: 15px;\n            font-weight: bold;\n            letter-spacing: 1px;\n        ",r=document.createElement("a");r.href="/",r.innerHTML='<i class="fas fa-home" style="margin-right:8px"></i> ËøîÂõûÈ¶ñÈ°µ',r.style.cssText=o,r.onmouseenter=()=>{r.style.transform="translateY(-3px)",r.style.boxShadow="0 6px 12px rgba(0,0,0,0.2)"},r.onmouseleave=()=>{r.style.transform="translateY(0)",r.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"},n.appendChild(r);const s=document.createElement("a");s.href="javascript:void(0);",s.onclick=toRandomPost,s.innerHTML='<i class="fas fa-dice" style="margin-right:8px"></i> Èöè‰æøÁúãÁúã',s.style.cssText=o+"background: #FF7242;",s.onmouseenter=()=>{s.style.transform="translateY(-3px)",s.style.boxShadow="0 6px 12px rgba(0,0,0,0.2)"},s.onmouseleave=()=>{s.style.transform="translateY(0)",s.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"},n.appendChild(s),t.appendChild(n)}init404Recommendations(e)}function init404Recommendations(e){if(!e||document.getElementById("recent-posts-404"))return;const t=document.createElement("div");t.id="recent-posts-404",t.style.cssText="width: 100%; max-width: 900px; margin: 60px auto 0; opacity: 0; transform: translateY(20px); transition: all 0.6s ease-out;";const n=document.createElement("div");n.innerHTML='<i class="fas fa-random" style="margin-right:8px"></i> Èöè‰æøÁúãÁúã',n.style.cssText="text-align: center; margin-bottom: 20px; font-size: 1.4em; font-weight: bold; color: var(--font-color);",t.appendChild(n);const o=document.createElement("div");o.style.cssText="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;",t.appendChild(o),e.appendChild(t),requestAnimationFrame(()=>{t.style.opacity="1",t.style.transform="translateY(0)"}),fetch("/random_posts.json").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(!Array.isArray(e)||0===e.length)return;e.sort(()=>.5-Math.random()).slice(0,3).forEach(e=>{let t=e.cover||"https://b5dbf24.webp.li/icons/nini.png";const n=document.createElement("div");n.className="post-item-404",n.style.cssText="\n                    width: calc(33.33% - 14px);\n                    min-width: 260px;\n                    background: rgba(255, 255, 255, 0.5);\n                    backdrop-filter: blur(10px);\n                    border-radius: 12px;\n                    padding: 12px;\n                    box-sizing: border-box;\n                    transition: all 0.3s ease;\n                    cursor: pointer;\n                    border: 1px solid rgba(255,255,255,0.4);\n                    box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n                    display: flex;\n                    flex-direction: column;\n                ","dark"===document.documentElement.getAttribute("data-theme")&&(n.style.background="rgba(50, 50, 50, 0.5)",n.style.border="1px solid rgba(255,255,255,0.1)"),n.innerHTML=`\n                    <div class="thumbnail" style="width: 100%; height: 140px; overflow: hidden; border-radius: 8px; margin-bottom: 12px;">\n                        <img src="${t}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s;" onload="this.style.opacity=1" onerror="this.src='https://unpkg.zhimg.com/hexo-theme-butterfly/source/img/404.jpg'">\n                    </div>\n                    <div class="info">\n                        <a href="${e.path}" style="color: var(--font-color); text-decoration: none; font-weight: bold; font-size: 1.1em; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4;">${e.title}</a>\n                    </div>\n                `,n.onmouseenter=()=>{n.style.transform="translateY(-5px)",n.style.boxShadow="0 8px 20px rgba(0,0,0,0.12)",n.querySelector("img").style.transform="scale(1.1)"},n.onmouseleave=()=>{n.style.transform="translateY(0)",n.style.boxShadow="0 4px 10px rgba(0,0,0,0.05)",n.querySelector("img").style.transform="scale(1)"},n.onclick=t=>{"A"!==t.target.tagName&&(window.location.href=e.path)},o.appendChild(n)})}).catch(e=>{console.error("Fetch error:",e)})}function fixSwiperClick(){const e=document.querySelectorAll('.blog-slider__item a[onclick*="pjax.loadUrl"]');0!==e.length&&e.forEach(e=>{const t=e.getAttribute("onclick");if(!t)return;const n=t.match(/pjax\.loadUrl\s*\(\s*['"]([^'"]+)['"]\s*\)/);if(n&&n[1]){const t=n[1];e.removeAttribute("onclick"),e.setAttribute("href",t),e.style.pointerEvents="auto",e.style.cursor="pointer"}})}document.addEventListener("pjax:complete",initEssayBar),document.addEventListener("DOMContentLoaded",initEssayBar),document.addEventListener("DOMContentLoaded",()=>{init404Page()}),document.addEventListener("pjax:complete",()=>{init404Page()}),document.addEventListener("DOMContentLoaded",fixSwiperClick),document.addEventListener("pjax:complete",fixSwiperClick),setTimeout(fixSwiperClick,500),setTimeout(fixSwiperClick,1500);